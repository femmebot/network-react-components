{"code":"import { mapItems, warn } from 'datx-utils';\r\nimport { intercept, isObservableArray, observable } from 'mobx';\r\nimport { FieldType } from '../../enums/FieldType';\r\nimport { ReferenceType } from '../../enums/ReferenceType';\r\nimport { BACK_REF_READ_ONLY, ID_READONLY, REF_ARRAY, REF_NEEDS_COLLECTION, REF_SINGLE, TYPE_READONLY, WRONG_REF_TYPE, } from '../../errors';\r\nimport { PureModel } from '../../PureModel';\r\nimport { storage } from '../../services/storage';\r\nimport { error } from '../format';\r\nimport { getModelCollection, getModelId, getModelMetaKey, getModelType, setModelMetaKey } from './utils';\r\nfunction modelAddReference(model, key, newReference) {\r\n    var refOptions = storage.getModelReferenceOptions(model, key);\r\n    var newRefId = getModelId(newReference);\r\n    var data = storage.getModelDataKey(model, key);\r\n    if (refOptions.type === ReferenceType.TO_ONE) {\r\n        storage.setModelDataKey(model, key, newRefId);\r\n    }\r\n    else if (refOptions.type === ReferenceType.TO_MANY || isObservableArray(data)) {\r\n        data.push(newRefId);\r\n    }\r\n    else {\r\n        storage.setModelDataKey(model, key, newReference);\r\n    }\r\n}\r\nfunction modelRemoveReference(model, key, oldReference) {\r\n    var refOptions = storage.getModelReferenceOptions(model, key);\r\n    var oldRefId = getModelId(oldReference);\r\n    var data = storage.getModelDataKey(model, key);\r\n    if (refOptions.type === ReferenceType.TO_ONE) {\r\n        storage.setModelDataKey(model, key, null);\r\n    }\r\n    else if (refOptions.type === ReferenceType.TO_MANY || isObservableArray(data)) {\r\n        data.remove(oldRefId);\r\n    }\r\n    else {\r\n        storage.setModelDataKey(model, key, null);\r\n    }\r\n}\r\nfunction ensureModel(refOptions, collection) {\r\n    return function (data) {\r\n        var model = data;\r\n        if (!(data instanceof PureModel) && typeof data === 'object') {\r\n            if (!collection) {\r\n                throw new Error(REF_NEEDS_COLLECTION);\r\n            }\r\n            model = collection.add(data, refOptions.model);\r\n        }\r\n        return getModelId(model);\r\n    };\r\n}\r\nfunction partialRefUpdate(model, key, change) {\r\n    var refOptions = storage.getModelReferenceOptions(model, key);\r\n    var data = storage.getModelDataKey(model, key);\r\n    var collection = getModelCollection(model);\r\n    if (change.type === 'splice') {\r\n        var added = change.added.map(ensureModel(refOptions, collection));\r\n        data.splice.apply(data, [change.index, change.removedCount].concat(added));\r\n        return null;\r\n    }\r\n    data[change.index] = ensureModel(refOptions, collection)(change.newValue);\r\n    return null;\r\n}\r\nfunction backRefSplice(model, key, change, refOptions) {\r\n    var property = refOptions.property;\r\n    change.added.map(function (item) { return modelAddReference(item, property, model); });\r\n    var removed = model[key].slice(change.index, change.index + change.removedCount);\r\n    removed.map(function (item) { return modelRemoveReference(item, property, model); });\r\n    return null;\r\n}\r\nfunction backRefChange(model, key, change, refOptions) {\r\n    var property = refOptions.property;\r\n    var oldValue = model[key].length > change.index ? model[key][change.index] : null;\r\n    if (change.newValue) {\r\n        modelAddReference(change.newValue, property, model);\r\n    }\r\n    if (oldValue) {\r\n        modelRemoveReference(oldValue, property, model);\r\n    }\r\n    warn(\"This shouldn't have happened. Please open an issue: https://github.com/infinum/datx/issues/new\");\r\n    return null;\r\n}\r\nfunction partialBackRefUpdate(model, key, change) {\r\n    var refOptions = storage.getModelReferenceOptions(model, key);\r\n    if (change.type === 'splice') {\r\n        return backRefSplice(model, key, change, refOptions);\r\n    }\r\n    return backRefChange(model, key, change, refOptions);\r\n}\r\nexport function getField(model, key) {\r\n    return storage.getModelDataKey(model, key);\r\n}\r\nexport function updateField(model, key, value, type) {\r\n    if (type === FieldType.TYPE) {\r\n        throw error(TYPE_READONLY);\r\n    }\r\n    else if (type === FieldType.ID) {\r\n        throw error(ID_READONLY);\r\n    }\r\n    var refs = getModelMetaKey(model, 'refs');\r\n    if (key in refs) {\r\n        updateRef(model, key, value);\r\n    }\r\n    else {\r\n        storage.setModelDataKey(model, key, value);\r\n    }\r\n}\r\nfunction hasBackRef(item, property, target) {\r\n    if (item[property] === null || item[property] === undefined) {\r\n        return false;\r\n    }\r\n    else if (item[property] instanceof PureModel) {\r\n        return item[property] === target;\r\n    }\r\n    else {\r\n        return item[property].indexOf(target) !== -1;\r\n    }\r\n}\r\nfunction getBackRef(model, key, refOptions) {\r\n    var type = getModelType(refOptions.model);\r\n    var collection = getModelCollection(model);\r\n    if (!collection) {\r\n        return null;\r\n    }\r\n    var backModels = collection\r\n        .findAll(type)\r\n        .filter(function (item) { return hasBackRef(item, refOptions.property, model); });\r\n    var backData = observable.array(backModels, { deep: false });\r\n    intercept(backData, function (change) { return partialBackRefUpdate(model, key, change); });\r\n    return backData;\r\n}\r\nfunction getNormalRef(model, key, refOptions) {\r\n    var value = storage.getModelDataKey(model, key);\r\n    var collection = getModelCollection(model);\r\n    if (!collection) {\r\n        return null;\r\n    }\r\n    var dataModels = mapItems(value, function (id) { return id ? collection.find(refOptions.model, id) : id; });\r\n    if (refOptions.type === ReferenceType.TO_MANY && !(dataModels instanceof Array)) {\r\n        dataModels = [dataModels];\r\n    }\r\n    if (dataModels instanceof Array) {\r\n        var data = observable.array(dataModels, { deep: false });\r\n        intercept(data, function (change) { return partialRefUpdate(model, key, change); });\r\n        return data;\r\n    }\r\n    return dataModels;\r\n}\r\nexport function getRef(model, key) {\r\n    var refOptions = storage.getModelReferenceOptions(model, key);\r\n    return (typeof refOptions.property === 'string')\r\n        ? getBackRef(model, key, refOptions)\r\n        : getNormalRef(model, key, refOptions);\r\n}\r\nfunction validateRef(refOptions, isArray, key) {\r\n    if (refOptions.type === ReferenceType.TO_ONE && isArray) {\r\n        throw error(REF_SINGLE, { key: key });\r\n    }\r\n    else if (refOptions.type === ReferenceType.TO_MANY && !isArray) {\r\n        throw error(REF_ARRAY, { key: key });\r\n    }\r\n    else if (refOptions.property) {\r\n        throw error(BACK_REF_READ_ONLY);\r\n    }\r\n}\r\nexport function updateRef(model, key, value) {\r\n    var refOptions = storage.getModelReferenceOptions(model, key);\r\n    var oldIds = refOptions.type === ReferenceType.TO_MANY\r\n        ? (mapItems(value, getModelId) || [])\r\n        : mapItems(value, getModelId);\r\n    var check = refOptions.type === ReferenceType.TO_MANY ? value || [] : value;\r\n    var isArray = check instanceof Array || isObservableArray(check);\r\n    validateRef(refOptions, isArray, key);\r\n    var collection = getModelCollection(model);\r\n    var ids = mapItems(value, function (ref) {\r\n        if (ref && collection) {\r\n            if (ref instanceof PureModel) {\r\n                var refType = getModelType(ref);\r\n                if (refType !== getModelType(refOptions.model)) {\r\n                    throw new Error(WRONG_REF_TYPE);\r\n                }\r\n            }\r\n            var instance = collection.find(refOptions.model, ref);\r\n            if (!instance && typeof ref === 'object') {\r\n                instance = collection.add(ref, refOptions.model);\r\n            }\r\n            return getModelId(instance || ref);\r\n        }\r\n        else if (ref instanceof PureModel) {\r\n            throw error(REF_NEEDS_COLLECTION);\r\n        }\r\n        return ref;\r\n    });\r\n    if (refOptions.type === ReferenceType.TO_MANY) {\r\n        ids = ids || [];\r\n    }\r\n    if (!ids || (ids instanceof Array && ids.length === 0)) {\r\n        storage.setModelDataKey(model, key, ids);\r\n    }\r\n    else {\r\n        storage.setModelDataKey(model, key, ids);\r\n    }\r\n}\r\nfunction getModelRefsByType(model, type) {\r\n    var refs = getModelMetaKey(model, 'refs');\r\n    return Object.keys(refs)\r\n        .filter(function (key) { return !refs[key].property; })\r\n        .filter(function (key) { return getModelType(refs[key].model) === type; });\r\n}\r\nfunction updateModelReferences(model, newId, oldId, type) {\r\n    var collection = getModelCollection(model);\r\n    if (collection) {\r\n        var allModels = collection.getAllModels().map(function (item) {\r\n            getModelRefsByType(item, type).forEach(function (ref) {\r\n                var data = storage.getModelDataKey(item, ref);\r\n                if (data instanceof Array || isObservableArray(data)) {\r\n                    var targetIndex = data.indexOf(oldId);\r\n                    if (targetIndex !== -1) {\r\n                        data[targetIndex] = newId;\r\n                    }\r\n                }\r\n                else if (data === oldId) {\r\n                    storage.setModelDataKey(item, ref, newId);\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\n/**\r\n * Updates the model identifier and all the existing references to the model\r\n *\r\n * @export\r\n * @param {PureModel} model Model to be updated\r\n * @param {IIdentifier} newId New model identifier\r\n */\r\nexport function updateModelId(model, newId) {\r\n    var collection = getModelCollection(model);\r\n    var oldId = getModelId(model);\r\n    var type = getModelType(model);\r\n    setModelMetaKey(model, 'id', newId);\r\n    var staticModel = model.constructor;\r\n    var modelId = storage.getModelClassMetaKey(staticModel, 'id');\r\n    if (modelId) {\r\n        setRefId(model, modelId, newId);\r\n    }\r\n    if (collection) {\r\n        // @ts-ignore - I'm bad and I should feel bad...\r\n        collection.__changeModelId(oldId, newId, type);\r\n    }\r\n    updateModelReferences(model, newId, oldId, type);\r\n}\r\n/**\r\n * Get the id of the referenced model\r\n *\r\n * @export\r\n * @param {PureModel} model Source model\r\n * @param {string} key Referenced model property name\r\n * @returns {IIdentifier} Referenced model id\r\n */\r\nexport function getRefId(model, key) {\r\n    return storage.getModelDataKey(model, key);\r\n}\r\n/**\r\n * Set the id of the referenced model\r\n *\r\n * @export\r\n * @param {PureModel} model Source model\r\n * @param {string} key Referenced model property name\r\n * @param {IIdentifier} value The new value\r\n * @returns {IIdentifier} Referenced model id\r\n */\r\nexport function setRefId(model, key, value) {\r\n    return storage.setModelDataKey(model, key, value);\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllbGRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2hlbHBlcnMvbW9kZWwvZmllbGRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBQzFDLE9BQU8sRUFBNkIsU0FBUyxFQUFvQixpQkFBaUIsRUFBRSxVQUFVLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFFNUcsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLHVCQUF1QixDQUFDO0FBQ2hELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUN4RCxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFdBQVcsRUFDWCxTQUFTLEVBQ1Qsb0JBQW9CLEVBQ3BCLFVBQVUsRUFDVixhQUFhLEVBQ2IsY0FBYyxHQUNmLE1BQU0sY0FBYyxDQUFDO0FBT3RCLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUMxQyxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDL0MsT0FBTyxFQUFDLEtBQUssRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNoQyxPQUFPLEVBQUMsa0JBQWtCLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxZQUFZLEVBQUUsZUFBZSxFQUFDLE1BQU0sU0FBUyxDQUFDO0FBRXZHLDJCQUEyQixLQUFnQixFQUFFLEdBQVcsRUFBRSxZQUF1QjtJQUMvRSxJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsd0JBQXdCLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2hFLElBQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUMxQyxJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNqRCxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxLQUFLLGFB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TSxPQUFPLEdBQUcsT0FBTyxDQUFDLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNoRSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ1osUUFBUSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVELEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDZixnREFBZ0Q7UUFDaEQsVUFBVSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRCxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNuRCxDQUFDO0FBRUQ7Ozs7Ozs7R0FPRztBQUNILE1BQU0sbUJBQW1CLEtBQWdCLEVBQUUsR0FBVztJQUNwRCxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDN0MsQ0FBQztBQUVEOzs7Ozs7OztHQVFHO0FBQ0gsTUFBTSxtQkFBbUIsS0FBZ0IsRUFBRSxHQUFXLEVBQUUsS0FBcUM7SUFDM0YsTUFBTSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNwRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHttYXBJdGVtcywgd2Fybn0gZnJvbSAnZGF0eC11dGlscyc7XG5pbXBvcnQge0lBcnJheUNoYW5nZSwgSUFycmF5U3BsaWNlLCBpbnRlcmNlcHQsIElPYnNlcnZhYmxlQXJyYXksIGlzT2JzZXJ2YWJsZUFycmF5LCBvYnNlcnZhYmxlfSBmcm9tICdtb2J4JztcblxuaW1wb3J0IHtGaWVsZFR5cGV9IGZyb20gJy4uLy4uL2VudW1zL0ZpZWxkVHlwZSc7XG5pbXBvcnQge1JlZmVyZW5jZVR5cGV9IGZyb20gJy4uLy4uL2VudW1zL1JlZmVyZW5jZVR5cGUnO1xuaW1wb3J0IHtcbiAgQkFDS19SRUZfUkVBRF9PTkxZLFxuICBJRF9SRUFET05MWSxcbiAgUkVGX0FSUkFZLFxuICBSRUZfTkVFRFNfQ09MTEVDVElPTixcbiAgUkVGX1NJTkdMRSxcbiAgVFlQRV9SRUFET05MWSxcbiAgV1JPTkdfUkVGX1RZUEUsXG59IGZyb20gJy4uLy4uL2Vycm9ycyc7XG5pbXBvcnQge0lJZGVudGlmaWVyfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL0lJZGVudGlmaWVyJztcbmltcG9ydCB7SVJlZmVyZW5jZU9wdGlvbnN9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvSVJlZmVyZW5jZU9wdGlvbnMnO1xuaW1wb3J0IHtJVHlwZX0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1RDaGFuZ2V9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvVENoYW5nZSc7XG5pbXBvcnQge1RSZWZWYWx1ZX0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9UUmVmVmFsdWUnO1xuaW1wb3J0IHtQdXJlQ29sbGVjdGlvbn0gZnJvbSAnLi4vLi4vUHVyZUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtQdXJlTW9kZWx9IGZyb20gJy4uLy4uL1B1cmVNb2RlbCc7XG5pbXBvcnQge3N0b3JhZ2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0b3JhZ2UnO1xuaW1wb3J0IHtlcnJvcn0gZnJvbSAnLi4vZm9ybWF0JztcbmltcG9ydCB7Z2V0TW9kZWxDb2xsZWN0aW9uLCBnZXRNb2RlbElkLCBnZXRNb2RlbE1ldGFLZXksIGdldE1vZGVsVHlwZSwgc2V0TW9kZWxNZXRhS2V5fSBmcm9tICcuL3V0aWxzJztcblxuZnVuY3Rpb24gbW9kZWxBZGRSZWZlcmVuY2UobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcsIG5ld1JlZmVyZW5jZTogUHVyZU1vZGVsKSB7XG4gIGNvbnN0IHJlZk9wdGlvbnMgPSBzdG9yYWdlLmdldE1vZGVsUmVmZXJlbmNlT3B0aW9ucyhtb2RlbCwga2V5KTtcbiAgY29uc3QgbmV3UmVmSWQgPSBnZXRNb2RlbElkKG5ld1JlZmVyZW5jZSk7XG4gIGNvbnN0IGRhdGEgPSBzdG9yYWdlLmdldE1vZGVsRGF0YUtleShtb2RlbCwga2V5KTtcbiAgaWYgKHJlZk9wdGlvbnMudHlwZSA9PT0gUmVmZXJlbmNlVHlwZS5UT19PTkUpIHtcbiAgICBzdG9yYWdlLnNldE1vZGVsRGF0YUtleShtb2RlbCwga2V5LCBuZXdSZWZJZCk7XG4gIH0gZWxzZSBpZiAocmVmT3B0aW9ucy50eXBlID09PSBSZWZlcmVuY2VUeXBlLlRPX01BTlkgfHwgaXNPYnNlcnZhYmxlQXJyYXkoZGF0YSkpIHtcbiAgICBkYXRhLnB1c2gobmV3UmVmSWQpO1xuICB9IGVsc2Uge1xuICAgIHN0b3JhZ2Uuc2V0TW9kZWxEYXRhS2V5KG1vZGVsLCBrZXksIG5ld1JlZmVyZW5jZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbW9kZWxSZW1vdmVSZWZlcmVuY2UobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcsIG9sZFJlZmVyZW5jZTogUHVyZU1vZGVsKSB7XG4gIGNvbnN0IHJlZk9wdGlvbnMgPSBzdG9yYWdlLmdldE1vZGVsUmVmZXJlbmNlT3B0aW9ucyhtb2RlbCwga2V5KTtcbiAgY29uc3Qgb2xkUmVmSWQgPSBnZXRNb2RlbElkKG9sZFJlZmVyZW5jZSk7XG4gIGNvbnN0IGRhdGEgPSBzdG9yYWdlLmdldE1vZGVsRGF0YUtleShtb2RlbCwga2V5KTtcbiAgaWYgKHJlZk9wdGlvbnMudHlwZSA9PT0gUmVmZXJlbmNlVHlwZS5UT19PTkUpIHtcbiAgICBzdG9yYWdlLnNldE1vZGVsRGF0YUtleShtb2RlbCwga2V5LCBudWxsKTtcbiAgfSBlbHNlIGlmIChyZWZPcHRpb25zLnR5cGUgPT09IFJlZmVyZW5jZVR5cGUuVE9fTUFOWSB8fCBpc09ic2VydmFibGVBcnJheShkYXRhKSkge1xuICAgIGRhdGEucmVtb3ZlKG9sZFJlZklkKTtcbiAgfSBlbHNlIHtcbiAgICBzdG9yYWdlLnNldE1vZGVsRGF0YUtleShtb2RlbCwga2V5LCBudWxsKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbnN1cmVNb2RlbChyZWZPcHRpb25zOiBJUmVmZXJlbmNlT3B0aW9ucywgY29sbGVjdGlvbj86IFB1cmVDb2xsZWN0aW9uKSB7XG4gIHJldHVybiAoZGF0YSkgPT4ge1xuICAgIGxldCBtb2RlbCA9IGRhdGE7XG4gICAgaWYgKCEoZGF0YSBpbnN0YW5jZW9mIFB1cmVNb2RlbCkgJiYgdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnKSB7XG4gICAgICBpZiAoIWNvbGxlY3Rpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFJFRl9ORUVEU19DT0xMRUNUSU9OKTtcbiAgICAgIH1cbiAgICAgIG1vZGVsID0gY29sbGVjdGlvbi5hZGQoZGF0YSwgcmVmT3B0aW9ucy5tb2RlbCk7XG4gICAgfVxuICAgIHJldHVybiBnZXRNb2RlbElkKG1vZGVsKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcGFydGlhbFJlZlVwZGF0ZShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgY2hhbmdlOiBUQ2hhbmdlKSB7XG4gIGNvbnN0IHJlZk9wdGlvbnMgPSBzdG9yYWdlLmdldE1vZGVsUmVmZXJlbmNlT3B0aW9ucyhtb2RlbCwga2V5KTtcbiAgY29uc3QgZGF0YSA9IHN0b3JhZ2UuZ2V0TW9kZWxEYXRhS2V5KG1vZGVsLCBrZXkpO1xuICBjb25zdCBjb2xsZWN0aW9uID0gZ2V0TW9kZWxDb2xsZWN0aW9uKG1vZGVsKTtcblxuICBpZiAoY2hhbmdlLnR5cGUgPT09ICdzcGxpY2UnKSB7XG4gICAgY29uc3QgYWRkZWQgPSBjaGFuZ2UuYWRkZWQubWFwKGVuc3VyZU1vZGVsKHJlZk9wdGlvbnMsIGNvbGxlY3Rpb24pKTtcbiAgICBkYXRhLnNwbGljZShjaGFuZ2UuaW5kZXgsIGNoYW5nZS5yZW1vdmVkQ291bnQsIC4uLmFkZGVkKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGRhdGFbY2hhbmdlLmluZGV4XSA9IGVuc3VyZU1vZGVsKHJlZk9wdGlvbnMsIGNvbGxlY3Rpb24pKGNoYW5nZS5uZXdWYWx1ZSk7XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBiYWNrUmVmU3BsaWNlKG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCBjaGFuZ2U6IElBcnJheVNwbGljZTxQdXJlTW9kZWw+LCByZWZPcHRpb25zOiBJUmVmZXJlbmNlT3B0aW9ucykge1xuICBjb25zdCBwcm9wZXJ0eSA9IHJlZk9wdGlvbnMucHJvcGVydHkgYXMgc3RyaW5nO1xuICBjaGFuZ2UuYWRkZWQubWFwKChpdGVtKSA9PiBtb2RlbEFkZFJlZmVyZW5jZShpdGVtLCBwcm9wZXJ0eSwgbW9kZWwpKTtcbiAgY29uc3QgcmVtb3ZlZCA9IG1vZGVsW2tleV0uc2xpY2UoY2hhbmdlLmluZGV4LCBjaGFuZ2UuaW5kZXggKyBjaGFuZ2UucmVtb3ZlZENvdW50KTtcbiAgcmVtb3ZlZC5tYXAoKGl0ZW0pID0+IG1vZGVsUmVtb3ZlUmVmZXJlbmNlKGl0ZW0sIHByb3BlcnR5LCBtb2RlbCkpO1xuICByZXR1cm4gbnVsbDtcbn1cblxuZnVuY3Rpb24gYmFja1JlZkNoYW5nZShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgY2hhbmdlOiBJQXJyYXlDaGFuZ2U8UHVyZU1vZGVsPiwgcmVmT3B0aW9uczogSVJlZmVyZW5jZU9wdGlvbnMpIHtcbiAgY29uc3QgcHJvcGVydHkgPSByZWZPcHRpb25zLnByb3BlcnR5IGFzIHN0cmluZztcbiAgY29uc3Qgb2xkVmFsdWUgPSBtb2RlbFtrZXldLmxlbmd0aCA+IGNoYW5nZS5pbmRleCA/IG1vZGVsW2tleV1bY2hhbmdlLmluZGV4XSA6IG51bGw7XG4gIGlmIChjaGFuZ2UubmV3VmFsdWUpIHtcbiAgICBtb2RlbEFkZFJlZmVyZW5jZShjaGFuZ2UubmV3VmFsdWUsIHByb3BlcnR5LCBtb2RlbCk7XG4gIH1cbiAgaWYgKG9sZFZhbHVlKSB7XG4gICAgbW9kZWxSZW1vdmVSZWZlcmVuY2Uob2xkVmFsdWUsIHByb3BlcnR5LCBtb2RlbCk7XG4gIH1cblxuICB3YXJuKGBUaGlzIHNob3VsZG4ndCBoYXZlIGhhcHBlbmVkLiBQbGVhc2Ugb3BlbiBhbiBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL2luZmludW0vZGF0eC9pc3N1ZXMvbmV3YCk7XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBwYXJ0aWFsQmFja1JlZlVwZGF0ZShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgY2hhbmdlOiBUQ2hhbmdlKSB7XG4gIGNvbnN0IHJlZk9wdGlvbnMgPSBzdG9yYWdlLmdldE1vZGVsUmVmZXJlbmNlT3B0aW9ucyhtb2RlbCwga2V5KTtcblxuICBpZiAoY2hhbmdlLnR5cGUgPT09ICdzcGxpY2UnKSB7XG4gICAgcmV0dXJuIGJhY2tSZWZTcGxpY2UobW9kZWwsIGtleSwgY2hhbmdlLCByZWZPcHRpb25zKTtcbiAgfVxuICByZXR1cm4gYmFja1JlZkNoYW5nZShtb2RlbCwga2V5LCBjaGFuZ2UsIHJlZk9wdGlvbnMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmllbGQobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcpIHtcbiAgcmV0dXJuIHN0b3JhZ2UuZ2V0TW9kZWxEYXRhS2V5KG1vZGVsLCBrZXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlRmllbGQobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR5cGU6IEZpZWxkVHlwZSkge1xuICBpZiAodHlwZSA9PT0gRmllbGRUeXBlLlRZUEUpIHtcbiAgICB0aHJvdyBlcnJvcihUWVBFX1JFQURPTkxZKTtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBGaWVsZFR5cGUuSUQpIHtcbiAgICB0aHJvdyBlcnJvcihJRF9SRUFET05MWSk7XG4gIH1cblxuICBjb25zdCByZWZzID0gZ2V0TW9kZWxNZXRhS2V5KG1vZGVsLCAncmVmcycpO1xuICBpZiAoa2V5IGluIHJlZnMpIHtcbiAgICB1cGRhdGVSZWYobW9kZWwsIGtleSwgdmFsdWUpO1xuICB9IGVsc2Uge1xuICAgIHN0b3JhZ2Uuc2V0TW9kZWxEYXRhS2V5KG1vZGVsLCBrZXksIHZhbHVlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYXNCYWNrUmVmKGl0ZW06IFB1cmVNb2RlbCwgcHJvcGVydHk6IHN0cmluZywgdGFyZ2V0OiBQdXJlTW9kZWwpOiBib29sZWFuIHtcbiAgaWYgKGl0ZW1bcHJvcGVydHldID09PSBudWxsIHx8IGl0ZW1bcHJvcGVydHldID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gZWxzZSBpZiAoaXRlbVtwcm9wZXJ0eV0gaW5zdGFuY2VvZiBQdXJlTW9kZWwpIHtcbiAgICByZXR1cm4gaXRlbVtwcm9wZXJ0eV0gPT09IHRhcmdldDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gaXRlbVtwcm9wZXJ0eV0uaW5kZXhPZih0YXJnZXQpICE9PSAtMTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRCYWNrUmVmKG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCByZWZPcHRpb25zOiBJUmVmZXJlbmNlT3B0aW9ucyk6IFB1cmVNb2RlbHxBcnJheTxQdXJlTW9kZWw+fG51bGwge1xuICBjb25zdCB0eXBlID0gZ2V0TW9kZWxUeXBlKHJlZk9wdGlvbnMubW9kZWwpO1xuXG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBnZXRNb2RlbENvbGxlY3Rpb24obW9kZWwpO1xuICBpZiAoIWNvbGxlY3Rpb24pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IGJhY2tNb2RlbHMgPSBjb2xsZWN0aW9uXG4gICAgLmZpbmRBbGwodHlwZSlcbiAgICAuZmlsdGVyKChpdGVtKSA9PiBoYXNCYWNrUmVmKGl0ZW0sIHJlZk9wdGlvbnMucHJvcGVydHkgYXMgc3RyaW5nLCBtb2RlbCkpO1xuXG4gIGNvbnN0IGJhY2tEYXRhOiBJT2JzZXJ2YWJsZUFycmF5PFB1cmVNb2RlbD4gPSBvYnNlcnZhYmxlLmFycmF5KGJhY2tNb2RlbHMsIHtkZWVwOiBmYWxzZX0pO1xuICBpbnRlcmNlcHQoYmFja0RhdGEsIChjaGFuZ2U6IFRDaGFuZ2UpID0+IHBhcnRpYWxCYWNrUmVmVXBkYXRlKG1vZGVsLCBrZXksIGNoYW5nZSkpO1xuICByZXR1cm4gYmFja0RhdGE7XG59XG5cbmZ1bmN0aW9uIGdldE5vcm1hbFJlZihtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgcmVmT3B0aW9uczogSVJlZmVyZW5jZU9wdGlvbnMpOiBQdXJlTW9kZWx8QXJyYXk8UHVyZU1vZGVsPnxudWxsIHtcbiAgY29uc3QgdmFsdWUgPSBzdG9yYWdlLmdldE1vZGVsRGF0YUtleShtb2RlbCwga2V5KTtcbiAgY29uc3QgY29sbGVjdGlvbiA9IGdldE1vZGVsQ29sbGVjdGlvbihtb2RlbCk7XG4gIGlmICghY29sbGVjdGlvbikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgbGV0IGRhdGFNb2RlbHMgPSBtYXBJdGVtcyh2YWx1ZSwgKGlkKSA9PiBpZCA/IGNvbGxlY3Rpb24uZmluZChyZWZPcHRpb25zLm1vZGVsLCBpZCkgOiBpZCk7XG4gIGlmIChyZWZPcHRpb25zLnR5cGUgPT09IFJlZmVyZW5jZVR5cGUuVE9fTUFOWSAmJiAhKGRhdGFNb2RlbHMgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICBkYXRhTW9kZWxzID0gW2RhdGFNb2RlbHNdO1xuICB9XG4gIGlmIChkYXRhTW9kZWxzIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICBjb25zdCBkYXRhOiBJT2JzZXJ2YWJsZUFycmF5PFB1cmVNb2RlbD4gPSBvYnNlcnZhYmxlLmFycmF5KGRhdGFNb2RlbHMsIHtkZWVwOiBmYWxzZX0pO1xuICAgIGludGVyY2VwdChkYXRhLCAoY2hhbmdlOiBUQ2hhbmdlKSA9PiBwYXJ0aWFsUmVmVXBkYXRlKG1vZGVsLCBrZXksIGNoYW5nZSkpO1xuICAgIHJldHVybiBkYXRhO1xuICB9XG4gIHJldHVybiBkYXRhTW9kZWxzO1xuXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZWYobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcpOiBQdXJlTW9kZWx8QXJyYXk8UHVyZU1vZGVsPnxudWxsIHtcbiAgY29uc3QgcmVmT3B0aW9ucyA9IHN0b3JhZ2UuZ2V0TW9kZWxSZWZlcmVuY2VPcHRpb25zKG1vZGVsLCBrZXkpO1xuXG4gIHJldHVybiAodHlwZW9mIHJlZk9wdGlvbnMucHJvcGVydHkgPT09ICdzdHJpbmcnKVxuICAgID8gZ2V0QmFja1JlZihtb2RlbCwga2V5LCByZWZPcHRpb25zKVxuICAgIDogZ2V0Tm9ybWFsUmVmKG1vZGVsLCBrZXksIHJlZk9wdGlvbnMpO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZVJlZihyZWZPcHRpb25zOiBJUmVmZXJlbmNlT3B0aW9ucywgaXNBcnJheTogYm9vbGVhbiwga2V5OiBzdHJpbmcpIHtcbiAgaWYgKHJlZk9wdGlvbnMudHlwZSA9PT0gUmVmZXJlbmNlVHlwZS5UT19PTkUgJiYgaXNBcnJheSkge1xuICAgIHRocm93IGVycm9yKFJFRl9TSU5HTEUsIHtrZXl9KTtcbiAgfSBlbHNlIGlmIChyZWZPcHRpb25zLnR5cGUgPT09IFJlZmVyZW5jZVR5cGUuVE9fTUFOWSAmJiAhaXNBcnJheSkge1xuICAgIHRocm93IGVycm9yKFJFRl9BUlJBWSwge2tleX0pO1xuICB9IGVsc2UgaWYgKHJlZk9wdGlvbnMucHJvcGVydHkpIHtcbiAgICB0aHJvdyBlcnJvcihCQUNLX1JFRl9SRUFEX09OTFkpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSZWYobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcsIHZhbHVlOiBUUmVmVmFsdWUpIHtcbiAgY29uc3QgcmVmT3B0aW9ucyA9IHN0b3JhZ2UuZ2V0TW9kZWxSZWZlcmVuY2VPcHRpb25zKG1vZGVsLCBrZXkpO1xuICBjb25zdCBvbGRJZHMgPSByZWZPcHRpb25zLnR5cGUgPT09IFJlZmVyZW5jZVR5cGUuVE9fTUFOWVxuICAgID8gKG1hcEl0ZW1zKHZhbHVlLCBnZXRNb2RlbElkKSB8fCBbXSlcbiAgICA6IG1hcEl0ZW1zKHZhbHVlLCBnZXRNb2RlbElkKTtcblxuICBjb25zdCBjaGVjayA9IHJlZk9wdGlvbnMudHlwZSA9PT0gUmVmZXJlbmNlVHlwZS5UT19NQU5ZID8gdmFsdWUgfHwgW10gOiB2YWx1ZTtcbiAgY29uc3QgaXNBcnJheSA9IGNoZWNrIGluc3RhbmNlb2YgQXJyYXkgfHwgaXNPYnNlcnZhYmxlQXJyYXkoY2hlY2spO1xuICB2YWxpZGF0ZVJlZihyZWZPcHRpb25zLCBpc0FycmF5LCBrZXkpO1xuXG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBnZXRNb2RlbENvbGxlY3Rpb24obW9kZWwpO1xuXG4gIGxldCBpZHM6IElJZGVudGlmaWVyfEFycmF5PElJZGVudGlmaWVyPnxudWxsID0gbWFwSXRlbXModmFsdWUsIChyZWY6IElJZGVudGlmaWVyfFB1cmVNb2RlbCkgPT4ge1xuICAgIGlmIChyZWYgJiYgY29sbGVjdGlvbikge1xuICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFB1cmVNb2RlbCkge1xuICAgICAgICBjb25zdCByZWZUeXBlID0gZ2V0TW9kZWxUeXBlKHJlZik7XG4gICAgICAgIGlmIChyZWZUeXBlICE9PSBnZXRNb2RlbFR5cGUocmVmT3B0aW9ucy5tb2RlbCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoV1JPTkdfUkVGX1RZUEUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsZXQgaW5zdGFuY2UgPSBjb2xsZWN0aW9uLmZpbmQocmVmT3B0aW9ucy5tb2RlbCwgcmVmKTtcbiAgICAgIGlmICghaW5zdGFuY2UgJiYgdHlwZW9mIHJlZiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgaW5zdGFuY2UgPSBjb2xsZWN0aW9uLmFkZChyZWYsIHJlZk9wdGlvbnMubW9kZWwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdldE1vZGVsSWQoaW5zdGFuY2UgfHwgcmVmKTtcbiAgICB9IGVsc2UgaWYgKHJlZiBpbnN0YW5jZW9mIFB1cmVNb2RlbCkge1xuICAgICAgdGhyb3cgZXJyb3IoUkVGX05FRURTX0NPTExFQ1RJT04pO1xuICAgIH1cbiAgICByZXR1cm4gcmVmO1xuICB9KTtcblxuICBpZiAocmVmT3B0aW9ucy50eXBlID09PSBSZWZlcmVuY2VUeXBlLlRPX01BTlkpIHtcbiAgICBpZHMgPSBpZHMgfHwgW107XG4gIH1cblxuICBpZiAoIWlkcyB8fCAoaWRzIGluc3RhbmNlb2YgQXJyYXkgJiYgaWRzLmxlbmd0aCA9PT0gMCkpIHtcbiAgICBzdG9yYWdlLnNldE1vZGVsRGF0YUtleShtb2RlbCwga2V5LCBpZHMpO1xuICB9IGVsc2Uge1xuXG4gICAgc3RvcmFnZS5zZXRNb2RlbERhdGFLZXkobW9kZWwsIGtleSwgaWRzKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRNb2RlbFJlZnNCeVR5cGUobW9kZWw6IFB1cmVNb2RlbCwgdHlwZTogSVR5cGUpIHtcbiAgY29uc3QgcmVmcyA9IGdldE1vZGVsTWV0YUtleShtb2RlbCwgJ3JlZnMnKTtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKHJlZnMpXG4gICAgLmZpbHRlcigoa2V5KSA9PiAhcmVmc1trZXldLnByb3BlcnR5KVxuICAgIC5maWx0ZXIoKGtleSkgPT4gZ2V0TW9kZWxUeXBlKHJlZnNba2V5XS5tb2RlbCkgPT09IHR5cGUpO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVNb2RlbFJlZmVyZW5jZXMobW9kZWw6IFB1cmVNb2RlbCwgbmV3SWQ6IElJZGVudGlmaWVyLCBvbGRJZDogSUlkZW50aWZpZXIsIHR5cGU6IElUeXBlKSB7XG4gIGNvbnN0IGNvbGxlY3Rpb24gPSBnZXRNb2RlbENvbGxlY3Rpb24obW9kZWwpO1xuICBpZiAoY29sbGVjdGlvbikge1xuICAgIGNvbnN0IGFsbE1vZGVscyA9IGNvbGxlY3Rpb24uZ2V0QWxsTW9kZWxzKCkubWFwKChpdGVtKSA9PiB7XG4gICAgICBnZXRNb2RlbFJlZnNCeVR5cGUoaXRlbSwgdHlwZSkuZm9yRWFjaCgocmVmKSA9PiB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBzdG9yYWdlLmdldE1vZGVsRGF0YUtleShpdGVtLCByZWYpO1xuICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5IHx8IGlzT2JzZXJ2YWJsZUFycmF5KGRhdGEpKSB7XG4gICAgICAgICAgY29uc3QgdGFyZ2V0SW5kZXggPSBkYXRhLmluZGV4T2Yob2xkSWQpO1xuICAgICAgICAgIGlmICh0YXJnZXRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIGRhdGFbdGFyZ2V0SW5kZXhdID0gbmV3SWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGRhdGEgPT09IG9sZElkKSB7XG4gICAgICAgICAgc3RvcmFnZS5zZXRNb2RlbERhdGFLZXkoaXRlbSwgcmVmLCBuZXdJZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogVXBkYXRlcyB0aGUgbW9kZWwgaWRlbnRpZmllciBhbmQgYWxsIHRoZSBleGlzdGluZyByZWZlcmVuY2VzIHRvIHRoZSBtb2RlbFxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7UHVyZU1vZGVsfSBtb2RlbCBNb2RlbCB0byBiZSB1cGRhdGVkXG4gKiBAcGFyYW0ge0lJZGVudGlmaWVyfSBuZXdJZCBOZXcgbW9kZWwgaWRlbnRpZmllclxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlTW9kZWxJZChtb2RlbDogUHVyZU1vZGVsLCBuZXdJZDogSUlkZW50aWZpZXIpOiB2b2lkIHtcbiAgY29uc3QgY29sbGVjdGlvbiA9IGdldE1vZGVsQ29sbGVjdGlvbihtb2RlbCk7XG5cbiAgY29uc3Qgb2xkSWQgPSBnZXRNb2RlbElkKG1vZGVsKTtcbiAgY29uc3QgdHlwZSA9IGdldE1vZGVsVHlwZShtb2RlbCk7XG4gIHNldE1vZGVsTWV0YUtleShtb2RlbCwgJ2lkJywgbmV3SWQpO1xuXG4gIGNvbnN0IHN0YXRpY01vZGVsID0gbW9kZWwuY29uc3RydWN0b3IgYXMgdHlwZW9mIFB1cmVNb2RlbDtcbiAgY29uc3QgbW9kZWxJZCA9IHN0b3JhZ2UuZ2V0TW9kZWxDbGFzc01ldGFLZXkoc3RhdGljTW9kZWwsICdpZCcpO1xuICBpZiAobW9kZWxJZCkge1xuICAgIHNldFJlZklkKG1vZGVsLCBtb2RlbElkLCBuZXdJZCk7XG4gIH1cblxuICBpZiAoY29sbGVjdGlvbikge1xuICAgIC8vIEB0cy1pZ25vcmUgLSBJJ20gYmFkIGFuZCBJIHNob3VsZCBmZWVsIGJhZC4uLlxuICAgIGNvbGxlY3Rpb24uX19jaGFuZ2VNb2RlbElkKG9sZElkLCBuZXdJZCwgdHlwZSk7XG4gIH1cblxuICB1cGRhdGVNb2RlbFJlZmVyZW5jZXMobW9kZWwsIG5ld0lkLCBvbGRJZCwgdHlwZSk7XG59XG5cbi8qKlxuICogR2V0IHRoZSBpZCBvZiB0aGUgcmVmZXJlbmNlZCBtb2RlbFxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7UHVyZU1vZGVsfSBtb2RlbCBTb3VyY2UgbW9kZWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgUmVmZXJlbmNlZCBtb2RlbCBwcm9wZXJ0eSBuYW1lXG4gKiBAcmV0dXJucyB7SUlkZW50aWZpZXJ9IFJlZmVyZW5jZWQgbW9kZWwgaWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFJlZklkKG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nKTogSUlkZW50aWZpZXJ8QXJyYXk8SUlkZW50aWZpZXI+IHtcbiAgcmV0dXJuIHN0b3JhZ2UuZ2V0TW9kZWxEYXRhS2V5KG1vZGVsLCBrZXkpO1xufVxuXG4vKipcbiAqIFNldCB0aGUgaWQgb2YgdGhlIHJlZmVyZW5jZWQgbW9kZWxcbiAqXG4gKiBAZXhwb3J0XG4gKiBAcGFyYW0ge1B1cmVNb2RlbH0gbW9kZWwgU291cmNlIG1vZGVsXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFJlZmVyZW5jZWQgbW9kZWwgcHJvcGVydHkgbmFtZVxuICogQHBhcmFtIHtJSWRlbnRpZmllcn0gdmFsdWUgVGhlIG5ldyB2YWx1ZVxuICogQHJldHVybnMge0lJZGVudGlmaWVyfSBSZWZlcmVuY2VkIG1vZGVsIGlkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRSZWZJZChtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgdmFsdWU6IElJZGVudGlmaWVyfEFycmF5PElJZGVudGlmaWVyPikge1xuICByZXR1cm4gc3RvcmFnZS5zZXRNb2RlbERhdGFLZXkobW9kZWwsIGtleSwgdmFsdWUpO1xufVxuIl19","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/helpers/model/fields.d.ts","text":"import { FieldType } from '../../enums/FieldType';\r\nimport { IIdentifier } from '../../interfaces/IIdentifier';\r\nimport { TRefValue } from '../../interfaces/TRefValue';\r\nimport { PureModel } from '../../PureModel';\r\nexport declare function getField(model: PureModel, key: string): any;\r\nexport declare function updateField(model: PureModel, key: string, value: any, type: FieldType): void;\r\nexport declare function getRef(model: PureModel, key: string): PureModel | Array<PureModel> | null;\r\nexport declare function updateRef(model: PureModel, key: string, value: TRefValue): void;\r\n/**\r\n * Updates the model identifier and all the existing references to the model\r\n *\r\n * @export\r\n * @param {PureModel} model Model to be updated\r\n * @param {IIdentifier} newId New model identifier\r\n */\r\nexport declare function updateModelId(model: PureModel, newId: IIdentifier): void;\r\n/**\r\n * Get the id of the referenced model\r\n *\r\n * @export\r\n * @param {PureModel} model Source model\r\n * @param {string} key Referenced model property name\r\n * @returns {IIdentifier} Referenced model id\r\n */\r\nexport declare function getRefId(model: PureModel, key: string): IIdentifier | Array<IIdentifier>;\r\n/**\r\n * Set the id of the referenced model\r\n *\r\n * @export\r\n * @param {PureModel} model Source model\r\n * @param {string} key Referenced model property name\r\n * @param {IIdentifier} value The new value\r\n * @returns {IIdentifier} Referenced model id\r\n */\r\nexport declare function setRefId(model: PureModel, key: string, value: IIdentifier | Array<IIdentifier>): void;\r\n"}}
