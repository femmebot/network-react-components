{"code":"import * as tslib_1 from \"tslib\";\r\nimport { deprecated, mapItems, warn } from 'datx-utils';\r\nimport { isObservableArray } from 'mobx';\r\nimport { FieldType } from './enums/FieldType';\r\nimport { ReferenceType } from './enums/ReferenceType';\r\nimport { updateField } from './helpers/model/fields';\r\nimport { initModelField, initModelRef } from './helpers/model/init';\r\nimport { getModelCollection, getModelId, getModelMetaKey, getModelType, modelToJSON, updateModel, } from './helpers/model/utils';\r\nimport { PureModel } from './PureModel';\r\nimport { storage } from './services/storage';\r\nwarn('CompatModel is just a migration tool. Please move to Model or PureModel as soon as possible.');\r\nvar CompatModel = /** @class */ (function (_super) {\r\n    tslib_1.__extends(CompatModel, _super);\r\n    function CompatModel(initialData, collection) {\r\n        var _this = _super.call(this, initialData, collection) || this;\r\n        Object.keys(_this.static.refs).forEach(function (prop) {\r\n            var refs = getModelMetaKey(_this, 'refs');\r\n            if (prop in refs) {\r\n                return;\r\n            }\r\n            var ref = _this.static.refs[prop];\r\n            var data = mapItems(_this[prop] || _this.static.defaults[prop], getModelId);\r\n            delete _this[prop];\r\n            if (typeof ref === 'object') {\r\n                // Back reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref.model,\r\n                    property: ref.property,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n            else {\r\n                // Normal reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n        });\r\n        Object.keys(_this.static.defaults).forEach(function (prop) {\r\n            if (!(prop in _this.static.refs) && !(prop in _this)) {\r\n                initModelField(_this, prop, _this.static.defaults[prop]);\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    CompatModel.prototype.getRecordId = function () {\r\n        deprecated('model.getRecordId is deprecated. Use getModelId() instead.');\r\n        return getModelId(this);\r\n    };\r\n    CompatModel.prototype.getRecordType = function () {\r\n        deprecated('model.getRecordType is deprecated. Use getModelType() instead.');\r\n        return getModelType(this);\r\n    };\r\n    CompatModel.prototype.assign = function (key, value) {\r\n        deprecated('model.assign is deprecated. Use assignModel() instead.');\r\n        var type = FieldType.DATA;\r\n        var modelId = storage.getModelClassMetaKey(this.static, 'id');\r\n        var modelType = storage.getModelClassMetaKey(this.static, 'type');\r\n        if (key === modelId) {\r\n            type = FieldType.ID;\r\n        }\r\n        else if (key === modelType) {\r\n            type = FieldType.TYPE;\r\n        }\r\n        updateField(this, key, value, type);\r\n        return value;\r\n    };\r\n    CompatModel.prototype.assignRef = function (key, value, type) {\r\n        deprecated('model.assignRef is deprecated. Use initModelRef() instead.');\r\n        var refs = getModelMetaKey(this, 'refs');\r\n        if (refs[key]) {\r\n            return this[key] = value;\r\n        }\r\n        var model = type;\r\n        if (!model) {\r\n            if (value instanceof Array || isObservableArray(value)) {\r\n                model = value.reduce(function (t, m) { return t || getModelType(m); }, null);\r\n            }\r\n            else if (value instanceof PureModel) {\r\n                model = getModelType(value);\r\n            }\r\n        }\r\n        if (!model) {\r\n            throw new Error('The type property is missing');\r\n        }\r\n        initModelRef(this, key, {\r\n            model: model,\r\n            type: ReferenceType.TO_ONE_OR_MANY,\r\n        }, value);\r\n        return this[key];\r\n    };\r\n    CompatModel.prototype.update = function (data) {\r\n        var _this = this;\r\n        deprecated('model.update is deprecated. Use updateModel() instead.');\r\n        var updateData = Object.assign({}, data);\r\n        Object.keys(updateData).forEach(function (key) {\r\n            if (typeof _this[key] === 'function') {\r\n                delete updateData[key];\r\n            }\r\n        });\r\n        return updateModel(this, updateData);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"static\", {\r\n        get: function () {\r\n            deprecated('model.static is deprecated.');\r\n            return this.constructor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.prototype.toJS = function () {\r\n        deprecated('model.toJS() is deprecated. Use modelToJSON() instead.');\r\n        return modelToJSON(this);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"snapshot\", {\r\n        get: function () {\r\n            deprecated('model.snapshot is deprecated. Use modelToJSON() instead.');\r\n            return modelToJSON(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompatModel.prototype, \"__collection\", {\r\n        get: function () {\r\n            deprecated('model.__collection is deprecated. Use getModelCollection() instead.');\r\n            return getModelCollection(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.refs = {};\r\n    CompatModel.defaults = {};\r\n    return CompatModel;\r\n}(PureModel));\r\nexport { CompatModel };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tcGF0TW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvQ29tcGF0TW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQTBCLFFBQVEsRUFBRSxJQUFJLEVBQUMsTUFBTSxZQUFZLENBQUM7QUFDOUUsT0FBTyxFQUFDLGlCQUFpQixFQUFNLE1BQU0sTUFBTSxDQUFDO0FBRzVDLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUM1QyxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFDcEQsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBQyxjQUFjLEVBQUUsWUFBWSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDbEUsT0FBTyxFQUNMLGtCQUFrQixFQUNsQixVQUFVLEVBQ1YsZUFBZSxFQUNmLFlBQVksRUFDWixXQUFXLEVBQ1gsV0FBVyxHQUNaLE1BQU0sdUJBQXVCLENBQUM7QUFHL0IsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGFBQWEsQ0FBQztBQUN0QyxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFFM0MsSUFBSSxDQUFDLDhGQUE4RixDQUFDLENBQUM7QUFFckc7SUFBaUMsdUNBQVM7SUFJeEMscUJBQVksV0FBbUIsRUFBRSxVQUF1QjtRQUF4RCxZQUNFLGtCQUFNLFdBQVcsRUFBRSxVQUFVLENBQUMsU0ErQi9CO1FBN0JDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFJO1lBQ3pDLElBQU0sSUFBSSxHQUFHLGVBQWUsQ0FBQyxLQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDM0MsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLE1BQU0s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LFNBQVMsR0F5SHpDO1NBekhZLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2RlcHJlY2F0ZWQsIElEaWN0aW9uYXJ5LCBJUmF3TW9kZWwsIG1hcEl0ZW1zLCB3YXJufSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7aXNPYnNlcnZhYmxlQXJyYXksIHNldH0gZnJvbSAnbW9ieCc7XG5cbmltcG9ydCB7Q29sbGVjdGlvbn0gZnJvbSAnLi9Db2xsZWN0aW9uJztcbmltcG9ydCB7RmllbGRUeXBlfSBmcm9tICcuL2VudW1zL0ZpZWxkVHlwZSc7XG5pbXBvcnQge1JlZmVyZW5jZVR5cGV9IGZyb20gJy4vZW51bXMvUmVmZXJlbmNlVHlwZSc7XG5pbXBvcnQge3VwZGF0ZUZpZWxkfSBmcm9tICcuL2hlbHBlcnMvbW9kZWwvZmllbGRzJztcbmltcG9ydCB7aW5pdE1vZGVsRmllbGQsIGluaXRNb2RlbFJlZn0gZnJvbSAnLi9oZWxwZXJzL21vZGVsL2luaXQnO1xuaW1wb3J0IHtcbiAgZ2V0TW9kZWxDb2xsZWN0aW9uLFxuICBnZXRNb2RlbElkLFxuICBnZXRNb2RlbE1ldGFLZXksXG4gIGdldE1vZGVsVHlwZSxcbiAgbW9kZWxUb0pTT04sXG4gIHVwZGF0ZU1vZGVsLFxufSBmcm9tICcuL2hlbHBlcnMvbW9kZWwvdXRpbHMnO1xuaW1wb3J0IHtJUmVmZXJlbmNlc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSZWZlcmVuY2VzJztcbmltcG9ydCB7SVR5cGV9IGZyb20gJy4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1B1cmVNb2RlbH0gZnJvbSAnLi9QdXJlTW9kZWwnO1xuaW1wb3J0IHtzdG9yYWdlfSBmcm9tICcuL3NlcnZpY2VzL3N0b3JhZ2UnO1xuXG53YXJuKCdDb21wYXRNb2RlbCBpcyBqdXN0IGEgbWlncmF0aW9uIHRvb2wuIFBsZWFzZSBtb3ZlIHRvIE1vZGVsIG9yIFB1cmVNb2RlbCBhcyBzb29uIGFzIHBvc3NpYmxlLicpO1xuXG5leHBvcnQgY2xhc3MgQ29tcGF0TW9kZWwgZXh0ZW5kcyBQdXJlTW9kZWwge1xuICBwdWJsaWMgc3RhdGljIHJlZnM6IElSZWZlcmVuY2VzID0ge307XG4gIHB1YmxpYyBzdGF0aWMgZGVmYXVsdHM6IElEaWN0aW9uYXJ5PGFueT4gPSB7fTtcblxuICBjb25zdHJ1Y3Rvcihpbml0aWFsRGF0YTogb2JqZWN0LCBjb2xsZWN0aW9uPzogQ29sbGVjdGlvbikge1xuICAgIHN1cGVyKGluaXRpYWxEYXRhLCBjb2xsZWN0aW9uKTtcblxuICAgIE9iamVjdC5rZXlzKHRoaXMuc3RhdGljLnJlZnMpLmZvckVhY2goKHByb3ApID0+IHtcbiAgICAgIGNvbnN0IHJlZnMgPSBnZXRNb2RlbE1ldGFLZXkodGhpcywgJ3JlZnMnKTtcbiAgICAgIGlmIChwcm9wIGluIHJlZnMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVmID0gdGhpcy5zdGF0aWMucmVmc1twcm9wXTtcbiAgICAgIGNvbnN0IGRhdGEgPSBtYXBJdGVtcyh0aGlzW3Byb3BdIHx8IHRoaXMuc3RhdGljLmRlZmF1bHRzW3Byb3BdLCBnZXRNb2RlbElkKTtcbiAgICAgIGRlbGV0ZSB0aGlzW3Byb3BdO1xuICAgICAgaWYgKHR5cGVvZiByZWYgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIC8vIEJhY2sgcmVmZXJlbmNlXG4gICAgICAgIGluaXRNb2RlbFJlZih0aGlzLCBwcm9wLCB7XG4gICAgICAgICAgbW9kZWw6IHJlZi5tb2RlbCxcbiAgICAgICAgICBwcm9wZXJ0eTogcmVmLnByb3BlcnR5LFxuICAgICAgICAgIHR5cGU6IFJlZmVyZW5jZVR5cGUuVE9fT05FX09SX01BTlksXG4gICAgICAgIH0sIGRhdGEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTm9ybWFsIHJlZmVyZW5jZVxuICAgICAgICBpbml0TW9kZWxSZWYodGhpcywgcHJvcCwge1xuICAgICAgICAgIG1vZGVsOiByZWYsXG4gICAgICAgICAgdHlwZTogUmVmZXJlbmNlVHlwZS5UT19PTkVfT1JfTUFOWSxcbiAgICAgICAgfSwgZGF0YSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBPYmplY3Qua2V5cyh0aGlzLnN0YXRpYy5kZWZhdWx0cykuZm9yRWFjaCgocHJvcCkgPT4ge1xuICAgICAgaWYgKCEocHJvcCBpbiB0aGlzLnN0YXRpYy5yZWZzKSAmJiAhKHByb3AgaW4gdGhpcykpIHtcbiAgICAgICAgaW5pdE1vZGVsRmllbGQodGhpcywgcHJvcCwgdGhpcy5zdGF0aWMuZGVmYXVsdHNbcHJvcF0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGdldFJlY29yZElkKCkge1xuICAgIGRlcHJlY2F0ZWQoJ21vZGVsLmdldFJlY29yZElkIGlzIGRlcHJlY2F0ZWQuIFVzZSBnZXRNb2RlbElkKCkgaW5zdGVhZC4nKTtcbiAgICByZXR1cm4gZ2V0TW9kZWxJZCh0aGlzKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSZWNvcmRUeXBlKCkge1xuICAgIGRlcHJlY2F0ZWQoJ21vZGVsLmdldFJlY29yZFR5cGUgaXMgZGVwcmVjYXRlZC4gVXNlIGdldE1vZGVsVHlwZSgpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIGdldE1vZGVsVHlwZSh0aGlzKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3NpZ24oa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5hc3NpZ24gaXMgZGVwcmVjYXRlZC4gVXNlIGFzc2lnbk1vZGVsKCkgaW5zdGVhZC4nKTtcbiAgICBsZXQgdHlwZSA9IEZpZWxkVHlwZS5EQVRBO1xuICAgIGNvbnN0IG1vZGVsSWQgPSBzdG9yYWdlLmdldE1vZGVsQ2xhc3NNZXRhS2V5KHRoaXMuc3RhdGljLCAnaWQnKTtcbiAgICBjb25zdCBtb2RlbFR5cGUgPSBzdG9yYWdlLmdldE1vZGVsQ2xhc3NNZXRhS2V5KHRoaXMuc3RhdGljLCAndHlwZScpO1xuICAgIGlmIChrZXkgPT09IG1vZGVsSWQpIHtcbiAgICAgIHR5cGUgPSBGaWVsZFR5cGUuSUQ7XG4gICAgfSBlbHNlIGlmIChrZXkgPT09IG1vZGVsVHlwZSkge1xuICAgICAgdHlwZSA9IEZpZWxkVHlwZS5UWVBFO1xuICAgIH1cblxuICAgIHVwZGF0ZUZpZWxkKHRoaXMsIGtleSwgdmFsdWUsIHR5cGUpO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIHB1YmxpYyBhc3NpZ25SZWYoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR5cGU/OiBJVHlwZSkge1xuICAgIGRlcHJlY2F0ZWQoJ21vZGVsLmFzc2lnblJlZiBpcyBkZXByZWNhdGVkLiBVc2UgaW5pdE1vZGVsUmVmKCkgaW5zdGVhZC4nKTtcbiAgICBjb25zdCByZWZzID0gZ2V0TW9kZWxNZXRhS2V5KHRoaXMsICdyZWZzJyk7XG5cbiAgICBpZiAocmVmc1trZXldKSB7XG4gICAgICByZXR1cm4gdGhpc1trZXldID0gdmFsdWU7XG4gICAgfVxuXG4gICAgbGV0IG1vZGVsID0gdHlwZTtcbiAgICBpZiAoIW1vZGVsKSB7XG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSB8fCBpc09ic2VydmFibGVBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgbW9kZWwgPSB2YWx1ZS5yZWR1Y2UoKHQsIG0pID0+IHQgfHwgZ2V0TW9kZWxUeXBlKG0pLCBudWxsKTtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBQdXJlTW9kZWwpIHtcbiAgICAgICAgbW9kZWwgPSBnZXRNb2RlbFR5cGUodmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghbW9kZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHR5cGUgcHJvcGVydHkgaXMgbWlzc2luZycpO1xuICAgIH1cblxuICAgIGluaXRNb2RlbFJlZih0aGlzLCBrZXksIHtcbiAgICAgIG1vZGVsLFxuICAgICAgdHlwZTogUmVmZXJlbmNlVHlwZS5UT19PTkVfT1JfTUFOWSxcbiAgICB9LCB2YWx1ZSk7XG4gICAgcmV0dXJuIHRoaXNba2V5XTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGUoZGF0YTogUHVyZU1vZGVsIHwgSURpY3Rpb25hcnk8YW55Pik6IG9iamVjdCB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwudXBkYXRlIGlzIGRlcHJlY2F0ZWQuIFVzZSB1cGRhdGVNb2RlbCgpIGluc3RlYWQuJyk7XG4gICAgY29uc3QgdXBkYXRlRGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xuICAgIE9iamVjdC5rZXlzKHVwZGF0ZURhdGEpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiB0aGlzW2tleV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZGVsZXRlIHVwZGF0ZURhdGFba2V5XTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdXBkYXRlTW9kZWwodGhpcywgdXBkYXRlRGF0YSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHN0YXRpYygpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5zdGF0aWMgaXMgZGVwcmVjYXRlZC4nKTtcbiAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RvciBhcyB0eXBlb2YgQ29tcGF0TW9kZWw7XG4gIH1cblxuICBwdWJsaWMgdG9KUygpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC50b0pTKCkgaXMgZGVwcmVjYXRlZC4gVXNlIG1vZGVsVG9KU09OKCkgaW5zdGVhZC4nKTtcbiAgICByZXR1cm4gbW9kZWxUb0pTT04odGhpcyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNuYXBzaG90KCkge1xuICAgIGRlcHJlY2F0ZWQoJ21vZGVsLnNuYXBzaG90IGlzIGRlcHJlY2F0ZWQuIFVzZSBtb2RlbFRvSlNPTigpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIG1vZGVsVG9KU09OKHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgX19jb2xsZWN0aW9uKCkge1xuICAgIGRlcHJlY2F0ZWQoJ21vZGVsLl9fY29sbGVjdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgZ2V0TW9kZWxDb2xsZWN0aW9uKCkgaW5zdGVhZC4nKTtcbiAgICByZXR1cm4gZ2V0TW9kZWxDb2xsZWN0aW9uKHRoaXMpO1xuICB9XG59XG4iXX0=","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/CompatModel.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { Collection } from './Collection';\r\nimport { IReferences } from './interfaces/IReferences';\r\nimport { IType } from './interfaces/IType';\r\nimport { PureModel } from './PureModel';\r\nexport declare class CompatModel extends PureModel {\r\n    static refs: IReferences;\r\n    static defaults: IDictionary<any>;\r\n    constructor(initialData: object, collection?: Collection);\r\n    getRecordId(): IType;\r\n    getRecordType(): IType;\r\n    assign(key: string, value: any): any;\r\n    assignRef(key: string, value: any, type?: IType): any;\r\n    update(data: PureModel | IDictionary<any>): object;\r\n    readonly static: typeof CompatModel;\r\n    toJS(): IRawModel;\r\n    readonly snapshot: IRawModel;\r\n    private readonly __collection;\r\n}\r\n"}}
