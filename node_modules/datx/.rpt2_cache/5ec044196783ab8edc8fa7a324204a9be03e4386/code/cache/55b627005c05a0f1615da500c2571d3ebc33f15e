{"code":"import { observable, set } from 'mobx';\r\nimport { MODEL_REQUIRED } from '../errors';\r\nimport { error } from '../helpers/format';\r\nimport { reducePrototypeChain } from '../helpers/selectors';\r\nvar DataStorage = /** @class */ (function () {\r\n    function DataStorage() {\r\n        this.modelData = new WeakMap();\r\n        this.modelClassData = new WeakMap();\r\n    }\r\n    DataStorage.prototype.initModel = function (model) {\r\n        var modelData = observable({ data: {}, meta: {} });\r\n        this.modelData.set(model, modelData);\r\n        return modelData;\r\n    };\r\n    DataStorage.prototype.getModelData = function (model) {\r\n        return this.__getModelData(model).data;\r\n    };\r\n    DataStorage.prototype.getModelDataKey = function (model, key) {\r\n        var modelData = this.__getModelData(model);\r\n        return modelData.data[key];\r\n    };\r\n    DataStorage.prototype.setModelData = function (model, data) {\r\n        var modelData = this.__getModelData(model);\r\n        set(modelData.data, data);\r\n    };\r\n    DataStorage.prototype.setModelDataKey = function (model, key, value) {\r\n        this.setModelData(model, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.getModelMeta = function (model) {\r\n        return this.modelData.get(model).meta;\r\n    };\r\n    DataStorage.prototype.getModelMetaKey = function (model, key) {\r\n        return this.getModelMeta(model)[key];\r\n    };\r\n    DataStorage.prototype.setModelMeta = function (model, meta) {\r\n        var modelData = this.__getModelData(model);\r\n        set(modelData.meta, meta);\r\n        return modelData.meta;\r\n    };\r\n    DataStorage.prototype.setModelMetaKey = function (model, key, value) {\r\n        this.setModelMeta(model, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.setModelClassMetaKey = function (model, key, value) {\r\n        var data = this.modelClassData.get(model);\r\n        Object.assign(data.meta, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.getModelClassMetaKey = function (obj, key) {\r\n        var _this = this;\r\n        return reducePrototypeChain(obj, function (value, model) {\r\n            return value || (_this.modelClassData.get(model) || { meta: {} }).meta[key] || null;\r\n        }, null);\r\n    };\r\n    DataStorage.prototype.addModelDefaultField = function (model, key, value) {\r\n        var data = this.modelClassData.get(model);\r\n        if (data) {\r\n            Object.assign(data.data, (_a = {}, _a[key] = value, _a));\r\n        }\r\n        else {\r\n            this.modelClassData.set(model, {\r\n                data: (_b = {}, _b[key] = value, _b),\r\n                meta: {},\r\n                references: {},\r\n            });\r\n        }\r\n        var _a, _b;\r\n    };\r\n    DataStorage.prototype.getModelDefaults = function (obj) {\r\n        var _this = this;\r\n        var defaults = reducePrototypeChain(obj, function (state, model) {\r\n            return state.concat((_this.modelClassData.get(model) || { data: [] }).data);\r\n        }, []);\r\n        return Object.assign.apply(Object, [{}].concat(defaults.reverse()));\r\n    };\r\n    DataStorage.prototype.addModelClassReference = function (model, key, options) {\r\n        if (!options.model && options.model !== 0) {\r\n            throw error(MODEL_REQUIRED);\r\n        }\r\n        var data = this.modelClassData.get(model);\r\n        if (data) {\r\n            Object.assign(data.references, (_a = {}, _a[key] = options, _a));\r\n        }\r\n        else {\r\n            this.modelClassData.set(model, {\r\n                data: {},\r\n                meta: {},\r\n                references: (_b = {}, _b[key] = options, _b),\r\n            });\r\n        }\r\n        var _a, _b;\r\n    };\r\n    DataStorage.prototype.getModelClassReferences = function (obj) {\r\n        var _this = this;\r\n        var defaults = reducePrototypeChain(obj, function (state, model) {\r\n            return state.concat((_this.modelClassData.get(model) || { references: {} }).references);\r\n        }, []);\r\n        return Object.assign.apply(Object, [{}].concat(defaults.reverse()));\r\n    };\r\n    DataStorage.prototype.getModelReferenceOptions = function (model, key) {\r\n        var refs = this.getModelMetaKey(model, 'refs');\r\n        return refs[key];\r\n    };\r\n    DataStorage.prototype.__getModelData = function (model) {\r\n        return this.modelData.get(model) || this.initModel(model);\r\n    };\r\n    // For testing purposes only\r\n    DataStorage.prototype.clear = function () {\r\n        this.modelData = new WeakMap();\r\n        this.modelClassData = new WeakMap();\r\n    };\r\n    return DataStorage;\r\n}());\r\nexport { DataStorage };\r\nexport var storage = new DataStorage();\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2aWNlcy9zdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBc0MsVUFBVSxFQUFFLEdBQUcsRUFBTyxNQUFNLE1BQU0sQ0FBQztBQUVoRixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUV4QyxPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQWMxRDtJQUFBO1FBQ1UsY0FBUyxHQUFHLElBQUksT0FBTyxFQUEyQixDQUFDO1FBRW5ELG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQW1ELENBQUM7SUFpSDFGLENBQUM7SUEvR1EsK0JBQVMsR0FBaEIsVUFBaUIsS0FBZ0I7UUFDL0IsSUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLEVBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFDLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRU0sa0NBQVksR0FBbkIsVUFBb0IsS0FBZ0I7UUFDbEMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ3pDLENBQUM7SUFFTSxxQ0FBZSxHQUF0QixVQUF1QixLQUFnQixFQUFFLEdBQVc7UUFDbEQsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRU0sa0NBQVksR0FBbkIsVUFBb0IsS0FBZ0IsRUFBRSxJQUFz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QUFNLFFBQVEsR0FBRyxvQkFBb0IsQ0FBQyxHQUFHLEVBQUUsVUFBQyxLQUFLLEVBQUUsS0FBSztZQUN0RCxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUMsVUFBVSxFQUFFLEVBQUUsRUFBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdkYsQ0FBQyxFQUFFLEVBQTZCLENBQUMsQ0FBQztRQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sT0FBYixNQUFNLEdBQVEsRUFBRSxTQUFLLFFBQVEsQ0FBQyxPQUFPLEVBQUUsR0FBRTtJQUNsRCxDQUFDO0lBRU0sOENBQXdCLEdBQS9CLFVBQWdDLEtBQWdCLEVBQUUsR0FBVztRQUMzRCxJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNqRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFFTyxvQ0FBYyxHQUF0QixVQUF1QixLQUFnQjtRQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQsNEJBQTRCO0lBQ3BCLDJCQUFLLEdBQWI7UUFDRSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksT0FBTyxFQUEyQixDQUFDO1FBQ3hELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxPQUFPLEVBQXFDLENBQUM7SUFDekUsQ0FBQztJQUNILGtCQUFDO0FBQUQsQ0FBQyxBQXBIRCxJQW9IQzs7QUFFRCxNQUFNLENBQUMsSUFBTSxPQUFPLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7ZmxhdHRlbiwgSURpY3Rpb25hcnksIHVuaXF9IGZyb20gJ2RhdHgtdXRpbHMnO1xuaW1wb3J0IHtJT2JzZXJ2YWJsZUFycmF5LCBJT2JzZXJ2YWJsZU9iamVjdCwgb2JzZXJ2YWJsZSwgc2V0LCB0b0pTfSBmcm9tICdtb2J4JztcblxuaW1wb3J0IHtNT0RFTF9SRVFVSVJFRH0gZnJvbSAnLi4vZXJyb3JzJztcbmltcG9ydCB7ZXJyb3J9IGZyb20gJy4uL2hlbHBlcnMvZm9ybWF0JztcbmltcG9ydCB7Z2V0TW9kZWxJZCwgZ2V0TW9kZWxUeXBlfSBmcm9tICcuLi9oZWxwZXJzL21vZGVsL3V0aWxzJztcbmltcG9ydCB7cmVkdWNlUHJvdG90eXBlQ2hhaW59IGZyb20gJy4uL2hlbHBlcnMvc2VsZWN0b3JzJztcbmltcG9ydCB7SURhdGFTdG9yYWdlfSBmcm9tICcuLi9pbnRlcmZhY2VzL0lEYXRhU3RvcmFnZSc7XG5pbXBvcnQge0lJZGVudGlmaWVyfSBmcm9tICcuLi9pbnRlcmZhY2VzL0lJZGVudGlmaWVyJztcbmltcG9ydCB7SVJlZmVyZW5jZU9wdGlvbnN9IGZyb20gJy4uL2ludGVyZmFjZXMvSVJlZmVyZW5jZU9wdGlvbnMnO1xuaW1wb3J0IHtJVHlwZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1B1cmVDb2xsZWN0aW9ufSBmcm9tICcuLi9QdXJlQ29sbGVjdGlvbic7XG5pbXBvcnQge1B1cmVNb2RlbH0gZnJvbSAnLi4vUHVyZU1vZGVsJztcblxuaW50ZXJmYWNlIElNb2RlbENsYXNzRGF0YSB7XG4gIGRhdGE6IElEaWN0aW9uYXJ5PGFueT47XG4gIG1ldGE6IElEaWN0aW9uYXJ5PGFueT47XG4gIHJlZmVyZW5jZXM6IElEaWN0aW9uYXJ5PElSZWZlcmVuY2VPcHRpb25zPjtcbn1cblxuZXhwb3J0IGNsYXNzIERhdGFTdG9yYWdlIHtcbiAgcHJpdmF0ZSBtb2RlbERhdGEgPSBuZXcgV2Vha01hcDxQdXJlTW9kZWwsIElEYXRhU3RvcmFnZT4oKTtcblxuICBwcml2YXRlIG1vZGVsQ2xhc3NEYXRhID0gbmV3IFdlYWtNYXA8dHlwZW9mIFB1cmVNb2RlbHx7dHlwZTogSVR5cGV9LCBJTW9kZWxDbGFzc0RhdGE+KCk7XG5cbiAgcHVibGljIGluaXRNb2RlbChtb2RlbDogUHVyZU1vZGVsKSB7XG4gICAgY29uc3QgbW9kZWxEYXRhID0gb2JzZXJ2YWJsZSh7ZGF0YToge30sIG1ldGE6IHt9fSk7XG4gICAgdGhpcy5tb2RlbERhdGEuc2V0KG1vZGVsLCBtb2RlbERhdGEpO1xuICAgIHJldHVybiBtb2RlbERhdGE7XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxEYXRhKG1vZGVsOiBQdXJlTW9kZWwpIHtcbiAgICByZXR1cm4gdGhpcy5fX2dldE1vZGVsRGF0YShtb2RlbCkuZGF0YTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNb2RlbERhdGFLZXkobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcpIHtcbiAgICBjb25zdCBtb2RlbERhdGEgPSB0aGlzLl9fZ2V0TW9kZWxEYXRhKG1vZGVsKTtcbiAgICByZXR1cm4gbW9kZWxEYXRhLmRhdGFba2V5XTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRNb2RlbERhdGEobW9kZWw6IFB1cmVNb2RlbCwgZGF0YTogSURpY3Rpb25hcnk8YW55Pikge1xuICAgIGNvbnN0IG1vZGVsRGF0YSA9IHRoaXMuX19nZXRNb2RlbERhdGEobW9kZWwpO1xuICAgIHNldChtb2RlbERhdGEuZGF0YSwgZGF0YSk7XG4gIH1cblxuICBwdWJsaWMgc2V0TW9kZWxEYXRhS2V5KG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCB2YWx1ZT86IGFueSkge1xuICAgIHRoaXMuc2V0TW9kZWxEYXRhKG1vZGVsLCB7W2tleV06IHZhbHVlfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxNZXRhKG1vZGVsOiBQdXJlTW9kZWwpOiBJRGljdGlvbmFyeTxhbnk+IHtcbiAgICByZXR1cm4gKHRoaXMubW9kZWxEYXRhLmdldChtb2RlbCkgYXMgSURhdGFTdG9yYWdlKS5tZXRhO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsTWV0YUtleShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TW9kZWxNZXRhKG1vZGVsKVtrZXldO1xuICB9XG5cbiAgcHVibGljIHNldE1vZGVsTWV0YShtb2RlbDogUHVyZU1vZGVsLCBtZXRhOiBJRGljdGlvbmFyeTxhbnk+KSB7XG4gICAgY29uc3QgbW9kZWxEYXRhID0gdGhpcy5fX2dldE1vZGVsRGF0YShtb2RlbCk7XG4gICAgc2V0KG1vZGVsRGF0YS5tZXRhLCBtZXRhKTtcbiAgICByZXR1cm4gbW9kZWxEYXRhLm1ldGE7XG4gIH1cblxuICBwdWJsaWMgc2V0TW9kZWxNZXRhS2V5KG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCB2YWx1ZT86IGFueSkge1xuICAgIHRoaXMuc2V0TW9kZWxNZXRhKG1vZGVsLCB7W2tleV06IHZhbHVlfSk7XG4gIH1cblxuICBwdWJsaWMgc2V0TW9kZWxDbGFzc01ldGFLZXkobW9kZWw6IHR5cGVvZiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCB2YWx1ZT86IGFueSkge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCkgYXMgSU1vZGVsQ2xhc3NEYXRhO1xuICAgIE9iamVjdC5hc3NpZ24oZGF0YS5tZXRhLCB7W2tleV06IHZhbHVlfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxDbGFzc01ldGFLZXkob2JqOiB0eXBlb2YgUHVyZU1vZGVsLCBrZXk6IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHJlZHVjZVByb3RvdHlwZUNoYWluKG9iaiwgKHZhbHVlLCBtb2RlbCkgPT4ge1xuICAgICAgcmV0dXJuIHZhbHVlIHx8ICh0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCkgfHwge21ldGE6IHt9fSkubWV0YVtrZXldIHx8IG51bGw7XG4gICAgfSwgbnVsbCk7XG4gIH1cblxuICBwdWJsaWMgYWRkTW9kZWxEZWZhdWx0RmllbGQobW9kZWw6IHR5cGVvZiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCB2YWx1ZT86IGFueSkge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCk7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24oZGF0YS5kYXRhLCB7W2tleV06IHZhbHVlfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubW9kZWxDbGFzc0RhdGEuc2V0KG1vZGVsLCB7XG4gICAgICAgIGRhdGE6IHtba2V5XTogdmFsdWV9LFxuICAgICAgICBtZXRhOiB7fSxcbiAgICAgICAgcmVmZXJlbmNlczoge30sXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxEZWZhdWx0cyhvYmo6IHR5cGVvZiBQdXJlTW9kZWwpOiBJRGljdGlvbmFyeTxhbnk+IHtcbiAgICBjb25zdCBkZWZhdWx0cyA9IHJlZHVjZVByb3RvdHlwZUNoYWluKG9iaiwgKHN0YXRlLCBtb2RlbCkgPT4ge1xuICAgICAgcmV0dXJuIHN0YXRlLmNvbmNhdCgodGhpcy5tb2RlbENsYXNzRGF0YS5nZXQobW9kZWwpIHx8IHtkYXRhOiBbXX0pLmRhdGEpO1xuICAgIH0sIFtdIGFzIEFycmF5PElEaWN0aW9uYXJ5PGFueT4+KTtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgLi4uZGVmYXVsdHMucmV2ZXJzZSgpKTtcbiAgfVxuXG4gIHB1YmxpYyBhZGRNb2RlbENsYXNzUmVmZXJlbmNlKG1vZGVsOiB0eXBlb2YgUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgb3B0aW9uczogSVJlZmVyZW5jZU9wdGlvbnMpIHtcbiAgICBpZiAoIW9wdGlvbnMubW9kZWwgJiYgb3B0aW9ucy5tb2RlbCAhPT0gMCkge1xuICAgICAgdGhyb3cgZXJyb3IoTU9ERUxfUkVRVUlSRUQpO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCk7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24oZGF0YS5yZWZlcmVuY2VzLCB7W2tleV06IG9wdGlvbnN9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tb2RlbENsYXNzRGF0YS5zZXQobW9kZWwsIHtcbiAgICAgICAgZGF0YToge30sXG4gICAgICAgIG1ldGE6IHt9LFxuICAgICAgICByZWZlcmVuY2VzOiB7W2tleV06IG9wdGlvbnN9LFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldE1vZGVsQ2xhc3NSZWZlcmVuY2VzKG9iajogdHlwZW9mIFB1cmVNb2RlbCk6IElEaWN0aW9uYXJ5PElSZWZlcmVuY2VPcHRpb25zPiB7XG4gICAgY29uc3QgZGVmYXVsdHMgPSByZWR1Y2VQcm90b3R5cGVDaGFpbihvYmosIChzdGF0ZSwgbW9kZWwpID0+IHtcbiAgICAgIHJldHVybiBzdGF0ZS5jb25jYXQoKHRoaXMubW9kZWxDbGFzc0RhdGEuZ2V0KG1vZGVsKSB8fCB7cmVmZXJlbmNlczoge319KS5yZWZlcmVuY2VzKTtcbiAgICB9LCBbXSBhcyBBcnJheTxJRGljdGlvbmFyeTxhbnk+Pik7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIC4uLmRlZmF1bHRzLnJldmVyc2UoKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxSZWZlcmVuY2VPcHRpb25zKG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nKTogSVJlZmVyZW5jZU9wdGlvbnMge1xuICAgIGNvbnN0IHJlZnMgPSB0aGlzLmdldE1vZGVsTWV0YUtleShtb2RlbCwgJ3JlZnMnKTtcbiAgICByZXR1cm4gcmVmc1trZXldO1xuICB9XG5cbiAgcHJpdmF0ZSBfX2dldE1vZGVsRGF0YShtb2RlbDogUHVyZU1vZGVsKTogSURhdGFTdG9yYWdlIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbERhdGEuZ2V0KG1vZGVsKSB8fCB0aGlzLmluaXRNb2RlbChtb2RlbCk7XG4gIH1cblxuICAvLyBGb3IgdGVzdGluZyBwdXJwb3NlcyBvbmx5XG4gIHByaXZhdGUgY2xlYXIoKSB7XG4gICAgdGhpcy5tb2RlbERhdGEgPSBuZXcgV2Vha01hcDxQdXJlTW9kZWwsIElEYXRhU3RvcmFnZT4oKTtcbiAgICB0aGlzLm1vZGVsQ2xhc3NEYXRhID0gbmV3IFdlYWtNYXA8dHlwZW9mIFB1cmVNb2RlbCwgSU1vZGVsQ2xhc3NEYXRhPigpO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBzdG9yYWdlID0gbmV3IERhdGFTdG9yYWdlKCk7XG4iXX0=","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/services/storage.d.ts","text":"import { IDictionary } from 'datx-utils';\r\nimport { IObservableObject } from 'mobx';\r\nimport { IReferenceOptions } from '../interfaces/IReferenceOptions';\r\nimport { PureModel } from '../PureModel';\r\nexport declare class DataStorage {\r\n    private modelData;\r\n    private modelClassData;\r\n    initModel(model: PureModel): {\r\n        data: {};\r\n        meta: {};\r\n    } & IObservableObject;\r\n    getModelData(model: PureModel): IDictionary<any>;\r\n    getModelDataKey(model: PureModel, key: string): any;\r\n    setModelData(model: PureModel, data: IDictionary<any>): void;\r\n    setModelDataKey(model: PureModel, key: string, value?: any): void;\r\n    getModelMeta(model: PureModel): IDictionary<any>;\r\n    getModelMetaKey(model: PureModel, key: string): any;\r\n    setModelMeta(model: PureModel, meta: IDictionary<any>): IDictionary<any>;\r\n    setModelMetaKey(model: PureModel, key: string, value?: any): void;\r\n    setModelClassMetaKey(model: typeof PureModel, key: string, value?: any): void;\r\n    getModelClassMetaKey(obj: typeof PureModel, key: string): any;\r\n    addModelDefaultField(model: typeof PureModel, key: string, value?: any): void;\r\n    getModelDefaults(obj: typeof PureModel): IDictionary<any>;\r\n    addModelClassReference(model: typeof PureModel, key: string, options: IReferenceOptions): void;\r\n    getModelClassReferences(obj: typeof PureModel): IDictionary<IReferenceOptions>;\r\n    getModelReferenceOptions(model: PureModel, key: string): IReferenceOptions;\r\n    private __getModelData(model);\r\n    private clear();\r\n}\r\nexport declare const storage: DataStorage;\r\n"}}
