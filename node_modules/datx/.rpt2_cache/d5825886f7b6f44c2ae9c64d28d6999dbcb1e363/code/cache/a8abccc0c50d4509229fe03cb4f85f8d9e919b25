{"code":"import { UNDEFINED_MODEL, UNDEFINED_TYPE } from '../errors';\r\nimport { PureModel } from '../PureModel';\r\nimport { error } from './format';\r\nimport { getMetaKeyFromRaw, updateModel } from './model/utils';\r\nfunction initCollectionModel(collection, data) {\r\n    var type = getMetaKeyFromRaw(data, 'type');\r\n    return upsertModel(data, type, collection);\r\n}\r\nexport function upsertModel(data, type, collection) {\r\n    if (!type && type !== 0) {\r\n        throw error(UNDEFINED_TYPE);\r\n    }\r\n    var staticCollection = collection.constructor;\r\n    var TypeModel = staticCollection.types.find(function (item) { return item.type === type; }) || staticCollection.defaultModel;\r\n    if (!TypeModel) {\r\n        throw error(UNDEFINED_MODEL, { type: type });\r\n    }\r\n    var id = getMetaKeyFromRaw(data, 'id', TypeModel);\r\n    var existingModel = id && collection.find(type, id);\r\n    if (existingModel) {\r\n        return updateModel(existingModel, data);\r\n    }\r\n    return new TypeModel(data, collection);\r\n}\r\nexport function isSelectorFunction(fn) {\r\n    return (typeof fn === 'function') && (fn !== PureModel && !(fn.prototype instanceof PureModel));\r\n}\r\nexport function initModels(collection, data) {\r\n    return data.map(function (item) { return initCollectionModel(collection, item); });\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9oZWxwZXJzL2NvbGxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFDLGVBQWUsRUFBRSxjQUFjLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFHMUQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUV2QyxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQy9CLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxXQUFXLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFN0QsNkJBQTZCLFVBQTBCLEVBQUUsSUFBZTtJQUN0RSxJQUFNLElBQUksR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDN0MsT0FBTyxXQUFXLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztBQUM3QyxDQUFDO0FBRUQsTUFBTSxzQkFBc0IsSUFBZSxFQUFFLElBQTRCLEVBQUUsVUFBMEI7SUFDbkcsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLEtBQUssQ0FBQyxFQUFFO1FBQ3ZCLE1BQU0sS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0tBQzdCO0lBRUQsSUFBTSxnQkFBZ0IsR0FBRyxVQUFVLENBQUMsV0FBb0MsQ0FBQztJQUN6RSxJQUFNLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLEVBQWxCLENBQWtCLENBQUMsSUFBSSxnQkFBZ0IsQ0FBQyxZQUFZLENBQUM7SUFDN0csSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUNkLE1BQU0sS0FBSyxDQUFDLGVBQWUsRUFBRSxFQUFDLElBQUksTUFBQSxFQUFDLENBQUMsQ0FBQztLQUN0QztJQUVELElBQU0sRUFBRSxHQUFHLGlCQUFpQixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBdUMsQ0FBQyxDQUFDO0lBQ2xGLElBQU0sYUFBYSxHQUFHLEVBQUUsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN0RCxJQUFJLGFBQWEsRUFBRTtRQUNqQixPQUFPLFdBQVcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDekM7SUFFRCxPQUFPLElBQUksU0FBUyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztBQUN6QyxDQUFDO0FBRUQsTUFBTSw2QkFBNkIsRUFBTztJQUN4QyxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssU0FBUyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsU0FBUyxZQUFZLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDbEcsQ0FBQztBQUVELE1BQU0scUJBQXFCLFVBQTBCLEVBQUUsSUFBc0I7SUFDM0UsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsbUJBQW1CLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFyQyxDQUFxQyxDQUFDLENBQUM7QUFDbkUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SVJhd01vZGVsfSBmcm9tICdkYXR4LXV0aWxzJztcblxuaW1wb3J0IHtVTkRFRklORURfTU9ERUwsIFVOREVGSU5FRF9UWVBFfSBmcm9tICcuLi9lcnJvcnMnO1xuaW1wb3J0IHtJVHlwZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1B1cmVDb2xsZWN0aW9ufSBmcm9tICcuLi9QdXJlQ29sbGVjdGlvbic7XG5pbXBvcnQge1B1cmVNb2RlbH0gZnJvbSAnLi4vUHVyZU1vZGVsJztcbmltcG9ydCB7c3RvcmFnZX0gZnJvbSAnLi4vc2VydmljZXMvc3RvcmFnZSc7XG5pbXBvcnQge2Vycm9yfSBmcm9tICcuL2Zvcm1hdCc7XG5pbXBvcnQge2dldE1ldGFLZXlGcm9tUmF3LCB1cGRhdGVNb2RlbH0gZnJvbSAnLi9tb2RlbC91dGlscyc7XG5cbmZ1bmN0aW9uIGluaXRDb2xsZWN0aW9uTW9kZWwoY29sbGVjdGlvbjogUHVyZUNvbGxlY3Rpb24sIGRhdGE6IElSYXdNb2RlbCk6IFB1cmVNb2RlbCB7XG4gIGNvbnN0IHR5cGUgPSBnZXRNZXRhS2V5RnJvbVJhdyhkYXRhLCAndHlwZScpO1xuICByZXR1cm4gdXBzZXJ0TW9kZWwoZGF0YSwgdHlwZSwgY29sbGVjdGlvbik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cHNlcnRNb2RlbChkYXRhOiBJUmF3TW9kZWwsIHR5cGU6IElUeXBlfHR5cGVvZiBQdXJlTW9kZWwsIGNvbGxlY3Rpb246IFB1cmVDb2xsZWN0aW9uKTogUHVyZU1vZGVsIHtcbiAgaWYgKCF0eXBlICYmIHR5cGUgIT09IDApIHtcbiAgICB0aHJvdyBlcnJvcihVTkRFRklORURfVFlQRSk7XG4gIH1cblxuICBjb25zdCBzdGF0aWNDb2xsZWN0aW9uID0gY29sbGVjdGlvbi5jb25zdHJ1Y3RvciBhcyB0eXBlb2YgUHVyZUNvbGxlY3Rpb247XG4gIGNvbnN0IFR5cGVNb2RlbCA9IHN0YXRpY0NvbGxlY3Rpb24udHlwZXMuZmluZCgoaXRlbSkgPT4gaXRlbS50eXBlID09PSB0eXBlKSB8fCBzdGF0aWNDb2xsZWN0aW9uLmRlZmF1bHRNb2RlbDtcbiAgaWYgKCFUeXBlTW9kZWwpIHtcbiAgICB0aHJvdyBlcnJvcihVTkRFRklORURfTU9ERUwsIHt0eXBlfSk7XG4gIH1cblxuICBjb25zdCBpZCA9IGdldE1ldGFLZXlGcm9tUmF3KGRhdGEsICdpZCcsIFR5cGVNb2RlbCBhcyB0eXBlb2YgUHVyZU1vZGVsfHVuZGVmaW5lZCk7XG4gIGNvbnN0IGV4aXN0aW5nTW9kZWwgPSBpZCAmJiBjb2xsZWN0aW9uLmZpbmQodHlwZSwgaWQpO1xuICBpZiAoZXhpc3RpbmdNb2RlbCkge1xuICAgIHJldHVybiB1cGRhdGVNb2RlbChleGlzdGluZ01vZGVsLCBkYXRhKTtcbiAgfVxuXG4gIHJldHVybiBuZXcgVHlwZU1vZGVsKGRhdGEsIGNvbGxlY3Rpb24pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTZWxlY3RvckZ1bmN0aW9uKGZuOiBhbnkpIHtcbiAgcmV0dXJuICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpICYmIChmbiAhPT0gUHVyZU1vZGVsICYmICEoZm4ucHJvdG90eXBlIGluc3RhbmNlb2YgUHVyZU1vZGVsKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0TW9kZWxzKGNvbGxlY3Rpb246IFB1cmVDb2xsZWN0aW9uLCBkYXRhOiBBcnJheTxJUmF3TW9kZWw+KSB7XG4gIHJldHVybiBkYXRhLm1hcCgoaXRlbSkgPT4gaW5pdENvbGxlY3Rpb25Nb2RlbChjb2xsZWN0aW9uLCBpdGVtKSk7XG59XG4iXX0=","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/helpers/collection.d.ts","text":"import { IRawModel } from 'datx-utils';\r\nimport { IType } from '../interfaces/IType';\r\nimport { PureCollection } from '../PureCollection';\r\nimport { PureModel } from '../PureModel';\r\nexport declare function upsertModel(data: IRawModel, type: IType | typeof PureModel, collection: PureCollection): PureModel;\r\nexport declare function isSelectorFunction(fn: any): boolean;\r\nexport declare function initModels(collection: PureCollection, data: Array<IRawModel>): PureModel[];\r\n"}}
