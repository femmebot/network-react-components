{"code":"import * as tslib_1 from \"tslib\";\r\nimport { action, computed, extendObservable, observable, set } from 'mobx';\r\nimport { MODEL_SINGLE_COLLECTION, UNDEFINED_TYPE, VIEW_NAME_TAKEN } from './errors';\r\nimport { initModels, isSelectorFunction, upsertModel } from './helpers/collection';\r\nimport { error } from './helpers/format';\r\nimport { getModelCollection, getModelId, getModelType, modelToJSON, setModelMetaKey, updateModel, } from './helpers/model/utils';\r\nimport { PureModel } from './PureModel';\r\nimport { View } from './View';\r\nvar PureCollection = /** @class */ (function () {\r\n    function PureCollection(data) {\r\n        if (data === void 0) { data = []; }\r\n        var _this = this;\r\n        this.__data = observable.array([], { deep: false });\r\n        this.__views = [];\r\n        this.__dataMap = {};\r\n        this.__dataList = {};\r\n        extendObservable(this, {});\r\n        if (data instanceof Array) {\r\n            this.insert(data);\r\n        }\r\n        else if (data && 'models' in data) {\r\n            this.insert(data.models);\r\n        }\r\n        var staticCollection = this.constructor;\r\n        var initViews = (data && 'views' in data) ? data.views : {};\r\n        Object.keys(staticCollection.views).forEach(function (key) {\r\n            var view = staticCollection.views[key];\r\n            var init = initViews[key] || view;\r\n            _this.addView(key, init.modelType, {\r\n                mixins: view.mixins,\r\n                models: init.models || [],\r\n                sortMethod: view.sortMethod,\r\n                unique: init.unique,\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * Function for inserting raw models into the collection. Used when hydrating the collection\r\n     *\r\n     * @param {Array<IRawModel>} data Raw model data\r\n     * @returns {Array<PureModel>} A list of initialized models\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.insert = function (data) {\r\n        var models = initModels(this, data);\r\n        this.__insertModel(models);\r\n        return models;\r\n    };\r\n    PureCollection.prototype.add = function (data, model) {\r\n        return (data instanceof Array) ? this.__addArray(data, model) : this.__addSingle(data, model);\r\n    };\r\n    PureCollection.prototype.find = function (model, id) {\r\n        if (id instanceof PureModel) {\r\n            return id;\r\n        }\r\n        return isSelectorFunction(model)\r\n            ? (this.__data.find(model) || null)\r\n            : (this.__findByType(model, id) || null);\r\n    };\r\n    /**\r\n     * Filter models based on a matching function\r\n     *\r\n     * @param {TFilterFn} test Function used to match the models\r\n     * @returns {(PureModel|null)} The matching models\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.filter = function (test) {\r\n        return this.__data.filter(test);\r\n    };\r\n    /**\r\n     * Find all matching models or all models if no type is given\r\n     *\r\n     * @param {(IType|typeof PureModel)} [model] Model type to select\r\n     * @returns {Array<PureModel>} List of matching models\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.findAll = function (model) {\r\n        if (model) {\r\n            var type = getModelType(model);\r\n            if (!(type in this.__dataList)) {\r\n                set(this.__dataList, (_a = {}, _a[type] = observable.array([]), _a));\r\n            }\r\n            return this.__dataList[type];\r\n        }\r\n        return this.__data;\r\n        var _a;\r\n    };\r\n    /**\r\n     * Check if a model is in the collection\r\n     *\r\n     * @param {PureModel} model Model to check\r\n     * @returns {boolean} The given model is in the collection\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.hasItem = function (model) {\r\n        var id = getModelId(model);\r\n        return Boolean(this.find(model, id));\r\n    };\r\n    PureCollection.prototype.remove = function (obj, id) {\r\n        var model = typeof obj === 'object' ? obj : this.find(obj, id);\r\n        if (model) {\r\n            this.__removeModel(model);\r\n        }\r\n    };\r\n    /**\r\n     * Remove all models of the given model type from the collection\r\n     *\r\n     * @param {(IType|typeof PureModel)} type Model type\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.removeAll = function (type) {\r\n        this.__removeModel(this.findAll(type).slice());\r\n    };\r\n    Object.defineProperty(PureCollection.prototype, \"length\", {\r\n        /**\r\n         * A total count of models in the collection\r\n         *\r\n         * @readonly\r\n         * @type {number}\r\n         * @memberof Collection\r\n         */\r\n        get: function () {\r\n            return this.__data.length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Get the serializable value of the collection\r\n     *\r\n     * @returns {IRawCollection} Pure JS value of the collection\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.toJSON = function () {\r\n        var _this = this;\r\n        var views = {};\r\n        this.__views.forEach(function (key) {\r\n            views[key] = _this[key].toJSON();\r\n        });\r\n        return {\r\n            models: this.__data.map(modelToJSON),\r\n            views: views,\r\n        };\r\n    };\r\n    Object.defineProperty(PureCollection.prototype, \"snapshot\", {\r\n        get: function () {\r\n            return this.toJSON();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Reset the collection (remove all models)\r\n     *\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.reset = function () {\r\n        this.__data.map(function (model) { return setModelMetaKey(model, 'collection', undefined); });\r\n        this.__data.replace([]);\r\n        this.__dataList = observable({});\r\n        this.__dataMap = observable({});\r\n    };\r\n    PureCollection.prototype.getAllModels = function () {\r\n        return this.__data.slice();\r\n    };\r\n    /**\r\n     * Add a view to the collection\r\n     *\r\n     * @template T Model type of the view\r\n     * @param {string} name View name\r\n     * @param {(IModelConstructor<T>|IType)} type Model type the view will represent\r\n     * @param {({\r\n     *       sortMethod?: string|((item: T) => any),\r\n     *       models?: Array<IIdentifier|PureModel>,\r\n     *       unique?: boolean,\r\n     *       mixins?: Array<(view: any) => any>,\r\n     *     })} [{sortMethod, models, unique, mixins}={}] View options\r\n     * @returns {View} The created view\r\n     * @memberof PureCollection\r\n     */\r\n    PureCollection.prototype.addView = function (name, type, _a) {\r\n        var _b = _a === void 0 ? {} : _a, sortMethod = _b.sortMethod, models = _b.models, unique = _b.unique, mixins = _b.mixins;\r\n        if (name in this) {\r\n            throw error(VIEW_NAME_TAKEN);\r\n        }\r\n        var ViewConstructor = mixins\r\n            ? mixins.reduce(function (view, mixin) {\r\n                return mixin(view);\r\n            }, View)\r\n            : View;\r\n        this.__views.push(name);\r\n        this[name] = new ViewConstructor(type, this, sortMethod, models, unique);\r\n        return this[name];\r\n    };\r\n    PureCollection.prototype.__addArray = function (data, model) {\r\n        var _this = this;\r\n        return data.filter(Boolean).map(function (item) { return _this.__addSingle(item, model); });\r\n    };\r\n    PureCollection.prototype.__addSingle = function (data, model) {\r\n        if (!data || typeof data === 'number' || typeof data === 'string') {\r\n            return data;\r\n        }\r\n        if (data instanceof PureModel) {\r\n            if (!this.hasItem(data)) {\r\n                this.__insertModel(data);\r\n            }\r\n            return data;\r\n        }\r\n        if (!model && model !== 0) {\r\n            throw error(UNDEFINED_TYPE);\r\n        }\r\n        var type = getModelType(model);\r\n        var modelInstance = upsertModel(data, type, this);\r\n        this.__insertModel(modelInstance, type);\r\n        return modelInstance;\r\n    };\r\n    PureCollection.prototype.__insertModel = function (model, type, id) {\r\n        var _this = this;\r\n        if (model instanceof Array) {\r\n            return model.forEach(function (item) { return _this.__insertModel(item, type, id); });\r\n        }\r\n        var collection = getModelCollection(model);\r\n        if (collection && collection !== this) {\r\n            throw error(MODEL_SINGLE_COLLECTION);\r\n        }\r\n        var modelType = type || getModelType(model);\r\n        var modelId = id || getModelId(model);\r\n        var stringType = modelType.toString();\r\n        var existingModel = this.find(modelType, modelId);\r\n        if (existingModel) {\r\n            updateModel(existingModel, model);\r\n            return;\r\n        }\r\n        this.__data.push(model);\r\n        if (modelType in this.__dataList) {\r\n            this.__dataList[modelType].push(model);\r\n        }\r\n        else {\r\n            set(this.__dataList, stringType, observable.array([model], { deep: false }));\r\n        }\r\n        if (modelType in this.__dataMap) {\r\n            set(this.__dataMap[modelType], modelId.toString(), model);\r\n        }\r\n        else {\r\n            set(this.__dataMap, stringType, observable.shallowObject((_a = {}, _a[modelId] = model, _a)));\r\n        }\r\n        setModelMetaKey(model, 'collection', this);\r\n        var _a;\r\n    };\r\n    PureCollection.prototype.__removeModel = function (model, type, id) {\r\n        var _this = this;\r\n        if (model instanceof Array) {\r\n            return model.forEach(function (item) { return _this.__removeModel(item, type, id); });\r\n        }\r\n        var modelType = type || getModelType(model);\r\n        var modelId = id || getModelId(model);\r\n        this.__data.remove(model);\r\n        this.__dataList[modelType].remove(model);\r\n        set(this.__dataMap[modelType], modelId.toString(), undefined);\r\n        setModelMetaKey(model, 'collection', undefined);\r\n    };\r\n    PureCollection.prototype.__findByType = function (model, id) {\r\n        var type = getModelType(model);\r\n        var stringType = type.toString();\r\n        if (id) {\r\n            if (!(type in this.__dataMap)) {\r\n                set(this.__dataMap, stringType, (_a = {}, _a[id] = undefined, _a));\r\n            }\r\n            else if (!(id in this.__dataMap[type])) {\r\n                set(this.__dataMap[type], id.toString(), undefined);\r\n            }\r\n            return this.__dataMap[type][id];\r\n        }\r\n        else {\r\n            if (!(type in this.__dataList)) {\r\n                set(this.__dataList, stringType, observable.array([], { deep: false }));\r\n            }\r\n            return this.__dataList[type].length ? this.__dataList[type][0] : null;\r\n        }\r\n        var _a;\r\n    };\r\n    PureCollection.prototype.__changeModelId = function (oldId, newId, type) {\r\n        this.__dataMap[type][newId] = this.__dataMap[type][oldId];\r\n        delete this.__dataMap[type][oldId];\r\n    };\r\n    /**\r\n     * List of models available in the collection\r\n     *\r\n     * @static\r\n     * @type {Array<typeof PureModel>}\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.types = [];\r\n    PureCollection.views = {};\r\n    tslib_1.__decorate([\r\n        observable\r\n    ], PureCollection.prototype, \"__dataMap\", void 0);\r\n    tslib_1.__decorate([\r\n        observable\r\n    ], PureCollection.prototype, \"__dataList\", void 0);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"insert\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"add\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"remove\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"removeAll\", null);\r\n    tslib_1.__decorate([\r\n        computed\r\n    ], PureCollection.prototype, \"length\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"reset\", null);\r\n    return PureCollection;\r\n}());\r\nexport { PureCollection };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHVyZUNvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvUHVyZUNvbGxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFZLGdCQUFnQixFQUF1QyxVQUFVLEVBQUUsR0FBRyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRXhILE9BQU8sRUFBQyx1QkFBdUIsRUFBbUIsY0FBYyxFQUFFLGVBQWUsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUNuRyxPQUFPLEVBQUMsVUFBVSxFQUFFLGtCQUFrQixFQUFFLFdBQVcsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2pGLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxrQkFBa0IsQ0FBQztBQUN2QyxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLGVBQWUsRUFDZixXQUFXLEdBQ1osTUFBTSx1QkFBdUIsQ0FBQztBQU8vQixPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQ3RDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFFNUI7SUEyQkUsd0JBQVksSUFBMEM7UUFBMUMscUJBQUEsRUFBQSxTQUEwQztRQUF0RCxpQkFvQkM7UUEzQk8sV0FBTSxHQUFnQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBRTFFLFlBQU8sR0FBa0IsRUFBRSxDQUFDO1FBRWhCLGNBQVMsR0FBd0MsRUFBRSxDQUFDO1FBQ3BELGVBQVUsR0FBNkMsRUFBRSxDQUFDO1FBRzVFLGdCQUFnQixDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzQixJQUFJLElBQUksWUFBWSxLQUFLLEVBQUU7WUFDekIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNuQjthQUFNLElB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LENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1NBQ3ZFOztJQUNILENBQUM7SUFFTyx3Q0FBZSxHQUF2QixVQUF3QixLQUFrQixFQUFFLEtBQWtCLEVBQUUsSUFBVztRQUN6RSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUF0WkQ7Ozs7OztPQU1HO0lBQ1csb0JBQUssR0FBeUQsRUFBRSxDQUFDO0lBRWpFLG9CQUFLLEdBS2QsRUFBRSxDQUFDO0lBUUk7UUFBWCxVQUFVO3FEQUE2RDtJQUM1RDtRQUFYLFVBQVU7c0RBQW1FO0lBK0J0RTtRQUFQLE1BQU07Z0RBSU47SUE0Q087UUFBUCxNQUFNOzZDQUtOO0lBeUZPO1FBQVAsTUFBTTtnREFLTjtJQVFPO1FBQVAsTUFBTTttREFFTjtJQVNTO1FBQVQsUUFBUTtnREFFUjtJQThCTztRQUFQLE1BQU07K0NBS047SUFzSkgscUJBQUM7Q0FBQSxBQXpaRCxJQXlaQztTQXpaWSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJRGljdGlvbmFyeSwgSVJhd01vZGVsfSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7YWN0aW9uLCBjb21wdXRlZCwgZGVjb3JhdGUsIGV4dGVuZE9ic2VydmFibGUsIElPYnNlcnZhYmxlQXJyYXksIElPYnNlcnZhYmxlT2JqZWN0LCBvYnNlcnZhYmxlLCBzZXR9IGZyb20gJ21vYngnO1xuXG5pbXBvcnQge01PREVMX1NJTkdMRV9DT0xMRUNUSU9OLCBVTkRFRklORURfTU9ERUwsIFVOREVGSU5FRF9UWVBFLCBWSUVXX05BTUVfVEFLRU59IGZyb20gJy4vZXJyb3JzJztcbmltcG9ydCB7aW5pdE1vZGVscywgaXNTZWxlY3RvckZ1bmN0aW9uLCB1cHNlcnRNb2RlbH0gZnJvbSAnLi9oZWxwZXJzL2NvbGxlY3Rpb24nO1xuaW1wb3J0IHtlcnJvcn0gZnJvbSAnLi9oZWxwZXJzL2Zvcm1hdCc7XG5pbXBvcnQge1xuICBnZXRNb2RlbENvbGxlY3Rpb24sXG4gIGdldE1vZGVsSWQsXG4gIGdldE1vZGVsVHlwZSxcbiAgbW9kZWxUb0pTT04sXG4gIHNldE1vZGVsTWV0YUtleSxcbiAgdXBkYXRlTW9kZWwsXG59IGZyb20gJy4vaGVscGVycy9tb2RlbC91dGlscyc7XG5pbXBvcnQge0lJZGVudGlmaWVyfSBmcm9tICcuL2ludGVyZmFjZXMvSUlkZW50aWZpZXInO1xuaW1wb3J0IHtJTW9kZWxDb25zdHJ1Y3Rvcn0gZnJvbSAnLi9pbnRlcmZhY2VzL0lNb2RlbENvbnN0cnVjdG9yJztcbmltcG9ydCB7SVJhd0NvbGxlY3Rpb259IGZyb20gJy4vaW50ZXJmYWNlcy9JUmF3Q29sbGVjdGlvbic7XG5pbXBvcnQge0lSYXdWaWV3fSBmcm9tICcuL2ludGVyZmFjZXMvSVJhd1ZpZXcnO1xuaW1wb3J0IHtJVHlwZX0gZnJvbSAnLi9pbnRlcmZhY2VzL0lUeXBlJztcbmltcG9ydCB7VEZpbHRlckZufSBmcm9tICcuL2ludGVyZmFjZXMvVEZpbHRlckZuJztcbmltcG9ydCB7UHVyZU1vZGVsfSBmcm9tICcuL1B1cmVNb2RlbCc7XG5pbXBvcnQge1ZpZXd9IGZyb20gJy4vVmlldyc7XG5cbmV4cG9ydCBjbGFzcyBQdXJlQ29sbGVjdGlvbiB7XG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgbW9kZWxzIGF2YWlsYWJsZSBpbiB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEB0eXBlIHtBcnJheTx0eXBlb2YgUHVyZU1vZGVsPn1cbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgdHlwZXM6IEFycmF5PHR5cGVvZiBQdXJlTW9kZWx8SU1vZGVsQ29uc3RydWN0b3I8UHVyZU1vZGVsPj4gPSBbXTtcblxuICBwdWJsaWMgc3RhdGljIHZpZXdzOiBJRGljdGlvbmFyeTx7XG4gICAgbW9kZWxUeXBlOiBJVHlwZXxQdXJlTW9kZWwsXG4gICAgc29ydE1ldGhvZD86IHN0cmluZ3woKFB1cmVNb2RlbCkgPT4gYW55KTtcbiAgICB1bmlxdWU/OiBib29sZWFuO1xuICAgIG1peGlucz86IEFycmF5PCh2aWV3OiBhbnkpID0+IGFueT47XG4gIH0+ID0ge307XG5cbiAgcHVibGljIHN0YXRpYyBkZWZhdWx0TW9kZWw/OiB0eXBlb2YgUHVyZU1vZGVsO1xuXG4gIHByaXZhdGUgX19kYXRhOiBJT2JzZXJ2YWJsZUFycmF5PFB1cmVNb2RlbD4gPSBvYnNlcnZhYmxlLmFycmF5KFtdLCB7ZGVlcDogZmFsc2V9KTtcblxuICBwcml2YXRlIF9fdmlld3M6IEFycmF5PHN0cmluZz4gPSBbXTtcblxuICBAb2JzZXJ2YWJsZSBwcml2YXRlIF9fZGF0YU1hcDogSURpY3Rpb25hcnk8SURpY3Rpb25hcnk8UHVyZU1vZGVsPj4gPSB7fTtcbiAgQG9ic2VydmFibGUgcHJpdmF0ZSBfX2RhdGFMaXN0OiBJRGljdGlvbmFyeTxJT2JzZXJ2YWJsZUFycmF5PFB1cmVNb2RlbD4+ID0ge307XG5cbiAgY29uc3RydWN0b3IoZGF0YTogQXJyYXk8SVJhd01vZGVsPnxJUmF3Q29sbGVjdGlvbiA9IFtdKSB7XG4gICAgZXh0ZW5kT2JzZXJ2YWJsZSh0aGlzLCB7fSk7XG4gICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgdGhpcy5pbnNlcnQoZGF0YSk7XG4gICAgfSBlbHNlIGlmIChkYXRhICYmICdtb2RlbHMnIGluIGRhdGEpIHtcbiAgICAgIHRoaXMuaW5zZXJ0KGRhdGEubW9kZWxzKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0aWNDb2xsZWN0aW9uID0gdGhpcy5jb25zdHJ1Y3RvciBhcyB0eXBlb2YgUHVyZUNvbGxlY3Rpb247XG4gICAgY29uc3QgaW5pdFZpZXdzID0gKGRhdGEgJiYgJ3ZpZXdzJyBpbiBkYXRhKSA/IGRhdGEudmlld3MgOiB7fTtcbiAgICBPYmplY3Qua2V5cyhzdGF0aWNDb2xsZWN0aW9uLnZpZXdzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGNvbnN0IHZpZXcgPSBzdGF0aWNDb2xsZWN0aW9uLnZpZXdzW2tleV07XG4gICAgICBjb25zdCBpbml0ID0gaW5pdFZpZXdzW2tleV0gfHwgdmlldztcbiAgICAgIHRoaXMuYWRkVmlldyhrZXksIGluaXQubW9kZWxUeXBlLCB7XG4gICAgICAgIG1peGluczogdmlldy5taXhpbnMsXG4gICAgICAgIG1vZGVsczogaW5pdC5tb2RlbHMgfHwgW10sXG4gICAgICAgIHNvcnRNZXRob2Q6IHZpZXcuc29ydE1ldGhvZCxcbiAgICAgICAgdW5pcXVlOiBpbml0LnVuaXF1ZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGZvciBpbnNlcnRpbmcgcmF3IG1vZGVscyBpbnRvIHRoZSBjb2xsZWN0aW9uLiBVc2VkIHdoZW4gaHlkcmF0aW5nIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7QXJyYXk8SVJhd01vZGVsPn0gZGF0YSBSYXcgbW9kZWwgZGF0YVxuICAgKiBAcmV0dXJucyB7QXJyYXk8UHVyZU1vZGVsPn0gQSBsaXN0IG9mIGluaXRpYWxpemVkIG1vZGVsc1xuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgQGFjdGlvbiBwdWJsaWMgaW5zZXJ0KGRhdGE6IEFycmF5PFBhcnRpYWw8SVJhd01vZGVsPj4pOiBBcnJheTxQdXJlTW9kZWw+IHtcbiAgICBjb25zdCBtb2RlbHMgPSBpbml0TW9kZWxzKHRoaXMsIGRhdGEpO1xuICAgIHRoaXMuX19pbnNlcnRNb2RlbChtb2RlbHMpO1xuICAgIHJldHVybiBtb2RlbHM7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGV4aXN0aW5nIG1vZGVsIHRvIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSBUXG4gICAqIEBwYXJhbSB7VH0gZGF0YSBNb2RlbCB0byBiZSBhZGRlZFxuICAgKiBAcmV0dXJucyB7VH0gQWRkZWQgbW9kZWxcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBhZGQ8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogVCk6IFQ7XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBhcnJheSBvZiBleGlzdGluZyBtb2RlbHMgdG8gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHRlbXBsYXRlIFRcbiAgICogQHBhcmFtIHtBcnJheTxUPn0gZGF0YSBBcnJheSBvZiBtb2RlbHMgdG8gYmUgYWRkZWRcbiAgICogQHJldHVybnMge0FycmF5PFQ+fSBBZGRlZCBtb2RlbHNcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBhZGQ8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogQXJyYXk8VD4pOiBBcnJheTxUPjtcblxuICAvKipcbiAgICogQWRkIGFuIGFycmF5IG9mIG5ldyBtb2RlbHMgdG8gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHRlbXBsYXRlIFRcbiAgICogQHBhcmFtIHtBcnJheTxJUmF3TW9kZWx8SURpY3Rpb25hcnk8YW55Pj59IGRhdGEgQXJyYXkgb2YgbmV3IGRhdGEgdG8gYmUgYWRkZWRcbiAgICogQHBhcmFtIHsoSVR5cGV8SU1vZGVsQ29uc3RydWN0b3I8VD4pfSBtb2RlbCBNb2RlbCB0eXBlIHRvIGJlIGFkZGVkXG4gICAqIEByZXR1cm5zIHtBcnJheTxUPn0gQWRkZWQgbW9kZWxzXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgYWRkPFQgZXh0ZW5kcyBQdXJlTW9kZWw+KGRhdGE6IEFycmF5PElSYXdNb2RlbHxJRGljdGlvbmFyeTxhbnk+PiwgbW9kZWw6IElUeXBlfElNb2RlbENvbnN0cnVjdG9yPFQ+KTogQXJyYXk8VD47XG5cbiAgLyoqXG4gICAqIEFkZCBhIG5ldyBtb2RlbCB0byB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAdGVtcGxhdGUgVFxuICAgKiBAcGFyYW0geyhJUmF3TW9kZWx8SURpY3Rpb25hcnk8YW55Pil9IGRhdGEgTmV3IGRhdGEgdG8gYmUgYWRkZWRcbiAgICogQHBhcmFtIHsoSVR5cGV8SU1vZGVsQ29uc3RydWN0b3I8VD4pfSBtb2RlbCBNb2RlbCB0eXBlIHRvIGJlIGFkZGVkXG4gICAqIEByZXR1cm5zIHtUfSBBZGRlZCBtb2RlbFxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGFkZDxUIGV4dGVuZHMgUHVyZU1vZGVsPihkYXRhOiBJUmF3TW9kZWx8SURpY3Rpb25hcnk8YW55PiwgbW9kZWw6IElUeXBlfElNb2RlbENvbnN0cnVjdG9yPFQ+KTogVDtcblxuICBAYWN0aW9uIHB1YmxpYyBhZGQoXG4gICAgZGF0YTogUHVyZU1vZGVsfElSYXdNb2RlbHxJRGljdGlvbmFyeTxhbnk+fEFycmF5PFB1cmVNb2RlbD58QXJyYXk8SVJhd01vZGVsfElEaWN0aW9uYXJ5PGFueT4+LFxuICAgIG1vZGVsPzogSVR5cGV8SU1vZGVsQ29uc3RydWN0b3IsXG4gICk6IFB1cmVNb2RlbHxBcnJheTxQdXJlTW9kZWw+IHtcbiAgICByZXR1cm4gKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkgPyB0aGlzLl9fYWRkQXJyYXkoZGF0YSwgbW9kZWwpIDogdGhpcy5fX2FkZFNpbmdsZShkYXRhLCBtb2RlbCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhIG1vZGVsIGJhc2VkIG9uIHRoZSBkZWZpbmVkIHR5cGUgYW5kIChvcHRpb25hbCkgaWRlbnRpZmllclxuICAgKlxuICAgKiBAcGFyYW0geyhJVHlwZXx0eXBlb2YgUHVyZU1vZGVsfFB1cmVNb2RlbCl9IHR5cGUgTW9kZWwgdHlwZVxuICAgKiBAcGFyYW0ge0lJZGVudGlmaWVyfSBbaWRdIE1vZGVsIGlkZW50aWZpZXJcbiAgICogQHJldHVybnMgeyhQdXJlTW9kZWx8bnVsbCl9IFRoZSBmaXJzdCBtYXRjaGluZyBtb2RlbFxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGZpbmQ8VCBleHRlbmRzIFB1cmVNb2RlbD4odHlwZTogSVR5cGV8VHxJTW9kZWxDb25zdHJ1Y3RvcjxUPiwgaWQ/OiBJSWRlbnRpZmllcnxQdXJlTW9kZWwpOiBUfG51bGw7XG5cbiAgLyoqXG4gICAqIEZpbmQgYSBtb2RlbCBiYXNlZCBvbiBhIG1hdGNoaW5nIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7VEZpbHRlckZufSB0ZXN0IEZ1bmN0aW9uIHVzZWQgdG8gbWF0Y2ggdGhlIG1vZGVsXG4gICAqIEByZXR1cm5zIHsoUHVyZU1vZGVsfG51bGwpfSBUaGUgZmlyc3QgbWF0Y2hpbmcgbW9kZWxcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBmaW5kPFQgZXh0ZW5kcyBQdXJlTW9kZWw+KHRlc3Q6IFRGaWx0ZXJGbik6IFR8bnVsbDtcblxuICBwdWJsaWMgZmluZChtb2RlbDogSVR5cGV8dHlwZW9mIFB1cmVNb2RlbHwoVEZpbHRlckZuKSwgaWQ/OiBJSWRlbnRpZmllcnxQdXJlTW9kZWwpIHtcbiAgICBpZiAoaWQgaW5zdGFuY2VvZiBQdXJlTW9kZWwpIHtcbiAgICAgIHJldHVybiBpZDtcbiAgICB9XG5cbiAgICByZXR1cm4gaXNTZWxlY3RvckZ1bmN0aW9uKG1vZGVsKVxuICAgICAgPyAodGhpcy5fX2RhdGEuZmluZChtb2RlbCBhcyBURmlsdGVyRm4pIHx8IG51bGwpXG4gICAgICA6ICh0aGlzLl9fZmluZEJ5VHlwZShtb2RlbCBhcyB0eXBlb2YgUHVyZU1vZGVsLCBpZCkgfHwgbnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIG1vZGVscyBiYXNlZCBvbiBhIG1hdGNoaW5nIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7VEZpbHRlckZufSB0ZXN0IEZ1bmN0aW9uIHVzZWQgdG8gbWF0Y2ggdGhlIG1vZGVsc1xuICAgKiBAcmV0dXJucyB7KFB1cmVNb2RlbHxudWxsKX0gVGhlIG1hdGNoaW5nIG1vZGVsc1xuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGZpbHRlcih0ZXN0OiBURmlsdGVyRm4pOiBBcnJheTxQdXJlTW9kZWw+IHtcbiAgICByZXR1cm4gdGhpcy5fX2RhdGEuZmlsdGVyKHRlc3QpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgYWxsIG1hdGNoaW5nIG1vZGVscyBvciBhbGwgbW9kZWxzIGlmIG5vIHR5cGUgaXMgZ2l2ZW5cbiAgICpcbiAgICogQHBhcmFtIHsoSVR5cGV8dHlwZW9mIFB1cmVNb2RlbCl9IFttb2RlbF0gTW9kZWwgdHlwZSB0byBzZWxlY3RcbiAgICogQHJldHVybnMge0FycmF5PFB1cmVNb2RlbD59IExpc3Qgb2YgbWF0Y2hpbmcgbW9kZWxzXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgZmluZEFsbDxUIGV4dGVuZHMgUHVyZU1vZGVsPihtb2RlbD86IElUeXBlfElNb2RlbENvbnN0cnVjdG9yPFQ+KTogQXJyYXk8VD4ge1xuICAgIGlmIChtb2RlbCkge1xuICAgICAgY29uc3QgdHlwZSA9IGdldE1vZGVsVHlwZShtb2RlbCk7XG4gICAgICBpZiAoISh0eXBlIGluIHRoaXMuX19kYXRhTGlzdCkpIHtcbiAgICAgICAgc2V0KHRoaXMuX19kYXRhTGlzdCwge1t0eXBlXTogb2JzZXJ2YWJsZS5hcnJheShbXSl9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9fZGF0YUxpc3RbdHlwZV0gYXMgSU9ic2VydmFibGVBcnJheTxUPjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX19kYXRhIGFzIElPYnNlcnZhYmxlQXJyYXk8VD47XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSBtb2RlbCBpcyBpbiB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAcGFyYW0ge1B1cmVNb2RlbH0gbW9kZWwgTW9kZWwgdG8gY2hlY2tcbiAgICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBnaXZlbiBtb2RlbCBpcyBpbiB0aGUgY29sbGVjdGlvblxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGhhc0l0ZW0obW9kZWw6IFB1cmVNb2RlbCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGlkID0gZ2V0TW9kZWxJZChtb2RlbCk7XG4gICAgcmV0dXJuIEJvb2xlYW4odGhpcy5maW5kKG1vZGVsLCBpZCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSB0aGUgZmlyc3QgbW9kZWwgYmFzZWQgb24gdGhlIHR5cGUgYW5kIChvcHRpb25hbCkgaWRlbnRpZmllclxuICAgKlxuICAgKiBAcGFyYW0geyhJVHlwZXx0eXBlb2YgUHVyZU1vZGVsKX0gdHlwZSBNb2RlbCB0eXBlXG4gICAqIEBwYXJhbSB7SUlkZW50aWZpZXJ9IFtpZF0gTW9kZWwgaWRlbnRpZmllclxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIHJlbW92ZSh0eXBlOiBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsLCBpZD86IElJZGVudGlmaWVyKTtcblxuICAvKipcbiAgICogUmVtb3ZlIHRoZSBnaXZlbiBtb2RlbCBmcm9tIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7UHVyZU1vZGVsfSBtb2RlbCBNb2RlbCB0byBiZSByZW1vdmVkIGZyb20gdGhlIGNvbGxlY3Rpb25cbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyByZW1vdmUobW9kZWw6IFB1cmVNb2RlbCk7XG5cbiAgQGFjdGlvbiBwdWJsaWMgcmVtb3ZlKG9iajogSVR5cGV8dHlwZW9mIFB1cmVNb2RlbHxQdXJlTW9kZWwsIGlkPzogSUlkZW50aWZpZXIpIHtcbiAgICBjb25zdCBtb2RlbCA9IHR5cGVvZiBvYmogPT09ICdvYmplY3QnID8gb2JqIDogdGhpcy5maW5kKG9iaiwgaWQpO1xuICAgIGlmIChtb2RlbCkge1xuICAgICAgdGhpcy5fX3JlbW92ZU1vZGVsKG1vZGVsKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFsbCBtb2RlbHMgb2YgdGhlIGdpdmVuIG1vZGVsIHR5cGUgZnJvbSB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAcGFyYW0geyhJVHlwZXx0eXBlb2YgUHVyZU1vZGVsKX0gdHlwZSBNb2RlbCB0eXBlXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBAYWN0aW9uIHB1YmxpYyByZW1vdmVBbGwodHlwZTogSVR5cGV8dHlwZW9mIFB1cmVNb2RlbCkge1xuICAgIHRoaXMuX19yZW1vdmVNb2RlbCh0aGlzLmZpbmRBbGwodHlwZSkuc2xpY2UoKSk7XG4gIH1cblxuICAvKipcbiAgICogQSB0b3RhbCBjb3VudCBvZiBtb2RlbHMgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHJlYWRvbmx5XG4gICAqIEB0eXBlIHtudW1iZXJ9XG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBAY29tcHV0ZWQgcHVibGljIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fX2RhdGEubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc2VyaWFsaXphYmxlIHZhbHVlIG9mIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEByZXR1cm5zIHtJUmF3Q29sbGVjdGlvbn0gUHVyZSBKUyB2YWx1ZSBvZiB0aGUgY29sbGVjdGlvblxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIHRvSlNPTigpOiBJUmF3Q29sbGVjdGlvbiB7XG4gICAgY29uc3Qgdmlld3M6IElEaWN0aW9uYXJ5PElSYXdWaWV3PiA9IHt9O1xuXG4gICAgdGhpcy5fX3ZpZXdzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgdmlld3Nba2V5XSA9IHRoaXNba2V5XS50b0pTT04oKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBtb2RlbHM6IHRoaXMuX19kYXRhLm1hcChtb2RlbFRvSlNPTiksXG4gICAgICB2aWV3cyxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGdldCBzbmFwc2hvdCgpIHtcbiAgICByZXR1cm4gdGhpcy50b0pTT04oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgY29sbGVjdGlvbiAocmVtb3ZlIGFsbCBtb2RlbHMpXG4gICAqXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBAYWN0aW9uIHB1YmxpYyByZXNldCgpIHtcbiAgICB0aGlzLl9fZGF0YS5tYXAoKG1vZGVsKSA9PiBzZXRNb2RlbE1ldGFLZXkobW9kZWwsICdjb2xsZWN0aW9uJywgdW5kZWZpbmVkKSk7XG4gICAgdGhpcy5fX2RhdGEucmVwbGFjZShbXSk7XG4gICAgdGhpcy5fX2RhdGFMaXN0ID0gb2JzZXJ2YWJsZSh7fSkgYXMgSU9ic2VydmFibGVPYmplY3QgJiBJRGljdGlvbmFyeTxJT2JzZXJ2YWJsZUFycmF5PFB1cmVNb2RlbD4+O1xuICAgIHRoaXMuX19kYXRhTWFwID0gb2JzZXJ2YWJsZSh7fSkgYXMgSU9ic2VydmFibGVPYmplY3QgJklEaWN0aW9uYXJ5PElEaWN0aW9uYXJ5PFB1cmVNb2RlbD4+O1xuICB9XG5cbiAgcHVibGljIGdldEFsbE1vZGVscygpIHtcbiAgICByZXR1cm4gdGhpcy5fX2RhdGEuc2xpY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSB2aWV3IHRvIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSBUIE1vZGVsIHR5cGUgb2YgdGhlIHZpZXdcbiAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVmlldyBuYW1lXG4gICAqIEBwYXJhbSB7KElNb2RlbENvbnN0cnVjdG9yPFQ+fElUeXBlKX0gdHlwZSBNb2RlbCB0eXBlIHRoZSB2aWV3IHdpbGwgcmVwcmVzZW50XG4gICAqIEBwYXJhbSB7KHtcbiAgICogICAgICAgc29ydE1ldGhvZD86IHN0cmluZ3woKGl0ZW06IFQpID0+IGFueSksXG4gICAqICAgICAgIG1vZGVscz86IEFycmF5PElJZGVudGlmaWVyfFB1cmVNb2RlbD4sXG4gICAqICAgICAgIHVuaXF1ZT86IGJvb2xlYW4sXG4gICAqICAgICAgIG1peGlucz86IEFycmF5PCh2aWV3OiBhbnkpID0+IGFueT4sXG4gICAqICAgICB9KX0gW3tzb3J0TWV0aG9kLCBtb2RlbHMsIHVuaXF1ZSwgbWl4aW5zfT17fV0gVmlldyBvcHRpb25zXG4gICAqIEByZXR1cm5zIHtWaWV3fSBUaGUgY3JlYXRlZCB2aWV3XG4gICAqIEBtZW1iZXJvZiBQdXJlQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGFkZFZpZXc8VCBleHRlbmRzIFB1cmVNb2RlbD4oXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHR5cGU6IElNb2RlbENvbnN0cnVjdG9yPFQ+fElUeXBlLFxuICAgIHtzb3J0TWV0aG9kLCBtb2RlbHMsIHVuaXF1ZSwgbWl4aW5zfToge1xuICAgICAgc29ydE1ldGhvZD86IHN0cmluZ3woKGl0ZW06IFQpID0+IGFueSksXG4gICAgICBtb2RlbHM/OiBBcnJheTxJSWRlbnRpZmllcnxQdXJlTW9kZWw+LFxuICAgICAgdW5pcXVlPzogYm9vbGVhbixcbiAgICAgIG1peGlucz86IEFycmF5PCh2aWV3OiBhbnkpID0+IGFueT4sXG4gICAgfSA9IHt9LFxuICApIHtcbiAgICBpZiAobmFtZSBpbiB0aGlzKSB7XG4gICAgICB0aHJvdyBlcnJvcihWSUVXX05BTUVfVEFLRU4pO1xuICAgIH1cblxuICAgIGNvbnN0IFZpZXdDb25zdHJ1Y3RvciA9IG1peGluc1xuICAgICAgPyBtaXhpbnMucmVkdWNlKCh2aWV3OiBhbnksIG1peGluOiAodmlldzogYW55KSA9PiBhbnkpID0+IHtcbiAgICAgICAgICByZXR1cm4gbWl4aW4odmlldyk7XG4gICAgICAgIH0sIFZpZXcpIGFzIHR5cGVvZiBWaWV3XG4gICAgICA6IFZpZXc7XG5cbiAgICB0aGlzLl9fdmlld3MucHVzaChuYW1lKTtcbiAgICB0aGlzW25hbWVdID0gbmV3IFZpZXdDb25zdHJ1Y3RvcjxUPih0eXBlLCB0aGlzLCBzb3J0TWV0aG9kLCBtb2RlbHMsIHVuaXF1ZSk7XG5cbiAgICByZXR1cm4gdGhpc1tuYW1lXTtcbiAgfVxuXG4gIHByaXZhdGUgX19hZGRBcnJheTxUIGV4dGVuZHMgUHVyZU1vZGVsPihkYXRhOiBBcnJheTxUPik6IEFycmF5PFQ+O1xuICBwcml2YXRlIF9fYWRkQXJyYXk8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogQXJyYXk8SURpY3Rpb25hcnk8YW55Pj4sIG1vZGVsPzogSVR5cGV8SU1vZGVsQ29uc3RydWN0b3I8VD4pOiBBcnJheTxUPjtcbiAgcHJpdmF0ZSBfX2FkZEFycmF5KGRhdGE6IEFycmF5PFB1cmVNb2RlbHxJRGljdGlvbmFyeTxhbnk+PiwgbW9kZWw/OiBJVHlwZXxJTW9kZWxDb25zdHJ1Y3Rvcik6IEFycmF5PFB1cmVNb2RlbD4ge1xuICAgIHJldHVybiBkYXRhLmZpbHRlcihCb29sZWFuKS5tYXAoKGl0ZW0pID0+IHRoaXMuX19hZGRTaW5nbGUoaXRlbSwgbW9kZWwpKTtcbiAgfVxuXG4gIHByaXZhdGUgX19hZGRTaW5nbGU8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogVCk6IFQ7XG4gIHByaXZhdGUgX19hZGRTaW5nbGU8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogSURpY3Rpb25hcnk8YW55PiwgbW9kZWw/OiBJVHlwZXxJTW9kZWxDb25zdHJ1Y3RvcjxUPik6IFQ7XG4gIHByaXZhdGUgX19hZGRTaW5nbGUoZGF0YTogUHVyZU1vZGVsfElEaWN0aW9uYXJ5PGFueT58SUlkZW50aWZpZXIsIG1vZGVsPzogSVR5cGV8SU1vZGVsQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgPT09ICdudW1iZXInIHx8IHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBQdXJlTW9kZWwpIHtcbiAgICAgIGlmICghdGhpcy5oYXNJdGVtKGRhdGEpKSB7XG4gICAgICAgIHRoaXMuX19pbnNlcnRNb2RlbChkYXRhKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgaWYgKCFtb2RlbCAmJiBtb2RlbCAhPT0gMCkge1xuICAgICAgdGhyb3cgZXJyb3IoVU5ERUZJTkVEX1RZUEUpO1xuICAgIH1cblxuICAgIGNvbnN0IHR5cGUgPSBnZXRNb2RlbFR5cGUobW9kZWwgYXMgSVR5cGV8dHlwZW9mIFB1cmVNb2RlbCk7XG4gICAgY29uc3QgbW9kZWxJbnN0YW5jZSA9IHVwc2VydE1vZGVsKGRhdGEsIHR5cGUsIHRoaXMpO1xuICAgIHRoaXMuX19pbnNlcnRNb2RlbChtb2RlbEluc3RhbmNlLCB0eXBlKTtcblxuICAgIHJldHVybiBtb2RlbEluc3RhbmNlO1xuICB9XG5cbiAgcHJpdmF0ZSBfX2luc2VydE1vZGVsKG1vZGVsOiBQdXJlTW9kZWx8QXJyYXk8UHVyZU1vZGVsPiwgdHlwZT86IElUeXBlLCBpZD86IElJZGVudGlmaWVyKSB7XG4gICAgaWYgKG1vZGVsIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHJldHVybiBtb2RlbC5mb3JFYWNoKChpdGVtKSA9PiB0aGlzLl9faW5zZXJ0TW9kZWwoaXRlbSwgdHlwZSwgaWQpKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb2xsZWN0aW9uID0gZ2V0TW9kZWxDb2xsZWN0aW9uKG1vZGVsKTtcbiAgICBpZiAoY29sbGVjdGlvbiAmJiBjb2xsZWN0aW9uICE9PSB0aGlzKSB7XG4gICAgICB0aHJvdyBlcnJvcihNT0RFTF9TSU5HTEVfQ09MTEVDVElPTik7XG4gICAgfVxuXG4gICAgY29uc3QgbW9kZWxUeXBlID0gdHlwZSB8fCBnZXRNb2RlbFR5cGUobW9kZWwpO1xuICAgIGNvbnN0IG1vZGVsSWQgPSBpZCB8fCBnZXRNb2RlbElkKG1vZGVsKTtcbiAgICBjb25zdCBzdHJpbmdUeXBlID0gbW9kZWxUeXBlLnRvU3RyaW5nKCk7XG5cbiAgICBjb25zdCBleGlzdGluZ01vZGVsID0gdGhpcy5maW5kKG1vZGVsVHlwZSwgbW9kZWxJZCk7XG4gICAgaWYgKGV4aXN0aW5nTW9kZWwpIHtcbiAgICAgIHVwZGF0ZU1vZGVsKGV4aXN0aW5nTW9kZWwsIG1vZGVsKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9fZGF0YS5wdXNoKG1vZGVsKTtcbiAgICBpZiAobW9kZWxUeXBlIGluIHRoaXMuX19kYXRhTGlzdCkge1xuICAgICAgdGhpcy5fX2RhdGFMaXN0W21vZGVsVHlwZV0ucHVzaChtb2RlbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldCh0aGlzLl9fZGF0YUxpc3QsIHN0cmluZ1R5cGUsIG9ic2VydmFibGUuYXJyYXkoW21vZGVsXSwge2RlZXA6IGZhbHNlfSkpO1xuICAgIH1cblxuICAgIGlmIChtb2RlbFR5cGUgaW4gdGhpcy5fX2RhdGFNYXApIHtcbiAgICAgIHNldCh0aGlzLl9fZGF0YU1hcFttb2RlbFR5cGVdLCBtb2RlbElkLnRvU3RyaW5nKCksIG1vZGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0KHRoaXMuX19kYXRhTWFwLCBzdHJpbmdUeXBlLCBvYnNlcnZhYmxlLnNoYWxsb3dPYmplY3Qoe1ttb2RlbElkXTogbW9kZWx9KSk7XG4gICAgfVxuICAgIHNldE1vZGVsTWV0YUtleShtb2RlbCwgJ2NvbGxlY3Rpb24nLCB0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgX19yZW1vdmVNb2RlbChtb2RlbDogUHVyZU1vZGVsfEFycmF5PFB1cmVNb2RlbD4sIHR5cGU/OiBJVHlwZSwgaWQ/OiBJSWRlbnRpZmllcikge1xuICAgIGlmIChtb2RlbCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICByZXR1cm4gbW9kZWwuZm9yRWFjaCgoaXRlbSkgPT4gdGhpcy5fX3JlbW92ZU1vZGVsKGl0ZW0sIHR5cGUsIGlkKSk7XG4gICAgfVxuXG4gICAgY29uc3QgbW9kZWxUeXBlID0gdHlwZSB8fCBnZXRNb2RlbFR5cGUobW9kZWwpO1xuICAgIGNvbnN0IG1vZGVsSWQgPSBpZCB8fCBnZXRNb2RlbElkKG1vZGVsKTtcbiAgICB0aGlzLl9fZGF0YS5yZW1vdmUobW9kZWwpO1xuICAgIHRoaXMuX19kYXRhTGlzdFttb2RlbFR5cGVdLnJlbW92ZShtb2RlbCk7XG4gICAgc2V0KHRoaXMuX19kYXRhTWFwW21vZGVsVHlwZV0sIG1vZGVsSWQudG9TdHJpbmcoKSwgdW5kZWZpbmVkKTtcbiAgICBzZXRNb2RlbE1ldGFLZXkobW9kZWwsICdjb2xsZWN0aW9uJywgdW5kZWZpbmVkKTtcbiAgfVxuXG4gIHByaXZhdGUgX19maW5kQnlUeXBlKG1vZGVsOiBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsfFB1cmVNb2RlbCwgaWQ/OiBJSWRlbnRpZmllcikge1xuICAgIGNvbnN0IHR5cGUgPSBnZXRNb2RlbFR5cGUobW9kZWwpO1xuICAgIGNvbnN0IHN0cmluZ1R5cGUgPSB0eXBlLnRvU3RyaW5nKCk7XG5cbiAgICBpZiAoaWQpIHtcbiAgICAgIGlmICghKHR5cGUgaW4gdGhpcy5fX2RhdGFNYXApKSB7XG4gICAgICAgIHNldCh0aGlzLl9fZGF0YU1hcCwgc3RyaW5nVHlwZSwge1tpZF06IHVuZGVmaW5lZH0pO1xuICAgICAgfSBlbHNlIGlmICghKGlkIGluIHRoaXMuX19kYXRhTWFwW3R5cGVdKSkge1xuICAgICAgICBzZXQodGhpcy5fX2RhdGFNYXBbdHlwZV0sIGlkLnRvU3RyaW5nKCksIHVuZGVmaW5lZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5fX2RhdGFNYXBbdHlwZV1baWRdO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoISh0eXBlIGluIHRoaXMuX19kYXRhTGlzdCkpIHtcbiAgICAgICAgc2V0KHRoaXMuX19kYXRhTGlzdCwgc3RyaW5nVHlwZSwgb2JzZXJ2YWJsZS5hcnJheShbXSwge2RlZXA6IGZhbHNlfSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuX19kYXRhTGlzdFt0eXBlXS5sZW5ndGggPyB0aGlzLl9fZGF0YUxpc3RbdHlwZV1bMF0gOiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX19jaGFuZ2VNb2RlbElkKG9sZElkOiBJSWRlbnRpZmllciwgbmV3SWQ6IElJZGVudGlmaWVyLCB0eXBlOiBJVHlwZSkge1xuICAgIHRoaXMuX19kYXRhTWFwW3R5cGVdW25ld0lkXSA9IHRoaXMuX19kYXRhTWFwW3R5cGVdW29sZElkXTtcbiAgICBkZWxldGUgdGhpcy5fX2RhdGFNYXBbdHlwZV1bb2xkSWRdO1xuICB9XG59XG4iXX0=","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/PureCollection.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { IIdentifier } from './interfaces/IIdentifier';\r\nimport { IModelConstructor } from './interfaces/IModelConstructor';\r\nimport { IRawCollection } from './interfaces/IRawCollection';\r\nimport { IType } from './interfaces/IType';\r\nimport { TFilterFn } from './interfaces/TFilterFn';\r\nimport { PureModel } from './PureModel';\r\nexport declare class PureCollection {\r\n    /**\r\n     * List of models available in the collection\r\n     *\r\n     * @static\r\n     * @type {Array<typeof PureModel>}\r\n     * @memberof Collection\r\n     */\r\n    static types: Array<typeof PureModel | IModelConstructor<PureModel>>;\r\n    static views: IDictionary<{\r\n        modelType: IType | PureModel;\r\n        sortMethod?: string | ((PureModel) => any);\r\n        unique?: boolean;\r\n        mixins?: Array<(view: any) => any>;\r\n    }>;\r\n    static defaultModel?: typeof PureModel;\r\n    private __data;\r\n    private __views;\r\n    private __dataMap;\r\n    private __dataList;\r\n    constructor(data?: Array<IRawModel> | IRawCollection);\r\n    /**\r\n     * Function for inserting raw models into the collection. Used when hydrating the collection\r\n     *\r\n     * @param {Array<IRawModel>} data Raw model data\r\n     * @returns {Array<PureModel>} A list of initialized models\r\n     * @memberof Collection\r\n     */\r\n    insert(data: Array<Partial<IRawModel>>): Array<PureModel>;\r\n    /**\r\n     * Add an existing model to the collection\r\n     *\r\n     * @template T\r\n     * @param {T} data Model to be added\r\n     * @returns {T} Added model\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: T): T;\r\n    /**\r\n     * Add an array of existing models to the collection\r\n     *\r\n     * @template T\r\n     * @param {Array<T>} data Array of models to be added\r\n     * @returns {Array<T>} Added models\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: Array<T>): Array<T>;\r\n    /**\r\n     * Add an array of new models to the collection\r\n     *\r\n     * @template T\r\n     * @param {Array<IRawModel|IDictionary<any>>} data Array of new data to be added\r\n     * @param {(IType|IModelConstructor<T>)} model Model type to be added\r\n     * @returns {Array<T>} Added models\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: Array<IRawModel | IDictionary<any>>, model: IType | IModelConstructor<T>): Array<T>;\r\n    /**\r\n     * Add a new model to the collection\r\n     *\r\n     * @template T\r\n     * @param {(IRawModel|IDictionary<any>)} data New data to be added\r\n     * @param {(IType|IModelConstructor<T>)} model Model type to be added\r\n     * @returns {T} Added model\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: IRawModel | IDictionary<any>, model: IType | IModelConstructor<T>): T;\r\n    /**\r\n     * Find a model based on the defined type and (optional) identifier\r\n     *\r\n     * @param {(IType|typeof PureModel|PureModel)} type Model type\r\n     * @param {IIdentifier} [id] Model identifier\r\n     * @returns {(PureModel|null)} The first matching model\r\n     * @memberof Collection\r\n     */\r\n    find<T extends PureModel>(type: IType | T | IModelConstructor<T>, id?: IIdentifier | PureModel): T | null;\r\n    /**\r\n     * Find a model based on a matching function\r\n     *\r\n     * @param {TFilterFn} test Function used to match the model\r\n     * @returns {(PureModel|null)} The first matching model\r\n     * @memberof Collection\r\n     */\r\n    find<T extends PureModel>(test: TFilterFn): T | null;\r\n    /**\r\n     * Filter models based on a matching function\r\n     *\r\n     * @param {TFilterFn} test Function used to match the models\r\n     * @returns {(PureModel|null)} The matching models\r\n     * @memberof Collection\r\n     */\r\n    filter(test: TFilterFn): Array<PureModel>;\r\n    /**\r\n     * Find all matching models or all models if no type is given\r\n     *\r\n     * @param {(IType|typeof PureModel)} [model] Model type to select\r\n     * @returns {Array<PureModel>} List of matching models\r\n     * @memberof Collection\r\n     */\r\n    findAll<T extends PureModel>(model?: IType | IModelConstructor<T>): Array<T>;\r\n    /**\r\n     * Check if a model is in the collection\r\n     *\r\n     * @param {PureModel} model Model to check\r\n     * @returns {boolean} The given model is in the collection\r\n     * @memberof Collection\r\n     */\r\n    hasItem(model: PureModel): boolean;\r\n    /**\r\n     * Remove the first model based on the type and (optional) identifier\r\n     *\r\n     * @param {(IType|typeof PureModel)} type Model type\r\n     * @param {IIdentifier} [id] Model identifier\r\n     * @memberof Collection\r\n     */\r\n    remove(type: IType | typeof PureModel, id?: IIdentifier): any;\r\n    /**\r\n     * Remove the given model from the collection\r\n     *\r\n     * @param {PureModel} model Model to be removed from the collection\r\n     * @memberof Collection\r\n     */\r\n    remove(model: PureModel): any;\r\n    /**\r\n     * Remove all models of the given model type from the collection\r\n     *\r\n     * @param {(IType|typeof PureModel)} type Model type\r\n     * @memberof Collection\r\n     */\r\n    removeAll(type: IType | typeof PureModel): void;\r\n    /**\r\n     * A total count of models in the collection\r\n     *\r\n     * @readonly\r\n     * @type {number}\r\n     * @memberof Collection\r\n     */\r\n    readonly length: number;\r\n    /**\r\n     * Get the serializable value of the collection\r\n     *\r\n     * @returns {IRawCollection} Pure JS value of the collection\r\n     * @memberof Collection\r\n     */\r\n    toJSON(): IRawCollection;\r\n    readonly snapshot: IRawCollection;\r\n    /**\r\n     * Reset the collection (remove all models)\r\n     *\r\n     * @memberof Collection\r\n     */\r\n    reset(): void;\r\n    getAllModels(): PureModel[];\r\n    /**\r\n     * Add a view to the collection\r\n     *\r\n     * @template T Model type of the view\r\n     * @param {string} name View name\r\n     * @param {(IModelConstructor<T>|IType)} type Model type the view will represent\r\n     * @param {({\r\n     *       sortMethod?: string|((item: T) => any),\r\n     *       models?: Array<IIdentifier|PureModel>,\r\n     *       unique?: boolean,\r\n     *       mixins?: Array<(view: any) => any>,\r\n     *     })} [{sortMethod, models, unique, mixins}={}] View options\r\n     * @returns {View} The created view\r\n     * @memberof PureCollection\r\n     */\r\n    addView<T extends PureModel>(name: string, type: IModelConstructor<T> | IType, {sortMethod, models, unique, mixins}?: {\r\n        sortMethod?: string | ((item: T) => any);\r\n        models?: Array<IIdentifier | PureModel>;\r\n        unique?: boolean;\r\n        mixins?: Array<(view: any) => any>;\r\n    }): any;\r\n    private __addArray<T>(data);\r\n    private __addArray<T>(data, model?);\r\n    private __addSingle<T>(data);\r\n    private __addSingle<T>(data, model?);\r\n    private __insertModel(model, type?, id?);\r\n    private __removeModel(model, type?, id?);\r\n    private __findByType(model, id?);\r\n    private __changeModelId(oldId, newId, type);\r\n}\r\n"}}
