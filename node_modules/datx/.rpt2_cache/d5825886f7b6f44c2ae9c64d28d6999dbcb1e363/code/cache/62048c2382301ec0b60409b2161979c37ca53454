{"code":"import * as tslib_1 from \"tslib\";\r\nimport { deprecated, mapItems, warn } from 'datx-utils';\r\nimport { isObservableArray } from 'mobx';\r\nimport { FieldType } from './enums/FieldType';\r\nimport { ReferenceType } from './enums/ReferenceType';\r\nimport { updateField } from './helpers/model/fields';\r\nimport { initModelField, initModelRef } from './helpers/model/init';\r\nimport { getModelCollection, getModelId, getModelMetaKey, getModelType, modelToJSON, updateModel, } from './helpers/model/utils';\r\nimport { PureModel } from './PureModel';\r\nimport { storage } from './services/storage';\r\nwarn('CompatModel is just a migration tool. Please move to Model or PureModel as soon as possible.');\r\nvar CompatModel = /** @class */ (function (_super) {\r\n    tslib_1.__extends(CompatModel, _super);\r\n    function CompatModel(initialData, collection) {\r\n        var _this = _super.call(this, initialData, collection) || this;\r\n        Object.keys(_this.static.refs).forEach(function (prop) {\r\n            var refs = getModelMetaKey(_this, 'refs');\r\n            if (prop in refs) {\r\n                return;\r\n            }\r\n            var ref = _this.static.refs[prop];\r\n            var data = mapItems(_this[prop] || _this.static.defaults[prop], getModelId);\r\n            delete _this[prop];\r\n            if (typeof ref === 'object') {\r\n                // Back reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref.model,\r\n                    property: ref.property,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n            else {\r\n                // Normal reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n        });\r\n        Object.keys(_this.static.defaults).forEach(function (prop) {\r\n            if (!(prop in _this.static.refs) && !(prop in _this)) {\r\n                initModelField(_this, prop, _this.static.defaults[prop]);\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    CompatModel.prototype.getRecordId = function () {\r\n        deprecated('model.getRecordId is deprecated. Use getModelId() instead.');\r\n        return getModelId(this);\r\n    };\r\n    CompatModel.prototype.getRecordType = function () {\r\n        deprecated('model.getRecordType is deprecated. Use getModelType() instead.');\r\n        return getModelType(this);\r\n    };\r\n    CompatModel.prototype.assign = function (key, value) {\r\n        deprecated('model.assign is deprecated. Use assignModel() instead.');\r\n        var type = FieldType.DATA;\r\n        var modelId = storage.getModelClassMetaKey(this.static, 'id');\r\n        var modelType = storage.getModelClassMetaKey(this.static, 'type');\r\n        if (key === modelId) {\r\n            type = FieldType.ID;\r\n        }\r\n        else if (key === modelType) {\r\n            type = FieldType.TYPE;\r\n        }\r\n        updateField(this, key, value, type);\r\n        return value;\r\n    };\r\n    CompatModel.prototype.assignRef = function (key, value, type) {\r\n        deprecated('model.assignRef is deprecated. Use initModelRef() instead.');\r\n        var refs = getModelMetaKey(this, 'refs');\r\n        if (refs[key]) {\r\n            return this[key] = value;\r\n        }\r\n        var model = type;\r\n        if (!model) {\r\n            if (value instanceof Array || isObservableArray(value)) {\r\n                model = value.reduce(function (t, m) { return t || getModelType(m); }, null);\r\n            }\r\n            else if (value instanceof PureModel) {\r\n                model = getModelType(value);\r\n            }\r\n        }\r\n        if (!model) {\r\n            throw new Error('The type property is missing');\r\n        }\r\n        initModelRef(this, key, {\r\n            model: model,\r\n            type: ReferenceType.TO_ONE_OR_MANY,\r\n        }, value);\r\n        return this[key];\r\n    };\r\n    CompatModel.prototype.update = function (data) {\r\n        var _this = this;\r\n        deprecated('model.update is deprecated. Use updateModel() instead.');\r\n        var updateData = Object.assign({}, data);\r\n        Object.keys(updateData).forEach(function (key) {\r\n            if (typeof _this[key] === 'function') {\r\n                delete updateData[key];\r\n            }\r\n        });\r\n        return updateModel(this, updateData);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"static\", {\r\n        get: function () {\r\n            deprecated('model.static is deprecated.');\r\n            return this.constructor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.prototype.toJS = function () {\r\n        deprecated('model.toJS() is deprecated. Use modelToJSON() instead.');\r\n        return modelToJSON(this);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"snapshot\", {\r\n        get: function () {\r\n            deprecated('model.snapshot is deprecated. Use modelToJSON() instead.');\r\n            return modelToJSON(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompatModel.prototype, \"__collection\", {\r\n        get: function () {\r\n            deprecated('model.__collection is deprecated. Use getModelCollection() instead.');\r\n            return getModelCollection(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.refs = {};\r\n    CompatModel.defaults = {};\r\n    return CompatModel;\r\n}(PureModel));\r\nexport { CompatModel };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tcGF0TW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvQ29tcGF0TW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQTBCLFFBQVEsRUFBRSxJQUFJLEVBQUMsTUFBTSxZQUFZLENBQUM7QUFDOUUsT0FBTyxFQUFDLGlCQUFpQixFQUFNLE1BQU0sTUFBTSxDQUFDO0FBRzVDLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUM1QyxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFDcEQsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBQyxjQUFjLEVBQUUsWUFBWSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDbEUsT0FBTyxFQUNMLGtCQUFrQixFQUNsQixVQUFVLEVBQ1YsZUFBZSxFQUNmLFlBQVksRUFDWixXQUFXLEVBQ1gsV0FBVyxHQUNaLE1BQU0sdUJBQXVCLENBQUM7QUFHL0IsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGFBQWEsQ0FBQztBQUN0QyxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFFM0MsSUFBSSxDQUFDLDhGQUE4RixDQUFDLENBQUM7QUFFckc7SUFBaUMsdUNBQVM7SUFJeEMscUJBQVksV0FBbUIsRUFBRSxVQUF1QjtRQUF4RCxZQUNFLGtCQUFNLFdBQVcsRUFBRSxVQUFVLENBQUMsU0ErQi9CO1FBN0JDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFJO1lBQ3pDLElBQU0sSUFBSSxHQUFHLGVBQWUsQ0FBQyxLQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDM0MsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO2dCQUNoQixPQUFPO2FBQ1I7WUFDRCxJQUFNLEdBQUcs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LFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxzQkFBVywrQkFBTTthQUFqQjtZQUNFLFVBQVUsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1lBQzFDLE9BQU8sSUFBSSxDQUFDLFdBQWlDLENBQUM7UUFDaEQsQ0FBQzs7O09BQUE7SUFFTSwwQkFBSSxHQUFYO1FBQ0UsVUFBVSxDQUFDLHdEQUF3RCxDQUFDLENBQUM7UUFDckUsT0FBTyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELHNCQUFXLGlDQUFRO2FBQW5CO1lBQ0UsVUFBVSxDQUFDLDBEQUEwRCxDQUFDLENBQUM7WUFDdkUsT0FBTyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBWSxxQ0FBWTthQUF4QjtZQUNFLFVBQVUsQ0FBQyxxRUFBcUUsQ0FBQyxDQUFDO1lBQ2xGLE9BQU8sa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsQ0FBQzs7O09BQUE7SUF2SGEsZ0JBQUksR0FBZ0IsRUFBRSxDQUFDO0lBQ3ZCLG9CQUFRLEdBQXFCLEVBQUUsQ0FBQztJQXVIaEQsa0JBQUM7Q0FBQSxBQXpIRCxDQUFpQyxTQUFTLEdBeUh6QztTQXpIWSxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtkZXByZWNhdGVkLCBJRGljdGlvbmFyeSwgSVJhd01vZGVsLCBtYXBJdGVtcywgd2Fybn0gZnJvbSAnZGF0eC11dGlscyc7XG5pbXBvcnQge2lzT2JzZXJ2YWJsZUFycmF5LCBzZXR9IGZyb20gJ21vYngnO1xuXG5pbXBvcnQge0NvbGxlY3Rpb259IGZyb20gJy4vQ29sbGVjdGlvbic7XG5pbXBvcnQge0ZpZWxkVHlwZX0gZnJvbSAnLi9lbnVtcy9GaWVsZFR5cGUnO1xuaW1wb3J0IHtSZWZlcmVuY2VUeXBlfSBmcm9tICcuL2VudW1zL1JlZmVyZW5jZVR5cGUnO1xuaW1wb3J0IHt1cGRhdGVGaWVsZH0gZnJvbSAnLi9oZWxwZXJzL21vZGVsL2ZpZWxkcyc7XG5pbXBvcnQge2luaXRNb2RlbEZpZWxkLCBpbml0TW9kZWxSZWZ9IGZyb20gJy4vaGVscGVycy9tb2RlbC9pbml0JztcbmltcG9ydCB7XG4gIGdldE1vZGVsQ29sbGVjdGlvbixcbiAgZ2V0TW9kZWxJZCxcbiAgZ2V0TW9kZWxNZXRhS2V5LFxuICBnZXRNb2RlbFR5cGUsXG4gIG1vZGVsVG9KU09OLFxuICB1cGRhdGVNb2RlbCxcbn0gZnJvbSAnLi9oZWxwZXJzL21vZGVsL3V0aWxzJztcbmltcG9ydCB7SVJlZmVyZW5jZXN9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmVmZXJlbmNlcyc7XG5pbXBvcnQge0lUeXBlfSBmcm9tICcuL2ludGVyZmFjZXMvSVR5cGUnO1xuaW1wb3J0IHtQdXJlTW9kZWx9IGZyb20gJy4vUHVyZU1vZGVsJztcbmltcG9ydCB7c3RvcmFnZX0gZnJvbSAnLi9zZXJ2aWNlcy9zdG9yYWdlJztcblxud2FybignQ29tcGF0TW9kZWwgaXMganVzdCBhIG1pZ3JhdGlvbiB0b29sLiBQbGVhc2UgbW92ZSB0byBNb2RlbCBvciBQdXJlTW9kZWwgYXMgc29vbiBhcyBwb3NzaWJsZS4nKTtcblxuZXhwb3J0IGNsYXNzIENvbXBhdE1vZGVsIGV4dGVuZHMgUHVyZU1vZGVsIHtcbiAgcHVibGljIHN0YXRpYyByZWZzOiBJUmVmZXJlbmNlcyA9IHt9O1xuICBwdWJsaWMgc3RhdGljIGRlZmF1bHRzOiBJRGljdGlvbmFyeTxhbnk+ID0ge307XG5cbiAgY29uc3RydWN0b3IoaW5pdGlhbERhdGE6IG9iamVjdCwgY29sbGVjdGlvbj86IENvbGxlY3Rpb24pIHtcbiAgICBzdXBlcihpbml0aWFsRGF0YSwgY29sbGVjdGlvbik7XG5cbiAgICBPYmplY3Qua2V5cyh0aGlzLnN0YXRpYy5yZWZzKS5mb3JFYWNoKChwcm9wKSA9PiB7XG4gICAgICBjb25zdCByZWZzID0gZ2V0TW9kZWxNZXRhS2V5KHRoaXMsICdyZWZzJyk7XG4gICAgICBpZiAocHJvcCBpbiByZWZzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlZiA9IHRoaXMuc3RhdGljLnJlZnNbcHJvcF07XG4gICAgICBjb25zdCBkYXRhID0gbWFwSXRlbXModGhpc1twcm9wXSB8fCB0aGlzLnN0YXRpYy5kZWZhdWx0c1twcm9wXSwgZ2V0TW9kZWxJZCk7XG4gICAgICBkZWxldGUgdGhpc1twcm9wXTtcbiAgICAgIGlmICh0eXBlb2YgcmVmID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyBCYWNrIHJlZmVyZW5jZVxuICAgICAgICBpbml0TW9kZWxSZWYodGhpcywgcHJvcCwge1xuICAgICAgICAgIG1vZGVsOiByZWYubW9kZWwsXG4gICAgICAgICAgcHJvcGVydHk6IHJlZi5wcm9wZXJ0eSxcbiAgICAgICAgICB0eXBlOiBSZWZlcmVuY2VUeXBlLlRPX09ORV9PUl9NQU5ZLFxuICAgICAgICB9LCBkYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5vcm1hbCByZWZlcmVuY2VcbiAgICAgICAgaW5pdE1vZGVsUmVmKHRoaXMsIHByb3AsIHtcbiAgICAgICAgICBtb2RlbDogcmVmLFxuICAgICAgICAgIHR5cGU6IFJlZmVyZW5jZVR5cGUuVE9fT05FX09SX01BTlksXG4gICAgICAgIH0sIGRhdGEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgT2JqZWN0LmtleXModGhpcy5zdGF0aWMuZGVmYXVsdHMpLmZvckVhY2goKHByb3ApID0+IHtcbiAgICAgIGlmICghKHByb3AgaW4gdGhpcy5zdGF0aWMucmVmcykgJiYgIShwcm9wIGluIHRoaXMpKSB7XG4gICAgICAgIGluaXRNb2RlbEZpZWxkKHRoaXMsIHByb3AsIHRoaXMuc3RhdGljLmRlZmF1bHRzW3Byb3BdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSZWNvcmRJZCgpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5nZXRSZWNvcmRJZCBpcyBkZXByZWNhdGVkLiBVc2UgZ2V0TW9kZWxJZCgpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIGdldE1vZGVsSWQodGhpcyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjb3JkVHlwZSgpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5nZXRSZWNvcmRUeXBlIGlzIGRlcHJlY2F0ZWQuIFVzZSBnZXRNb2RlbFR5cGUoKSBpbnN0ZWFkLicpO1xuICAgIHJldHVybiBnZXRNb2RlbFR5cGUodGhpcyk7XG4gIH1cblxuICBwdWJsaWMgYXNzaWduKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuYXNzaWduIGlzIGRlcHJlY2F0ZWQuIFVzZSBhc3NpZ25Nb2RlbCgpIGluc3RlYWQuJyk7XG4gICAgbGV0IHR5cGUgPSBGaWVsZFR5cGUuREFUQTtcbiAgICBjb25zdCBtb2RlbElkID0gc3RvcmFnZS5nZXRNb2RlbENsYXNzTWV0YUtleSh0aGlzLnN0YXRpYywgJ2lkJyk7XG4gICAgY29uc3QgbW9kZWxUeXBlID0gc3RvcmFnZS5nZXRNb2RlbENsYXNzTWV0YUtleSh0aGlzLnN0YXRpYywgJ3R5cGUnKTtcbiAgICBpZiAoa2V5ID09PSBtb2RlbElkKSB7XG4gICAgICB0eXBlID0gRmllbGRUeXBlLklEO1xuICAgIH0gZWxzZSBpZiAoa2V5ID09PSBtb2RlbFR5cGUpIHtcbiAgICAgIHR5cGUgPSBGaWVsZFR5cGUuVFlQRTtcbiAgICB9XG5cbiAgICB1cGRhdGVGaWVsZCh0aGlzLCBrZXksIHZhbHVlLCB0eXBlKTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBwdWJsaWMgYXNzaWduUmVmKGtleTogc3RyaW5nLCB2YWx1ZTogYW55LCB0eXBlPzogSVR5cGUpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5hc3NpZ25SZWYgaXMgZGVwcmVjYXRlZC4gVXNlIGluaXRNb2RlbFJlZigpIGluc3RlYWQuJyk7XG4gICAgY29uc3QgcmVmcyA9IGdldE1vZGVsTWV0YUtleSh0aGlzLCAncmVmcycpO1xuXG4gICAgaWYgKHJlZnNba2V5XSkge1xuICAgICAgcmV0dXJuIHRoaXNba2V5XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGxldCBtb2RlbCA9IHR5cGU7XG4gICAgaWYgKCFtb2RlbCkge1xuICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkgfHwgaXNPYnNlcnZhYmxlQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIG1vZGVsID0gdmFsdWUucmVkdWNlKCh0LCBtKSA9PiB0IHx8IGdldE1vZGVsVHlwZShtKSwgbnVsbCk7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgUHVyZU1vZGVsKSB7XG4gICAgICAgIG1vZGVsID0gZ2V0TW9kZWxUeXBlKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIW1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSB0eXBlIHByb3BlcnR5IGlzIG1pc3NpbmcnKTtcbiAgICB9XG5cbiAgICBpbml0TW9kZWxSZWYodGhpcywga2V5LCB7XG4gICAgICBtb2RlbCxcbiAgICAgIHR5cGU6IFJlZmVyZW5jZVR5cGUuVE9fT05FX09SX01BTlksXG4gICAgfSwgdmFsdWUpO1xuICAgIHJldHVybiB0aGlzW2tleV07XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlKGRhdGE6IFB1cmVNb2RlbCB8IElEaWN0aW9uYXJ5PGFueT4pOiBvYmplY3Qge1xuICAgIGRlcHJlY2F0ZWQoJ21vZGVsLnVwZGF0ZSBpcyBkZXByZWNhdGVkLiBVc2UgdXBkYXRlTW9kZWwoKSBpbnN0ZWFkLicpO1xuICAgIGNvbnN0IHVwZGF0ZURhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhKTtcbiAgICBPYmplY3Qua2V5cyh1cGRhdGVEYXRhKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgdGhpc1trZXldID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGRlbGV0ZSB1cGRhdGVEYXRhW2tleV07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZU1vZGVsKHRoaXMsIHVwZGF0ZURhdGEpO1xuICB9XG5cbiAgcHVibGljIGdldCBzdGF0aWMoKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuc3RhdGljIGlzIGRlcHJlY2F0ZWQuJyk7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IgYXMgdHlwZW9mIENvbXBhdE1vZGVsO1xuICB9XG5cbiAgcHVibGljIHRvSlMoKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwudG9KUygpIGlzIGRlcHJlY2F0ZWQuIFVzZSBtb2RlbFRvSlNPTigpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIG1vZGVsVG9KU09OKHRoaXMpO1xuICB9XG5cbiAgcHVibGljIGdldCBzbmFwc2hvdCgpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5zbmFwc2hvdCBpcyBkZXByZWNhdGVkLiBVc2UgbW9kZWxUb0pTT04oKSBpbnN0ZWFkLicpO1xuICAgIHJldHVybiBtb2RlbFRvSlNPTih0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IF9fY29sbGVjdGlvbigpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5fX2NvbGxlY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIGdldE1vZGVsQ29sbGVjdGlvbigpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIGdldE1vZGVsQ29sbGVjdGlvbih0aGlzKTtcbiAgfVxufVxuIl19","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/CompatModel.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { Collection } from './Collection';\r\nimport { IReferences } from './interfaces/IReferences';\r\nimport { IType } from './interfaces/IType';\r\nimport { PureModel } from './PureModel';\r\nexport declare class CompatModel extends PureModel {\r\n    static refs: IReferences;\r\n    static defaults: IDictionary<any>;\r\n    constructor(initialData: object, collection?: Collection);\r\n    getRecordId(): IType;\r\n    getRecordType(): IType;\r\n    assign(key: string, value: any): any;\r\n    assignRef(key: string, value: any, type?: IType): any;\r\n    update(data: PureModel | IDictionary<any>): object;\r\n    readonly static: typeof CompatModel;\r\n    toJS(): IRawModel;\r\n    readonly snapshot: IRawModel;\r\n    private readonly __collection;\r\n}\r\n"}}
