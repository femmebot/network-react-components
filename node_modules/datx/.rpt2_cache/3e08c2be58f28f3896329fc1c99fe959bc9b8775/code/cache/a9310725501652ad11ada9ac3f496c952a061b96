{"code":"import { META_FIELD, warn } from 'datx-utils';\r\nimport { toJS } from 'mobx';\r\nimport { NO_REFS, NOT_A_CLONE, REF_NEEDS_COLLECTION } from '../../errors';\r\nimport { PureModel } from '../../PureModel';\r\nimport { storage } from '../../services/storage';\r\nimport { error } from '../format';\r\nimport { initModelField } from '../model/init';\r\n/**\r\n * Get the model type\r\n *\r\n * @export\r\n * @param {(IType|typeof PureModel|PureModel)} model Model to be checked\r\n * @returns {IType} Model type\r\n */\r\nexport function getModelType(model) {\r\n    if (typeof model === 'function') {\r\n        return model.type;\r\n    }\r\n    else if (typeof model === 'object') {\r\n        return getModelMetaKey(model, 'type') || model.constructor.type;\r\n    }\r\n    return model;\r\n}\r\n/**\r\n * Get the model identifier\r\n *\r\n * @export\r\n * @param {(PureModel|IIdentifier)} model Model to be checked\r\n * @returns {IIdentifier} Model identifier\r\n */\r\nexport function getModelId(model) {\r\n    if (model instanceof PureModel) {\r\n        return getModelMetaKey(model, 'id');\r\n    }\r\n    return model;\r\n}\r\n/**\r\n * Get a collection the given model belongs to\r\n *\r\n * @export\r\n * @param {PureModel} model Model to be checked\r\n * @returns {PureCollection} A collection the given model belongs to\r\n */\r\nexport function getModelCollection(model) {\r\n    return getModelMetaKey(model, 'collection');\r\n}\r\n/**\r\n * Clone the given model\r\n *\r\n * @export\r\n * @template T\r\n * @param {T} model Model to be clones\r\n * @returns {T} Cloned model object\r\n */\r\nexport function cloneModel(model) {\r\n    var TypeModel = model.constructor;\r\n    var rawData = modelToJSON(model);\r\n    var meta = rawData[META_FIELD];\r\n    meta.originalId = meta.id;\r\n    delete meta.id;\r\n    var clone = new TypeModel(rawData);\r\n    var collection = getModelCollection(model);\r\n    if (collection) {\r\n        collection.add(clone);\r\n    }\r\n    else {\r\n        warn(\"The model is not in the collection. Referencing the original model won't be possible\");\r\n    }\r\n    return clone;\r\n}\r\n/**\r\n * Get the original model for the cloned model\r\n *\r\n * @export\r\n * @param {PureModel} model Cloned model\r\n * @returns {PureModel} Original model\r\n */\r\nexport function getOriginalModel(model) {\r\n    var collection = getModelCollection(model);\r\n    var originalId = getModelMetaKey(model, 'originalId');\r\n    if (originalId) {\r\n        if (!collection) {\r\n            throw error(REF_NEEDS_COLLECTION);\r\n        }\r\n        return collection.find(model, originalId);\r\n    }\r\n    throw error(NOT_A_CLONE);\r\n}\r\n/**\r\n * Bulk update the model data\r\n *\r\n * @export\r\n * @template T\r\n * @param {T} model Model to be updated\r\n * @param {IDictionary<any>} data Data that should be assigned to the model\r\n * @returns {T}\r\n */\r\nexport function updateModel(model, data) {\r\n    var modelId = storage.getModelClassMetaKey(model.constructor, 'id') || 'id';\r\n    var modelType = storage.getModelClassMetaKey(model.constructor, 'type') || 'type';\r\n    var keys = Object.keys(data instanceof PureModel ? modelToJSON(data) : data);\r\n    keys.forEach(function (key) {\r\n        if (key !== META_FIELD && key !== modelId && key !== modelType) {\r\n            assignModel(model, key, data[key]);\r\n        }\r\n    });\r\n    return model;\r\n}\r\n/**\r\n * Assign a property to a model\r\n *\r\n * @export\r\n * @template T\r\n * @param {T} model A model to modify\r\n * @param {string} key Property name\r\n * @param {*} value Property value\r\n */\r\nexport function assignModel(model, key, value) {\r\n    var refs = getModelMetaKey(model, 'refs');\r\n    if (key in refs) {\r\n        assignModelRef(model, key, value);\r\n    }\r\n    else if (value instanceof PureModel) {\r\n        throw error(NO_REFS, { key: key });\r\n    }\r\n    else {\r\n        assignModelField(model, key, value);\r\n    }\r\n}\r\nfunction assignModelField(model, key, value) {\r\n    var fields = getModelMetaKey(model, 'fields');\r\n    if (fields.indexOf(key) !== -1) {\r\n        model[key] = value;\r\n    }\r\n    else {\r\n        initModelField(model, key, value);\r\n    }\r\n}\r\nfunction assignModelRef(model, key, value) {\r\n    var refs = getModelMetaKey(model, 'refs');\r\n    model[key] = value;\r\n}\r\nexport function getMetaKeyFromRaw(data, key, model) {\r\n    if (META_FIELD in data && typeof data[META_FIELD] === 'object' && data[META_FIELD] !== undefined) {\r\n        return data[META_FIELD][key];\r\n    }\r\n    if (model) {\r\n        var modelId = storage.getModelClassMetaKey(model, key);\r\n        return modelId && data[modelId];\r\n    }\r\n    return data && data[key];\r\n}\r\n/**\r\n * Get a serializable value of the model\r\n *\r\n * @export\r\n * @param {PureModel} model Model to serialize\r\n * @returns {IRawModel} Pure JS value of the model\r\n */\r\nexport function modelToJSON(model) {\r\n    var data = toJS(storage.getModelData(model));\r\n    var rawMeta = Object.assign({}, storage.getModelMeta(model));\r\n    delete rawMeta.collection;\r\n    var meta = toJS(rawMeta);\r\n    delete meta.collection;\r\n    var raw = Object.assign(data, (_a = {}, _a[META_FIELD] = meta, _a));\r\n    var staticModel = model.constructor;\r\n    var modelId = storage.getModelClassMetaKey(staticModel, 'id');\r\n    var modelType = storage.getModelClassMetaKey(staticModel, 'type');\r\n    if (meta && modelId) {\r\n        raw[modelId] = meta.id;\r\n    }\r\n    if (meta && modelType) {\r\n        raw[modelType] = meta.type;\r\n    }\r\n    return raw;\r\n    var _a;\r\n}\r\nexport function getModelMetaKey(model, key) {\r\n    return storage.getModelMetaKey(model, key);\r\n}\r\nexport function setModelMetaKey(model, key, value) {\r\n    return storage.setModelMetaKey(model, key, value);\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaGVscGVycy9tb2RlbC91dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQXlCLFVBQVUsRUFBRSxJQUFJLEVBQUMsTUFBTSxZQUFZLENBQUM7QUFDcEUsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUUxQixPQUFPLEVBQUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxvQkFBb0IsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQU14RSxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDMUMsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQy9DLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUU3Qzs7Ozs7O0dBTUc7QUFDSCxNQUFNLHVCQUF1QixLQUF1QztJQUNsRSxJQUFJLE9BQU8sS0FBSyxLQUFLLFVBQVUsRUFBRTtRQUMvQixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUM7S0FDbkI7U0FBTSxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtRQUNwQyxPQUFPLGVBQWUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLElBQUssS0FBSyxDQUFDLFdBQWdDLENBQUMsSUFBSSxDQUFDO0tBQ3ZGO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0gsTUFBTSxxQkFBcUIsS0FBNEI7SUFDckQsSUFBSSxLQUFLLFlBQVksU0FBUyxFQUFFO1FBQzlCLE9BQU8sZUFBZSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztLQUNyQztJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVEOzs7Ozs7R0FNRztBQUNILE1BQU0sNkJBQTZCLEtBQWdCO0lBQ2pELE9BQU8s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R0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3BELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0lEaWN0aW9uYXJ5LCBJUmF3TW9kZWwsIE1FVEFfRklFTEQsIHdhcm59IGZyb20gJ2RhdHgtdXRpbHMnO1xuaW1wb3J0IHt0b0pTfSBmcm9tICdtb2J4JztcblxuaW1wb3J0IHtOT19SRUZTLCBOT1RfQV9DTE9ORSwgUkVGX05FRURTX0NPTExFQ1RJT059IGZyb20gJy4uLy4uL2Vycm9ycyc7XG5pbXBvcnQge0lJZGVudGlmaWVyfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL0lJZGVudGlmaWVyJztcbmltcG9ydCB7SVJlZmVyZW5jZU9wdGlvbnN9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvSVJlZmVyZW5jZU9wdGlvbnMnO1xuaW1wb3J0IHtJVHlwZX0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1RSZWZWYWx1ZX0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9UUmVmVmFsdWUnO1xuaW1wb3J0IHtQdXJlQ29sbGVjdGlvbn0gZnJvbSAnLi4vLi4vUHVyZUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtQdXJlTW9kZWx9IGZyb20gJy4uLy4uL1B1cmVNb2RlbCc7XG5pbXBvcnQge3N0b3JhZ2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0b3JhZ2UnO1xuaW1wb3J0IHtlcnJvcn0gZnJvbSAnLi4vZm9ybWF0JztcbmltcG9ydCB7aW5pdE1vZGVsRmllbGR9IGZyb20gJy4uL21vZGVsL2luaXQnO1xuXG4vKipcbiAqIEdldCB0aGUgbW9kZWwgdHlwZVxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7KElUeXBlfHR5cGVvZiBQdXJlTW9kZWx8UHVyZU1vZGVsKX0gbW9kZWwgTW9kZWwgdG8gYmUgY2hlY2tlZFxuICogQHJldHVybnMge0lUeXBlfSBNb2RlbCB0eXBlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNb2RlbFR5cGUobW9kZWw6IElUeXBlfHR5cGVvZiBQdXJlTW9kZWx8UHVyZU1vZGVsKTogSVR5cGUge1xuICBpZiAodHlwZW9mIG1vZGVsID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIG1vZGVsLnR5cGU7XG4gIH0gZWxzZSBpZiAodHlwZW9mIG1vZGVsID09PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiBnZXRNb2RlbE1ldGFLZXkobW9kZWwsICd0eXBlJykgfHwgKG1vZGVsLmNvbnN0cnVjdG9yIGFzIHR5cGVvZiBQdXJlTW9kZWwpLnR5cGU7XG4gIH1cbiAgcmV0dXJuIG1vZGVsO1xufVxuXG4vKipcbiAqIEdldCB0aGUgbW9kZWwgaWRlbnRpZmllclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7KFB1cmVNb2RlbHxJSWRlbnRpZmllcil9IG1vZGVsIE1vZGVsIHRvIGJlIGNoZWNrZWRcbiAqIEByZXR1cm5zIHtJSWRlbnRpZmllcn0gTW9kZWwgaWRlbnRpZmllclxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9kZWxJZChtb2RlbDogUHVyZU1vZGVsfElJZGVudGlmaWVyKTogSUlkZW50aWZpZXIge1xuICBpZiAobW9kZWwgaW5zdGFuY2VvZiBQdXJlTW9kZWwpIHtcbiAgICByZXR1cm4gZ2V0TW9kZWxNZXRhS2V5KG1vZGVsLCAnaWQnKTtcbiAgfVxuICByZXR1cm4gbW9kZWw7XG59XG5cbi8qKlxuICogR2V0IGEgY29sbGVjdGlvbiB0aGUgZ2l2ZW4gbW9kZWwgYmVsb25ncyB0b1xuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7UHVyZU1vZGVsfSBtb2RlbCBNb2RlbCB0byBiZSBjaGVja2VkXG4gKiBAcmV0dXJucyB7UHVyZUNvbGxlY3Rpb259IEEgY29sbGVjdGlvbiB0aGUgZ2l2ZW4gbW9kZWwgYmVsb25ncyB0b1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9kZWxDb2xsZWN0aW9uKG1vZGVsOiBQdXJlTW9kZWwpOiBQdXJlQ29sbGVjdGlvbnx1bmRlZmluZWQge1xuICByZXR1cm4gZ2V0TW9kZWxNZXRhS2V5KG1vZGVsLCAnY29sbGVjdGlvbicpO1xufVxuXG4vKipcbiAqIENsb25lIHRoZSBnaXZlbiBtb2RlbFxuICpcbiAqIEBleHBvcnRcbiAqIEB0ZW1wbGF0ZSBUXG4gKiBAcGFyYW0ge1R9IG1vZGVsIE1vZGVsIHRvIGJlIGNsb25lc1xuICogQHJldHVybnMge1R9IENsb25lZCBtb2RlbCBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsb25lTW9kZWw8VCBleHRlbmRzIFB1cmVNb2RlbD4obW9kZWw6IFQpOiBUIHtcbiAgY29uc3QgVHlwZU1vZGVsID0gbW9kZWwuY29uc3RydWN0b3IgYXMgdHlwZW9mIFB1cmVNb2RlbDtcbiAgY29uc3QgcmF3RGF0YSA9IG1vZGVsVG9KU09OKG1vZGVsKTtcbiAgY29uc3QgbWV0YSA9IChyYXdEYXRhW01FVEFfRklFTERdIGFzIElEaWN0aW9uYXJ5PGFueT4pO1xuICBtZXRhLm9yaWdpbmFsSWQgPSBtZXRhLmlkO1xuICBkZWxldGUgbWV0YS5pZDtcblxuICBjb25zdCBjbG9uZSA9IG5ldyBUeXBlTW9kZWwocmF3RGF0YSkgYXMgVDtcblxuICBjb25zdCBjb2xsZWN0aW9uID0gZ2V0TW9kZWxDb2xsZWN0aW9uKG1vZGVsKTtcbiAgaWYgKGNvbGxlY3Rpb24pIHtcbiAgICBjb2xsZWN0aW9uLmFkZChjbG9uZSk7XG4gIH0gZWxzZSB7XG4gICAgd2FybihgVGhlIG1vZGVsIGlzIG5vdCBpbiB0aGUgY29sbGVjdGlvbi4gUmVmZXJlbmNpbmcgdGhlIG9yaWdpbmFsIG1vZGVsIHdvbid0IGJlIHBvc3NpYmxlYCk7XG4gIH1cblxuICByZXR1cm4gY2xvbmU7XG59XG5cbi8qKlxuICogR2V0IHRoZSBvcmlnaW5hbCBtb2RlbCBmb3IgdGhlIGNsb25lZCBtb2RlbFxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7UHVyZU1vZGVsfSBtb2RlbCBDbG9uZWQgbW9kZWxcbiAqIEByZXR1cm5zIHtQdXJlTW9kZWx9IE9yaWdpbmFsIG1vZGVsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRPcmlnaW5hbE1vZGVsKG1vZGVsOiBQdXJlTW9kZWwpOiBQdXJlTW9kZWwge1xuICBjb25zdCBjb2xsZWN0aW9uID0gZ2V0TW9kZWxDb2xsZWN0aW9uKG1vZGVsKTtcbiAgY29uc3Qgb3JpZ2luYWxJZCA9IGdldE1vZGVsTWV0YUtleShtb2RlbCwgJ29yaWdpbmFsSWQnKTtcbiAgaWYgKG9yaWdpbmFsSWQpIHtcbiAgICBpZiAoIWNvbGxlY3Rpb24pIHtcbiAgICAgIHRocm93IGVycm9yKFJFRl9ORUVEU19DT0xMRUNUSU9OKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY29sbGVjdGlvbi5maW5kKG1vZGVsLCBvcmlnaW5hbElkKSBhcyBQdXJlTW9kZWw7XG4gIH1cbiAgdGhyb3cgZXJyb3IoTk9UX0FfQ0xPTkUpO1xufVxuXG4vKipcbiAqIEJ1bGsgdXBkYXRlIHRoZSBtb2RlbCBkYXRhXG4gKlxuICogQGV4cG9ydFxuICogQHRlbXBsYXRlIFRcbiAqIEBwYXJhbSB7VH0gbW9kZWwgTW9kZWwgdG8gYmUgdXBkYXRlZFxuICogQHBhcmFtIHtJRGljdGlvbmFyeTxhbnk+fSBkYXRhIERhdGEgdGhhdCBzaG91bGQgYmUgYXNzaWduZWQgdG8gdGhlIG1vZGVsXG4gKiBAcmV0dXJucyB7VH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZU1vZGVsPFQgZXh0ZW5kcyBQdXJlTW9kZWw+KG1vZGVsOiBULCBkYXRhOiBJRGljdGlvbmFyeTxhbnk+KTogVCB7XG4gIGNvbnN0IG1vZGVsSWQgPSBzdG9yYWdlLmdldE1vZGVsQ2xhc3NNZXRhS2V5KG1vZGVsLmNvbnN0cnVjdG9yIGFzIHR5cGVvZiBQdXJlTW9kZWwsICdpZCcpIHx8ICdpZCc7XG4gIGNvbnN0IG1vZGVsVHlwZSA9IHN0b3JhZ2UuZ2V0TW9kZWxDbGFzc01ldGFLZXkobW9kZWwuY29uc3RydWN0b3IgYXMgdHlwZW9mIFB1cmVNb2RlbCwgJ3R5cGUnKSB8fCAndHlwZSc7XG5cbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEgaW5zdGFuY2VvZiBQdXJlTW9kZWwgPyBtb2RlbFRvSlNPTihkYXRhKSA6IGRhdGEpO1xuICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgIGlmIChrZXkgIT09IE1FVEFfRklFTEQgJiYga2V5ICE9PSBtb2RlbElkICYmIGtleSAhPT0gbW9kZWxUeXBlKSB7XG4gICAgICBhc3NpZ25Nb2RlbChtb2RlbCwga2V5LCBkYXRhW2tleV0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBtb2RlbDtcbn1cblxuLyoqXG4gKiBBc3NpZ24gYSBwcm9wZXJ0eSB0byBhIG1vZGVsXG4gKlxuICogQGV4cG9ydFxuICogQHRlbXBsYXRlIFRcbiAqIEBwYXJhbSB7VH0gbW9kZWwgQSBtb2RlbCB0byBtb2RpZnlcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgUHJvcGVydHkgbmFtZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBQcm9wZXJ0eSB2YWx1ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzaWduTW9kZWw8VCBleHRlbmRzIFB1cmVNb2RlbD4obW9kZWw6IFQsIGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogdm9pZCB7XG4gIGNvbnN0IHJlZnMgPSBnZXRNb2RlbE1ldGFLZXkobW9kZWwsICdyZWZzJykgYXMgSURpY3Rpb25hcnk8SVJlZmVyZW5jZU9wdGlvbnM+O1xuICBpZiAoa2V5IGluIHJlZnMpIHtcbiAgICBhc3NpZ25Nb2RlbFJlZihtb2RlbCwga2V5LCB2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBQdXJlTW9kZWwpIHtcbiAgICB0aHJvdyBlcnJvcihOT19SRUZTLCB7a2V5fSk7XG4gIH0gZWxzZSB7XG4gICAgYXNzaWduTW9kZWxGaWVsZChtb2RlbCwga2V5LCB2YWx1ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXNzaWduTW9kZWxGaWVsZDxUIGV4dGVuZHMgUHVyZU1vZGVsPihtb2RlbDogVCwga2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgY29uc3QgZmllbGRzID0gZ2V0TW9kZWxNZXRhS2V5KG1vZGVsLCAnZmllbGRzJykgYXMgQXJyYXk8c3RyaW5nPjtcbiAgaWYgKGZpZWxkcy5pbmRleE9mKGtleSkgIT09IC0xKSB7XG4gICAgbW9kZWxba2V5XSA9IHZhbHVlO1xuICB9IGVsc2Uge1xuICAgIGluaXRNb2RlbEZpZWxkKG1vZGVsLCBrZXksIHZhbHVlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NpZ25Nb2RlbFJlZjxUIGV4dGVuZHMgUHVyZU1vZGVsPihtb2RlbDogVCwga2V5OiBzdHJpbmcsIHZhbHVlOiBUUmVmVmFsdWUpOiB2b2lkIHtcbiAgY29uc3QgcmVmcyA9IGdldE1vZGVsTWV0YUtleShtb2RlbCwgJ3JlZnMnKTtcbiAgbW9kZWxba2V5XSA9IHZhbHVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWV0YUtleUZyb21SYXcoZGF0YTogSVJhd01vZGVsLCBrZXk6IHN0cmluZywgbW9kZWw/OiB0eXBlb2YgUHVyZU1vZGVsKTogYW55IHtcbiAgaWYgKE1FVEFfRklFTEQgaW4gZGF0YSAmJiB0eXBlb2YgZGF0YVtNRVRBX0ZJRUxEXSA9PT0gJ29iamVjdCcgJiYgZGF0YVtNRVRBX0ZJRUxEXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIChkYXRhW01FVEFfRklFTERdIGFzIElEaWN0aW9uYXJ5PGFueT4pW2tleV07XG4gIH1cbiAgaWYgKG1vZGVsKSB7XG4gICAgY29uc3QgbW9kZWxJZCA9IHN0b3JhZ2UuZ2V0TW9kZWxDbGFzc01ldGFLZXkobW9kZWwsIGtleSk7XG4gICAgcmV0dXJuIG1vZGVsSWQgJiYgZGF0YVttb2RlbElkXTtcbiAgfVxuICByZXR1cm4gZGF0YSAmJiBkYXRhW2tleV07XG59XG5cbi8qKlxuICogR2V0IGEgc2VyaWFsaXphYmxlIHZhbHVlIG9mIHRoZSBtb2RlbFxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7UHVyZU1vZGVsfSBtb2RlbCBNb2RlbCB0byBzZXJpYWxpemVcbiAqIEByZXR1cm5zIHtJUmF3TW9kZWx9IFB1cmUgSlMgdmFsdWUgb2YgdGhlIG1vZGVsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtb2RlbFRvSlNPTihtb2RlbDogUHVyZU1vZGVsKTogSVJhd01vZGVsIHtcbiAgY29uc3QgZGF0YSA9IHRvSlMoc3RvcmFnZS5nZXRNb2RlbERhdGEobW9kZWwpKTtcblxuICBjb25zdCByYXdNZXRhID0gT2JqZWN0LmFzc2lnbih7fSwgc3RvcmFnZS5nZXRNb2RlbE1ldGEobW9kZWwpKTtcbiAgZGVsZXRlIHJhd01ldGEuY29sbGVjdGlvbjtcbiAgY29uc3QgbWV0YSA9IHRvSlMocmF3TWV0YSk7XG5cbiAgZGVsZXRlIG1ldGEuY29sbGVjdGlvbjtcblxuICBjb25zdCByYXcgPSBPYmplY3QuYXNzaWduKGRhdGEsIHtbTUVUQV9GSUVMRF06IG1ldGF9KTtcblxuICBjb25zdCBzdGF0aWNNb2RlbCA9IG1vZGVsLmNvbnN0cnVjdG9yIGFzIHR5cGVvZiBQdXJlTW9kZWw7XG4gIGNvbnN0IG1vZGVsSWQgPSBzdG9yYWdlLmdldE1vZGVsQ2xhc3NNZXRhS2V5KHN0YXRpY01vZGVsLCAnaWQnKTtcbiAgY29uc3QgbW9kZWxUeXBlID0gc3RvcmFnZS5nZXRNb2RlbENsYXNzTWV0YUtleShzdGF0aWNNb2RlbCwgJ3R5cGUnKTtcbiAgaWYgKG1ldGEgJiYgbW9kZWxJZCkge1xuICAgIHJhd1ttb2RlbElkXSA9IG1ldGEuaWQ7XG4gIH1cbiAgaWYgKG1ldGEgJiYgbW9kZWxUeXBlKSB7XG4gICAgcmF3W21vZGVsVHlwZV0gPSBtZXRhLnR5cGU7XG4gIH1cblxuICByZXR1cm4gcmF3O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9kZWxNZXRhS2V5KG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nKSB7XG4gIHJldHVybiBzdG9yYWdlLmdldE1vZGVsTWV0YUtleShtb2RlbCwga2V5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldE1vZGVsTWV0YUtleShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICByZXR1cm4gc3RvcmFnZS5zZXRNb2RlbE1ldGFLZXkobW9kZWwsIGtleSwgdmFsdWUpO1xufVxuIl19","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/helpers/model/utils.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { IIdentifier } from '../../interfaces/IIdentifier';\r\nimport { IType } from '../../interfaces/IType';\r\nimport { PureCollection } from '../../PureCollection';\r\nimport { PureModel } from '../../PureModel';\r\n/**\r\n * Get the model type\r\n *\r\n * @export\r\n * @param {(IType|typeof PureModel|PureModel)} model Model to be checked\r\n * @returns {IType} Model type\r\n */\r\nexport declare function getModelType(model: IType | typeof PureModel | PureModel): IType;\r\n/**\r\n * Get the model identifier\r\n *\r\n * @export\r\n * @param {(PureModel|IIdentifier)} model Model to be checked\r\n * @returns {IIdentifier} Model identifier\r\n */\r\nexport declare function getModelId(model: PureModel | IIdentifier): IIdentifier;\r\n/**\r\n * Get a collection the given model belongs to\r\n *\r\n * @export\r\n * @param {PureModel} model Model to be checked\r\n * @returns {PureCollection} A collection the given model belongs to\r\n */\r\nexport declare function getModelCollection(model: PureModel): PureCollection | undefined;\r\n/**\r\n * Clone the given model\r\n *\r\n * @export\r\n * @template T\r\n * @param {T} model Model to be clones\r\n * @returns {T} Cloned model object\r\n */\r\nexport declare function cloneModel<T extends PureModel>(model: T): T;\r\n/**\r\n * Get the original model for the cloned model\r\n *\r\n * @export\r\n * @param {PureModel} model Cloned model\r\n * @returns {PureModel} Original model\r\n */\r\nexport declare function getOriginalModel(model: PureModel): PureModel;\r\n/**\r\n * Bulk update the model data\r\n *\r\n * @export\r\n * @template T\r\n * @param {T} model Model to be updated\r\n * @param {IDictionary<any>} data Data that should be assigned to the model\r\n * @returns {T}\r\n */\r\nexport declare function updateModel<T extends PureModel>(model: T, data: IDictionary<any>): T;\r\n/**\r\n * Assign a property to a model\r\n *\r\n * @export\r\n * @template T\r\n * @param {T} model A model to modify\r\n * @param {string} key Property name\r\n * @param {*} value Property value\r\n */\r\nexport declare function assignModel<T extends PureModel>(model: T, key: string, value: any): void;\r\nexport declare function getMetaKeyFromRaw(data: IRawModel, key: string, model?: typeof PureModel): any;\r\n/**\r\n * Get a serializable value of the model\r\n *\r\n * @export\r\n * @param {PureModel} model Model to serialize\r\n * @returns {IRawModel} Pure JS value of the model\r\n */\r\nexport declare function modelToJSON(model: PureModel): IRawModel;\r\nexport declare function getModelMetaKey(model: PureModel, key: string): any;\r\nexport declare function setModelMetaKey(model: PureModel, key: string, value: any): void;\r\n"}}
