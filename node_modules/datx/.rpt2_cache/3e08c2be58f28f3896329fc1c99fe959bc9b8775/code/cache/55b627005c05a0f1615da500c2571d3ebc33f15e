{"code":"import { observable, set } from 'mobx';\r\nimport { MODEL_REQUIRED } from '../errors';\r\nimport { error } from '../helpers/format';\r\nimport { reducePrototypeChain } from '../helpers/selectors';\r\nvar DataStorage = /** @class */ (function () {\r\n    function DataStorage() {\r\n        this.modelData = new WeakMap();\r\n        this.modelClassData = new WeakMap();\r\n    }\r\n    DataStorage.prototype.initModel = function (model) {\r\n        var modelData = observable({ data: {}, meta: {} });\r\n        this.modelData.set(model, modelData);\r\n        return modelData;\r\n    };\r\n    DataStorage.prototype.getModelData = function (model) {\r\n        return this.__getModelData(model).data;\r\n    };\r\n    DataStorage.prototype.getModelDataKey = function (model, key) {\r\n        var modelData = this.__getModelData(model);\r\n        return modelData.data[key];\r\n    };\r\n    DataStorage.prototype.setModelData = function (model, data) {\r\n        var modelData = this.__getModelData(model);\r\n        set(modelData.data, data);\r\n    };\r\n    DataStorage.prototype.setModelDataKey = function (model, key, value) {\r\n        this.setModelData(model, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.getModelMeta = function (model) {\r\n        return this.modelData.get(model).meta;\r\n    };\r\n    DataStorage.prototype.getModelMetaKey = function (model, key) {\r\n        return this.getModelMeta(model)[key];\r\n    };\r\n    DataStorage.prototype.setModelMeta = function (model, meta) {\r\n        var modelData = this.__getModelData(model);\r\n        set(modelData.meta, meta);\r\n        return modelData.meta;\r\n    };\r\n    DataStorage.prototype.setModelMetaKey = function (model, key, value) {\r\n        this.setModelMeta(model, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.setModelClassMetaKey = function (model, key, value) {\r\n        var data = this.modelClassData.get(model);\r\n        Object.assign(data.meta, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.getModelClassMetaKey = function (obj, key) {\r\n        var _this = this;\r\n        return reducePrototypeChain(obj, function (value, model) {\r\n            return value || (_this.modelClassData.get(model) || { meta: {} }).meta[key] || null;\r\n        }, null);\r\n    };\r\n    DataStorage.prototype.addModelDefaultField = function (model, key, value) {\r\n        var data = this.modelClassData.get(model);\r\n        if (data) {\r\n            Object.assign(data.data, (_a = {}, _a[key] = value, _a));\r\n        }\r\n        else {\r\n            this.modelClassData.set(model, {\r\n                data: (_b = {}, _b[key] = value, _b),\r\n                meta: {},\r\n                references: {},\r\n            });\r\n        }\r\n        var _a, _b;\r\n    };\r\n    DataStorage.prototype.getModelDefaults = function (obj) {\r\n        var _this = this;\r\n        var defaults = reducePrototypeChain(obj, function (state, model) {\r\n            return state.concat((_this.modelClassData.get(model) || { data: [] }).data);\r\n        }, []);\r\n        return Object.assign.apply(Object, [{}].concat(defaults.reverse()));\r\n    };\r\n    DataStorage.prototype.addModelClassReference = function (model, key, options) {\r\n        if (!options.model && options.model !== 0) {\r\n            throw error(MODEL_REQUIRED);\r\n        }\r\n        var data = this.modelClassData.get(model);\r\n        if (data) {\r\n            Object.assign(data.references, (_a = {}, _a[key] = options, _a));\r\n        }\r\n        else {\r\n            this.modelClassData.set(model, {\r\n                data: {},\r\n                meta: {},\r\n                references: (_b = {}, _b[key] = options, _b),\r\n            });\r\n        }\r\n        var _a, _b;\r\n    };\r\n    DataStorage.prototype.getModelClassReferences = function (obj) {\r\n        var _this = this;\r\n        var defaults = reducePrototypeChain(obj, function (state, model) {\r\n            return state.concat((_this.modelClassData.get(model) || { references: {} }).references);\r\n        }, []);\r\n        return Object.assign.apply(Object, [{}].concat(defaults.reverse()));\r\n    };\r\n    DataStorage.prototype.getModelReferenceOptions = function (model, key) {\r\n        var refs = this.getModelMetaKey(model, 'refs');\r\n        return refs[key];\r\n    };\r\n    DataStorage.prototype.__getModelData = function (model) {\r\n        return this.modelData.get(model) || this.initModel(model);\r\n    };\r\n    // For testing purposes only\r\n    DataStorage.prototype.clear = function () {\r\n        this.modelData = new WeakMap();\r\n        this.modelClassData = new WeakMap();\r\n    };\r\n    return DataStorage;\r\n}());\r\nexport { DataStorage };\r\nexport var storage = new DataStorage();\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2aWNlcy9zdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBc0MsVUFBVSxFQUFFLEdBQUcsRUFBTyxNQUFNLE1BQU0sQ0FBQztBQUVoRixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUV4QyxPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQWMxRDtJQUFBO1FBQ1UsY0FBUyxHQUFHLElBQUksT0FBTyxFQUEyQixDQUFDO1FBRW5ELG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQW1ELENBQUM7SUFpSDFGLENBQUM7SUEvR1EsK0JBQVMsR0FBaEIsVUFBaUIsS0FBZ0I7UUFDL0IsSUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLEVBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFDLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDckMsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVNLGtDQUFZLEdBQW5CLFVBQW9CLEtBQWdCO1FBQ2xDLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDekMsQ0FBQztJQUVNLHFDQUFlLEdBQXRCLFVBQXVCLEtBQWdCLEVBQUUsR0FBVztRQUNsRCxJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdDLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRU0sa0NBQVksR0FBbkIsVUFBb0IsS0FBZ0IsRUFBRSxJQUFzQjtRQUMxRCxJQUFNLFNB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QyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3ZGLENBQUMsRUFBRSxFQUE2QixDQUFDLENBQUM7UUFDbEMsT0FBTyxNQUFNLENBQUMsTUFBTSxPQUFiLE1BQU0sR0FBUSxFQUFFLFNBQUssUUFBUSxDQUFDLE9BQU8sRUFBRSxHQUFFO0lBQ2xELENBQUM7SUFFTSw4Q0FBd0IsR0FBL0IsVUFBZ0MsS0FBZ0IsRUFBRSxHQUFXO1FBQzNELElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2pELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFFTyxvQ0FBYyxHQUF0QixVQUF1QixLQUFnQjtRQUNyQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVELDRCQUE0QjtJQUNwQiwyQkFBSyxHQUFiO1FBQ0UsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLE9BQU8sRUFBMkIsQ0FBQztRQUN4RCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksT0FBTyxFQUFxQyxDQUFDO0lBQ3pFLENBQUM7SUFDSCxrQkFBQztBQUFELENBQUMsQUFwSEQsSUFvSEM7O0FBRUQsTUFBTSxDQUFDLElBQU0sT0FBTyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2ZsYXR0ZW4sIElEaWN0aW9uYXJ5LCB1bmlxfSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7SU9ic2VydmFibGVBcnJheSwgSU9ic2VydmFibGVPYmplY3QsIG9ic2VydmFibGUsIHNldCwgdG9KU30gZnJvbSAnbW9ieCc7XG5cbmltcG9ydCB7TU9ERUxfUkVRVUlSRUR9IGZyb20gJy4uL2Vycm9ycyc7XG5pbXBvcnQge2Vycm9yfSBmcm9tICcuLi9oZWxwZXJzL2Zvcm1hdCc7XG5pbXBvcnQge2dldE1vZGVsSWQsIGdldE1vZGVsVHlwZX0gZnJvbSAnLi4vaGVscGVycy9tb2RlbC91dGlscyc7XG5pbXBvcnQge3JlZHVjZVByb3RvdHlwZUNoYWlufSBmcm9tICcuLi9oZWxwZXJzL3NlbGVjdG9ycyc7XG5pbXBvcnQge0lEYXRhU3RvcmFnZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9JRGF0YVN0b3JhZ2UnO1xuaW1wb3J0IHtJSWRlbnRpZmllcn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9JSWRlbnRpZmllcic7XG5pbXBvcnQge0lSZWZlcmVuY2VPcHRpb25zfSBmcm9tICcuLi9pbnRlcmZhY2VzL0lSZWZlcmVuY2VPcHRpb25zJztcbmltcG9ydCB7SVR5cGV9IGZyb20gJy4uL2ludGVyZmFjZXMvSVR5cGUnO1xuaW1wb3J0IHtQdXJlQ29sbGVjdGlvbn0gZnJvbSAnLi4vUHVyZUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtQdXJlTW9kZWx9IGZyb20gJy4uL1B1cmVNb2RlbCc7XG5cbmludGVyZmFjZSBJTW9kZWxDbGFzc0RhdGEge1xuICBkYXRhOiBJRGljdGlvbmFyeTxhbnk+O1xuICBtZXRhOiBJRGljdGlvbmFyeTxhbnk+O1xuICByZWZlcmVuY2VzOiBJRGljdGlvbmFyeTxJUmVmZXJlbmNlT3B0aW9ucz47XG59XG5cbmV4cG9ydCBjbGFzcyBEYXRhU3RvcmFnZSB7XG4gIHByaXZhdGUgbW9kZWxEYXRhID0gbmV3IFdlYWtNYXA8UHVyZU1vZGVsLCBJRGF0YVN0b3JhZ2U+KCk7XG5cbiAgcHJpdmF0ZSBtb2RlbENsYXNzRGF0YSA9IG5ldyBXZWFrTWFwPHR5cGVvZiBQdXJlTW9kZWx8e3R5cGU6IElUeXBlfSwgSU1vZGVsQ2xhc3NEYXRhPigpO1xuXG4gIHB1YmxpYyBpbml0TW9kZWwobW9kZWw6IFB1cmVNb2RlbCkge1xuICAgIGNvbnN0IG1vZGVsRGF0YSA9IG9ic2VydmFibGUoe2RhdGE6IHt9LCBtZXRhOiB7fX0pO1xuICAgIHRoaXMubW9kZWxEYXRhLnNldChtb2RlbCwgbW9kZWxEYXRhKTtcbiAgICByZXR1cm4gbW9kZWxEYXRhO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsRGF0YShtb2RlbDogUHVyZU1vZGVsKSB7XG4gICAgcmV0dXJuIHRoaXMuX19nZXRNb2RlbERhdGEobW9kZWwpLmRhdGE7XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxEYXRhS2V5KG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nKSB7XG4gICAgY29uc3QgbW9kZWxEYXRhID0gdGhpcy5fX2dldE1vZGVsRGF0YShtb2RlbCk7XG4gICAgcmV0dXJuIG1vZGVsRGF0YS5kYXRhW2tleV07XG4gIH1cblxuICBwdWJsaWMgc2V0TW9kZWxEYXRhKG1vZGVsOiBQdXJlTW9kZWwsIGRhdGE6IElEaWN0aW9uYXJ5PGFueT4pIHtcbiAgICBjb25zdCBtb2RlbERhdGEgPSB0aGlzLl9fZ2V0TW9kZWxEYXRhKG1vZGVsKTtcbiAgICBzZXQobW9kZWxEYXRhLmRhdGEsIGRhdGEpO1xuICB9XG5cbiAgcHVibGljIHNldE1vZGVsRGF0YUtleShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgdmFsdWU/OiBhbnkpIHtcbiAgICB0aGlzLnNldE1vZGVsRGF0YShtb2RlbCwge1trZXldOiB2YWx1ZX0pO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsTWV0YShtb2RlbDogUHVyZU1vZGVsKTogSURpY3Rpb25hcnk8YW55PiB7XG4gICAgcmV0dXJuICh0aGlzLm1vZGVsRGF0YS5nZXQobW9kZWwpIGFzIElEYXRhU3RvcmFnZSkubWV0YTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNb2RlbE1ldGFLZXkobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmdldE1vZGVsTWV0YShtb2RlbClba2V5XTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRNb2RlbE1ldGEobW9kZWw6IFB1cmVNb2RlbCwgbWV0YTogSURpY3Rpb25hcnk8YW55Pikge1xuICAgIGNvbnN0IG1vZGVsRGF0YSA9IHRoaXMuX19nZXRNb2RlbERhdGEobW9kZWwpO1xuICAgIHNldChtb2RlbERhdGEubWV0YSwgbWV0YSk7XG4gICAgcmV0dXJuIG1vZGVsRGF0YS5tZXRhO1xuICB9XG5cbiAgcHVibGljIHNldE1vZGVsTWV0YUtleShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgdmFsdWU/OiBhbnkpIHtcbiAgICB0aGlzLnNldE1vZGVsTWV0YShtb2RlbCwge1trZXldOiB2YWx1ZX0pO1xuICB9XG5cbiAgcHVibGljIHNldE1vZGVsQ2xhc3NNZXRhS2V5KG1vZGVsOiB0eXBlb2YgUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgdmFsdWU/OiBhbnkpIHtcbiAgICBjb25zdCBkYXRhID0gdGhpcy5tb2RlbENsYXNzRGF0YS5nZXQobW9kZWwpIGFzIElNb2RlbENsYXNzRGF0YTtcbiAgICBPYmplY3QuYXNzaWduKGRhdGEubWV0YSwge1trZXldOiB2YWx1ZX0pO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsQ2xhc3NNZXRhS2V5KG9iajogdHlwZW9mIFB1cmVNb2RlbCwga2V5OiBzdHJpbmcpOiBhbnkge1xuICAgIHJldHVybiByZWR1Y2VQcm90b3R5cGVDaGFpbihvYmosICh2YWx1ZSwgbW9kZWwpID0+IHtcbiAgICAgIHJldHVybiB2YWx1ZSB8fCAodGhpcy5tb2RlbENsYXNzRGF0YS5nZXQobW9kZWwpIHx8IHttZXRhOiB7fX0pLm1ldGFba2V5XSB8fCBudWxsO1xuICAgIH0sIG51bGwpO1xuICB9XG5cbiAgcHVibGljIGFkZE1vZGVsRGVmYXVsdEZpZWxkKG1vZGVsOiB0eXBlb2YgUHVyZU1vZGVsLCBrZXk6IHN0cmluZywgdmFsdWU/OiBhbnkpIHtcbiAgICBjb25zdCBkYXRhID0gdGhpcy5tb2RlbENsYXNzRGF0YS5nZXQobW9kZWwpO1xuICAgIGlmIChkYXRhKSB7XG4gICAgICBPYmplY3QuYXNzaWduKGRhdGEuZGF0YSwge1trZXldOiB2YWx1ZX0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm1vZGVsQ2xhc3NEYXRhLnNldChtb2RlbCwge1xuICAgICAgICBkYXRhOiB7W2tleV06IHZhbHVlfSxcbiAgICAgICAgbWV0YToge30sXG4gICAgICAgIHJlZmVyZW5jZXM6IHt9LFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldE1vZGVsRGVmYXVsdHMob2JqOiB0eXBlb2YgUHVyZU1vZGVsKTogSURpY3Rpb25hcnk8YW55PiB7XG4gICAgY29uc3QgZGVmYXVsdHMgPSByZWR1Y2VQcm90b3R5cGVDaGFpbihvYmosIChzdGF0ZSwgbW9kZWwpID0+IHtcbiAgICAgIHJldHVybiBzdGF0ZS5jb25jYXQoKHRoaXMubW9kZWxDbGFzc0RhdGEuZ2V0KG1vZGVsKSB8fCB7ZGF0YTogW119KS5kYXRhKTtcbiAgICB9LCBbXSBhcyBBcnJheTxJRGljdGlvbmFyeTxhbnk+Pik7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIC4uLmRlZmF1bHRzLnJldmVyc2UoKSk7XG4gIH1cblxuICBwdWJsaWMgYWRkTW9kZWxDbGFzc1JlZmVyZW5jZShtb2RlbDogdHlwZW9mIFB1cmVNb2RlbCwga2V5OiBzdHJpbmcsIG9wdGlvbnM6IElSZWZlcmVuY2VPcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zLm1vZGVsICYmIG9wdGlvbnMubW9kZWwgIT09IDApIHtcbiAgICAgIHRocm93IGVycm9yKE1PREVMX1JFUVVJUkVEKTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gdGhpcy5tb2RlbENsYXNzRGF0YS5nZXQobW9kZWwpO1xuICAgIGlmIChkYXRhKSB7XG4gICAgICBPYmplY3QuYXNzaWduKGRhdGEucmVmZXJlbmNlcywge1trZXldOiBvcHRpb25zfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubW9kZWxDbGFzc0RhdGEuc2V0KG1vZGVsLCB7XG4gICAgICAgIGRhdGE6IHt9LFxuICAgICAgICBtZXRhOiB7fSxcbiAgICAgICAgcmVmZXJlbmNlczoge1trZXldOiBvcHRpb25zfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRNb2RlbENsYXNzUmVmZXJlbmNlcyhvYmo6IHR5cGVvZiBQdXJlTW9kZWwpOiBJRGljdGlvbmFyeTxJUmVmZXJlbmNlT3B0aW9ucz4ge1xuICAgIGNvbnN0IGRlZmF1bHRzID0gcmVkdWNlUHJvdG90eXBlQ2hhaW4ob2JqLCAoc3RhdGUsIG1vZGVsKSA9PiB7XG4gICAgICByZXR1cm4gc3RhdGUuY29uY2F0KCh0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCkgfHwge3JlZmVyZW5jZXM6IHt9fSkucmVmZXJlbmNlcyk7XG4gICAgfSwgW10gYXMgQXJyYXk8SURpY3Rpb25hcnk8YW55Pj4pO1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCAuLi5kZWZhdWx0cy5yZXZlcnNlKCkpO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsUmVmZXJlbmNlT3B0aW9ucyhtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZyk6IElSZWZlcmVuY2VPcHRpb25zIHtcbiAgICBjb25zdCByZWZzID0gdGhpcy5nZXRNb2RlbE1ldGFLZXkobW9kZWwsICdyZWZzJyk7XG4gICAgcmV0dXJuIHJlZnNba2V5XTtcbiAgfVxuXG4gIHByaXZhdGUgX19nZXRNb2RlbERhdGEobW9kZWw6IFB1cmVNb2RlbCk6IElEYXRhU3RvcmFnZSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxEYXRhLmdldChtb2RlbCkgfHwgdGhpcy5pbml0TW9kZWwobW9kZWwpO1xuICB9XG5cbiAgLy8gRm9yIHRlc3RpbmcgcHVycG9zZXMgb25seVxuICBwcml2YXRlIGNsZWFyKCkge1xuICAgIHRoaXMubW9kZWxEYXRhID0gbmV3IFdlYWtNYXA8UHVyZU1vZGVsLCBJRGF0YVN0b3JhZ2U+KCk7XG4gICAgdGhpcy5tb2RlbENsYXNzRGF0YSA9IG5ldyBXZWFrTWFwPHR5cGVvZiBQdXJlTW9kZWwsIElNb2RlbENsYXNzRGF0YT4oKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3Qgc3RvcmFnZSA9IG5ldyBEYXRhU3RvcmFnZSgpO1xuIl19","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/services/storage.d.ts","text":"import { IDictionary } from 'datx-utils';\r\nimport { IObservableObject } from 'mobx';\r\nimport { IReferenceOptions } from '../interfaces/IReferenceOptions';\r\nimport { PureModel } from '../PureModel';\r\nexport declare class DataStorage {\r\n    private modelData;\r\n    private modelClassData;\r\n    initModel(model: PureModel): {\r\n        data: {};\r\n        meta: {};\r\n    } & IObservableObject;\r\n    getModelData(model: PureModel): IDictionary<any>;\r\n    getModelDataKey(model: PureModel, key: string): any;\r\n    setModelData(model: PureModel, data: IDictionary<any>): void;\r\n    setModelDataKey(model: PureModel, key: string, value?: any): void;\r\n    getModelMeta(model: PureModel): IDictionary<any>;\r\n    getModelMetaKey(model: PureModel, key: string): any;\r\n    setModelMeta(model: PureModel, meta: IDictionary<any>): IDictionary<any>;\r\n    setModelMetaKey(model: PureModel, key: string, value?: any): void;\r\n    setModelClassMetaKey(model: typeof PureModel, key: string, value?: any): void;\r\n    getModelClassMetaKey(obj: typeof PureModel, key: string): any;\r\n    addModelDefaultField(model: typeof PureModel, key: string, value?: any): void;\r\n    getModelDefaults(obj: typeof PureModel): IDictionary<any>;\r\n    addModelClassReference(model: typeof PureModel, key: string, options: IReferenceOptions): void;\r\n    getModelClassReferences(obj: typeof PureModel): IDictionary<IReferenceOptions>;\r\n    getModelReferenceOptions(model: PureModel, key: string): IReferenceOptions;\r\n    private __getModelData(model);\r\n    private clear();\r\n}\r\nexport declare const storage: DataStorage;\r\n"}}
