{"code":"import * as tslib_1 from \"tslib\";\r\nimport { action, computed, extendObservable, observable, set } from 'mobx';\r\nimport { MODEL_SINGLE_COLLECTION, UNDEFINED_TYPE, VIEW_NAME_TAKEN } from './errors';\r\nimport { initModels, isSelectorFunction, upsertModel } from './helpers/collection';\r\nimport { error } from './helpers/format';\r\nimport { getModelCollection, getModelId, getModelType, modelToJSON, setModelMetaKey, updateModel, } from './helpers/model/utils';\r\nimport { PureModel } from './PureModel';\r\nimport { View } from './View';\r\nvar PureCollection = /** @class */ (function () {\r\n    function PureCollection(data) {\r\n        if (data === void 0) { data = []; }\r\n        var _this = this;\r\n        this.__data = observable.array([], { deep: false });\r\n        this.__views = [];\r\n        this.__viewList = [];\r\n        this.__dataMap = {};\r\n        this.__dataList = {};\r\n        extendObservable(this, {});\r\n        if (data instanceof Array) {\r\n            this.insert(data);\r\n        }\r\n        else if (data && 'models' in data) {\r\n            this.insert(data.models);\r\n        }\r\n        var staticCollection = this.constructor;\r\n        var initViews = (data && 'views' in data) ? data.views : {};\r\n        Object.keys(staticCollection.views).forEach(function (key) {\r\n            var view = staticCollection.views[key];\r\n            var init = initViews[key] || view;\r\n            _this.addView(key, init.modelType, {\r\n                mixins: view.mixins,\r\n                models: init.models || [],\r\n                sortMethod: view.sortMethod,\r\n                unique: init.unique,\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * Function for inserting raw models into the collection. Used when hydrating the collection\r\n     *\r\n     * @param {Array<IRawModel>} data Raw model data\r\n     * @returns {Array<PureModel>} A list of initialized models\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.insert = function (data) {\r\n        var models = initModels(this, data);\r\n        this.__insertModel(models);\r\n        return models;\r\n    };\r\n    PureCollection.prototype.add = function (data, model) {\r\n        return (data instanceof Array) ? this.__addArray(data, model) : this.__addSingle(data, model);\r\n    };\r\n    PureCollection.prototype.find = function (model, id) {\r\n        if (id instanceof PureModel) {\r\n            return id;\r\n        }\r\n        return isSelectorFunction(model)\r\n            ? (this.__data.find(model) || null)\r\n            : (this.__findByType(model, id) || null);\r\n    };\r\n    /**\r\n     * Filter models based on a matching function\r\n     *\r\n     * @param {TFilterFn} test Function used to match the models\r\n     * @returns {(PureModel|null)} The matching models\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.filter = function (test) {\r\n        return this.__data.filter(test);\r\n    };\r\n    /**\r\n     * Find all matching models or all models if no type is given\r\n     *\r\n     * @param {(IType|typeof PureModel)} [model] Model type to select\r\n     * @returns {Array<PureModel>} List of matching models\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.findAll = function (model) {\r\n        if (model) {\r\n            var type = getModelType(model);\r\n            if (!(type in this.__dataList)) {\r\n                set(this.__dataList, (_a = {}, _a[type] = observable.array([]), _a));\r\n            }\r\n            return this.__dataList[type];\r\n        }\r\n        return this.__data;\r\n        var _a;\r\n    };\r\n    /**\r\n     * Check if a model is in the collection\r\n     *\r\n     * @param {PureModel} model Model to check\r\n     * @returns {boolean} The given model is in the collection\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.hasItem = function (model) {\r\n        var id = getModelId(model);\r\n        return Boolean(this.find(model, id));\r\n    };\r\n    PureCollection.prototype.remove = function (obj, id) {\r\n        var model = typeof obj === 'object' ? obj : this.find(obj, id);\r\n        if (model) {\r\n            this.__removeModel(model);\r\n        }\r\n    };\r\n    /**\r\n     * Remove all models of the given model type from the collection\r\n     *\r\n     * @param {(IType|typeof PureModel)} type Model type\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.removeAll = function (type) {\r\n        this.__removeModel(this.findAll(type).slice());\r\n    };\r\n    Object.defineProperty(PureCollection.prototype, \"length\", {\r\n        /**\r\n         * A total count of models in the collection\r\n         *\r\n         * @readonly\r\n         * @type {number}\r\n         * @memberof Collection\r\n         */\r\n        get: function () {\r\n            return this.__data.length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Get the serializable value of the collection\r\n     *\r\n     * @returns {IRawCollection} Pure JS value of the collection\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.toJSON = function () {\r\n        var _this = this;\r\n        var views = {};\r\n        this.__views.forEach(function (key) {\r\n            views[key] = _this[key].toJSON();\r\n        });\r\n        return {\r\n            models: this.__data.map(modelToJSON),\r\n            views: views,\r\n        };\r\n    };\r\n    Object.defineProperty(PureCollection.prototype, \"snapshot\", {\r\n        get: function () {\r\n            return this.toJSON();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Reset the collection (remove all models)\r\n     *\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.prototype.reset = function () {\r\n        this.__data.forEach(function (model) {\r\n            setModelMetaKey(model, 'collection', undefined);\r\n        });\r\n        this.__data.replace([]);\r\n        this.__dataList = observable({}, {}, { deep: false });\r\n        this.__dataMap = observable({}, {}, { deep: false });\r\n    };\r\n    PureCollection.prototype.getAllModels = function () {\r\n        return this.__data.slice();\r\n    };\r\n    /**\r\n     * Add a view to the collection\r\n     *\r\n     * @template T Model type of the view\r\n     * @param {string} name View name\r\n     * @param {(IModelConstructor<T>|IType)} type Model type the view will represent\r\n     * @param {({\r\n     *       sortMethod?: string|((item: T) => any),\r\n     *       models?: Array<IIdentifier|PureModel>,\r\n     *       unique?: boolean,\r\n     *       mixins?: Array<(view: any) => any>,\r\n     *     })} [{sortMethod, models, unique, mixins}={}] View options\r\n     * @returns {View} The created view\r\n     * @memberof PureCollection\r\n     */\r\n    PureCollection.prototype.addView = function (name, type, _a) {\r\n        var _b = _a === void 0 ? {} : _a, sortMethod = _b.sortMethod, _c = _b.models, models = _c === void 0 ? [] : _c, unique = _b.unique, mixins = _b.mixins;\r\n        if (name in this) {\r\n            throw error(VIEW_NAME_TAKEN);\r\n        }\r\n        var ViewConstructor = mixins\r\n            ? mixins.reduce(function (view, mixin) {\r\n                return mixin(view);\r\n            }, View)\r\n            : View;\r\n        this.__views.push(name);\r\n        this[name] = new ViewConstructor(type, this, sortMethod, models, unique);\r\n        return this[name];\r\n    };\r\n    PureCollection.prototype.__addArray = function (data, model) {\r\n        var _this = this;\r\n        return data.filter(Boolean).map(function (item) { return _this.__addSingle(item, model); });\r\n    };\r\n    PureCollection.prototype.__addSingle = function (data, model) {\r\n        if (!data || typeof data === 'number' || typeof data === 'string') {\r\n            return data;\r\n        }\r\n        if (data instanceof PureModel) {\r\n            if (!this.hasItem(data)) {\r\n                this.__insertModel(data);\r\n            }\r\n            return data;\r\n        }\r\n        if (!model && model !== 0) {\r\n            throw error(UNDEFINED_TYPE);\r\n        }\r\n        var type = getModelType(model);\r\n        var modelInstance = upsertModel(data, type, this);\r\n        this.__insertModel(modelInstance, type);\r\n        return modelInstance;\r\n    };\r\n    PureCollection.prototype.__insertModel = function (model, type, id) {\r\n        var _this = this;\r\n        if (model instanceof Array) {\r\n            model.forEach(function (item) {\r\n                _this.__insertModel(item, type, id);\r\n            });\r\n            return;\r\n        }\r\n        var collection = getModelCollection(model);\r\n        if (collection && collection !== this) {\r\n            throw error(MODEL_SINGLE_COLLECTION);\r\n        }\r\n        var modelType = type || getModelType(model);\r\n        var modelId = id || getModelId(model);\r\n        var stringType = modelType.toString();\r\n        var existingModel = this.find(modelType, modelId);\r\n        if (existingModel) {\r\n            updateModel(existingModel, model);\r\n            return;\r\n        }\r\n        this.__data.push(model);\r\n        if (modelType in this.__dataList) {\r\n            this.__dataList[modelType].push(model);\r\n        }\r\n        else {\r\n            set(this.__dataList, stringType, observable.array([model], { deep: false }));\r\n        }\r\n        if (modelType in this.__dataMap) {\r\n            set(this.__dataMap[modelType], modelId.toString(), model);\r\n        }\r\n        else {\r\n            set(this.__dataMap, stringType, observable.object((_a = {}, _a[modelId] = model, _a), {}, { deep: false }));\r\n        }\r\n        setModelMetaKey(model, 'collection', this);\r\n        var _a;\r\n    };\r\n    PureCollection.prototype.__removeModel = function (model, type, id) {\r\n        var _this = this;\r\n        if (model instanceof Array) {\r\n            model.forEach(function (item) {\r\n                _this.__removeModel(item, type, id);\r\n            });\r\n            return;\r\n        }\r\n        var modelType = type || getModelType(model);\r\n        var modelId = id || getModelId(model);\r\n        this.__data.remove(model);\r\n        this.__dataList[modelType].remove(model);\r\n        set(this.__dataMap[modelType], modelId.toString(), undefined);\r\n        setModelMetaKey(model, 'collection', undefined);\r\n    };\r\n    PureCollection.prototype.__findByType = function (model, id) {\r\n        var type = getModelType(model);\r\n        var stringType = type.toString();\r\n        if (id) {\r\n            if (!(type in this.__dataMap)) {\r\n                set(this.__dataMap, stringType, observable.object((_a = {}, _a[id] = undefined, _a), {}, { deep: false }));\r\n            }\r\n            else if (!(id in this.__dataMap[type])) {\r\n                set(this.__dataMap[type], id.toString(), undefined);\r\n            }\r\n            return this.__dataMap[type][id];\r\n        }\r\n        else {\r\n            if (!(type in this.__dataList)) {\r\n                set(this.__dataList, stringType, observable.array([], { deep: false }));\r\n            }\r\n            return this.__dataList[type].length ? this.__dataList[type][0] : null;\r\n        }\r\n        var _a;\r\n    };\r\n    PureCollection.prototype.__changeModelId = function (oldId, newId, type) {\r\n        this.__dataMap[type][newId] = this.__dataMap[type][oldId];\r\n        delete this.__dataMap[type][oldId];\r\n        this.__viewList\r\n            .filter(function (view) { return view.modelType === type; })\r\n            .forEach(function (view) {\r\n            // @ts-ignore - I'm bad and I should feel bad...\r\n            view.__changeModelId(oldId, newId);\r\n        });\r\n    };\r\n    /**\r\n     * List of models available in the collection\r\n     *\r\n     * @static\r\n     * @type {Array<typeof PureModel>}\r\n     * @memberof Collection\r\n     */\r\n    PureCollection.types = [];\r\n    PureCollection.views = {};\r\n    tslib_1.__decorate([\r\n        observable.shallow\r\n    ], PureCollection.prototype, \"__dataMap\", void 0);\r\n    tslib_1.__decorate([\r\n        observable.shallow\r\n    ], PureCollection.prototype, \"__dataList\", void 0);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"insert\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"add\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"remove\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"removeAll\", null);\r\n    tslib_1.__decorate([\r\n        computed\r\n    ], PureCollection.prototype, \"length\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], PureCollection.prototype, \"reset\", null);\r\n    return PureCollection;\r\n}());\r\nexport { PureCollection };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHVyZUNvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvUHVyZUNvbGxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFZLGdCQUFnQixFQUF1QyxVQUFVLEVBQUUsR0FBRyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRXhILE9BQU8sRUFBQyx1QkFBdUIsRUFBbUIsY0FBYyxFQUFFLGVBQWUsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUNuRyxPQUFPLEVBQUMsVUFBVSxFQUFFLGtCQUFrQixFQUFFLFdBQVcsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2pGLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxrQkFBa0IsQ0FBQztBQUN2QyxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLGVBQWUsRUFDZixXQUFXLEdBQ1osTUFBTSx1QkFBdUIsQ0FBQztBQU8vQixPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQ3RDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFFNUI7SUEyQkUsd0JBQVksSUFBNEM7UUFBNUMscUJBQUEsRUFBQSxTQUE0QztRQUF4RCxpQkFvQkM7UUE1Qk8sV0FBTSxHQUFnQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBRTFFLFlBQU8sR0FBa0IsRUFBRSxDQUFDO1FBQzVCLGVBQVUsR0FBZ0IsRUFBRSxDQUFDO1FBRVQsY0FBUyxHQUF3QyxFQUFFLENBQUM7UUFDcEQsZUFBVSxHQUE2QyxFQUFFLENBQUM7UUFHcEYsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzNCLElBQUksSUFBSSxZQUFZLEtBQUssRUFBRTtZQUN6QixJQUFJLENBQUMsTUFBTSxDQUFDLElB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RTtRQUFQLE1BQU07Z0RBS047SUE0Q087UUFBUCxNQUFNOzZDQUtOO0lBNEZPO1FBQVAsTUFBTTtnREFLTjtJQVFPO1FBQVAsTUFBTTttREFFTjtJQVNTO1FBQVQsUUFBUTtnREFFUjtJQThCTztRQUFQLE1BQU07K0NBT047SUF3S0gscUJBQUM7Q0FBQSxBQWpiRCxJQWliQztTQWpiWSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJRGljdGlvbmFyeSwgSVJhd01vZGVsfSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7YWN0aW9uLCBjb21wdXRlZCwgZGVjb3JhdGUsIGV4dGVuZE9ic2VydmFibGUsIElPYnNlcnZhYmxlQXJyYXksIElPYnNlcnZhYmxlT2JqZWN0LCBvYnNlcnZhYmxlLCBzZXR9IGZyb20gJ21vYngnO1xuXG5pbXBvcnQge01PREVMX1NJTkdMRV9DT0xMRUNUSU9OLCBVTkRFRklORURfTU9ERUwsIFVOREVGSU5FRF9UWVBFLCBWSUVXX05BTUVfVEFLRU59IGZyb20gJy4vZXJyb3JzJztcbmltcG9ydCB7aW5pdE1vZGVscywgaXNTZWxlY3RvckZ1bmN0aW9uLCB1cHNlcnRNb2RlbH0gZnJvbSAnLi9oZWxwZXJzL2NvbGxlY3Rpb24nO1xuaW1wb3J0IHtlcnJvcn0gZnJvbSAnLi9oZWxwZXJzL2Zvcm1hdCc7XG5pbXBvcnQge1xuICBnZXRNb2RlbENvbGxlY3Rpb24sXG4gIGdldE1vZGVsSWQsXG4gIGdldE1vZGVsVHlwZSxcbiAgbW9kZWxUb0pTT04sXG4gIHNldE1vZGVsTWV0YUtleSxcbiAgdXBkYXRlTW9kZWwsXG59IGZyb20gJy4vaGVscGVycy9tb2RlbC91dGlscyc7XG5pbXBvcnQge0lJZGVudGlmaWVyfSBmcm9tICcuL2ludGVyZmFjZXMvSUlkZW50aWZpZXInO1xuaW1wb3J0IHtJTW9kZWxDb25zdHJ1Y3Rvcn0gZnJvbSAnLi9pbnRlcmZhY2VzL0lNb2RlbENvbnN0cnVjdG9yJztcbmltcG9ydCB7SVJhd0NvbGxlY3Rpb259IGZyb20gJy4vaW50ZXJmYWNlcy9JUmF3Q29sbGVjdGlvbic7XG5pbXBvcnQge0lSYXdWaWV3fSBmcm9tICcuL2ludGVyZmFjZXMvSVJhd1ZpZXcnO1xuaW1wb3J0IHtJVHlwZX0gZnJvbSAnLi9pbnRlcmZhY2VzL0lUeXBlJztcbmltcG9ydCB7VEZpbHRlckZufSBmcm9tICcuL2ludGVyZmFjZXMvVEZpbHRlckZuJztcbmltcG9ydCB7UHVyZU1vZGVsfSBmcm9tICcuL1B1cmVNb2RlbCc7XG5pbXBvcnQge1ZpZXd9IGZyb20gJy4vVmlldyc7XG5cbmV4cG9ydCBjbGFzcyBQdXJlQ29sbGVjdGlvbiB7XG4gIC8qKlxuICAgKiBMaXN0IG9mIG1vZGVscyBhdmFpbGFibGUgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHN0YXRpY1xuICAgKiBAdHlwZSB7QXJyYXk8dHlwZW9mIFB1cmVNb2RlbD59XG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHR5cGVzOiBBcnJheTx0eXBlb2YgUHVyZU1vZGVsIHwgSU1vZGVsQ29uc3RydWN0b3I+ID0gW107XG5cbiAgcHVibGljIHN0YXRpYyB2aWV3czogSURpY3Rpb25hcnk8e1xuICAgIG1vZGVsVHlwZTogSVR5cGUgfCBQdXJlTW9kZWw7XG4gICAgc29ydE1ldGhvZD86IHN0cmluZyB8ICgoUHVyZU1vZGVsKSA9PiBhbnkpO1xuICAgIHVuaXF1ZT86IGJvb2xlYW47XG4gICAgbWl4aW5zPzogQXJyYXk8KHZpZXc6IGFueSkgPT4gYW55PjtcbiAgfT4gPSB7fTtcblxuICBwdWJsaWMgc3RhdGljIGRlZmF1bHRNb2RlbD86IHR5cGVvZiBQdXJlTW9kZWw7XG5cbiAgcHJpdmF0ZSBfX2RhdGE6IElPYnNlcnZhYmxlQXJyYXk8UHVyZU1vZGVsPiA9IG9ic2VydmFibGUuYXJyYXkoW10sIHtkZWVwOiBmYWxzZX0pO1xuXG4gIHByaXZhdGUgX192aWV3czogQXJyYXk8c3RyaW5nPiA9IFtdO1xuICBwcml2YXRlIF9fdmlld0xpc3Q6IEFycmF5PFZpZXc+ID0gW107XG5cbiAgQG9ic2VydmFibGUuc2hhbGxvdyBwcml2YXRlIF9fZGF0YU1hcDogSURpY3Rpb25hcnk8SURpY3Rpb25hcnk8UHVyZU1vZGVsPj4gPSB7fTtcbiAgQG9ic2VydmFibGUuc2hhbGxvdyBwcml2YXRlIF9fZGF0YUxpc3Q6IElEaWN0aW9uYXJ5PElPYnNlcnZhYmxlQXJyYXk8UHVyZU1vZGVsPj4gPSB7fTtcblxuICBjb25zdHJ1Y3RvcihkYXRhOiBBcnJheTxJUmF3TW9kZWw+IHwgSVJhd0NvbGxlY3Rpb24gPSBbXSkge1xuICAgIGV4dGVuZE9ic2VydmFibGUodGhpcywge30pO1xuICAgIGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHRoaXMuaW5zZXJ0KGRhdGEpO1xuICAgIH0gZWxzZSBpZiAoZGF0YSAmJiAnbW9kZWxzJyBpbiBkYXRhKSB7XG4gICAgICB0aGlzLmluc2VydChkYXRhLm1vZGVscyk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhdGljQ29sbGVjdGlvbiA9IHRoaXMuY29uc3RydWN0b3IgYXMgdHlwZW9mIFB1cmVDb2xsZWN0aW9uO1xuICAgIGNvbnN0IGluaXRWaWV3cyA9IChkYXRhICYmICd2aWV3cycgaW4gZGF0YSkgPyBkYXRhLnZpZXdzIDoge307XG4gICAgT2JqZWN0LmtleXMoc3RhdGljQ29sbGVjdGlvbi52aWV3cykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCB2aWV3ID0gc3RhdGljQ29sbGVjdGlvbi52aWV3c1trZXldO1xuICAgICAgY29uc3QgaW5pdCA9IGluaXRWaWV3c1trZXldIHx8IHZpZXc7XG4gICAgICB0aGlzLmFkZFZpZXcoa2V5LCBpbml0Lm1vZGVsVHlwZSwge1xuICAgICAgICBtaXhpbnM6IHZpZXcubWl4aW5zLFxuICAgICAgICBtb2RlbHM6IGluaXQubW9kZWxzIHx8IFtdLFxuICAgICAgICBzb3J0TWV0aG9kOiB2aWV3LnNvcnRNZXRob2QsXG4gICAgICAgIHVuaXF1ZTogaW5pdC51bmlxdWUsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBmb3IgaW5zZXJ0aW5nIHJhdyBtb2RlbHMgaW50byB0aGUgY29sbGVjdGlvbi4gVXNlZCB3aGVuIGh5ZHJhdGluZyB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAcGFyYW0ge0FycmF5PElSYXdNb2RlbD59IGRhdGEgUmF3IG1vZGVsIGRhdGFcbiAgICogQHJldHVybnMge0FycmF5PFB1cmVNb2RlbD59IEEgbGlzdCBvZiBpbml0aWFsaXplZCBtb2RlbHNcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIEBhY3Rpb24gcHVibGljIGluc2VydChkYXRhOiBBcnJheTxQYXJ0aWFsPElSYXdNb2RlbD4+KTogQXJyYXk8UHVyZU1vZGVsPiB7XG4gICAgY29uc3QgbW9kZWxzID0gaW5pdE1vZGVscyh0aGlzLCBkYXRhKTtcbiAgICB0aGlzLl9faW5zZXJ0TW9kZWwobW9kZWxzKTtcblxuICAgIHJldHVybiBtb2RlbHM7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGV4aXN0aW5nIG1vZGVsIHRvIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSBUXG4gICAqIEBwYXJhbSB7VH0gZGF0YSBNb2RlbCB0byBiZSBhZGRlZFxuICAgKiBAcmV0dXJucyB7VH0gQWRkZWQgbW9kZWxcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBhZGQ8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogVCk6IFQ7XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBhcnJheSBvZiBleGlzdGluZyBtb2RlbHMgdG8gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHRlbXBsYXRlIFRcbiAgICogQHBhcmFtIHtBcnJheTxUPn0gZGF0YSBBcnJheSBvZiBtb2RlbHMgdG8gYmUgYWRkZWRcbiAgICogQHJldHVybnMge0FycmF5PFQ+fSBBZGRlZCBtb2RlbHNcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBhZGQ8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogQXJyYXk8VD4pOiBBcnJheTxUPjtcblxuICAvKipcbiAgICogQWRkIGFuIGFycmF5IG9mIG5ldyBtb2RlbHMgdG8gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHRlbXBsYXRlIFRcbiAgICogQHBhcmFtIHtBcnJheTxJUmF3TW9kZWx8SURpY3Rpb25hcnk+fSBkYXRhIEFycmF5IG9mIG5ldyBkYXRhIHRvIGJlIGFkZGVkXG4gICAqIEBwYXJhbSB7KElUeXBlfElNb2RlbENvbnN0cnVjdG9yPFQ+KX0gbW9kZWwgTW9kZWwgdHlwZSB0byBiZSBhZGRlZFxuICAgKiBAcmV0dXJucyB7QXJyYXk8VD59IEFkZGVkIG1vZGVsc1xuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGFkZDxUIGV4dGVuZHMgUHVyZU1vZGVsPihkYXRhOiBBcnJheTxJUmF3TW9kZWx8SURpY3Rpb25hcnk+LCBtb2RlbDogSVR5cGV8SU1vZGVsQ29uc3RydWN0b3I8VD4pOiBBcnJheTxUPjtcblxuICAvKipcbiAgICogQWRkIGEgbmV3IG1vZGVsIHRvIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSBUXG4gICAqIEBwYXJhbSB7KElSYXdNb2RlbHxJRGljdGlvbmFyeSl9IGRhdGEgTmV3IGRhdGEgdG8gYmUgYWRkZWRcbiAgICogQHBhcmFtIHsoSVR5cGV8SU1vZGVsQ29uc3RydWN0b3I8VD4pfSBtb2RlbCBNb2RlbCB0eXBlIHRvIGJlIGFkZGVkXG4gICAqIEByZXR1cm5zIHtUfSBBZGRlZCBtb2RlbFxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGFkZDxUIGV4dGVuZHMgUHVyZU1vZGVsPihkYXRhOiBJUmF3TW9kZWx8SURpY3Rpb25hcnksIG1vZGVsOiBJVHlwZXxJTW9kZWxDb25zdHJ1Y3RvcjxUPik6IFQ7XG5cbiAgQGFjdGlvbiBwdWJsaWMgYWRkKFxuICAgIGRhdGE6IFB1cmVNb2RlbHxJUmF3TW9kZWx8SURpY3Rpb25hcnl8QXJyYXk8UHVyZU1vZGVsPnxBcnJheTxJUmF3TW9kZWx8SURpY3Rpb25hcnk+LFxuICAgIG1vZGVsPzogSVR5cGV8SU1vZGVsQ29uc3RydWN0b3IsXG4gICk6IFB1cmVNb2RlbHxBcnJheTxQdXJlTW9kZWw+IHtcbiAgICByZXR1cm4gKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkgPyB0aGlzLl9fYWRkQXJyYXkoZGF0YSwgbW9kZWwpIDogdGhpcy5fX2FkZFNpbmdsZShkYXRhLCBtb2RlbCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhIG1vZGVsIGJhc2VkIG9uIHRoZSBkZWZpbmVkIHR5cGUgYW5kIChvcHRpb25hbCkgaWRlbnRpZmllclxuICAgKlxuICAgKiBAcGFyYW0geyhJVHlwZXx0eXBlb2YgUHVyZU1vZGVsfFB1cmVNb2RlbCl9IHR5cGUgTW9kZWwgdHlwZVxuICAgKiBAcGFyYW0ge0lJZGVudGlmaWVyfSBbaWRdIE1vZGVsIGlkZW50aWZpZXJcbiAgICogQHJldHVybnMgeyhQdXJlTW9kZWx8bnVsbCl9IFRoZSBmaXJzdCBtYXRjaGluZyBtb2RlbFxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGZpbmQ8VCBleHRlbmRzIFB1cmVNb2RlbD4odHlwZTogSVR5cGV8VHxJTW9kZWxDb25zdHJ1Y3RvcjxUPiwgaWQ/OiBJSWRlbnRpZmllcnxQdXJlTW9kZWwpOiBUfG51bGw7XG5cbiAgLyoqXG4gICAqIEZpbmQgYSBtb2RlbCBiYXNlZCBvbiBhIG1hdGNoaW5nIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7VEZpbHRlckZufSB0ZXN0IEZ1bmN0aW9uIHVzZWQgdG8gbWF0Y2ggdGhlIG1vZGVsXG4gICAqIEByZXR1cm5zIHsoUHVyZU1vZGVsfG51bGwpfSBUaGUgZmlyc3QgbWF0Y2hpbmcgbW9kZWxcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBmaW5kPFQgZXh0ZW5kcyBQdXJlTW9kZWw+KHRlc3Q6IFRGaWx0ZXJGbik6IFR8bnVsbDtcblxuICBwdWJsaWMgZmluZChtb2RlbDogSVR5cGV8dHlwZW9mIFB1cmVNb2RlbHwoVEZpbHRlckZuKSwgaWQ/OiBJSWRlbnRpZmllcnxQdXJlTW9kZWwpIHtcbiAgICBpZiAoaWQgaW5zdGFuY2VvZiBQdXJlTW9kZWwpIHtcbiAgICAgIHJldHVybiBpZDtcbiAgICB9XG5cbiAgICByZXR1cm4gaXNTZWxlY3RvckZ1bmN0aW9uKG1vZGVsKVxuICAgICAgPyAodGhpcy5fX2RhdGEuZmluZChtb2RlbCBhcyBURmlsdGVyRm4pIHx8IG51bGwpXG4gICAgICA6ICh0aGlzLl9fZmluZEJ5VHlwZShtb2RlbCBhcyB0eXBlb2YgUHVyZU1vZGVsLCBpZCkgfHwgbnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIG1vZGVscyBiYXNlZCBvbiBhIG1hdGNoaW5nIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7VEZpbHRlckZufSB0ZXN0IEZ1bmN0aW9uIHVzZWQgdG8gbWF0Y2ggdGhlIG1vZGVsc1xuICAgKiBAcmV0dXJucyB7KFB1cmVNb2RlbHxudWxsKX0gVGhlIG1hdGNoaW5nIG1vZGVsc1xuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGZpbHRlcih0ZXN0OiBURmlsdGVyRm4pOiBBcnJheTxQdXJlTW9kZWw+IHtcbiAgICByZXR1cm4gdGhpcy5fX2RhdGEuZmlsdGVyKHRlc3QpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgYWxsIG1hdGNoaW5nIG1vZGVscyBvciBhbGwgbW9kZWxzIGlmIG5vIHR5cGUgaXMgZ2l2ZW5cbiAgICpcbiAgICogQHBhcmFtIHsoSVR5cGV8dHlwZW9mIFB1cmVNb2RlbCl9IFttb2RlbF0gTW9kZWwgdHlwZSB0byBzZWxlY3RcbiAgICogQHJldHVybnMge0FycmF5PFB1cmVNb2RlbD59IExpc3Qgb2YgbWF0Y2hpbmcgbW9kZWxzXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgZmluZEFsbDxUIGV4dGVuZHMgUHVyZU1vZGVsPihtb2RlbD86IElUeXBlfElNb2RlbENvbnN0cnVjdG9yPFQ+KTogSU9ic2VydmFibGVBcnJheTxUPiB7XG4gICAgaWYgKG1vZGVsKSB7XG4gICAgICBjb25zdCB0eXBlID0gZ2V0TW9kZWxUeXBlKG1vZGVsKTtcbiAgICAgIGlmICghKHR5cGUgaW4gdGhpcy5fX2RhdGFMaXN0KSkge1xuICAgICAgICBzZXQodGhpcy5fX2RhdGFMaXN0LCB7W3R5cGVdOiBvYnNlcnZhYmxlLmFycmF5KFtdKX0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5fX2RhdGFMaXN0W3R5cGVdIGFzIElPYnNlcnZhYmxlQXJyYXk8VD47XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX19kYXRhIGFzIElPYnNlcnZhYmxlQXJyYXk8VD47XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSBtb2RlbCBpcyBpbiB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAcGFyYW0ge1B1cmVNb2RlbH0gbW9kZWwgTW9kZWwgdG8gY2hlY2tcbiAgICogQHJldHVybnMge2Jvb2xlYW59IFRoZSBnaXZlbiBtb2RlbCBpcyBpbiB0aGUgY29sbGVjdGlvblxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIGhhc0l0ZW0obW9kZWw6IFB1cmVNb2RlbCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGlkID0gZ2V0TW9kZWxJZChtb2RlbCk7XG5cbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLmZpbmQobW9kZWwsIGlkKSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIHRoZSBmaXJzdCBtb2RlbCBiYXNlZCBvbiB0aGUgdHlwZSBhbmQgKG9wdGlvbmFsKSBpZGVudGlmaWVyXG4gICAqXG4gICAqIEBwYXJhbSB7KElUeXBlfHR5cGVvZiBQdXJlTW9kZWwpfSB0eXBlIE1vZGVsIHR5cGVcbiAgICogQHBhcmFtIHtJSWRlbnRpZmllcn0gW2lkXSBNb2RlbCBpZGVudGlmaWVyXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlKHR5cGU6IElUeXBlfHR5cGVvZiBQdXJlTW9kZWwsIGlkPzogSUlkZW50aWZpZXIpO1xuXG4gIC8qKlxuICAgKiBSZW1vdmUgdGhlIGdpdmVuIG1vZGVsIGZyb20gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHBhcmFtIHtQdXJlTW9kZWx9IG1vZGVsIE1vZGVsIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgY29sbGVjdGlvblxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgcHVibGljIHJlbW92ZShtb2RlbDogUHVyZU1vZGVsKTtcblxuICBAYWN0aW9uIHB1YmxpYyByZW1vdmUob2JqOiBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsfFB1cmVNb2RlbCwgaWQ/OiBJSWRlbnRpZmllcikge1xuICAgIGNvbnN0IG1vZGVsID0gdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgPyBvYmogOiB0aGlzLmZpbmQob2JqLCBpZCk7XG4gICAgaWYgKG1vZGVsKSB7XG4gICAgICB0aGlzLl9fcmVtb3ZlTW9kZWwobW9kZWwpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYWxsIG1vZGVscyBvZiB0aGUgZ2l2ZW4gbW9kZWwgdHlwZSBmcm9tIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7KElUeXBlfHR5cGVvZiBQdXJlTW9kZWwpfSB0eXBlIE1vZGVsIHR5cGVcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIEBhY3Rpb24gcHVibGljIHJlbW92ZUFsbCh0eXBlOiBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsKSB7XG4gICAgdGhpcy5fX3JlbW92ZU1vZGVsKHRoaXMuZmluZEFsbCh0eXBlKS5zbGljZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIHRvdGFsIGNvdW50IG9mIG1vZGVscyBpbiB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAcmVhZG9ubHlcbiAgICogQHR5cGUge251bWJlcn1cbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIEBjb21wdXRlZCBwdWJsaWMgZ2V0IGxlbmd0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9fZGF0YS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzZXJpYWxpemFibGUgdmFsdWUgb2YgdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHJldHVybnMge0lSYXdDb2xsZWN0aW9ufSBQdXJlIEpTIHZhbHVlIG9mIHRoZSBjb2xsZWN0aW9uXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgdG9KU09OKCk6IElSYXdDb2xsZWN0aW9uIHtcbiAgICBjb25zdCB2aWV3czogSURpY3Rpb25hcnk8SVJhd1ZpZXc+ID0ge307XG5cbiAgICB0aGlzLl9fdmlld3MuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICB2aWV3c1trZXldID0gdGhpc1trZXldLnRvSlNPTigpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG1vZGVsczogdGhpcy5fX2RhdGEubWFwKG1vZGVsVG9KU09OKSxcbiAgICAgIHZpZXdzLFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNuYXBzaG90KCkge1xuICAgIHJldHVybiB0aGlzLnRvSlNPTigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRoZSBjb2xsZWN0aW9uIChyZW1vdmUgYWxsIG1vZGVscylcbiAgICpcbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIEBhY3Rpb24gcHVibGljIHJlc2V0KCkge1xuICAgIHRoaXMuX19kYXRhLmZvckVhY2goKG1vZGVsKSA9PiB7XG4gICAgICBzZXRNb2RlbE1ldGFLZXkobW9kZWwsICdjb2xsZWN0aW9uJywgdW5kZWZpbmVkKTtcbiAgICB9KTtcbiAgICB0aGlzLl9fZGF0YS5yZXBsYWNlKFtdKTtcbiAgICB0aGlzLl9fZGF0YUxpc3QgPSBvYnNlcnZhYmxlKHt9LCB7fSwge2RlZXA6IGZhbHNlfSkgYXMgSU9ic2VydmFibGVPYmplY3QgJiBJRGljdGlvbmFyeTxJT2JzZXJ2YWJsZUFycmF5PFB1cmVNb2RlbD4+O1xuICAgIHRoaXMuX19kYXRhTWFwID0gb2JzZXJ2YWJsZSh7fSwge30sIHtkZWVwOiBmYWxzZX0pIGFzIElPYnNlcnZhYmxlT2JqZWN0ICZJRGljdGlvbmFyeTxJRGljdGlvbmFyeTxQdXJlTW9kZWw+PjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBbGxNb2RlbHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX19kYXRhLnNsaWNlKCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgdmlldyB0byB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAdGVtcGxhdGUgVCBNb2RlbCB0eXBlIG9mIHRoZSB2aWV3XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFZpZXcgbmFtZVxuICAgKiBAcGFyYW0geyhJTW9kZWxDb25zdHJ1Y3RvcjxUPnxJVHlwZSl9IHR5cGUgTW9kZWwgdHlwZSB0aGUgdmlldyB3aWxsIHJlcHJlc2VudFxuICAgKiBAcGFyYW0geyh7XG4gICAqICAgICAgIHNvcnRNZXRob2Q/OiBzdHJpbmd8KChpdGVtOiBUKSA9PiBhbnkpLFxuICAgKiAgICAgICBtb2RlbHM/OiBBcnJheTxJSWRlbnRpZmllcnxQdXJlTW9kZWw+LFxuICAgKiAgICAgICB1bmlxdWU/OiBib29sZWFuLFxuICAgKiAgICAgICBtaXhpbnM/OiBBcnJheTwodmlldzogYW55KSA9PiBhbnk+LFxuICAgKiAgICAgfSl9IFt7c29ydE1ldGhvZCwgbW9kZWxzLCB1bmlxdWUsIG1peGluc309e31dIFZpZXcgb3B0aW9uc1xuICAgKiBAcmV0dXJucyB7Vmlld30gVGhlIGNyZWF0ZWQgdmlld1xuICAgKiBAbWVtYmVyb2YgUHVyZUNvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBhZGRWaWV3PFQgZXh0ZW5kcyBQdXJlTW9kZWwgPSBQdXJlTW9kZWw+KFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICB0eXBlOiBJTW9kZWxDb25zdHJ1Y3RvcjxUPnxJVHlwZSxcbiAgICB7c29ydE1ldGhvZCwgbW9kZWxzID0gW10sIHVuaXF1ZSwgbWl4aW5zfToge1xuICAgICAgc29ydE1ldGhvZD86IHN0cmluZ3woKGl0ZW06IFQpID0+IGFueSk7XG4gICAgICBtb2RlbHM/OiBBcnJheTxJSWRlbnRpZmllcnxUPjtcbiAgICAgIHVuaXF1ZT86IGJvb2xlYW47XG4gICAgICBtaXhpbnM/OiBBcnJheTwodmlldzogYW55KSA9PiBhbnk+O1xuICAgIH0gPSB7fSxcbiAgKSB7XG4gICAgaWYgKG5hbWUgaW4gdGhpcykge1xuICAgICAgdGhyb3cgZXJyb3IoVklFV19OQU1FX1RBS0VOKTtcbiAgICB9XG5cbiAgICBjb25zdCBWaWV3Q29uc3RydWN0b3IgPSBtaXhpbnNcbiAgICAgID8gbWl4aW5zLnJlZHVjZSgodmlldzogYW55LCBtaXhpbjogKHZpZXc6IGFueSkgPT4gYW55KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIG1peGluKHZpZXcpO1xuICAgICAgICB9LCBWaWV3KSBhcyB0eXBlb2YgVmlld1xuICAgICAgOiBWaWV3O1xuXG4gICAgdGhpcy5fX3ZpZXdzLnB1c2gobmFtZSk7XG4gICAgdGhpc1tuYW1lXSA9IG5ldyBWaWV3Q29uc3RydWN0b3I8VD4odHlwZSwgdGhpcywgc29ydE1ldGhvZCwgbW9kZWxzLCB1bmlxdWUpO1xuXG4gICAgcmV0dXJuIHRoaXNbbmFtZV07XG4gIH1cblxuICBwcml2YXRlIF9fYWRkQXJyYXk8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogQXJyYXk8VD4pOiBBcnJheTxUPjtcbiAgcHJpdmF0ZSBfX2FkZEFycmF5PFQgZXh0ZW5kcyBQdXJlTW9kZWw+KGRhdGE6IEFycmF5PElEaWN0aW9uYXJ5PiwgbW9kZWw/OiBJVHlwZXxJTW9kZWxDb25zdHJ1Y3RvcjxUPik6IEFycmF5PFQ+O1xuICBwcml2YXRlIF9fYWRkQXJyYXkoZGF0YTogQXJyYXk8UHVyZU1vZGVsfElEaWN0aW9uYXJ5PiwgbW9kZWw/OiBJVHlwZXxJTW9kZWxDb25zdHJ1Y3Rvcik6IEFycmF5PFB1cmVNb2RlbD4ge1xuICAgIHJldHVybiBkYXRhLmZpbHRlcihCb29sZWFuKS5tYXAoKGl0ZW0pID0+IHRoaXMuX19hZGRTaW5nbGUoaXRlbSwgbW9kZWwpKTtcbiAgfVxuXG4gIHByaXZhdGUgX19hZGRTaW5nbGU8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogVCk6IFQ7XG4gIHByaXZhdGUgX19hZGRTaW5nbGU8VCBleHRlbmRzIFB1cmVNb2RlbD4oZGF0YTogSURpY3Rpb25hcnksIG1vZGVsPzogSVR5cGV8SU1vZGVsQ29uc3RydWN0b3I8VD4pOiBUO1xuICBwcml2YXRlIF9fYWRkU2luZ2xlKGRhdGE6IFB1cmVNb2RlbHxJRGljdGlvbmFyeXxJSWRlbnRpZmllciwgbW9kZWw/OiBJVHlwZXxJTW9kZWxDb25zdHJ1Y3Rvcikge1xuICAgIGlmICghZGF0YSB8fCB0eXBlb2YgZGF0YSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIFB1cmVNb2RlbCkge1xuICAgICAgaWYgKCF0aGlzLmhhc0l0ZW0oZGF0YSkpIHtcbiAgICAgICAgdGhpcy5fX2luc2VydE1vZGVsKGRhdGEpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBpZiAoIW1vZGVsICYmIG1vZGVsICE9PSAwKSB7XG4gICAgICB0aHJvdyBlcnJvcihVTkRFRklORURfVFlQRSk7XG4gICAgfVxuXG4gICAgY29uc3QgdHlwZSA9IGdldE1vZGVsVHlwZShtb2RlbCBhcyBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsKTtcbiAgICBjb25zdCBtb2RlbEluc3RhbmNlID0gdXBzZXJ0TW9kZWwoZGF0YSwgdHlwZSwgdGhpcyk7XG4gICAgdGhpcy5fX2luc2VydE1vZGVsKG1vZGVsSW5zdGFuY2UsIHR5cGUpO1xuXG4gICAgcmV0dXJuIG1vZGVsSW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIF9faW5zZXJ0TW9kZWwobW9kZWw6IFB1cmVNb2RlbHxBcnJheTxQdXJlTW9kZWw+LCB0eXBlPzogSVR5cGUsIGlkPzogSUlkZW50aWZpZXIpIHtcbiAgICBpZiAobW9kZWwgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgbW9kZWwuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICB0aGlzLl9faW5zZXJ0TW9kZWwoaXRlbSwgdHlwZSwgaWQpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjb2xsZWN0aW9uID0gZ2V0TW9kZWxDb2xsZWN0aW9uKG1vZGVsKTtcbiAgICBpZiAoY29sbGVjdGlvbiAmJiBjb2xsZWN0aW9uICE9PSB0aGlzKSB7XG4gICAgICB0aHJvdyBlcnJvcihNT0RFTF9TSU5HTEVfQ09MTEVDVElPTik7XG4gICAgfVxuXG4gICAgY29uc3QgbW9kZWxUeXBlID0gdHlwZSB8fCBnZXRNb2RlbFR5cGUobW9kZWwpO1xuICAgIGNvbnN0IG1vZGVsSWQgPSBpZCB8fCBnZXRNb2RlbElkKG1vZGVsKTtcbiAgICBjb25zdCBzdHJpbmdUeXBlID0gbW9kZWxUeXBlLnRvU3RyaW5nKCk7XG5cbiAgICBjb25zdCBleGlzdGluZ01vZGVsID0gdGhpcy5maW5kKG1vZGVsVHlwZSwgbW9kZWxJZCk7XG4gICAgaWYgKGV4aXN0aW5nTW9kZWwpIHtcbiAgICAgIHVwZGF0ZU1vZGVsKGV4aXN0aW5nTW9kZWwsIG1vZGVsKTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX19kYXRhLnB1c2gobW9kZWwpO1xuICAgIGlmIChtb2RlbFR5cGUgaW4gdGhpcy5fX2RhdGFMaXN0KSB7XG4gICAgICB0aGlzLl9fZGF0YUxpc3RbbW9kZWxUeXBlXS5wdXNoKG1vZGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0KHRoaXMuX19kYXRhTGlzdCwgc3RyaW5nVHlwZSwgb2JzZXJ2YWJsZS5hcnJheShbbW9kZWxdLCB7ZGVlcDogZmFsc2V9KSk7XG4gICAgfVxuXG4gICAgaWYgKG1vZGVsVHlwZSBpbiB0aGlzLl9fZGF0YU1hcCkge1xuICAgICAgc2V0KHRoaXMuX19kYXRhTWFwW21vZGVsVHlwZV0sIG1vZGVsSWQudG9TdHJpbmcoKSwgbW9kZWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXQodGhpcy5fX2RhdGFNYXAsIHN0cmluZ1R5cGUsIG9ic2VydmFibGUub2JqZWN0KHtbbW9kZWxJZF06IG1vZGVsfSwge30sIHtkZWVwOiBmYWxzZX0pKTtcbiAgICB9XG4gICAgc2V0TW9kZWxNZXRhS2V5KG1vZGVsLCAnY29sbGVjdGlvbicsIHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfX3JlbW92ZU1vZGVsKG1vZGVsOiBQdXJlTW9kZWx8QXJyYXk8UHVyZU1vZGVsPiwgdHlwZT86IElUeXBlLCBpZD86IElJZGVudGlmaWVyKSB7XG4gICAgaWYgKG1vZGVsIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIG1vZGVsLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgdGhpcy5fX3JlbW92ZU1vZGVsKGl0ZW0sIHR5cGUsIGlkKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbW9kZWxUeXBlID0gdHlwZSB8fCBnZXRNb2RlbFR5cGUobW9kZWwpO1xuICAgIGNvbnN0IG1vZGVsSWQgPSBpZCB8fCBnZXRNb2RlbElkKG1vZGVsKTtcbiAgICB0aGlzLl9fZGF0YS5yZW1vdmUobW9kZWwpO1xuICAgIHRoaXMuX19kYXRhTGlzdFttb2RlbFR5cGVdLnJlbW92ZShtb2RlbCk7XG4gICAgc2V0KHRoaXMuX19kYXRhTWFwW21vZGVsVHlwZV0sIG1vZGVsSWQudG9TdHJpbmcoKSwgdW5kZWZpbmVkKTtcbiAgICBzZXRNb2RlbE1ldGFLZXkobW9kZWwsICdjb2xsZWN0aW9uJywgdW5kZWZpbmVkKTtcbiAgfVxuXG4gIHByaXZhdGUgX19maW5kQnlUeXBlKG1vZGVsOiBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsfFB1cmVNb2RlbCwgaWQ/OiBJSWRlbnRpZmllcikge1xuICAgIGNvbnN0IHR5cGUgPSBnZXRNb2RlbFR5cGUobW9kZWwpO1xuICAgIGNvbnN0IHN0cmluZ1R5cGUgPSB0eXBlLnRvU3RyaW5nKCk7XG5cbiAgICBpZiAoaWQpIHtcbiAgICAgIGlmICghKHR5cGUgaW4gdGhpcy5fX2RhdGFNYXApKSB7XG4gICAgICAgIHNldCh0aGlzLl9fZGF0YU1hcCwgc3RyaW5nVHlwZSwgb2JzZXJ2YWJsZS5vYmplY3Qoe1tpZF06IHVuZGVmaW5lZH0sIHt9LCB7ZGVlcDogZmFsc2V9KSk7XG4gICAgICB9IGVsc2UgaWYgKCEoaWQgaW4gdGhpcy5fX2RhdGFNYXBbdHlwZV0pKSB7XG4gICAgICAgIHNldCh0aGlzLl9fZGF0YU1hcFt0eXBlXSwgaWQudG9TdHJpbmcoKSwgdW5kZWZpbmVkKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuX19kYXRhTWFwW3R5cGVdW2lkXTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCEodHlwZSBpbiB0aGlzLl9fZGF0YUxpc3QpKSB7XG4gICAgICAgIHNldCh0aGlzLl9fZGF0YUxpc3QsIHN0cmluZ1R5cGUsIG9ic2VydmFibGUuYXJyYXkoW10sIHtkZWVwOiBmYWxzZX0pKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuX19kYXRhTGlzdFt0eXBlXS5sZW5ndGggPyB0aGlzLl9fZGF0YUxpc3RbdHlwZV1bMF0gOiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX19jaGFuZ2VNb2RlbElkKG9sZElkOiBJSWRlbnRpZmllciwgbmV3SWQ6IElJZGVudGlmaWVyLCB0eXBlOiBJVHlwZSkge1xuICAgIHRoaXMuX19kYXRhTWFwW3R5cGVdW25ld0lkXSA9IHRoaXMuX19kYXRhTWFwW3R5cGVdW29sZElkXTtcbiAgICBkZWxldGUgdGhpcy5fX2RhdGFNYXBbdHlwZV1bb2xkSWRdO1xuXG4gICAgdGhpcy5fX3ZpZXdMaXN0XG4gICAgICAuZmlsdGVyKCh2aWV3KSA9PiB2aWV3Lm1vZGVsVHlwZSA9PT0gdHlwZSlcbiAgICAgIC5mb3JFYWNoKCh2aWV3KSA9PiB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmUgLSBJJ20gYmFkIGFuZCBJIHNob3VsZCBmZWVsIGJhZC4uLlxuICAgICAgICB2aWV3Ll9fY2hhbmdlTW9kZWxJZChvbGRJZCwgbmV3SWQpO1xuICAgICAgfSk7XG4gIH1cbn1cbiJdfQ==","dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/PureCollection.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { IObservableArray } from 'mobx';\r\nimport { IIdentifier } from './interfaces/IIdentifier';\r\nimport { IModelConstructor } from './interfaces/IModelConstructor';\r\nimport { IRawCollection } from './interfaces/IRawCollection';\r\nimport { IType } from './interfaces/IType';\r\nimport { TFilterFn } from './interfaces/TFilterFn';\r\nimport { PureModel } from './PureModel';\r\nexport declare class PureCollection {\r\n    /**\r\n     * List of models available in the collection\r\n     *\r\n     * @static\r\n     * @type {Array<typeof PureModel>}\r\n     * @memberof Collection\r\n     */\r\n    static types: Array<typeof PureModel | IModelConstructor>;\r\n    static views: IDictionary<{\r\n        modelType: IType | PureModel;\r\n        sortMethod?: string | ((PureModel) => any);\r\n        unique?: boolean;\r\n        mixins?: Array<(view: any) => any>;\r\n    }>;\r\n    static defaultModel?: typeof PureModel;\r\n    private __data;\r\n    private __views;\r\n    private __viewList;\r\n    private __dataMap;\r\n    private __dataList;\r\n    constructor(data?: Array<IRawModel> | IRawCollection);\r\n    /**\r\n     * Function for inserting raw models into the collection. Used when hydrating the collection\r\n     *\r\n     * @param {Array<IRawModel>} data Raw model data\r\n     * @returns {Array<PureModel>} A list of initialized models\r\n     * @memberof Collection\r\n     */\r\n    insert(data: Array<Partial<IRawModel>>): Array<PureModel>;\r\n    /**\r\n     * Add an existing model to the collection\r\n     *\r\n     * @template T\r\n     * @param {T} data Model to be added\r\n     * @returns {T} Added model\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: T): T;\r\n    /**\r\n     * Add an array of existing models to the collection\r\n     *\r\n     * @template T\r\n     * @param {Array<T>} data Array of models to be added\r\n     * @returns {Array<T>} Added models\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: Array<T>): Array<T>;\r\n    /**\r\n     * Add an array of new models to the collection\r\n     *\r\n     * @template T\r\n     * @param {Array<IRawModel|IDictionary>} data Array of new data to be added\r\n     * @param {(IType|IModelConstructor<T>)} model Model type to be added\r\n     * @returns {Array<T>} Added models\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: Array<IRawModel | IDictionary>, model: IType | IModelConstructor<T>): Array<T>;\r\n    /**\r\n     * Add a new model to the collection\r\n     *\r\n     * @template T\r\n     * @param {(IRawModel|IDictionary)} data New data to be added\r\n     * @param {(IType|IModelConstructor<T>)} model Model type to be added\r\n     * @returns {T} Added model\r\n     * @memberof Collection\r\n     */\r\n    add<T extends PureModel>(data: IRawModel | IDictionary, model: IType | IModelConstructor<T>): T;\r\n    /**\r\n     * Find a model based on the defined type and (optional) identifier\r\n     *\r\n     * @param {(IType|typeof PureModel|PureModel)} type Model type\r\n     * @param {IIdentifier} [id] Model identifier\r\n     * @returns {(PureModel|null)} The first matching model\r\n     * @memberof Collection\r\n     */\r\n    find<T extends PureModel>(type: IType | T | IModelConstructor<T>, id?: IIdentifier | PureModel): T | null;\r\n    /**\r\n     * Find a model based on a matching function\r\n     *\r\n     * @param {TFilterFn} test Function used to match the model\r\n     * @returns {(PureModel|null)} The first matching model\r\n     * @memberof Collection\r\n     */\r\n    find<T extends PureModel>(test: TFilterFn): T | null;\r\n    /**\r\n     * Filter models based on a matching function\r\n     *\r\n     * @param {TFilterFn} test Function used to match the models\r\n     * @returns {(PureModel|null)} The matching models\r\n     * @memberof Collection\r\n     */\r\n    filter(test: TFilterFn): Array<PureModel>;\r\n    /**\r\n     * Find all matching models or all models if no type is given\r\n     *\r\n     * @param {(IType|typeof PureModel)} [model] Model type to select\r\n     * @returns {Array<PureModel>} List of matching models\r\n     * @memberof Collection\r\n     */\r\n    findAll<T extends PureModel>(model?: IType | IModelConstructor<T>): IObservableArray<T>;\r\n    /**\r\n     * Check if a model is in the collection\r\n     *\r\n     * @param {PureModel} model Model to check\r\n     * @returns {boolean} The given model is in the collection\r\n     * @memberof Collection\r\n     */\r\n    hasItem(model: PureModel): boolean;\r\n    /**\r\n     * Remove the first model based on the type and (optional) identifier\r\n     *\r\n     * @param {(IType|typeof PureModel)} type Model type\r\n     * @param {IIdentifier} [id] Model identifier\r\n     * @memberof Collection\r\n     */\r\n    remove(type: IType | typeof PureModel, id?: IIdentifier): any;\r\n    /**\r\n     * Remove the given model from the collection\r\n     *\r\n     * @param {PureModel} model Model to be removed from the collection\r\n     * @memberof Collection\r\n     */\r\n    remove(model: PureModel): any;\r\n    /**\r\n     * Remove all models of the given model type from the collection\r\n     *\r\n     * @param {(IType|typeof PureModel)} type Model type\r\n     * @memberof Collection\r\n     */\r\n    removeAll(type: IType | typeof PureModel): void;\r\n    /**\r\n     * A total count of models in the collection\r\n     *\r\n     * @readonly\r\n     * @type {number}\r\n     * @memberof Collection\r\n     */\r\n    readonly length: number;\r\n    /**\r\n     * Get the serializable value of the collection\r\n     *\r\n     * @returns {IRawCollection} Pure JS value of the collection\r\n     * @memberof Collection\r\n     */\r\n    toJSON(): IRawCollection;\r\n    readonly snapshot: IRawCollection;\r\n    /**\r\n     * Reset the collection (remove all models)\r\n     *\r\n     * @memberof Collection\r\n     */\r\n    reset(): void;\r\n    getAllModels(): PureModel[];\r\n    /**\r\n     * Add a view to the collection\r\n     *\r\n     * @template T Model type of the view\r\n     * @param {string} name View name\r\n     * @param {(IModelConstructor<T>|IType)} type Model type the view will represent\r\n     * @param {({\r\n     *       sortMethod?: string|((item: T) => any),\r\n     *       models?: Array<IIdentifier|PureModel>,\r\n     *       unique?: boolean,\r\n     *       mixins?: Array<(view: any) => any>,\r\n     *     })} [{sortMethod, models, unique, mixins}={}] View options\r\n     * @returns {View} The created view\r\n     * @memberof PureCollection\r\n     */\r\n    addView<T extends PureModel = PureModel>(name: string, type: IModelConstructor<T> | IType, {sortMethod, models, unique, mixins}?: {\r\n        sortMethod?: string | ((item: T) => any);\r\n        models?: Array<IIdentifier | T>;\r\n        unique?: boolean;\r\n        mixins?: Array<(view: any) => any>;\r\n    }): any;\r\n    private __addArray<T>(data);\r\n    private __addArray<T>(data, model?);\r\n    private __addSingle<T>(data);\r\n    private __addSingle<T>(data, model?);\r\n    private __insertModel(model, type?, id?);\r\n    private __removeModel(model, type?, id?);\r\n    private __findByType(model, id?);\r\n    private __changeModelId(oldId, newId, type);\r\n}\r\n"}}
