{"code":"import { UNDEFINED_MODEL, UNDEFINED_TYPE } from '../errors';\r\nimport { PureModel } from '../PureModel';\r\nimport { error } from './format';\r\nimport { getMetaKeyFromRaw, updateModel } from './model/utils';\r\nfunction initCollectionModel(collection, data) {\r\n    var type = getMetaKeyFromRaw(data, 'type');\r\n    return upsertModel(data, type, collection);\r\n}\r\nexport function upsertModel(data, type, collection) {\r\n    if (!type && type !== 0) {\r\n        throw error(UNDEFINED_TYPE);\r\n    }\r\n    var staticCollection = collection.constructor;\r\n    var TypeModel = staticCollection.types.find(function (item) { return item.type === type; }) || staticCollection.defaultModel;\r\n    if (!TypeModel) {\r\n        throw error(UNDEFINED_MODEL, { type: type });\r\n    }\r\n    var id = getMetaKeyFromRaw(data, 'id', TypeModel);\r\n    var existingModel = id && collection.find(type, id);\r\n    if (existingModel) {\r\n        return updateModel(existingModel, data);\r\n    }\r\n    return new TypeModel(data, collection);\r\n}\r\nexport function isSelectorFunction(fn) {\r\n    return (typeof fn === 'function') && (fn !== PureModel && !(fn.prototype instanceof PureModel));\r\n}\r\nexport function initModels(collection, data) {\r\n    return data.map(function (item) { return initCollectionModel(collection, item); });\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9oZWxwZXJzL2NvbGxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFDLGVBQWUsRUFBRSxjQUFjLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFHMUQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUV2QyxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQy9CLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxXQUFXLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFN0QsNkJBQTZCLFVBQTBCLEVBQUUsSUFBZTtJQUN0RSxJQUFNLElBQUksR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFN0MsT0FBTyxXQUFXLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztBQUM3QyxDQUFDO0FBRUQsTUFBTSxzQkFBc0IsSUFBZSxFQUFFLElBQTRCLEVBQUUsVUFBMEI7SUFDbkcsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLEtBQUssQ0FBQyxFQUFFO1FBQ3ZCLE1BQU0sS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0tBQzdCO0lBRUQsSUFBTSxnQkFBZ0IsR0FBRyxVQUFVLENBQUMsV0FBb0MsQ0FBQztJQUN6RSxJQUFNLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLEVBQWxCLENBQWtCLENBQUMsSUFBSSxnQkFBZ0IsQ0FBQyxZQUFZLENBQUM7SUFDN0csSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUNkLE1BQU0sS0FBSyxDQUFDLGVBQWUsRUFBRSxFQUFDLElBQUksTUFBQSxFQUFDLENBQUMsQ0FBQztLQUN0QztJQUVELElBQU0sRUFBRSxHQUFHLGlCQUFpQixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBdUMsQ0FBQyxDQUFDO0lBQ2xGLElBQU0sYUFBYSxHQUFHLEVBQUUsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN0RCxJQUFJLGFBQWEsRUFBRTtRQUNqQixPQUFPLFdBQVcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDekM7SUFFRCxPQUFPLElBQUksU0FBUyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztBQUN6QyxDQUFDO0FBRUQsTUFBTSw2QkFBNkIsRUFBTztJQUN4QyxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssU0FBUyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsU0FBUyxZQUFZLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDbEcsQ0FBQztBQUVELE1BQU0scUJBQXFCLFVBQTBCLEVBQUUsSUFBc0I7SUFDM0UsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsbUJBQW1CLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFyQyxDQUFxQyxDQUFDLENBQUM7QUFDbkUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SVJhd01vZGVsfSBmcm9tICdkYXR4LXV0aWxzJztcblxuaW1wb3J0IHtVTkRFRklORURfTU9ERUwsIFVOREVGSU5FRF9UWVBFfSBmcm9tICcuLi9lcnJvcnMnO1xuaW1wb3J0IHtJVHlwZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1B1cmVDb2xsZWN0aW9ufSBmcm9tICcuLi9QdXJlQ29sbGVjdGlvbic7XG5pbXBvcnQge1B1cmVNb2RlbH0gZnJvbSAnLi4vUHVyZU1vZGVsJztcbmltcG9ydCB7c3RvcmFnZX0gZnJvbSAnLi4vc2VydmljZXMvc3RvcmFnZSc7XG5pbXBvcnQge2Vycm9yfSBmcm9tICcuL2Zvcm1hdCc7XG5pbXBvcnQge2dldE1ldGFLZXlGcm9tUmF3LCB1cGRhdGVNb2RlbH0gZnJvbSAnLi9tb2RlbC91dGlscyc7XG5cbmZ1bmN0aW9uIGluaXRDb2xsZWN0aW9uTW9kZWwoY29sbGVjdGlvbjogUHVyZUNvbGxlY3Rpb24sIGRhdGE6IElSYXdNb2RlbCk6IFB1cmVNb2RlbCB7XG4gIGNvbnN0IHR5cGUgPSBnZXRNZXRhS2V5RnJvbVJhdyhkYXRhLCAndHlwZScpO1xuXG4gIHJldHVybiB1cHNlcnRNb2RlbChkYXRhLCB0eXBlLCBjb2xsZWN0aW9uKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwc2VydE1vZGVsKGRhdGE6IElSYXdNb2RlbCwgdHlwZTogSVR5cGV8dHlwZW9mIFB1cmVNb2RlbCwgY29sbGVjdGlvbjogUHVyZUNvbGxlY3Rpb24pOiBQdXJlTW9kZWwge1xuICBpZiAoIXR5cGUgJiYgdHlwZSAhPT0gMCkge1xuICAgIHRocm93IGVycm9yKFVOREVGSU5FRF9UWVBFKTtcbiAgfVxuXG4gIGNvbnN0IHN0YXRpY0NvbGxlY3Rpb24gPSBjb2xsZWN0aW9uLmNvbnN0cnVjdG9yIGFzIHR5cGVvZiBQdXJlQ29sbGVjdGlvbjtcbiAgY29uc3QgVHlwZU1vZGVsID0gc3RhdGljQ29sbGVjdGlvbi50eXBlcy5maW5kKChpdGVtKSA9PiBpdGVtLnR5cGUgPT09IHR5cGUpIHx8IHN0YXRpY0NvbGxlY3Rpb24uZGVmYXVsdE1vZGVsO1xuICBpZiAoIVR5cGVNb2RlbCkge1xuICAgIHRocm93IGVycm9yKFVOREVGSU5FRF9NT0RFTCwge3R5cGV9KTtcbiAgfVxuXG4gIGNvbnN0IGlkID0gZ2V0TWV0YUtleUZyb21SYXcoZGF0YSwgJ2lkJywgVHlwZU1vZGVsIGFzIHR5cGVvZiBQdXJlTW9kZWx8dW5kZWZpbmVkKTtcbiAgY29uc3QgZXhpc3RpbmdNb2RlbCA9IGlkICYmIGNvbGxlY3Rpb24uZmluZCh0eXBlLCBpZCk7XG4gIGlmIChleGlzdGluZ01vZGVsKSB7XG4gICAgcmV0dXJuIHVwZGF0ZU1vZGVsKGV4aXN0aW5nTW9kZWwsIGRhdGEpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBUeXBlTW9kZWwoZGF0YSwgY29sbGVjdGlvbik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1NlbGVjdG9yRnVuY3Rpb24oZm46IGFueSkge1xuICByZXR1cm4gKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykgJiYgKGZuICE9PSBQdXJlTW9kZWwgJiYgIShmbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBQdXJlTW9kZWwpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRNb2RlbHMoY29sbGVjdGlvbjogUHVyZUNvbGxlY3Rpb24sIGRhdGE6IEFycmF5PElSYXdNb2RlbD4pIHtcbiAgcmV0dXJuIGRhdGEubWFwKChpdGVtKSA9PiBpbml0Q29sbGVjdGlvbk1vZGVsKGNvbGxlY3Rpb24sIGl0ZW0pKTtcbn1cbiJdfQ==","dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/helpers/collection.d.ts","text":"import { IRawModel } from 'datx-utils';\r\nimport { IType } from '../interfaces/IType';\r\nimport { PureCollection } from '../PureCollection';\r\nimport { PureModel } from '../PureModel';\r\nexport declare function upsertModel(data: IRawModel, type: IType | typeof PureModel, collection: PureCollection): PureModel;\r\nexport declare function isSelectorFunction(fn: any): boolean;\r\nexport declare function initModels(collection: PureCollection, data: Array<IRawModel>): PureModel[];\r\n"}}
