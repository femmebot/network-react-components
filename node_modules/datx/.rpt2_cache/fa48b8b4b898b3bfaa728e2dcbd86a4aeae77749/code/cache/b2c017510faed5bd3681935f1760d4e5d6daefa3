{"code":"import * as tslib_1 from \"tslib\";\r\nimport { deprecated, mapItems } from 'datx-utils';\r\nimport { isObservableArray } from 'mobx';\r\nimport { FieldType } from './enums/FieldType';\r\nimport { ReferenceType } from './enums/ReferenceType';\r\nimport { updateField } from './helpers/model/fields';\r\nimport { initModelField, initModelRef } from './helpers/model/init';\r\nimport { getModelCollection, getModelId, getModelMetaKey, getModelType, modelToJSON, updateModel, } from './helpers/model/utils';\r\nimport { PureModel } from './PureModel';\r\nimport { storage } from './services/storage';\r\nvar CompatModel = /** @class */ (function (_super) {\r\n    tslib_1.__extends(CompatModel, _super);\r\n    function CompatModel(initialData, collection) {\r\n        var _this = _super.call(this, initialData, collection) || this;\r\n        deprecated('CompatModel is just a migration tool. Please move to Model or PureModel as soon as possible.');\r\n        Object.keys(_this.static.refs).forEach(function (prop) {\r\n            var refs = getModelMetaKey(_this, 'refs');\r\n            if (prop in refs) {\r\n                return;\r\n            }\r\n            var ref = _this.static.refs[prop];\r\n            var data = mapItems(_this[prop] || _this.static.defaults[prop], getModelId);\r\n            delete _this[prop];\r\n            if (typeof ref === 'object') {\r\n                // Back reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref.model,\r\n                    property: ref.property,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n            else {\r\n                // Normal reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n        });\r\n        Object.keys(_this.static.defaults).forEach(function (prop) {\r\n            if (!(prop in _this.static.refs) && !(prop in _this)) {\r\n                initModelField(_this, prop, _this.static.defaults[prop]);\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    CompatModel.prototype.getRecordId = function () {\r\n        deprecated('model.getRecordId is deprecated. Use getModelId() instead.');\r\n        return getModelId(this);\r\n    };\r\n    CompatModel.prototype.getRecordType = function () {\r\n        deprecated('model.getRecordType is deprecated. Use getModelType() instead.');\r\n        return getModelType(this);\r\n    };\r\n    CompatModel.prototype.assign = function (key, value) {\r\n        deprecated('model.assign is deprecated. Use assignModel() instead.');\r\n        var type = FieldType.DATA;\r\n        var modelId = storage.getModelClassMetaKey(this.static, 'id');\r\n        var modelType = storage.getModelClassMetaKey(this.static, 'type');\r\n        if (key === modelId) {\r\n            type = FieldType.ID;\r\n        }\r\n        else if (key === modelType) {\r\n            type = FieldType.TYPE;\r\n        }\r\n        updateField(this, key, value, type);\r\n        return value;\r\n    };\r\n    CompatModel.prototype.assignRef = function (key, value, type) {\r\n        deprecated('model.assignRef is deprecated. Use initModelRef() instead.');\r\n        var refs = getModelMetaKey(this, 'refs');\r\n        if (refs[key]) {\r\n            return this[key] = value;\r\n        }\r\n        var model = type;\r\n        if (!model) {\r\n            if (value instanceof Array || isObservableArray(value)) {\r\n                model = value.reduce(function (t, m) { return t || getModelType(m); }, null);\r\n            }\r\n            else if (value instanceof PureModel) {\r\n                model = getModelType(value);\r\n            }\r\n        }\r\n        if (!model) {\r\n            throw new Error('The type property is missing');\r\n        }\r\n        initModelRef(this, key, {\r\n            model: model,\r\n            type: ReferenceType.TO_ONE_OR_MANY,\r\n        }, value);\r\n        return this[key];\r\n    };\r\n    CompatModel.prototype.update = function (data) {\r\n        var _this = this;\r\n        deprecated('model.update is deprecated. Use updateModel() instead.');\r\n        var updateData = Object.assign({}, data);\r\n        Object.keys(updateData).forEach(function (key) {\r\n            if (typeof _this[key] === 'function') {\r\n                delete updateData[key];\r\n            }\r\n        });\r\n        return updateModel(this, updateData);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"static\", {\r\n        get: function () {\r\n            deprecated('model.static is deprecated.');\r\n            return this.constructor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.prototype.toJS = function () {\r\n        deprecated('model.toJS() is deprecated. Use modelToJSON() instead.');\r\n        return modelToJSON(this);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"snapshot\", {\r\n        get: function () {\r\n            deprecated('model.snapshot is deprecated. Use modelToJSON() instead.');\r\n            return modelToJSON(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompatModel.prototype, \"__collection\", {\r\n        get: function () {\r\n            deprecated('model.__collection is deprecated. Use getModelCollection() instead.');\r\n            return getModelCollection(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.refs = {};\r\n    CompatModel.defaults = {};\r\n    return CompatModel;\r\n}(PureModel));\r\nexport { CompatModel };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tcGF0TW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvQ29tcGF0TW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQTBCLFFBQVEsRUFBQyxNQUFNLFlBQVksQ0FBQztBQUN4RSxPQUFPLEVBQUMsaUJBQWlCLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFHNUMsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRCxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDbkQsT0FBTyxFQUFDLGNBQWMsRUFBRSxZQUFZLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRSxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFVBQVUsRUFDVixlQUFlLEVBQ2YsWUFBWSxFQUNaLFdBQVcsRUFDWCxXQUFXLEdBQ1osTUFBTSx1QkFBdUIsQ0FBQztBQUcvQixPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQ3RDLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUUzQztJQUFpQyx1Q0FBUztJQUl4QyxxQkFBWSxXQUFtQixFQUFFLFVBQXVCO1FBQXhELFlBQ0Usa0JBQU0sV0FBVyxFQUFFLFVBQVUsQ0FBQyxTQWlDL0I7UUEvQkMsVUFBVSxDQUFDLDhGQUE4RixDQUFDLENBQUM7UUFFM0csTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQUk7WUFDekMsSUFBTSxJQUFJLEdBQUcsZUFBZSxDQUFDLEtBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUMzQyxJQUFJLElBQUksSUFBSSxJQUFJLEVBQUU7Z0JBQ2hCLE9BQU87YUFDUjtZQUNELElBQU0sR0FBRyxHQUFHLEtBQUks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LENBQUM7SUFDdkMsQ0FBQztJQUVELHNCQUFXLCtCQUFNO2FBQWpCO1lBQ0UsVUFBVSxDQUFDLDZCQUE2QixDQUFDLENBQUM7WUFFMUMsT0FBTyxJQUFJLENBQUMsV0FBaUMsQ0FBQztRQUNoRCxDQUFDOzs7T0FBQTtJQUVNLDBCQUFJLEdBQVg7UUFDRSxVQUFVLENBQUMsd0RBQXdELENBQUMsQ0FBQztRQUVyRSxPQUFPLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQsc0JBQVcsaUNBQVE7YUFBbkI7WUFDRSxVQUFVLENBQUMsMERBQTBELENBQUMsQ0FBQztZQUV2RSxPQUFPLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFZLHFDQUFZO2FBQXhCO1lBQ0UsVUFBVSxDQUFDLHFFQUFxRSxDQUFDLENBQUM7WUFFbEYsT0FBTyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxDQUFDOzs7T0FBQTtJQWxJYSxnQkFBSSxHQUFnQixFQUFFLENBQUM7SUFDdkIsb0JBQVEsR0FBZ0IsRUFBRSxDQUFDO0lBa0kzQyxrQkFBQztDQUFBLEFBcElELENBQWlDLFNBQVMsR0FvSXpDO1NBcElZLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2RlcHJlY2F0ZWQsIElEaWN0aW9uYXJ5LCBJUmF3TW9kZWwsIG1hcEl0ZW1zfSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7aXNPYnNlcnZhYmxlQXJyYXksIHNldH0gZnJvbSAnbW9ieCc7XG5cbmltcG9ydCB7Q29sbGVjdGlvbn0gZnJvbSAnLi9Db2xsZWN0aW9uJztcbmltcG9ydCB7RmllbGRUeXBlfSBmcm9tICcuL2VudW1zL0ZpZWxkVHlwZSc7XG5pbXBvcnQge1JlZmVyZW5jZVR5cGV9IGZyb20gJy4vZW51bXMvUmVmZXJlbmNlVHlwZSc7XG5pbXBvcnQge3VwZGF0ZUZpZWxkfSBmcm9tICcuL2hlbHBlcnMvbW9kZWwvZmllbGRzJztcbmltcG9ydCB7aW5pdE1vZGVsRmllbGQsIGluaXRNb2RlbFJlZn0gZnJvbSAnLi9oZWxwZXJzL21vZGVsL2luaXQnO1xuaW1wb3J0IHtcbiAgZ2V0TW9kZWxDb2xsZWN0aW9uLFxuICBnZXRNb2RlbElkLFxuICBnZXRNb2RlbE1ldGFLZXksXG4gIGdldE1vZGVsVHlwZSxcbiAgbW9kZWxUb0pTT04sXG4gIHVwZGF0ZU1vZGVsLFxufSBmcm9tICcuL2hlbHBlcnMvbW9kZWwvdXRpbHMnO1xuaW1wb3J0IHtJUmVmZXJlbmNlc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSZWZlcmVuY2VzJztcbmltcG9ydCB7SVR5cGV9IGZyb20gJy4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1B1cmVNb2RlbH0gZnJvbSAnLi9QdXJlTW9kZWwnO1xuaW1wb3J0IHtzdG9yYWdlfSBmcm9tICcuL3NlcnZpY2VzL3N0b3JhZ2UnO1xuXG5leHBvcnQgY2xhc3MgQ29tcGF0TW9kZWwgZXh0ZW5kcyBQdXJlTW9kZWwge1xuICBwdWJsaWMgc3RhdGljIHJlZnM6IElSZWZlcmVuY2VzID0ge307XG4gIHB1YmxpYyBzdGF0aWMgZGVmYXVsdHM6IElEaWN0aW9uYXJ5ID0ge307XG5cbiAgY29uc3RydWN0b3IoaW5pdGlhbERhdGE6IG9iamVjdCwgY29sbGVjdGlvbj86IENvbGxlY3Rpb24pIHtcbiAgICBzdXBlcihpbml0aWFsRGF0YSwgY29sbGVjdGlvbik7XG5cbiAgICBkZXByZWNhdGVkKCdDb21wYXRNb2RlbCBpcyBqdXN0IGEgbWlncmF0aW9uIHRvb2wuIFBsZWFzZSBtb3ZlIHRvIE1vZGVsIG9yIFB1cmVNb2RlbCBhcyBzb29uIGFzIHBvc3NpYmxlLicpO1xuXG4gICAgT2JqZWN0LmtleXModGhpcy5zdGF0aWMucmVmcykuZm9yRWFjaCgocHJvcCkgPT4ge1xuICAgICAgY29uc3QgcmVmcyA9IGdldE1vZGVsTWV0YUtleSh0aGlzLCAncmVmcycpO1xuICAgICAgaWYgKHByb3AgaW4gcmVmcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCByZWYgPSB0aGlzLnN0YXRpYy5yZWZzW3Byb3BdO1xuICAgICAgY29uc3QgZGF0YSA9IG1hcEl0ZW1zKHRoaXNbcHJvcF0gfHwgdGhpcy5zdGF0aWMuZGVmYXVsdHNbcHJvcF0sIGdldE1vZGVsSWQpO1xuICAgICAgZGVsZXRlIHRoaXNbcHJvcF07XG4gICAgICBpZiAodHlwZW9mIHJlZiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gQmFjayByZWZlcmVuY2VcbiAgICAgICAgaW5pdE1vZGVsUmVmKHRoaXMsIHByb3AsIHtcbiAgICAgICAgICBtb2RlbDogcmVmLm1vZGVsLFxuICAgICAgICAgIHByb3BlcnR5OiByZWYucHJvcGVydHksXG4gICAgICAgICAgdHlwZTogUmVmZXJlbmNlVHlwZS5UT19PTkVfT1JfTUFOWSxcbiAgICAgICAgfSwgZGF0YSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBOb3JtYWwgcmVmZXJlbmNlXG4gICAgICAgIGluaXRNb2RlbFJlZih0aGlzLCBwcm9wLCB7XG4gICAgICAgICAgbW9kZWw6IHJlZixcbiAgICAgICAgICB0eXBlOiBSZWZlcmVuY2VUeXBlLlRPX09ORV9PUl9NQU5ZLFxuICAgICAgICB9LCBkYXRhKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIE9iamVjdC5rZXlzKHRoaXMuc3RhdGljLmRlZmF1bHRzKS5mb3JFYWNoKChwcm9wKSA9PiB7XG4gICAgICBpZiAoIShwcm9wIGluIHRoaXMuc3RhdGljLnJlZnMpICYmICEocHJvcCBpbiB0aGlzKSkge1xuICAgICAgICBpbml0TW9kZWxGaWVsZCh0aGlzLCBwcm9wLCB0aGlzLnN0YXRpYy5kZWZhdWx0c1twcm9wXSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjb3JkSWQoKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuZ2V0UmVjb3JkSWQgaXMgZGVwcmVjYXRlZC4gVXNlIGdldE1vZGVsSWQoKSBpbnN0ZWFkLicpO1xuXG4gICAgcmV0dXJuIGdldE1vZGVsSWQodGhpcyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjb3JkVHlwZSgpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5nZXRSZWNvcmRUeXBlIGlzIGRlcHJlY2F0ZWQuIFVzZSBnZXRNb2RlbFR5cGUoKSBpbnN0ZWFkLicpO1xuXG4gICAgcmV0dXJuIGdldE1vZGVsVHlwZSh0aGlzKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3NpZ24oa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5hc3NpZ24gaXMgZGVwcmVjYXRlZC4gVXNlIGFzc2lnbk1vZGVsKCkgaW5zdGVhZC4nKTtcbiAgICBsZXQgdHlwZSA9IEZpZWxkVHlwZS5EQVRBO1xuICAgIGNvbnN0IG1vZGVsSWQgPSBzdG9yYWdlLmdldE1vZGVsQ2xhc3NNZXRhS2V5KHRoaXMuc3RhdGljLCAnaWQnKTtcbiAgICBjb25zdCBtb2RlbFR5cGUgPSBzdG9yYWdlLmdldE1vZGVsQ2xhc3NNZXRhS2V5KHRoaXMuc3RhdGljLCAndHlwZScpO1xuICAgIGlmIChrZXkgPT09IG1vZGVsSWQpIHtcbiAgICAgIHR5cGUgPSBGaWVsZFR5cGUuSUQ7XG4gICAgfSBlbHNlIGlmIChrZXkgPT09IG1vZGVsVHlwZSkge1xuICAgICAgdHlwZSA9IEZpZWxkVHlwZS5UWVBFO1xuICAgIH1cblxuICAgIHVwZGF0ZUZpZWxkKHRoaXMsIGtleSwgdmFsdWUsIHR5cGUpO1xuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgcHVibGljIGFzc2lnblJlZihrZXk6IHN0cmluZywgdmFsdWU6IGFueSwgdHlwZT86IElUeXBlKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuYXNzaWduUmVmIGlzIGRlcHJlY2F0ZWQuIFVzZSBpbml0TW9kZWxSZWYoKSBpbnN0ZWFkLicpO1xuICAgIGNvbnN0IHJlZnMgPSBnZXRNb2RlbE1ldGFLZXkodGhpcywgJ3JlZnMnKTtcblxuICAgIGlmIChyZWZzW2tleV0pIHtcbiAgICAgIHJldHVybiB0aGlzW2tleV0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBsZXQgbW9kZWwgPSB0eXBlO1xuICAgIGlmICghbW9kZWwpIHtcbiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5IHx8IGlzT2JzZXJ2YWJsZUFycmF5KHZhbHVlKSkge1xuICAgICAgICBtb2RlbCA9IHZhbHVlLnJlZHVjZSgodCwgbSkgPT4gdCB8fCBnZXRNb2RlbFR5cGUobSksIG51bGwpO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFB1cmVNb2RlbCkge1xuICAgICAgICBtb2RlbCA9IGdldE1vZGVsVHlwZSh2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFtb2RlbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgdHlwZSBwcm9wZXJ0eSBpcyBtaXNzaW5nJyk7XG4gICAgfVxuXG4gICAgaW5pdE1vZGVsUmVmKHRoaXMsIGtleSwge1xuICAgICAgbW9kZWwsXG4gICAgICB0eXBlOiBSZWZlcmVuY2VUeXBlLlRPX09ORV9PUl9NQU5ZLFxuICAgIH0sIHZhbHVlKTtcblxuICAgIHJldHVybiB0aGlzW2tleV07XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlKGRhdGE6IFB1cmVNb2RlbCB8IElEaWN0aW9uYXJ5KTogb2JqZWN0IHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC51cGRhdGUgaXMgZGVwcmVjYXRlZC4gVXNlIHVwZGF0ZU1vZGVsKCkgaW5zdGVhZC4nKTtcbiAgICBjb25zdCB1cGRhdGVEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XG4gICAgT2JqZWN0LmtleXModXBkYXRlRGF0YSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHRoaXNba2V5XSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBkZWxldGUgdXBkYXRlRGF0YVtrZXldO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHVwZGF0ZU1vZGVsKHRoaXMsIHVwZGF0ZURhdGEpO1xuICB9XG5cbiAgcHVibGljIGdldCBzdGF0aWMoKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuc3RhdGljIGlzIGRlcHJlY2F0ZWQuJyk7XG5cbiAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RvciBhcyB0eXBlb2YgQ29tcGF0TW9kZWw7XG4gIH1cblxuICBwdWJsaWMgdG9KUygpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC50b0pTKCkgaXMgZGVwcmVjYXRlZC4gVXNlIG1vZGVsVG9KU09OKCkgaW5zdGVhZC4nKTtcblxuICAgIHJldHVybiBtb2RlbFRvSlNPTih0aGlzKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgc25hcHNob3QoKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuc25hcHNob3QgaXMgZGVwcmVjYXRlZC4gVXNlIG1vZGVsVG9KU09OKCkgaW5zdGVhZC4nKTtcblxuICAgIHJldHVybiBtb2RlbFRvSlNPTih0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IF9fY29sbGVjdGlvbigpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5fX2NvbGxlY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIGdldE1vZGVsQ29sbGVjdGlvbigpIGluc3RlYWQuJyk7XG5cbiAgICByZXR1cm4gZ2V0TW9kZWxDb2xsZWN0aW9uKHRoaXMpO1xuICB9XG59XG4iXX0=","dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/CompatModel.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { Collection } from './Collection';\r\nimport { IReferences } from './interfaces/IReferences';\r\nimport { IType } from './interfaces/IType';\r\nimport { PureModel } from './PureModel';\r\nexport declare class CompatModel extends PureModel {\r\n    static refs: IReferences;\r\n    static defaults: IDictionary;\r\n    constructor(initialData: object, collection?: Collection);\r\n    getRecordId(): IType;\r\n    getRecordType(): IType;\r\n    assign(key: string, value: any): any;\r\n    assignRef(key: string, value: any, type?: IType): any;\r\n    update(data: PureModel | IDictionary): object;\r\n    readonly static: typeof CompatModel;\r\n    toJS(): IRawModel;\r\n    readonly snapshot: IRawModel;\r\n    private readonly __collection;\r\n}\r\n"}}
