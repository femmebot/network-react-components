{"code":"import * as tslib_1 from \"tslib\";\r\nimport { mapItems } from 'datx-utils';\r\nimport { action, computed, intercept, observable } from 'mobx';\r\nimport { SORTED_NO_WRITE, UNIQUE_MODEL } from './errors';\r\nimport { error } from './helpers/format';\r\nimport { getModelId, getModelType } from './helpers/model/utils';\r\nvar View = /** @class */ (function () {\r\n    function View(modelType, __collection, sortMethod, models, unique) {\r\n        if (models === void 0) { models = []; }\r\n        if (unique === void 0) { unique = false; }\r\n        this.__collection = __collection;\r\n        this.unique = unique;\r\n        this.__models = observable.array([]);\r\n        this.__models.replace(models.map(getModelId));\r\n        this.sortMethod = sortMethod;\r\n        this.modelType = getModelType(modelType);\r\n        // @ts-ignore\r\n        this.__collection.__viewList.push(this);\r\n    }\r\n    Object.defineProperty(View.prototype, \"length\", {\r\n        get: function () {\r\n            return this.__models.length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(View.prototype, \"list\", {\r\n        get: function () {\r\n            var _this = this;\r\n            var list = this.__models.map(function (id) { return _this.__collection.find(_this.modelType, id); });\r\n            if (this.sortMethod) {\r\n                var sortFn_1 = typeof this.sortMethod === 'string'\r\n                    ? function (item) { return item[_this.sortMethod]; }\r\n                    : this.sortMethod;\r\n                list.sort(function (a, b) {\r\n                    var valA = a ? sortFn_1(a) : Infinity;\r\n                    var valB = b ? sortFn_1(b) : Infinity;\r\n                    return valA - valB;\r\n                });\r\n            }\r\n            var instances = observable.array(list, { deep: false });\r\n            intercept(instances, this.__partialListUpdate.bind(this));\r\n            return instances;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    View.prototype.toJSON = function () {\r\n        return {\r\n            modelType: this.modelType,\r\n            models: this.__models.slice(),\r\n            unique: this.unique,\r\n        };\r\n    };\r\n    Object.defineProperty(View.prototype, \"snapshot\", {\r\n        get: function () {\r\n            return this.toJSON();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    View.prototype.add = function (data) {\r\n        var _this = this;\r\n        var models = mapItems(data, function (item) { return _this.__collection.add(item, _this.modelType); });\r\n        mapItems(models, function (instance) {\r\n            var id = getModelId(instance);\r\n            if (!_this.unique || _this.__models.indexOf(id) === -1) {\r\n                _this.__models.push(id);\r\n            }\r\n        });\r\n        return models;\r\n    };\r\n    /**\r\n     * Check if a model is in the collection\r\n     *\r\n     * @param {T|IIdentifier} model Model to check\r\n     * @returns {boolean} The given model is in the collection\r\n     * @memberof Collection\r\n     */\r\n    View.prototype.hasItem = function (model) {\r\n        var id = getModelId(model);\r\n        return this.__models.indexOf(id) !== -1;\r\n    };\r\n    /**\r\n     * Remove a model from the view\r\n     *\r\n     * @param {IIdentifier|T} model Model identifier\r\n     * @memberof Collection\r\n     */\r\n    View.prototype.remove = function (model) {\r\n        var id = getModelId(model);\r\n        this.__models.remove(id);\r\n    };\r\n    View.prototype.removeAll = function () {\r\n        this.__models.replace([]);\r\n    };\r\n    View.prototype.__partialListUpdate = function (change) {\r\n        var _this = this;\r\n        if (change.type === 'splice') {\r\n            if (this.sortMethod && change.added.length > 0) {\r\n                throw error(SORTED_NO_WRITE);\r\n            }\r\n            var added = change.added.map(getModelId);\r\n            var toRemove_1 = this.__models.slice(change.index, change.removedCount);\r\n            if (this.unique) {\r\n                added.forEach(function (newItemId) {\r\n                    if (_this.__models.indexOf(newItemId) !== -1 && toRemove_1.indexOf(newItemId) === -1) {\r\n                        throw error(UNIQUE_MODEL);\r\n                    }\r\n                });\r\n            }\r\n            (_a = this.__models).splice.apply(_a, [change.index, change.removedCount].concat(added));\r\n            return null;\r\n        }\r\n        if (this.sortMethod && change.newValue) {\r\n            throw error(SORTED_NO_WRITE);\r\n        }\r\n        var newId = getModelId(change.newValue);\r\n        var idIndex = this.__models.indexOf(newId);\r\n        if (this.unique && idIndex !== -1 && idIndex !== change.index) {\r\n            throw error(UNIQUE_MODEL);\r\n        }\r\n        this.__models[change.index] = newId;\r\n        return null;\r\n        var _a;\r\n    };\r\n    View.prototype.__changeModelId = function (oldId, newId) {\r\n        var oldIdIndex = this.__models.indexOf(oldId);\r\n        if (oldIdIndex !== -1) {\r\n            this.__models[oldIdIndex] = newId;\r\n        }\r\n    };\r\n    tslib_1.__decorate([\r\n        observable\r\n    ], View.prototype, \"sortMethod\", void 0);\r\n    tslib_1.__decorate([\r\n        computed\r\n    ], View.prototype, \"length\", null);\r\n    tslib_1.__decorate([\r\n        computed\r\n    ], View.prototype, \"list\", null);\r\n    tslib_1.__decorate([\r\n        computed\r\n    ], View.prototype, \"snapshot\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], View.prototype, \"add\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], View.prototype, \"remove\", null);\r\n    tslib_1.__decorate([\r\n        action\r\n    ], View.prototype, \"removeAll\", null);\r\n    return View;\r\n}());\r\nexport { View };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNyYy9WaWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQXlCLFFBQVEsRUFBQyxNQUFNLFlBQVksQ0FBQztBQUM1RCxPQUFPLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQW9CLFVBQVUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUUvRSxPQUFPLEVBQUMsZUFBZSxFQUFFLFlBQVksRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUN2RCxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFDdkMsT0FBTyxFQUFDLFVBQVUsRUFBRSxZQUFZLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQVMvRDtJQU1FLGNBQ0UsU0FBcUMsRUFDM0IsWUFBNEIsRUFDdEMsVUFBc0MsRUFDdEMsTUFBaUMsRUFDMUIsTUFBdUI7UUFEOUIsdUJBQUEsRUFBQSxXQUFpQztRQUMxQix1QkFBQSxFQUFBLGNBQXVCO1FBSHBCLGlCQUFZLEdBQVosWUFBWSxDQUFnQjtRQUcvQixXQUFNLEdBQU4sTUFBTSxDQUFpQjtRQVB4QixhQUFRLEdBQWtDLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFTckUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRXpDLGFBQWE7UUFDYixJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUVTLHNCQUFXLHdCQUFNO2FBQWpCO1lBQ1IsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUM5QixDQUFDOzs7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IG1hcEl0ZW1zfSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7YWN0aW9uLCBjb21wdXRlZCwgaW50ZXJjZXB0LCBJT2JzZXJ2YWJsZUFycmF5LCBvYnNlcnZhYmxlfSBmcm9tICdtb2J4JztcblxuaW1wb3J0IHtTT1JURURfTk9fV1JJVEUsIFVOSVFVRV9NT0RFTH0gZnJvbSAnLi9lcnJvcnMnO1xuaW1wb3J0IHtlcnJvcn0gZnJvbSAnLi9oZWxwZXJzL2Zvcm1hdCc7XG5pbXBvcnQge2dldE1vZGVsSWQsIGdldE1vZGVsVHlwZX0gZnJvbSAnLi9oZWxwZXJzL21vZGVsL3V0aWxzJztcbmltcG9ydCB7SUlkZW50aWZpZXJ9IGZyb20gJy4vaW50ZXJmYWNlcy9JSWRlbnRpZmllcic7XG5pbXBvcnQge0lNb2RlbENvbnN0cnVjdG9yfSBmcm9tICcuL2ludGVyZmFjZXMvSU1vZGVsQ29uc3RydWN0b3InO1xuaW1wb3J0IHtJUmF3Vmlld30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSYXdWaWV3JztcbmltcG9ydCB7SVR5cGV9IGZyb20gJy4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1RDaGFuZ2V9IGZyb20gJy4vaW50ZXJmYWNlcy9UQ2hhbmdlJztcbmltcG9ydCB7UHVyZUNvbGxlY3Rpb259IGZyb20gJy4vUHVyZUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtQdXJlTW9kZWx9IGZyb20gJy4vUHVyZU1vZGVsJztcblxuZXhwb3J0IGNsYXNzIFZpZXc8VCBleHRlbmRzIFB1cmVNb2RlbCA9IFB1cmVNb2RlbD4ge1xuICBwdWJsaWMgcmVhZG9ubHkgbW9kZWxUeXBlOiBJVHlwZTtcbiAgQG9ic2VydmFibGUgcHVibGljIHNvcnRNZXRob2Q/OiBzdHJpbmd8KChpdGVtOiBUKSA9PiBhbnkpO1xuXG4gIHByaXZhdGUgX19tb2RlbHM6IElPYnNlcnZhYmxlQXJyYXk8SUlkZW50aWZpZXI+ID0gb2JzZXJ2YWJsZS5hcnJheShbXSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgbW9kZWxUeXBlOiBJTW9kZWxDb25zdHJ1Y3RvcjxUPnxJVHlwZSxcbiAgICBwcm90ZWN0ZWQgX19jb2xsZWN0aW9uOiBQdXJlQ29sbGVjdGlvbixcbiAgICBzb3J0TWV0aG9kPzogc3RyaW5nfCgoaXRlbTogVCkgPT4gYW55KSxcbiAgICBtb2RlbHM6IEFycmF5PElJZGVudGlmaWVyfFQ+ID0gW10sXG4gICAgcHVibGljIHVuaXF1ZTogYm9vbGVhbiA9IGZhbHNlLFxuICApIHtcbiAgICB0aGlzLl9fbW9kZWxzLnJlcGxhY2UobW9kZWxzLm1hcChnZXRNb2RlbElkKSk7XG4gICAgdGhpcy5zb3J0TWV0aG9kID0gc29ydE1ldGhvZDtcbiAgICB0aGlzLm1vZGVsVHlwZSA9IGdldE1vZGVsVHlwZShtb2RlbFR5cGUpO1xuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHRoaXMuX19jb2xsZWN0aW9uLl9fdmlld0xpc3QucHVzaCh0aGlzKTtcbiAgfVxuXG4gIEBjb21wdXRlZCBwdWJsaWMgZ2V0IGxlbmd0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5fX21vZGVscy5sZW5ndGg7XG4gIH1cblxuICBAY29tcHV0ZWQgcHVibGljIGdldCBsaXN0KCk6IEFycmF5PFQgfCBudWxsPiB7XG4gICAgY29uc3QgbGlzdCA9IHRoaXMuX19tb2RlbHMubWFwKChpZCkgPT4gdGhpcy5fX2NvbGxlY3Rpb24uZmluZCh0aGlzLm1vZGVsVHlwZSwgaWQpKTtcblxuICAgIGlmICh0aGlzLnNvcnRNZXRob2QpIHtcbiAgICAgIGNvbnN0IHNvcnRGbiA9IHR5cGVvZiB0aGlzLnNvcnRNZXRob2QgPT09ICdzdHJpbmcnXG4gICAgICAgID8gKGl0ZW0pID0+IGl0ZW1bdGhpcy5zb3J0TWV0aG9kIGFzICdzdHJpbmcnXVxuICAgICAgICA6IHRoaXMuc29ydE1ldGhvZDtcbiAgICAgIGxpc3Quc29ydCgoYTogVCB8IG51bGwsIGI6IFQgfCBudWxsKSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbEEgPSBhID8gc29ydEZuKGEpIDogSW5maW5pdHk7XG4gICAgICAgIGNvbnN0IHZhbEIgPSBiID8gc29ydEZuKGIpIDogSW5maW5pdHk7XG5cbiAgICAgICAgcmV0dXJuIHZhbEEgLSB2YWxCO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgaW5zdGFuY2VzID0gb2JzZXJ2YWJsZS5hcnJheShsaXN0LCB7ZGVlcDogZmFsc2V9KTtcblxuICAgIGludGVyY2VwdChpbnN0YW5jZXMsIHRoaXMuX19wYXJ0aWFsTGlzdFVwZGF0ZS5iaW5kKHRoaXMpKTtcblxuICAgIHJldHVybiBpbnN0YW5jZXM7XG4gIH1cblxuICBwdWJsaWMgdG9KU09OKCk6IElSYXdWaWV3IHtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kZWxUeXBlOiB0aGlzLm1vZGVsVHlwZSxcbiAgICAgIG1vZGVsczogdGhpcy5fX21vZGVscy5zbGljZSgpLFxuICAgICAgdW5pcXVlOiB0aGlzLnVuaXF1ZSxcbiAgICB9O1xuICB9XG5cbiAgQGNvbXB1dGVkIHB1YmxpYyBnZXQgc25hcHNob3QoKSB7XG4gICAgcmV0dXJuIHRoaXMudG9KU09OKCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGV4aXN0aW5nIG9yIGEgbmV3IG1vZGVsIHRvIHRoZSBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSBUXG4gICAqIEBwYXJhbSB7VHxJUmF3TW9kZWx8SURpY3Rpb25hcnl9IGRhdGEgTW9kZWwgdG8gYmUgYWRkZWRcbiAgICogQHJldHVybnMge1R9IEFkZGVkIG1vZGVsXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgYWRkKGRhdGE6IFR8SVJhd01vZGVsfElEaWN0aW9uYXJ5KTogVDtcblxuICAvKipcbiAgICogQWRkIGFuIGFycmF5IG9mIGV4aXN0aW5nIG9yIG5ldyBtb2RlbHMgdG8gdGhlIGNvbGxlY3Rpb25cbiAgICpcbiAgICogQHRlbXBsYXRlIFRcbiAgICogQHBhcmFtIHtBcnJheTxUfElSYXdNb2RlbHxJRGljdGlvbmFyeT59IGRhdGEgQXJyYXkgb2YgbW9kZWxzIHRvIGJlIGFkZGVkXG4gICAqIEByZXR1cm5zIHtBcnJheTxUPn0gQWRkZWQgbW9kZWxzXG4gICAqIEBtZW1iZXJvZiBDb2xsZWN0aW9uXG4gICAqL1xuICBwdWJsaWMgYWRkKGRhdGE6IEFycmF5PFR8SVJhd01vZGVsfElEaWN0aW9uYXJ5Pik6IEFycmF5PFQ+O1xuXG4gIEBhY3Rpb24gcHVibGljIGFkZChcbiAgICBkYXRhOiBUfElSYXdNb2RlbHxJRGljdGlvbmFyeXxBcnJheTxUfElSYXdNb2RlbHxJRGljdGlvbmFyeT4sXG4gICk6IFR8QXJyYXk8VD4ge1xuICAgIGNvbnN0IG1vZGVscyA9IG1hcEl0ZW1zKGRhdGEsIChpdGVtKSA9PiB0aGlzLl9fY29sbGVjdGlvbi5hZGQ8VD4oaXRlbSwgdGhpcy5tb2RlbFR5cGUpKSBhcyBUIHwgQXJyYXk8VD47XG5cbiAgICBtYXBJdGVtcyhtb2RlbHMsIChpbnN0YW5jZSkgPT4ge1xuICAgICAgY29uc3QgaWQgPSBnZXRNb2RlbElkKGluc3RhbmNlKTtcbiAgICAgIGlmICghdGhpcy51bmlxdWUgfHwgdGhpcy5fX21vZGVscy5pbmRleE9mKGlkKSA9PT0gLTEpIHtcbiAgICAgICAgdGhpcy5fX21vZGVscy5wdXNoKGlkKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBtb2RlbHM7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSBtb2RlbCBpcyBpbiB0aGUgY29sbGVjdGlvblxuICAgKlxuICAgKiBAcGFyYW0ge1R8SUlkZW50aWZpZXJ9IG1vZGVsIE1vZGVsIHRvIGNoZWNrXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBUaGUgZ2l2ZW4gbW9kZWwgaXMgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICogQG1lbWJlcm9mIENvbGxlY3Rpb25cbiAgICovXG4gIHB1YmxpYyBoYXNJdGVtKG1vZGVsOiBUfElJZGVudGlmaWVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgaWQgPSBnZXRNb2RlbElkKG1vZGVsKTtcblxuICAgIHJldHVybiB0aGlzLl9fbW9kZWxzLmluZGV4T2YoaWQpICE9PSAtMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYSBtb2RlbCBmcm9tIHRoZSB2aWV3XG4gICAqXG4gICAqIEBwYXJhbSB7SUlkZW50aWZpZXJ8VH0gbW9kZWwgTW9kZWwgaWRlbnRpZmllclxuICAgKiBAbWVtYmVyb2YgQ29sbGVjdGlvblxuICAgKi9cbiAgQGFjdGlvbiBwdWJsaWMgcmVtb3ZlKG1vZGVsOiBJSWRlbnRpZmllcnxUKSB7XG4gICAgY29uc3QgaWQgPSBnZXRNb2RlbElkKG1vZGVsKTtcbiAgICB0aGlzLl9fbW9kZWxzLnJlbW92ZShpZCk7XG4gIH1cblxuICBAYWN0aW9uIHB1YmxpYyByZW1vdmVBbGwoKSB7XG4gICAgdGhpcy5fX21vZGVscy5yZXBsYWNlKFtdKTtcbiAgfVxuXG4gIHByaXZhdGUgX19wYXJ0aWFsTGlzdFVwZGF0ZShjaGFuZ2U6IFRDaGFuZ2UpIHtcbiAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICdzcGxpY2UnKSB7XG4gICAgICBpZiAodGhpcy5zb3J0TWV0aG9kICYmIGNoYW5nZS5hZGRlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRocm93IGVycm9yKFNPUlRFRF9OT19XUklURSk7XG4gICAgICB9XG4gICAgICBjb25zdCBhZGRlZCA9IGNoYW5nZS5hZGRlZC5tYXAoZ2V0TW9kZWxJZCk7XG5cbiAgICAgIGNvbnN0IHRvUmVtb3ZlID0gdGhpcy5fX21vZGVscy5zbGljZShjaGFuZ2UuaW5kZXgsIGNoYW5nZS5yZW1vdmVkQ291bnQpO1xuICAgICAgaWYgKHRoaXMudW5pcXVlKSB7XG4gICAgICAgIGFkZGVkLmZvckVhY2goKG5ld0l0ZW1JZCkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLl9fbW9kZWxzLmluZGV4T2YobmV3SXRlbUlkKSAhPT0gLTEgJiYgdG9SZW1vdmUuaW5kZXhPZihuZXdJdGVtSWQpID09PSAtMSkge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3IoVU5JUVVFX01PREVMKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9fbW9kZWxzLnNwbGljZShjaGFuZ2UuaW5kZXgsIGNoYW5nZS5yZW1vdmVkQ291bnQsIC4uLmFkZGVkKTtcblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc29ydE1ldGhvZCAmJiBjaGFuZ2UubmV3VmFsdWUpIHtcbiAgICAgIHRocm93IGVycm9yKFNPUlRFRF9OT19XUklURSk7XG4gICAgfVxuXG4gICAgY29uc3QgbmV3SWQgPSBnZXRNb2RlbElkKGNoYW5nZS5uZXdWYWx1ZSk7XG4gICAgY29uc3QgaWRJbmRleCA9IHRoaXMuX19tb2RlbHMuaW5kZXhPZihuZXdJZCk7XG4gICAgaWYgKHRoaXMudW5pcXVlICYmIGlkSW5kZXggIT09IC0xICYmIGlkSW5kZXggIT09IGNoYW5nZS5pbmRleCkge1xuICAgICAgdGhyb3cgZXJyb3IoVU5JUVVFX01PREVMKTtcbiAgICB9XG5cbiAgICB0aGlzLl9fbW9kZWxzW2NoYW5nZS5pbmRleF0gPSBuZXdJZDtcblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBfX2NoYW5nZU1vZGVsSWQob2xkSWQ6IElJZGVudGlmaWVyLCBuZXdJZDogSUlkZW50aWZpZXIpIHtcbiAgICBjb25zdCBvbGRJZEluZGV4ID0gdGhpcy5fX21vZGVscy5pbmRleE9mKG9sZElkKTtcbiAgICBpZiAob2xkSWRJbmRleCAhPT0gLTEpIHtcbiAgICAgIHRoaXMuX19tb2RlbHNbb2xkSWRJbmRleF0gPSBuZXdJZDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==","dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/View.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { IIdentifier } from './interfaces/IIdentifier';\r\nimport { IModelConstructor } from './interfaces/IModelConstructor';\r\nimport { IRawView } from './interfaces/IRawView';\r\nimport { IType } from './interfaces/IType';\r\nimport { PureCollection } from './PureCollection';\r\nimport { PureModel } from './PureModel';\r\nexport declare class View<T extends PureModel = PureModel> {\r\n    protected __collection: PureCollection;\r\n    unique: boolean;\r\n    readonly modelType: IType;\r\n    sortMethod?: string | ((item: T) => any);\r\n    private __models;\r\n    constructor(modelType: IModelConstructor<T> | IType, __collection: PureCollection, sortMethod?: string | ((item: T) => any), models?: Array<IIdentifier | T>, unique?: boolean);\r\n    readonly length: number;\r\n    readonly list: Array<T | null>;\r\n    toJSON(): IRawView;\r\n    readonly snapshot: IRawView;\r\n    /**\r\n     * Add an existing or a new model to the collection\r\n     *\r\n     * @template T\r\n     * @param {T|IRawModel|IDictionary} data Model to be added\r\n     * @returns {T} Added model\r\n     * @memberof Collection\r\n     */\r\n    add(data: T | IRawModel | IDictionary): T;\r\n    /**\r\n     * Add an array of existing or new models to the collection\r\n     *\r\n     * @template T\r\n     * @param {Array<T|IRawModel|IDictionary>} data Array of models to be added\r\n     * @returns {Array<T>} Added models\r\n     * @memberof Collection\r\n     */\r\n    add(data: Array<T | IRawModel | IDictionary>): Array<T>;\r\n    /**\r\n     * Check if a model is in the collection\r\n     *\r\n     * @param {T|IIdentifier} model Model to check\r\n     * @returns {boolean} The given model is in the collection\r\n     * @memberof Collection\r\n     */\r\n    hasItem(model: T | IIdentifier): boolean;\r\n    /**\r\n     * Remove a model from the view\r\n     *\r\n     * @param {IIdentifier|T} model Model identifier\r\n     * @memberof Collection\r\n     */\r\n    remove(model: IIdentifier | T): void;\r\n    removeAll(): void;\r\n    private __partialListUpdate(change);\r\n    private __changeModelId(oldId, newId);\r\n}\r\n"}}
