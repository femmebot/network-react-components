{"code":"import { observable, set } from 'mobx';\r\nimport { MODEL_REQUIRED } from '../errors';\r\nimport { error } from '../helpers/format';\r\nimport { reducePrototypeChain } from '../helpers/selectors';\r\nvar DataStorage = /** @class */ (function () {\r\n    function DataStorage() {\r\n        this.modelData = new WeakMap();\r\n        this.modelClassData = new WeakMap();\r\n    }\r\n    DataStorage.prototype.initModel = function (model) {\r\n        var modelData = observable({ data: {}, meta: {} });\r\n        this.modelData.set(model, modelData);\r\n        return modelData;\r\n    };\r\n    DataStorage.prototype.getModelData = function (model) {\r\n        return this.__getModelData(model).data;\r\n    };\r\n    DataStorage.prototype.getModelDataKey = function (model, key) {\r\n        var modelData = this.__getModelData(model);\r\n        return modelData.data[key];\r\n    };\r\n    DataStorage.prototype.setModelData = function (model, data) {\r\n        var modelData = this.__getModelData(model);\r\n        set(modelData.data, data);\r\n    };\r\n    DataStorage.prototype.setModelDataKey = function (model, key, value) {\r\n        this.setModelData(model, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.getModelMeta = function (model) {\r\n        return this.modelData.get(model).meta;\r\n    };\r\n    DataStorage.prototype.getModelMetaKey = function (model, key) {\r\n        return this.getModelMeta(model)[key];\r\n    };\r\n    DataStorage.prototype.setModelMeta = function (model, meta) {\r\n        var modelData = this.__getModelData(model);\r\n        set(modelData.meta, meta);\r\n        return modelData.meta;\r\n    };\r\n    DataStorage.prototype.setModelMetaKey = function (model, key, value) {\r\n        this.setModelMeta(model, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.setModelClassMetaKey = function (model, key, value) {\r\n        var data = this.modelClassData.get(model);\r\n        Object.assign(data.meta, (_a = {}, _a[key] = value, _a));\r\n        var _a;\r\n    };\r\n    DataStorage.prototype.getModelClassMetaKey = function (obj, key) {\r\n        var _this = this;\r\n        return reducePrototypeChain(obj, function (value, model) {\r\n            return value || (_this.modelClassData.get(model) || { meta: {} }).meta[key] || null;\r\n        }, null);\r\n    };\r\n    DataStorage.prototype.addModelDefaultField = function (model, key, value) {\r\n        var data = this.modelClassData.get(model);\r\n        if (data) {\r\n            Object.assign(data.data, (_a = {}, _a[key] = value, _a));\r\n        }\r\n        else {\r\n            this.modelClassData.set(model, {\r\n                data: (_b = {}, _b[key] = value, _b),\r\n                meta: {},\r\n                references: {},\r\n            });\r\n        }\r\n        var _a, _b;\r\n    };\r\n    DataStorage.prototype.getModelDefaults = function (obj) {\r\n        var _this = this;\r\n        var defaults = reducePrototypeChain(obj, function (state, model) {\r\n            return state.concat((_this.modelClassData.get(model) || { data: [] }).data);\r\n        }, []);\r\n        return Object.assign.apply(Object, [{}].concat(defaults.reverse()));\r\n    };\r\n    DataStorage.prototype.addModelClassReference = function (model, key, options) {\r\n        if (!options.model && options.model !== 0) {\r\n            throw error(MODEL_REQUIRED);\r\n        }\r\n        var data = this.modelClassData.get(model);\r\n        if (data) {\r\n            Object.assign(data.references, (_a = {}, _a[key] = options, _a));\r\n        }\r\n        else {\r\n            this.modelClassData.set(model, {\r\n                data: {},\r\n                meta: {},\r\n                references: (_b = {}, _b[key] = options, _b),\r\n            });\r\n        }\r\n        var _a, _b;\r\n    };\r\n    DataStorage.prototype.getModelClassReferences = function (obj) {\r\n        var _this = this;\r\n        var defaults = reducePrototypeChain(obj, function (state, model) {\r\n            return state.concat((_this.modelClassData.get(model) || { references: {} }).references);\r\n        }, []);\r\n        return Object.assign.apply(Object, [{}].concat(defaults.reverse()));\r\n    };\r\n    DataStorage.prototype.getModelReferenceOptions = function (model, key) {\r\n        var refs = this.getModelMetaKey(model, 'refs');\r\n        return refs[key];\r\n    };\r\n    DataStorage.prototype.__getModelData = function (model) {\r\n        return this.modelData.get(model) || this.initModel(model);\r\n    };\r\n    // For testing purposes only\r\n    DataStorage.prototype.clear = function () {\r\n        this.modelData = new WeakMap();\r\n        this.modelClassData = new WeakMap();\r\n    };\r\n    return DataStorage;\r\n}());\r\nexport { DataStorage };\r\nexport var storage = new DataStorage();\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2aWNlcy9zdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBc0MsVUFBVSxFQUFFLEdBQUcsRUFBTyxNQUFNLE1BQU0sQ0FBQztBQUVoRixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUV4QyxPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQWMxRDtJQUFBO1FBQ1UsY0FBUyxHQUFHLElBQUksT0FBTyxFQUEyQixDQUFDO1FBRW5ELG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQW1ELENBQUM7SUF1SDFGLENBQUM7SUFySFEsK0JBQVMsR0FBaEIsVUFBaUIsS0FBZ0I7UUFDL0IsSUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLEVBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFDLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFckMsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVNLGtDQUFZLEdBQW5CLFVBQW9CLEtBQWdCO1FBQ2xDLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDekMsQ0FBQztJQUVNLHFDQUFlLEdBQXRCLFVBQXVCLEtBQWdCLEVBQUUsR0FBVztRQUNsRCxJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTdDLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRU0sa0NBQVksR0FBbkIsVUFBb0IsS0FBZ0IsRUFBRSxJQUFpQjtRQUNyRCxJQUFNLFNB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QyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3ZGLENBQUMsRUFBRSxFQUF3QixDQUFDLENBQUM7UUFFN0IsT0FBTyxNQUFNLENBQUMsTUFBTSxPQUFiLE1BQU0sR0FBUSxFQUFFLFNBQUssUUFBUSxDQUFDLE9BQU8sRUFBRSxHQUFFO0lBQ2xELENBQUM7SUFFTSw4Q0FBd0IsR0FBL0IsVUFBZ0MsS0FBZ0IsRUFBRSxHQUFXO1FBQzNELElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRWpELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFFTyxvQ0FBYyxHQUF0QixVQUF1QixLQUFnQjtRQUNyQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVELDRCQUE0QjtJQUNwQiwyQkFBSyxHQUFiO1FBQ0UsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLE9BQU8sRUFBMkIsQ0FBQztRQUN4RCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksT0FBTyxFQUFxQyxDQUFDO0lBQ3pFLENBQUM7SUFDSCxrQkFBQztBQUFELENBQUMsQUExSEQsSUEwSEM7O0FBRUQsTUFBTSxDQUFDLElBQU0sT0FBTyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2ZsYXR0ZW4sIElEaWN0aW9uYXJ5LCB1bmlxfSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7SU9ic2VydmFibGVBcnJheSwgSU9ic2VydmFibGVPYmplY3QsIG9ic2VydmFibGUsIHNldCwgdG9KU30gZnJvbSAnbW9ieCc7XG5cbmltcG9ydCB7TU9ERUxfUkVRVUlSRUR9IGZyb20gJy4uL2Vycm9ycyc7XG5pbXBvcnQge2Vycm9yfSBmcm9tICcuLi9oZWxwZXJzL2Zvcm1hdCc7XG5pbXBvcnQge2dldE1vZGVsSWQsIGdldE1vZGVsVHlwZX0gZnJvbSAnLi4vaGVscGVycy9tb2RlbC91dGlscyc7XG5pbXBvcnQge3JlZHVjZVByb3RvdHlwZUNoYWlufSBmcm9tICcuLi9oZWxwZXJzL3NlbGVjdG9ycyc7XG5pbXBvcnQge0lEYXRhU3RvcmFnZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9JRGF0YVN0b3JhZ2UnO1xuaW1wb3J0IHtJSWRlbnRpZmllcn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9JSWRlbnRpZmllcic7XG5pbXBvcnQge0lSZWZlcmVuY2VPcHRpb25zfSBmcm9tICcuLi9pbnRlcmZhY2VzL0lSZWZlcmVuY2VPcHRpb25zJztcbmltcG9ydCB7SVR5cGV9IGZyb20gJy4uL2ludGVyZmFjZXMvSVR5cGUnO1xuaW1wb3J0IHtQdXJlQ29sbGVjdGlvbn0gZnJvbSAnLi4vUHVyZUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtQdXJlTW9kZWx9IGZyb20gJy4uL1B1cmVNb2RlbCc7XG5cbmludGVyZmFjZSBJTW9kZWxDbGFzc0RhdGEge1xuICBkYXRhOiBJRGljdGlvbmFyeTtcbiAgbWV0YTogSURpY3Rpb25hcnk7XG4gIHJlZmVyZW5jZXM6IElEaWN0aW9uYXJ5PElSZWZlcmVuY2VPcHRpb25zPjtcbn1cblxuZXhwb3J0IGNsYXNzIERhdGFTdG9yYWdlIHtcbiAgcHJpdmF0ZSBtb2RlbERhdGEgPSBuZXcgV2Vha01hcDxQdXJlTW9kZWwsIElEYXRhU3RvcmFnZT4oKTtcblxuICBwcml2YXRlIG1vZGVsQ2xhc3NEYXRhID0gbmV3IFdlYWtNYXA8dHlwZW9mIFB1cmVNb2RlbHx7dHlwZTogSVR5cGV9LCBJTW9kZWxDbGFzc0RhdGE+KCk7XG5cbiAgcHVibGljIGluaXRNb2RlbChtb2RlbDogUHVyZU1vZGVsKSB7XG4gICAgY29uc3QgbW9kZWxEYXRhID0gb2JzZXJ2YWJsZSh7ZGF0YToge30sIG1ldGE6IHt9fSk7XG4gICAgdGhpcy5tb2RlbERhdGEuc2V0KG1vZGVsLCBtb2RlbERhdGEpO1xuXG4gICAgcmV0dXJuIG1vZGVsRGF0YTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNb2RlbERhdGEobW9kZWw6IFB1cmVNb2RlbCkge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0TW9kZWxEYXRhKG1vZGVsKS5kYXRhO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsRGF0YUtleShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZykge1xuICAgIGNvbnN0IG1vZGVsRGF0YSA9IHRoaXMuX19nZXRNb2RlbERhdGEobW9kZWwpO1xuXG4gICAgcmV0dXJuIG1vZGVsRGF0YS5kYXRhW2tleV07XG4gIH1cblxuICBwdWJsaWMgc2V0TW9kZWxEYXRhKG1vZGVsOiBQdXJlTW9kZWwsIGRhdGE6IElEaWN0aW9uYXJ5KSB7XG4gICAgY29uc3QgbW9kZWxEYXRhID0gdGhpcy5fX2dldE1vZGVsRGF0YShtb2RlbCk7XG4gICAgc2V0KG1vZGVsRGF0YS5kYXRhLCBkYXRhKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRNb2RlbERhdGFLZXkobW9kZWw6IFB1cmVNb2RlbCwga2V5OiBzdHJpbmcsIHZhbHVlPzogYW55KSB7XG4gICAgdGhpcy5zZXRNb2RlbERhdGEobW9kZWwsIHtba2V5XTogdmFsdWV9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNb2RlbE1ldGEobW9kZWw6IFB1cmVNb2RlbCk6IElEaWN0aW9uYXJ5IHtcbiAgICByZXR1cm4gKHRoaXMubW9kZWxEYXRhLmdldChtb2RlbCkgYXMgSURhdGFTdG9yYWdlKS5tZXRhO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsTWV0YUtleShtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TW9kZWxNZXRhKG1vZGVsKVtrZXldO1xuICB9XG5cbiAgcHVibGljIHNldE1vZGVsTWV0YShtb2RlbDogUHVyZU1vZGVsLCBtZXRhOiBJRGljdGlvbmFyeSkge1xuICAgIGNvbnN0IG1vZGVsRGF0YSA9IHRoaXMuX19nZXRNb2RlbERhdGEobW9kZWwpO1xuICAgIHNldChtb2RlbERhdGEubWV0YSwgbWV0YSk7XG5cbiAgICByZXR1cm4gbW9kZWxEYXRhLm1ldGE7XG4gIH1cblxuICBwdWJsaWMgc2V0TW9kZWxNZXRhS2V5KG1vZGVsOiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCB2YWx1ZT86IGFueSkge1xuICAgIHRoaXMuc2V0TW9kZWxNZXRhKG1vZGVsLCB7W2tleV06IHZhbHVlfSk7XG4gIH1cblxuICBwdWJsaWMgc2V0TW9kZWxDbGFzc01ldGFLZXkobW9kZWw6IHR5cGVvZiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCB2YWx1ZT86IGFueSkge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCkgYXMgSU1vZGVsQ2xhc3NEYXRhO1xuICAgIE9iamVjdC5hc3NpZ24oZGF0YS5tZXRhLCB7W2tleV06IHZhbHVlfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxDbGFzc01ldGFLZXkob2JqOiB0eXBlb2YgUHVyZU1vZGVsLCBrZXk6IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHJlZHVjZVByb3RvdHlwZUNoYWluKG9iaiwgKHZhbHVlLCBtb2RlbCkgPT4ge1xuICAgICAgcmV0dXJuIHZhbHVlIHx8ICh0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCkgfHwge21ldGE6IHt9fSkubWV0YVtrZXldIHx8IG51bGw7XG4gICAgfSwgbnVsbCk7XG4gIH1cblxuICBwdWJsaWMgYWRkTW9kZWxEZWZhdWx0RmllbGQobW9kZWw6IHR5cGVvZiBQdXJlTW9kZWwsIGtleTogc3RyaW5nLCB2YWx1ZT86IGFueSkge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCk7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24oZGF0YS5kYXRhLCB7W2tleV06IHZhbHVlfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubW9kZWxDbGFzc0RhdGEuc2V0KG1vZGVsLCB7XG4gICAgICAgIGRhdGE6IHtba2V5XTogdmFsdWV9LFxuICAgICAgICBtZXRhOiB7fSxcbiAgICAgICAgcmVmZXJlbmNlczoge30sXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0TW9kZWxEZWZhdWx0cyhvYmo6IHR5cGVvZiBQdXJlTW9kZWwpOiBJRGljdGlvbmFyeSB7XG4gICAgY29uc3QgZGVmYXVsdHMgPSByZWR1Y2VQcm90b3R5cGVDaGFpbihvYmosIChzdGF0ZSwgbW9kZWwpID0+IHtcbiAgICAgIHJldHVybiBzdGF0ZS5jb25jYXQoKHRoaXMubW9kZWxDbGFzc0RhdGEuZ2V0KG1vZGVsKSB8fCB7ZGF0YTogW119KS5kYXRhKTtcbiAgICB9LCBbXSBhcyBBcnJheTxJRGljdGlvbmFyeT4pO1xuXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIC4uLmRlZmF1bHRzLnJldmVyc2UoKSk7XG4gIH1cblxuICBwdWJsaWMgYWRkTW9kZWxDbGFzc1JlZmVyZW5jZShtb2RlbDogdHlwZW9mIFB1cmVNb2RlbCwga2V5OiBzdHJpbmcsIG9wdGlvbnM6IElSZWZlcmVuY2VPcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zLm1vZGVsICYmIG9wdGlvbnMubW9kZWwgIT09IDApIHtcbiAgICAgIHRocm93IGVycm9yKE1PREVMX1JFUVVJUkVEKTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gdGhpcy5tb2RlbENsYXNzRGF0YS5nZXQobW9kZWwpO1xuICAgIGlmIChkYXRhKSB7XG4gICAgICBPYmplY3QuYXNzaWduKGRhdGEucmVmZXJlbmNlcywge1trZXldOiBvcHRpb25zfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubW9kZWxDbGFzc0RhdGEuc2V0KG1vZGVsLCB7XG4gICAgICAgIGRhdGE6IHt9LFxuICAgICAgICBtZXRhOiB7fSxcbiAgICAgICAgcmVmZXJlbmNlczoge1trZXldOiBvcHRpb25zfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRNb2RlbENsYXNzUmVmZXJlbmNlcyhvYmo6IHR5cGVvZiBQdXJlTW9kZWwpOiBJRGljdGlvbmFyeTxJUmVmZXJlbmNlT3B0aW9ucz4ge1xuICAgIGNvbnN0IGRlZmF1bHRzID0gcmVkdWNlUHJvdG90eXBlQ2hhaW4ob2JqLCAoc3RhdGUsIG1vZGVsKSA9PiB7XG4gICAgICByZXR1cm4gc3RhdGUuY29uY2F0KCh0aGlzLm1vZGVsQ2xhc3NEYXRhLmdldChtb2RlbCkgfHwge3JlZmVyZW5jZXM6IHt9fSkucmVmZXJlbmNlcyk7XG4gICAgfSwgW10gYXMgQXJyYXk8SURpY3Rpb25hcnk+KTtcblxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCAuLi5kZWZhdWx0cy5yZXZlcnNlKCkpO1xuICB9XG5cbiAgcHVibGljIGdldE1vZGVsUmVmZXJlbmNlT3B0aW9ucyhtb2RlbDogUHVyZU1vZGVsLCBrZXk6IHN0cmluZyk6IElSZWZlcmVuY2VPcHRpb25zIHtcbiAgICBjb25zdCByZWZzID0gdGhpcy5nZXRNb2RlbE1ldGFLZXkobW9kZWwsICdyZWZzJyk7XG5cbiAgICByZXR1cm4gcmVmc1trZXldO1xuICB9XG5cbiAgcHJpdmF0ZSBfX2dldE1vZGVsRGF0YShtb2RlbDogUHVyZU1vZGVsKTogSURhdGFTdG9yYWdlIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbERhdGEuZ2V0KG1vZGVsKSB8fCB0aGlzLmluaXRNb2RlbChtb2RlbCk7XG4gIH1cblxuICAvLyBGb3IgdGVzdGluZyBwdXJwb3NlcyBvbmx5XG4gIHByaXZhdGUgY2xlYXIoKSB7XG4gICAgdGhpcy5tb2RlbERhdGEgPSBuZXcgV2Vha01hcDxQdXJlTW9kZWwsIElEYXRhU3RvcmFnZT4oKTtcbiAgICB0aGlzLm1vZGVsQ2xhc3NEYXRhID0gbmV3IFdlYWtNYXA8dHlwZW9mIFB1cmVNb2RlbCwgSU1vZGVsQ2xhc3NEYXRhPigpO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBzdG9yYWdlID0gbmV3IERhdGFTdG9yYWdlKCk7XG4iXX0=","dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/services/storage.d.ts","text":"import { IDictionary } from 'datx-utils';\r\nimport { IObservableObject } from 'mobx';\r\nimport { IReferenceOptions } from '../interfaces/IReferenceOptions';\r\nimport { PureModel } from '../PureModel';\r\nexport declare class DataStorage {\r\n    private modelData;\r\n    private modelClassData;\r\n    initModel(model: PureModel): {\r\n        data: {};\r\n        meta: {};\r\n    } & IObservableObject;\r\n    getModelData(model: PureModel): IDictionary<any>;\r\n    getModelDataKey(model: PureModel, key: string): any;\r\n    setModelData(model: PureModel, data: IDictionary): void;\r\n    setModelDataKey(model: PureModel, key: string, value?: any): void;\r\n    getModelMeta(model: PureModel): IDictionary;\r\n    getModelMetaKey(model: PureModel, key: string): any;\r\n    setModelMeta(model: PureModel, meta: IDictionary): IDictionary<any>;\r\n    setModelMetaKey(model: PureModel, key: string, value?: any): void;\r\n    setModelClassMetaKey(model: typeof PureModel, key: string, value?: any): void;\r\n    getModelClassMetaKey(obj: typeof PureModel, key: string): any;\r\n    addModelDefaultField(model: typeof PureModel, key: string, value?: any): void;\r\n    getModelDefaults(obj: typeof PureModel): IDictionary;\r\n    addModelClassReference(model: typeof PureModel, key: string, options: IReferenceOptions): void;\r\n    getModelClassReferences(obj: typeof PureModel): IDictionary<IReferenceOptions>;\r\n    getModelReferenceOptions(model: PureModel, key: string): IReferenceOptions;\r\n    private __getModelData(model);\r\n    private clear();\r\n}\r\nexport declare const storage: DataStorage;\r\n"}}
