{"code":"import { UNDEFINED_MODEL, UNDEFINED_TYPE } from '../errors';\r\nimport { PureModel } from '../PureModel';\r\nimport { error } from './format';\r\nimport { getMetaKeyFromRaw, updateModel } from './model/utils';\r\nfunction initCollectionModel(collection, data) {\r\n    var type = getMetaKeyFromRaw(data, 'type');\r\n    return upsertModel(data, type, collection);\r\n}\r\nexport function upsertModel(data, type, collection) {\r\n    if (!type && type !== 0) {\r\n        throw error(UNDEFINED_TYPE);\r\n    }\r\n    var staticCollection = collection.constructor;\r\n    var TypeModel = staticCollection.types.find(function (item) { return item.type === type; }) || staticCollection.defaultModel;\r\n    if (!TypeModel) {\r\n        throw error(UNDEFINED_MODEL, { type: type });\r\n    }\r\n    var id = getMetaKeyFromRaw(data, 'id', TypeModel);\r\n    var existingModel = id && collection.find(type, id);\r\n    if (existingModel) {\r\n        return updateModel(existingModel, data);\r\n    }\r\n    return new TypeModel(data, collection);\r\n}\r\nexport function isSelectorFunction(fn) {\r\n    return (typeof fn === 'function') && (fn !== PureModel && !(fn.prototype instanceof PureModel));\r\n}\r\nexport function initModels(collection, data) {\r\n    return data.map(function (item) { return initCollectionModel(collection, item); });\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9oZWxwZXJzL2NvbGxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFDLGVBQWUsRUFBRSxjQUFjLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFHMUQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUV2QyxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQy9CLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxXQUFXLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFN0QsNkJBQTZCLFVBQTBCLEVBQUUsSUFBZTtJQUN0RSxJQUFNLElBQUksR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDN0MsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQzdDLENBQUM7QUFFRCxNQUFNLHNCQUFzQixJQUFlLEVBQUUsSUFBNEIsRUFBRSxVQUEwQjtJQUNuRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4QixNQUFNLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsSUFBTSxnQkFBZ0IsR0FBRyxVQUFVLENBQUMsV0FBb0MsQ0FBQztJQUN6RSxJQUFNLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLEVBQWxCLENBQWtCLENBQUMsSUFBSSxnQkFBZ0IsQ0FBQyxZQUFZLENBQUM7SUFDN0csRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ2YsTUFBTSxLQUFLLENBQUMsZUFBZSxFQUFFLEVBQUMsSUFBSSxNQUFBLEVBQUMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxJQUFNLEVBQUUsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFNBQXVDLENBQUMsQ0FBQztJQUNsRixJQUFNLGFBQWEsR0FBRyxFQUFFLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEQsRUFBRSxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUNsQixNQUFNLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksU0FBUyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztBQUN6QyxDQUFDO0FBRUQsTUFBTSw2QkFBNkIsRUFBTztJQUN4QyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxTQUFTLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxTQUFTLFlBQVksU0FBUyxDQUFDLENBQUMsQ0FBQztBQUNsRyxDQUFDO0FBRUQsTUFBTSxxQkFBcUIsVUFBMEIsRUFBRSxJQUFzQjtJQUMzRSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLG1CQUFtQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBckMsQ0FBcUMsQ0FBQyxDQUFDO0FBQ25FLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0lSYXdNb2RlbH0gZnJvbSAnZGF0eC11dGlscyc7XG5cbmltcG9ydCB7VU5ERUZJTkVEX01PREVMLCBVTkRFRklORURfVFlQRX0gZnJvbSAnLi4vZXJyb3JzJztcbmltcG9ydCB7SVR5cGV9IGZyb20gJy4uL2ludGVyZmFjZXMvSVR5cGUnO1xuaW1wb3J0IHtQdXJlQ29sbGVjdGlvbn0gZnJvbSAnLi4vUHVyZUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtQdXJlTW9kZWx9IGZyb20gJy4uL1B1cmVNb2RlbCc7XG5pbXBvcnQge3N0b3JhZ2V9IGZyb20gJy4uL3NlcnZpY2VzL3N0b3JhZ2UnO1xuaW1wb3J0IHtlcnJvcn0gZnJvbSAnLi9mb3JtYXQnO1xuaW1wb3J0IHtnZXRNZXRhS2V5RnJvbVJhdywgdXBkYXRlTW9kZWx9IGZyb20gJy4vbW9kZWwvdXRpbHMnO1xuXG5mdW5jdGlvbiBpbml0Q29sbGVjdGlvbk1vZGVsKGNvbGxlY3Rpb246IFB1cmVDb2xsZWN0aW9uLCBkYXRhOiBJUmF3TW9kZWwpOiBQdXJlTW9kZWwge1xuICBjb25zdCB0eXBlID0gZ2V0TWV0YUtleUZyb21SYXcoZGF0YSwgJ3R5cGUnKTtcbiAgcmV0dXJuIHVwc2VydE1vZGVsKGRhdGEsIHR5cGUsIGNvbGxlY3Rpb24pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBzZXJ0TW9kZWwoZGF0YTogSVJhd01vZGVsLCB0eXBlOiBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsLCBjb2xsZWN0aW9uOiBQdXJlQ29sbGVjdGlvbik6IFB1cmVNb2RlbCB7XG4gIGlmICghdHlwZSAmJiB0eXBlICE9PSAwKSB7XG4gICAgdGhyb3cgZXJyb3IoVU5ERUZJTkVEX1RZUEUpO1xuICB9XG5cbiAgY29uc3Qgc3RhdGljQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb24uY29uc3RydWN0b3IgYXMgdHlwZW9mIFB1cmVDb2xsZWN0aW9uO1xuICBjb25zdCBUeXBlTW9kZWwgPSBzdGF0aWNDb2xsZWN0aW9uLnR5cGVzLmZpbmQoKGl0ZW0pID0+IGl0ZW0udHlwZSA9PT0gdHlwZSkgfHwgc3RhdGljQ29sbGVjdGlvbi5kZWZhdWx0TW9kZWw7XG4gIGlmICghVHlwZU1vZGVsKSB7XG4gICAgdGhyb3cgZXJyb3IoVU5ERUZJTkVEX01PREVMLCB7dHlwZX0pO1xuICB9XG5cbiAgY29uc3QgaWQgPSBnZXRNZXRhS2V5RnJvbVJhdyhkYXRhLCAnaWQnLCBUeXBlTW9kZWwgYXMgdHlwZW9mIFB1cmVNb2RlbHx1bmRlZmluZWQpO1xuICBjb25zdCBleGlzdGluZ01vZGVsID0gaWQgJiYgY29sbGVjdGlvbi5maW5kKHR5cGUsIGlkKTtcbiAgaWYgKGV4aXN0aW5nTW9kZWwpIHtcbiAgICByZXR1cm4gdXBkYXRlTW9kZWwoZXhpc3RpbmdNb2RlbCwgZGF0YSk7XG4gIH1cblxuICByZXR1cm4gbmV3IFR5cGVNb2RlbChkYXRhLCBjb2xsZWN0aW9uKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzU2VsZWN0b3JGdW5jdGlvbihmbjogYW55KSB7XG4gIHJldHVybiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSAmJiAoZm4gIT09IFB1cmVNb2RlbCAmJiAhKGZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIFB1cmVNb2RlbCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdE1vZGVscyhjb2xsZWN0aW9uOiBQdXJlQ29sbGVjdGlvbiwgZGF0YTogQXJyYXk8SVJhd01vZGVsPikge1xuICByZXR1cm4gZGF0YS5tYXAoKGl0ZW0pID0+IGluaXRDb2xsZWN0aW9uTW9kZWwoY29sbGVjdGlvbiwgaXRlbSkpO1xufVxuIl19","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/helpers/collection.d.ts","text":"import { IRawModel } from 'datx-utils';\r\nimport { IType } from '../interfaces/IType';\r\nimport { PureCollection } from '../PureCollection';\r\nimport { PureModel } from '../PureModel';\r\nexport declare function upsertModel(data: IRawModel, type: IType | typeof PureModel, collection: PureCollection): PureModel;\r\nexport declare function isSelectorFunction(fn: any): boolean;\r\nexport declare function initModels(collection: PureCollection, data: Array<IRawModel>): PureModel[];\r\n"}}
