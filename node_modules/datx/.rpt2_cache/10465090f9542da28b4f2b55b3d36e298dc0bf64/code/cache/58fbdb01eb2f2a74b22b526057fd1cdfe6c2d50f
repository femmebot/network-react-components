{"code":"import * as tslib_1 from \"tslib\";\r\nimport { deprecated, mapItems } from 'datx-utils';\r\nimport { isObservableArray } from 'mobx';\r\nimport { FieldType } from './enums/FieldType';\r\nimport { ReferenceType } from './enums/ReferenceType';\r\nimport { updateField } from './helpers/model/fields';\r\nimport { initModelField, initModelRef } from './helpers/model/init';\r\nimport { getModelCollection, getModelId, getModelMetaKey, getModelType, modelToJSON, updateModel, } from './helpers/model/utils';\r\nimport { PureModel } from './PureModel';\r\nimport { storage } from './services/storage';\r\nvar CompatModel = /** @class */ (function (_super) {\r\n    tslib_1.__extends(CompatModel, _super);\r\n    function CompatModel(initialData, collection) {\r\n        var _this = _super.call(this, initialData, collection) || this;\r\n        deprecated('CompatModel is just a migration tool. Please move to Model or PureModel as soon as possible.');\r\n        Object.keys(_this.static.refs).forEach(function (prop) {\r\n            var refs = getModelMetaKey(_this, 'refs');\r\n            if (prop in refs) {\r\n                return;\r\n            }\r\n            var ref = _this.static.refs[prop];\r\n            var data = mapItems(_this[prop] || _this.static.defaults[prop], getModelId);\r\n            delete _this[prop];\r\n            if (typeof ref === 'object') {\r\n                // Back reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref.model,\r\n                    property: ref.property,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n            else {\r\n                // Normal reference\r\n                initModelRef(_this, prop, {\r\n                    model: ref,\r\n                    type: ReferenceType.TO_ONE_OR_MANY,\r\n                }, data);\r\n            }\r\n        });\r\n        Object.keys(_this.static.defaults).forEach(function (prop) {\r\n            if (!(prop in _this.static.refs) && !(prop in _this)) {\r\n                initModelField(_this, prop, _this.static.defaults[prop]);\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    CompatModel.prototype.getRecordId = function () {\r\n        deprecated('model.getRecordId is deprecated. Use getModelId() instead.');\r\n        return getModelId(this);\r\n    };\r\n    CompatModel.prototype.getRecordType = function () {\r\n        deprecated('model.getRecordType is deprecated. Use getModelType() instead.');\r\n        return getModelType(this);\r\n    };\r\n    CompatModel.prototype.assign = function (key, value) {\r\n        deprecated('model.assign is deprecated. Use assignModel() instead.');\r\n        var type = FieldType.DATA;\r\n        var modelId = storage.getModelClassMetaKey(this.static, 'id');\r\n        var modelType = storage.getModelClassMetaKey(this.static, 'type');\r\n        if (key === modelId) {\r\n            type = FieldType.ID;\r\n        }\r\n        else if (key === modelType) {\r\n            type = FieldType.TYPE;\r\n        }\r\n        updateField(this, key, value, type);\r\n        return value;\r\n    };\r\n    CompatModel.prototype.assignRef = function (key, value, type) {\r\n        deprecated('model.assignRef is deprecated. Use initModelRef() instead.');\r\n        var refs = getModelMetaKey(this, 'refs');\r\n        if (refs[key]) {\r\n            return this[key] = value;\r\n        }\r\n        var model = type;\r\n        if (!model) {\r\n            if (value instanceof Array || isObservableArray(value)) {\r\n                model = value.reduce(function (t, m) { return t || getModelType(m); }, null);\r\n            }\r\n            else if (value instanceof PureModel) {\r\n                model = getModelType(value);\r\n            }\r\n        }\r\n        if (!model) {\r\n            throw new Error('The type property is missing');\r\n        }\r\n        initModelRef(this, key, {\r\n            model: model,\r\n            type: ReferenceType.TO_ONE_OR_MANY,\r\n        }, value);\r\n        return this[key];\r\n    };\r\n    CompatModel.prototype.update = function (data) {\r\n        var _this = this;\r\n        deprecated('model.update is deprecated. Use updateModel() instead.');\r\n        var updateData = Object.assign({}, data);\r\n        Object.keys(updateData).forEach(function (key) {\r\n            if (typeof _this[key] === 'function') {\r\n                delete updateData[key];\r\n            }\r\n        });\r\n        return updateModel(this, updateData);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"static\", {\r\n        get: function () {\r\n            deprecated('model.static is deprecated.');\r\n            return this.constructor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.prototype.toJS = function () {\r\n        deprecated('model.toJS() is deprecated. Use modelToJSON() instead.');\r\n        return modelToJSON(this);\r\n    };\r\n    Object.defineProperty(CompatModel.prototype, \"snapshot\", {\r\n        get: function () {\r\n            deprecated('model.snapshot is deprecated. Use modelToJSON() instead.');\r\n            return modelToJSON(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompatModel.prototype, \"__collection\", {\r\n        get: function () {\r\n            deprecated('model.__collection is deprecated. Use getModelCollection() instead.');\r\n            return getModelCollection(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CompatModel.refs = {};\r\n    CompatModel.defaults = {};\r\n    return CompatModel;\r\n}(PureModel));\r\nexport { CompatModel };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tcGF0TW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvQ29tcGF0TW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQTBCLFFBQVEsRUFBQyxNQUFNLFlBQVksQ0FBQztBQUN4RSxPQUFPLEVBQUMsaUJBQWlCLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFHNUMsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRCxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDbkQsT0FBTyxFQUFDLGNBQWMsRUFBRSxZQUFZLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRSxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLFVBQVUsRUFDVixlQUFlLEVBQ2YsWUFBWSxFQUNaLFdBQVcsRUFDWCxXQUFXLEdBQ1osTUFBTSx1QkFBdUIsQ0FBQztBQUcvQixPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQ3RDLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUUzQztJQUFpQyx1Q0FBUztJQUl4QyxxQkFBWSxXQUFtQixFQUFFLFVBQXVCO1FBQXhELFlBQ0Usa0JBQU0sV0FBVyxFQUFFLFVBQVUsQ0FBQyxTQWlDL0I7UUEvQkMsVUFBVSxDQUFDLDhGQUE4RixDQUFDLENBQUM7UUFFM0csTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQUk7WUFDekMsSUFBTSxJQUFJLEdBQUcsZUFBZSxDQUFDLEtBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUMzQyxJQUFJLElBQUksSUFBSSxJQUFJLEVBQUU7Z0JBQ2hCLE9BQU87YUFDUjtZQUNELElBQU0sR0FBRyxHQUFHLEtBQUks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LENBQUM7SUFDdkMsQ0FBQztJQUVELHNCQUFXLCtCQUFNO2FBQWpCO1lBQ0UsVUFBVSxDQUFDLDZCQUE2QixDQUFDLENBQUM7WUFDMUMsT0FBTyxJQUFJLENBQUMsV0FBaUMsQ0FBQztRQUNoRCxDQUFDOzs7T0FBQTtJQUVNLDBCQUFJLEdBQVg7UUFDRSxVQUFVLENBQUMsd0RBQXdELENBQUMsQ0FBQztRQUNyRSxPQUFPLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQsc0JBQVcsaUNBQVE7YUFBbkI7WUFDRSxVQUFVLENBQUMsMERBQTBELENBQUMsQ0FBQztZQUN2RSxPQUFPLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFZLHFDQUFZO2FBQXhCO1lBQ0UsVUFBVSxDQUFDLHFFQUFxRSxDQUFDLENBQUM7WUFDbEYsT0FBTyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxDQUFDOzs7T0FBQTtJQXpIYSxnQkFBSSxHQUFnQixFQUFFLENBQUM7SUFDdkIsb0JBQVEsR0FBcUIsRUFBRSxDQUFDO0lBeUhoRCxrQkFBQztDQUFBLEFBM0hELENBQWlDLFNBQVMsR0EySHpDO1NBM0hZLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2RlcHJlY2F0ZWQsIElEaWN0aW9uYXJ5LCBJUmF3TW9kZWwsIG1hcEl0ZW1zfSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7aXNPYnNlcnZhYmxlQXJyYXksIHNldH0gZnJvbSAnbW9ieCc7XG5cbmltcG9ydCB7Q29sbGVjdGlvbn0gZnJvbSAnLi9Db2xsZWN0aW9uJztcbmltcG9ydCB7RmllbGRUeXBlfSBmcm9tICcuL2VudW1zL0ZpZWxkVHlwZSc7XG5pbXBvcnQge1JlZmVyZW5jZVR5cGV9IGZyb20gJy4vZW51bXMvUmVmZXJlbmNlVHlwZSc7XG5pbXBvcnQge3VwZGF0ZUZpZWxkfSBmcm9tICcuL2hlbHBlcnMvbW9kZWwvZmllbGRzJztcbmltcG9ydCB7aW5pdE1vZGVsRmllbGQsIGluaXRNb2RlbFJlZn0gZnJvbSAnLi9oZWxwZXJzL21vZGVsL2luaXQnO1xuaW1wb3J0IHtcbiAgZ2V0TW9kZWxDb2xsZWN0aW9uLFxuICBnZXRNb2RlbElkLFxuICBnZXRNb2RlbE1ldGFLZXksXG4gIGdldE1vZGVsVHlwZSxcbiAgbW9kZWxUb0pTT04sXG4gIHVwZGF0ZU1vZGVsLFxufSBmcm9tICcuL2hlbHBlcnMvbW9kZWwvdXRpbHMnO1xuaW1wb3J0IHtJUmVmZXJlbmNlc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSZWZlcmVuY2VzJztcbmltcG9ydCB7SVR5cGV9IGZyb20gJy4vaW50ZXJmYWNlcy9JVHlwZSc7XG5pbXBvcnQge1B1cmVNb2RlbH0gZnJvbSAnLi9QdXJlTW9kZWwnO1xuaW1wb3J0IHtzdG9yYWdlfSBmcm9tICcuL3NlcnZpY2VzL3N0b3JhZ2UnO1xuXG5leHBvcnQgY2xhc3MgQ29tcGF0TW9kZWwgZXh0ZW5kcyBQdXJlTW9kZWwge1xuICBwdWJsaWMgc3RhdGljIHJlZnM6IElSZWZlcmVuY2VzID0ge307XG4gIHB1YmxpYyBzdGF0aWMgZGVmYXVsdHM6IElEaWN0aW9uYXJ5PGFueT4gPSB7fTtcblxuICBjb25zdHJ1Y3Rvcihpbml0aWFsRGF0YTogb2JqZWN0LCBjb2xsZWN0aW9uPzogQ29sbGVjdGlvbikge1xuICAgIHN1cGVyKGluaXRpYWxEYXRhLCBjb2xsZWN0aW9uKTtcblxuICAgIGRlcHJlY2F0ZWQoJ0NvbXBhdE1vZGVsIGlzIGp1c3QgYSBtaWdyYXRpb24gdG9vbC4gUGxlYXNlIG1vdmUgdG8gTW9kZWwgb3IgUHVyZU1vZGVsIGFzIHNvb24gYXMgcG9zc2libGUuJyk7XG5cbiAgICBPYmplY3Qua2V5cyh0aGlzLnN0YXRpYy5yZWZzKS5mb3JFYWNoKChwcm9wKSA9PiB7XG4gICAgICBjb25zdCByZWZzID0gZ2V0TW9kZWxNZXRhS2V5KHRoaXMsICdyZWZzJyk7XG4gICAgICBpZiAocHJvcCBpbiByZWZzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlZiA9IHRoaXMuc3RhdGljLnJlZnNbcHJvcF07XG4gICAgICBjb25zdCBkYXRhID0gbWFwSXRlbXModGhpc1twcm9wXSB8fCB0aGlzLnN0YXRpYy5kZWZhdWx0c1twcm9wXSwgZ2V0TW9kZWxJZCk7XG4gICAgICBkZWxldGUgdGhpc1twcm9wXTtcbiAgICAgIGlmICh0eXBlb2YgcmVmID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyBCYWNrIHJlZmVyZW5jZVxuICAgICAgICBpbml0TW9kZWxSZWYodGhpcywgcHJvcCwge1xuICAgICAgICAgIG1vZGVsOiByZWYubW9kZWwsXG4gICAgICAgICAgcHJvcGVydHk6IHJlZi5wcm9wZXJ0eSxcbiAgICAgICAgICB0eXBlOiBSZWZlcmVuY2VUeXBlLlRPX09ORV9PUl9NQU5ZLFxuICAgICAgICB9LCBkYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5vcm1hbCByZWZlcmVuY2VcbiAgICAgICAgaW5pdE1vZGVsUmVmKHRoaXMsIHByb3AsIHtcbiAgICAgICAgICBtb2RlbDogcmVmLFxuICAgICAgICAgIHR5cGU6IFJlZmVyZW5jZVR5cGUuVE9fT05FX09SX01BTlksXG4gICAgICAgIH0sIGRhdGEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgT2JqZWN0LmtleXModGhpcy5zdGF0aWMuZGVmYXVsdHMpLmZvckVhY2goKHByb3ApID0+IHtcbiAgICAgIGlmICghKHByb3AgaW4gdGhpcy5zdGF0aWMucmVmcykgJiYgIShwcm9wIGluIHRoaXMpKSB7XG4gICAgICAgIGluaXRNb2RlbEZpZWxkKHRoaXMsIHByb3AsIHRoaXMuc3RhdGljLmRlZmF1bHRzW3Byb3BdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSZWNvcmRJZCgpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5nZXRSZWNvcmRJZCBpcyBkZXByZWNhdGVkLiBVc2UgZ2V0TW9kZWxJZCgpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIGdldE1vZGVsSWQodGhpcyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjb3JkVHlwZSgpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5nZXRSZWNvcmRUeXBlIGlzIGRlcHJlY2F0ZWQuIFVzZSBnZXRNb2RlbFR5cGUoKSBpbnN0ZWFkLicpO1xuICAgIHJldHVybiBnZXRNb2RlbFR5cGUodGhpcyk7XG4gIH1cblxuICBwdWJsaWMgYXNzaWduKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuYXNzaWduIGlzIGRlcHJlY2F0ZWQuIFVzZSBhc3NpZ25Nb2RlbCgpIGluc3RlYWQuJyk7XG4gICAgbGV0IHR5cGUgPSBGaWVsZFR5cGUuREFUQTtcbiAgICBjb25zdCBtb2RlbElkID0gc3RvcmFnZS5nZXRNb2RlbENsYXNzTWV0YUtleSh0aGlzLnN0YXRpYywgJ2lkJyk7XG4gICAgY29uc3QgbW9kZWxUeXBlID0gc3RvcmFnZS5nZXRNb2RlbENsYXNzTWV0YUtleSh0aGlzLnN0YXRpYywgJ3R5cGUnKTtcbiAgICBpZiAoa2V5ID09PSBtb2RlbElkKSB7XG4gICAgICB0eXBlID0gRmllbGRUeXBlLklEO1xuICAgIH0gZWxzZSBpZiAoa2V5ID09PSBtb2RlbFR5cGUpIHtcbiAgICAgIHR5cGUgPSBGaWVsZFR5cGUuVFlQRTtcbiAgICB9XG5cbiAgICB1cGRhdGVGaWVsZCh0aGlzLCBrZXksIHZhbHVlLCB0eXBlKTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBwdWJsaWMgYXNzaWduUmVmKGtleTogc3RyaW5nLCB2YWx1ZTogYW55LCB0eXBlPzogSVR5cGUpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5hc3NpZ25SZWYgaXMgZGVwcmVjYXRlZC4gVXNlIGluaXRNb2RlbFJlZigpIGluc3RlYWQuJyk7XG4gICAgY29uc3QgcmVmcyA9IGdldE1vZGVsTWV0YUtleSh0aGlzLCAncmVmcycpO1xuXG4gICAgaWYgKHJlZnNba2V5XSkge1xuICAgICAgcmV0dXJuIHRoaXNba2V5XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGxldCBtb2RlbCA9IHR5cGU7XG4gICAgaWYgKCFtb2RlbCkge1xuICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkgfHwgaXNPYnNlcnZhYmxlQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIG1vZGVsID0gdmFsdWUucmVkdWNlKCh0LCBtKSA9PiB0IHx8IGdldE1vZGVsVHlwZShtKSwgbnVsbCk7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgUHVyZU1vZGVsKSB7XG4gICAgICAgIG1vZGVsID0gZ2V0TW9kZWxUeXBlKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIW1vZGVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSB0eXBlIHByb3BlcnR5IGlzIG1pc3NpbmcnKTtcbiAgICB9XG5cbiAgICBpbml0TW9kZWxSZWYodGhpcywga2V5LCB7XG4gICAgICBtb2RlbCxcbiAgICAgIHR5cGU6IFJlZmVyZW5jZVR5cGUuVE9fT05FX09SX01BTlksXG4gICAgfSwgdmFsdWUpO1xuICAgIHJldHVybiB0aGlzW2tleV07XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlKGRhdGE6IFB1cmVNb2RlbCB8IElEaWN0aW9uYXJ5PGFueT4pOiBvYmplY3Qge1xuICAgIGRlcHJlY2F0ZWQoJ21vZGVsLnVwZGF0ZSBpcyBkZXByZWNhdGVkLiBVc2UgdXBkYXRlTW9kZWwoKSBpbnN0ZWFkLicpO1xuICAgIGNvbnN0IHVwZGF0ZURhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhKTtcbiAgICBPYmplY3Qua2V5cyh1cGRhdGVEYXRhKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgdGhpc1trZXldID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGRlbGV0ZSB1cGRhdGVEYXRhW2tleV07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZU1vZGVsKHRoaXMsIHVwZGF0ZURhdGEpO1xuICB9XG5cbiAgcHVibGljIGdldCBzdGF0aWMoKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwuc3RhdGljIGlzIGRlcHJlY2F0ZWQuJyk7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IgYXMgdHlwZW9mIENvbXBhdE1vZGVsO1xuICB9XG5cbiAgcHVibGljIHRvSlMoKSB7XG4gICAgZGVwcmVjYXRlZCgnbW9kZWwudG9KUygpIGlzIGRlcHJlY2F0ZWQuIFVzZSBtb2RlbFRvSlNPTigpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIG1vZGVsVG9KU09OKHRoaXMpO1xuICB9XG5cbiAgcHVibGljIGdldCBzbmFwc2hvdCgpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5zbmFwc2hvdCBpcyBkZXByZWNhdGVkLiBVc2UgbW9kZWxUb0pTT04oKSBpbnN0ZWFkLicpO1xuICAgIHJldHVybiBtb2RlbFRvSlNPTih0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IF9fY29sbGVjdGlvbigpIHtcbiAgICBkZXByZWNhdGVkKCdtb2RlbC5fX2NvbGxlY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIGdldE1vZGVsQ29sbGVjdGlvbigpIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIGdldE1vZGVsQ29sbGVjdGlvbih0aGlzKTtcbiAgfVxufVxuIl19","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx/CompatModel.d.ts","text":"import { IDictionary, IRawModel } from 'datx-utils';\r\nimport { Collection } from './Collection';\r\nimport { IReferences } from './interfaces/IReferences';\r\nimport { IType } from './interfaces/IType';\r\nimport { PureModel } from './PureModel';\r\nexport declare class CompatModel extends PureModel {\r\n    static refs: IReferences;\r\n    static defaults: IDictionary<any>;\r\n    constructor(initialData: object, collection?: Collection);\r\n    getRecordId(): IType;\r\n    getRecordType(): IType;\r\n    assign(key: string, value: any): any;\r\n    assignRef(key: string, value: any, type?: IType): any;\r\n    update(data: PureModel | IDictionary<any>): object;\r\n    readonly static: typeof CompatModel;\r\n    toJS(): IRawModel;\r\n    readonly snapshot: IRawModel;\r\n    private readonly __collection;\r\n}\r\n"}}
