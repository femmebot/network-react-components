{"code":"import * as tslib_1 from \"tslib\";\r\nimport { setModelMetaKey } from 'datx';\r\nimport { getCache, saveCache } from './cache';\r\nimport { MODEL_PERSISTED_FIELD, MODEL_PROP_FIELD, MODEL_QUEUE_FIELD, MODEL_RELATED_FIELD } from './consts';\r\nimport { ParamArrayType } from './enums/ParamArrayType';\r\nimport { isBrowser } from './helpers/utils';\r\nimport { Response as LibResponse } from './Response';\r\nexport var config = {\r\n    /** Base URL for all API calls */\r\n    baseUrl: '/',\r\n    /** Enable caching by default in the browser */\r\n    cache: isBrowser,\r\n    /** Default options that will be passed to the fetch function */\r\n    defaultFetchOptions: {\r\n        headers: {\r\n            'content-type': 'application/vnd.api+json',\r\n        },\r\n    },\r\n    /** Reference of the fetch method that should be used */\r\n    fetchReference: isBrowser && 'fetch' in window && window.fetch.bind(window),\r\n    /** Determines how will the request param arrays be stringified */\r\n    paramArrayType: ParamArrayType.COMMA_SEPARATED,\r\n    /**\r\n     * Base implementation of the fetch function (can be overridden)\r\n     *\r\n     * @param {string} method API call method\r\n     * @param {string} url API call URL\r\n     * @param {object} [body] API call body\r\n     * @param {IHeaders} [requestHeaders] Headers that will be sent\r\n     * @returns {Promise<IRawResponse>} Resolves with a raw response object\r\n     */\r\n    baseFetch: function (method, url, body, requestHeaders) {\r\n        var _this = this;\r\n        var data;\r\n        var status;\r\n        var headers;\r\n        var request = Promise.resolve();\r\n        var uppercaseMethod = method.toUpperCase();\r\n        var isBodySupported = uppercaseMethod !== 'GET' && uppercaseMethod !== 'HEAD';\r\n        return request\r\n            .then(function () {\r\n            var defaultHeaders = config.defaultFetchOptions.headers || {};\r\n            var reqHeaders = Object.assign({}, defaultHeaders, requestHeaders);\r\n            var options = Object.assign({}, config.defaultFetchOptions, {\r\n                body: isBodySupported && JSON.stringify(body) || undefined,\r\n                headers: reqHeaders,\r\n                method: method,\r\n            });\r\n            return _this.fetchReference(url, options);\r\n        })\r\n            .then(function (response) {\r\n            status = response.status;\r\n            headers = response.headers;\r\n            return response.json();\r\n        })\r\n            .catch(function (error) {\r\n            if (status === 204) {\r\n                return null;\r\n            }\r\n            throw error;\r\n        })\r\n            .then(function (responseData) {\r\n            data = responseData;\r\n            if (status >= 400) {\r\n                throw {\r\n                    message: \"Invalid HTTP status: \" + status,\r\n                    status: status,\r\n                };\r\n            }\r\n            return { data: data, headers: headers, requestHeaders: requestHeaders, status: status };\r\n        })\r\n            .catch(function (error) {\r\n            return _this.onError({ data: data, error: error, headers: headers, requestHeaders: requestHeaders, status: status });\r\n        });\r\n    },\r\n    onError: function (resp) {\r\n        return resp;\r\n    },\r\n    transformRequest: function (options) {\r\n        return options;\r\n    },\r\n    transformResponse: function (response) {\r\n        return response;\r\n    },\r\n};\r\n/**\r\n * Base implementation of the stateful fetch function (can be overridden)\r\n *\r\n * @param {ICollectionFetchOpts} reqOptions API request options\r\n * @returns {Promise<Response>} Resolves with a response object\r\n */\r\nfunction collectionFetch(reqOptions) {\r\n    var _a = config.transformRequest(reqOptions), url = _a.url, options = _a.options, data = _a.data, _b = _a.method, method = _b === void 0 ? 'GET' : _b, collection = _a.collection;\r\n    var staticCollection = collection && collection.constructor;\r\n    var collectionCache = staticCollection && staticCollection.cache;\r\n    var isCacheSupported = method.toUpperCase() === 'GET';\r\n    var skipCache = reqOptions.options && reqOptions.options.skipCache;\r\n    if (config.cache && isCacheSupported && collectionCache && !skipCache) {\r\n        var cache = getCache(url);\r\n        if (cache) {\r\n            return Promise.resolve(cache.response);\r\n        }\r\n    }\r\n    return config.baseFetch(method, url, data, options && options.headers)\r\n        .then(function (response) {\r\n        var collectionResponse = Object.assign(response, { collection: collection });\r\n        var resp = new LibResponse(config.transformResponse(collectionResponse), collection, options);\r\n        if (config.cache && isCacheSupported) {\r\n            saveCache(url, resp);\r\n        }\r\n        return resp;\r\n    });\r\n}\r\nexport function fetch(options) {\r\n    return collectionFetch(options);\r\n}\r\n/**\r\n * API call used to get data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function read(url, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: undefined,\r\n        method: 'GET',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * API call used to create data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function create(url, data, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: data,\r\n        method: 'POST',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * API call used to update data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function update(url, data, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: data,\r\n        method: 'PATCH',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * API call used to remove data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function remove(url, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: undefined,\r\n        method: 'DELETE',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * Fetch a link from the server\r\n *\r\n * @export\r\n * @param {JsonApi.ILink} link Link URL or a link object\r\n * @param {IJsonapiCollection} collection Store that will be used to save the response\r\n * @param {IDictionary<string>} [requestHeaders] Request headers\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<LibResponse>} Response promise\r\n */\r\nexport function fetchLink(link, collection, requestHeaders, options) {\r\n    if (link) {\r\n        var href = typeof link === 'object' ? link.href : link;\r\n        if (href) {\r\n            return read(href, collection, requestHeaders, options);\r\n        }\r\n    }\r\n    return Promise.resolve(new LibResponse({ data: undefined }, collection));\r\n}\r\nexport function handleResponse(record, prop) {\r\n    return function (response) {\r\n        if (response.error) {\r\n            throw response.error;\r\n        }\r\n        if (response.status === 204) {\r\n            setModelMetaKey(record, MODEL_PERSISTED_FIELD, true);\r\n            return record;\r\n        }\r\n        else if (response.status === 202) {\r\n            var responseRecord = response.data;\r\n            setModelMetaKey(responseRecord, MODEL_PROP_FIELD, prop);\r\n            setModelMetaKey(responseRecord, MODEL_QUEUE_FIELD, true);\r\n            setModelMetaKey(responseRecord, MODEL_RELATED_FIELD, record);\r\n            return responseRecord;\r\n        }\r\n        else {\r\n            setModelMetaKey(record, MODEL_PERSISTED_FIELD, true);\r\n            return response.replaceData(record).data;\r\n        }\r\n    };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV0d29ya1V0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3JjL05ldHdvcmtVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUlyQyxPQUFPLEVBQUMsUUFBUSxFQUFFLFNBQVMsRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUM1QyxPQUFPLEVBQUMscUJBQXFCLEVBQUUsZ0JBQWdCLEVBQUUsaUJBQWlCLEVBQUUsbUJBQW1CLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDekcsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ3RELE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQVExQyxPQUFPLEVBQUMsUUFBUSxJQUFJLFdBQVcsRUFBQyxNQUFNLFlBQVksQ0FBQztBQTBDbkQsTUFBTSxDQUFDLElBQU0sTUFBTSxHQUFnQjtJQUVqQyxpQ0FBaUM7SUFDakMsT0FBTyxFQUFFLEdBQUc7SUFFWiwrQ0FBK0M7SUFDL0MsS0FBSyxFQUFFLFNBQVM7SUFFaEIsZ0VBQWdFO0lBQ2hFLG1CQUFtQixFQUFFO1FBQ25CLE9BQU8sRUFBRTtZQUNQLGNBQWMsRUFBRSwwQkFBMEI7U0FDM0M7S0FDRjtJQUVELHdEQUF3RDtJQUN4RCxjQUFjLEVBQUUsU0FBUyxJQUFJLE9BQU8sSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRTNFLGtFQUFrRTtJQUNsRSxjQUFjLEVBQUUsY0FBYyxDQUFDLGVBQWU7SUFFOUM7Ozs7Ozs7O09BUUc7SUFDSCxTQUFTLEVBQVQsVUFDRSxNQUFjLEVBQ2QsR0FBVyxFQUNYLElBQWEsRUFDYixjQUF5QjtRQUozQixpQkFtREM7UUE3Q0MsSUFBSSxJQUFlLENBQUM7UUFDcEIsSUFBSSxNQUFjLENBQUM7UUFDbkIsSUFBSSxPQUF5QixDQUFDO1FBRTlCLElB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SCxDQUFDLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtzZXRNb2RlbE1ldGFLZXl9IGZyb20gJ2RhdHgnO1xuaW1wb3J0IHtJRGljdGlvbmFyeX0gZnJvbSAnZGF0eC11dGlscyc7XG5pbXBvcnQge2ZldGNoLCBSZXNwb25zZX0gZnJvbSAnaXNvbW9ycGhpYy1mZXRjaCc7XG5cbmltcG9ydCB7Z2V0Q2FjaGUsIHNhdmVDYWNoZX0gZnJvbSAnLi9jYWNoZSc7XG5pbXBvcnQge01PREVMX1BFUlNJU1RFRF9GSUVMRCwgTU9ERUxfUFJPUF9GSUVMRCwgTU9ERUxfUVVFVUVfRklFTEQsIE1PREVMX1JFTEFURURfRklFTER9IGZyb20gJy4vY29uc3RzJztcbmltcG9ydCB7UGFyYW1BcnJheVR5cGV9IGZyb20gJy4vZW51bXMvUGFyYW1BcnJheVR5cGUnO1xuaW1wb3J0IHtpc0Jyb3dzZXJ9IGZyb20gJy4vaGVscGVycy91dGlscyc7XG5pbXBvcnQge0lIZWFkZXJzfSBmcm9tICcuL2ludGVyZmFjZXMvSUhlYWRlcnMnO1xuaW1wb3J0IHtJSnNvbmFwaUNvbGxlY3Rpb259IGZyb20gJy4vaW50ZXJmYWNlcy9JSnNvbmFwaUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtJSnNvbmFwaU1vZGVsfSBmcm9tICcuL2ludGVyZmFjZXMvSUpzb25hcGlNb2RlbCc7XG5pbXBvcnQge0lSYXdSZXNwb25zZX0gZnJvbSAnLi9pbnRlcmZhY2VzL0lSYXdSZXNwb25zZSc7XG5pbXBvcnQge0lSZXF1ZXN0T3B0aW9uc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSZXF1ZXN0T3B0aW9ucyc7XG5pbXBvcnQge0lSZXNwb25zZUhlYWRlcnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmVzcG9uc2VIZWFkZXJzJztcbmltcG9ydCB7SUxpbmssIElSZXNwb25zZX0gZnJvbSAnLi9pbnRlcmZhY2VzL0pzb25BcGknO1xuaW1wb3J0IHtSZXNwb25zZSBhcyBMaWJSZXNwb25zZX0gZnJvbSAnLi9SZXNwb25zZSc7XG5cbmRlY2xhcmUgdmFyIHdpbmRvdzoge2ZldGNoPzogZmV0Y2h9O1xuXG5leHBvcnQgdHlwZSBGZXRjaFR5cGUgPSAoXG4gIG1ldGhvZDogc3RyaW5nLFxuICB1cmw6IHN0cmluZyxcbiAgYm9keT86IG9iamVjdCxcbiAgcmVxdWVzdEhlYWRlcnM/OiBJSGVhZGVycyxcbikgPT4gUHJvbWlzZTxJUmF3UmVzcG9uc2U+O1xuXG5leHBvcnQgaW50ZXJmYWNlIElDb2xsZWN0aW9uRmV0Y2hPcHRzIHtcbiAgdXJsOiBzdHJpbmc7XG4gIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMme2hlYWRlcnM/OiBJSGVhZGVyc307XG4gIGRhdGE/OiBvYmplY3Q7XG4gIG1ldGhvZDogc3RyaW5nO1xuICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uO1xuICBza2lwQ2FjaGU/OiBib29sZWFuO1xufVxuXG5leHBvcnQgdHlwZSBDb2xsZWN0aW9uRmV0Y2hUeXBlID0gPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsPihvcHRpb25zOiBJQ29sbGVjdGlvbkZldGNoT3B0cykgPT4gUHJvbWlzZTxMaWJSZXNwb25zZTxUPj47XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJlc3BvbnNlT2JqZWN0IHtcbiAgZGF0YTogSVJlc3BvbnNlO1xuICBlcnJvcj86IEVycm9yO1xuICBoZWFkZXJzOiBJUmVzcG9uc2VIZWFkZXJzO1xuICByZXF1ZXN0SGVhZGVyczogSUhlYWRlcnM7XG4gIHN0YXR1czogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElDb25maWdUeXBlIHtcbiAgYmFzZUZldGNoOiBGZXRjaFR5cGU7XG4gIGJhc2VVcmw6IHN0cmluZztcbiAgY2FjaGU6IGJvb2xlYW4sXG4gIGRlZmF1bHRGZXRjaE9wdGlvbnM6IElEaWN0aW9uYXJ5PGFueT47XG4gIGZldGNoUmVmZXJlbmNlOiBmZXRjaDtcbiAgcGFyYW1BcnJheVR5cGU6IFBhcmFtQXJyYXlUeXBlO1xuICBvbkVycm9yOiAoSVJlc3BvbnNlT2JqZWN0KSA9PiBJUmVzcG9uc2VPYmplY3Q7XG4gIHRyYW5zZm9ybVJlcXVlc3Q6IChvcHRpb25zOiBJQ29sbGVjdGlvbkZldGNoT3B0cykgPT4gSUNvbGxlY3Rpb25GZXRjaE9wdHM7XG4gIHRyYW5zZm9ybVJlc3BvbnNlOiAocmVzcG9uc2U6IElSYXdSZXNwb25zZSkgPT4gSVJhd1Jlc3BvbnNlO1xufVxuXG5leHBvcnQgY29uc3QgY29uZmlnOiBJQ29uZmlnVHlwZSA9IHtcblxuICAvKiogQmFzZSBVUkwgZm9yIGFsbCBBUEkgY2FsbHMgKi9cbiAgYmFzZVVybDogJy8nLFxuXG4gIC8qKiBFbmFibGUgY2FjaGluZyBieSBkZWZhdWx0IGluIHRoZSBicm93c2VyICovXG4gIGNhY2hlOiBpc0Jyb3dzZXIsXG5cbiAgLyoqIERlZmF1bHQgb3B0aW9ucyB0aGF0IHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBmZXRjaCBmdW5jdGlvbiAqL1xuICBkZWZhdWx0RmV0Y2hPcHRpb25zOiB7XG4gICAgaGVhZGVyczoge1xuICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi92bmQuYXBpK2pzb24nLFxuICAgIH0sXG4gIH0sXG5cbiAgLyoqIFJlZmVyZW5jZSBvZiB0aGUgZmV0Y2ggbWV0aG9kIHRoYXQgc2hvdWxkIGJlIHVzZWQgKi9cbiAgZmV0Y2hSZWZlcmVuY2U6IGlzQnJvd3NlciAmJiAnZmV0Y2gnIGluIHdpbmRvdyAmJiB3aW5kb3cuZmV0Y2guYmluZCh3aW5kb3cpLFxuXG4gIC8qKiBEZXRlcm1pbmVzIGhvdyB3aWxsIHRoZSByZXF1ZXN0IHBhcmFtIGFycmF5cyBiZSBzdHJpbmdpZmllZCAqL1xuICBwYXJhbUFycmF5VHlwZTogUGFyYW1BcnJheVR5cGUuQ09NTUFfU0VQQVJBVEVELCAvLyBBcyByZWNvbW1lbmRlZCBieSB0aGUgc3BlY1xuXG4gIC8qKlxuICAgKiBCYXNlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBmZXRjaCBmdW5jdGlvbiAoY2FuIGJlIG92ZXJyaWRkZW4pXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2QgQVBJIGNhbGwgbWV0aG9kXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQVBJIGNhbGwgVVJMXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbYm9keV0gQVBJIGNhbGwgYm9keVxuICAgKiBAcGFyYW0ge0lIZWFkZXJzfSBbcmVxdWVzdEhlYWRlcnNdIEhlYWRlcnMgdGhhdCB3aWxsIGJlIHNlbnRcbiAgICogQHJldHVybnMge1Byb21pc2U8SVJhd1Jlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIHJhdyByZXNwb25zZSBvYmplY3RcbiAgICovXG4gIGJhc2VGZXRjaChcbiAgICBtZXRob2Q6IHN0cmluZyxcbiAgICB1cmw6IHN0cmluZyxcbiAgICBib2R5Pzogb2JqZWN0LFxuICAgIHJlcXVlc3RIZWFkZXJzPzogSUhlYWRlcnMsXG4gICk6IFByb21pc2U8SVJhd1Jlc3BvbnNlPiB7XG4gICAgbGV0IGRhdGE6IElSZXNwb25zZTtcbiAgICBsZXQgc3RhdHVzOiBudW1iZXI7XG4gICAgbGV0IGhlYWRlcnM6IElSZXNwb25zZUhlYWRlcnM7XG5cbiAgICBjb25zdCByZXF1ZXN0OiBQcm9taXNlPHZvaWQ+ID0gUHJvbWlzZS5yZXNvbHZlKCk7XG5cbiAgICBjb25zdCB1cHBlcmNhc2VNZXRob2QgPSBtZXRob2QudG9VcHBlckNhc2UoKTtcbiAgICBjb25zdCBpc0JvZHlTdXBwb3J0ZWQgPSB1cHBlcmNhc2VNZXRob2QgIT09ICdHRVQnICYmIHVwcGVyY2FzZU1ldGhvZCAhPT0gJ0hFQUQnO1xuXG4gICAgcmV0dXJuIHJlcXVlc3RcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY29uc3QgZGVmYXVsdEhlYWRlcnMgPSBjb25maWcuZGVmYXVsdEZldGNoT3B0aW9ucy5oZWFkZXJzIHx8IHt9O1xuICAgICAgICBjb25zdCByZXFIZWFkZXJzOiBJSGVhZGVycyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRIZWFkZXJzLCByZXF1ZXN0SGVhZGVycykgYXMgSUhlYWRlcnM7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWcuZGVmYXVsdEZldGNoT3B0aW9ucywge1xuICAgICAgICAgIGJvZHk6IGlzQm9keVN1cHBvcnRlZCAmJiBKU09OLnN0cmluZ2lmeShib2R5KSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgaGVhZGVyczogcmVxSGVhZGVycyxcbiAgICAgICAgICBtZXRob2QsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5mZXRjaFJlZmVyZW5jZSh1cmwsIG9wdGlvbnMpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKChyZXNwb25zZTogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgc3RhdHVzID0gcmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgICBoZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVycztcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yOiBFcnJvcikgPT4ge1xuICAgICAgICBpZiAoc3RhdHVzID09PSAyMDQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH0pXG4gICAgICAudGhlbigocmVzcG9uc2VEYXRhOiBJUmVzcG9uc2UpID0+IHtcbiAgICAgICAgZGF0YSA9IHJlc3BvbnNlRGF0YTtcbiAgICAgICAgaWYgKHN0YXR1cyA+PSA0MDApIHtcbiAgICAgICAgICB0aHJvdyB7XG4gICAgICAgICAgICBtZXNzYWdlOiBgSW52YWxpZCBIVFRQIHN0YXR1czogJHtzdGF0dXN9YCxcbiAgICAgICAgICAgIHN0YXR1cyxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtkYXRhLCBoZWFkZXJzLCByZXF1ZXN0SGVhZGVycywgc3RhdHVzfTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLm9uRXJyb3Ioe2RhdGEsIGVycm9yLCBoZWFkZXJzLCByZXF1ZXN0SGVhZGVycywgc3RhdHVzfSk7XG4gICAgICB9KTtcbiAgfSxcblxuICBvbkVycm9yKHJlc3A6IElSZXNwb25zZU9iamVjdCkge1xuICAgIHJldHVybiByZXNwO1xuICB9LFxuXG4gIHRyYW5zZm9ybVJlcXVlc3Qob3B0aW9uczogSUNvbGxlY3Rpb25GZXRjaE9wdHMpOiBJQ29sbGVjdGlvbkZldGNoT3B0cyB7XG4gICAgcmV0dXJuIG9wdGlvbnM7XG4gIH0sXG5cbiAgdHJhbnNmb3JtUmVzcG9uc2UocmVzcG9uc2U6IElSYXdSZXNwb25zZSk6IElSYXdSZXNwb25zZSB7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9LFxufTtcblxuLyoqXG4gKiBCYXNlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBzdGF0ZWZ1bCBmZXRjaCBmdW5jdGlvbiAoY2FuIGJlIG92ZXJyaWRkZW4pXG4gKlxuICogQHBhcmFtIHtJQ29sbGVjdGlvbkZldGNoT3B0c30gcmVxT3B0aW9ucyBBUEkgcmVxdWVzdCBvcHRpb25zXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59IFJlc29sdmVzIHdpdGggYSByZXNwb25zZSBvYmplY3RcbiAqL1xuZnVuY3Rpb24gY29sbGVjdGlvbkZldGNoPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsPihyZXFPcHRpb25zOiBJQ29sbGVjdGlvbkZldGNoT3B0cyk6IFByb21pc2U8TGliUmVzcG9uc2U8VD4+IHtcbiAgY29uc3Qge1xuICAgIHVybCxcbiAgICBvcHRpb25zLFxuICAgIGRhdGEsXG4gICAgbWV0aG9kID0gJ0dFVCcsXG4gICAgY29sbGVjdGlvbixcbiAgfSA9IGNvbmZpZy50cmFuc2Zvcm1SZXF1ZXN0KHJlcU9wdGlvbnMpO1xuXG4gIGNvbnN0IHN0YXRpY0NvbGxlY3Rpb24gPSBjb2xsZWN0aW9uICYmIGNvbGxlY3Rpb24uY29uc3RydWN0b3IgYXMge2NhY2hlPzogYm9vbGVhbn07XG4gIGNvbnN0IGNvbGxlY3Rpb25DYWNoZSA9IHN0YXRpY0NvbGxlY3Rpb24gJiYgc3RhdGljQ29sbGVjdGlvbi5jYWNoZTtcbiAgY29uc3QgaXNDYWNoZVN1cHBvcnRlZCA9IG1ldGhvZC50b1VwcGVyQ2FzZSgpID09PSAnR0VUJztcbiAgY29uc3Qgc2tpcENhY2hlID0gcmVxT3B0aW9ucy5vcHRpb25zICYmIHJlcU9wdGlvbnMub3B0aW9ucy5za2lwQ2FjaGU7XG5cbiAgaWYgKGNvbmZpZy5jYWNoZSAmJiBpc0NhY2hlU3VwcG9ydGVkICYmIGNvbGxlY3Rpb25DYWNoZSAmJiAhc2tpcENhY2hlKSB7XG4gICAgY29uc3QgY2FjaGUgPSBnZXRDYWNoZSh1cmwpO1xuICAgIGlmIChjYWNoZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjYWNoZS5yZXNwb25zZSkgYXMgUHJvbWlzZTxMaWJSZXNwb25zZTxUPj47XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGNvbmZpZy5iYXNlRmV0Y2gobWV0aG9kLCB1cmwsIGRhdGEsIG9wdGlvbnMgJiYgb3B0aW9ucy5oZWFkZXJzKVxuICAgIC50aGVuKChyZXNwb25zZTogSVJhd1Jlc3BvbnNlKSA9PiB7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uUmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKHJlc3BvbnNlLCB7Y29sbGVjdGlvbn0pO1xuICAgICAgY29uc3QgcmVzcCA9IG5ldyBMaWJSZXNwb25zZTxUPihjb25maWcudHJhbnNmb3JtUmVzcG9uc2UoY29sbGVjdGlvblJlc3BvbnNlKSwgY29sbGVjdGlvbiwgb3B0aW9ucyk7XG4gICAgICBpZiAoY29uZmlnLmNhY2hlICYmIGlzQ2FjaGVTdXBwb3J0ZWQpIHtcbiAgICAgICAgc2F2ZUNhY2hlKHVybCwgcmVzcCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzcDtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZldGNoPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4ob3B0aW9uczogSUNvbGxlY3Rpb25GZXRjaE9wdHMpIHtcbiAgcmV0dXJuIGNvbGxlY3Rpb25GZXRjaDxUPihvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBBUEkgY2FsbCB1c2VkIHRvIGdldCBkYXRhIGZyb20gdGhlIHNlcnZlclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7SUpzb25hcGlDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIFJlbGF0ZWQgY29sbGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBBUEkgY2FsbCBVUkxcbiAqIEBwYXJhbSB7SUhlYWRlcnN9IFtoZWFkZXJzXSBIZWFkZXJzIHRvIGJlIHNlbnRcbiAqIEBwYXJhbSB7SVJlcXVlc3RPcHRpb25zfSBbb3B0aW9uc10gU2VydmVyIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIFJlc3BvbnNlIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZDxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICB1cmw6IHN0cmluZyxcbiAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgaGVhZGVycz86IElIZWFkZXJzLFxuICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICByZXR1cm4gY29sbGVjdGlvbkZldGNoPFQ+KHtcbiAgICBjb2xsZWN0aW9uLFxuICAgIGRhdGE6IHVuZGVmaW5lZCxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIG9wdGlvbnM6IHsuLi5vcHRpb25zLCBoZWFkZXJzfSxcbiAgICB1cmwsXG4gIH0pO1xufVxuXG4vKipcbiAqIEFQSSBjYWxsIHVzZWQgdG8gY3JlYXRlIGRhdGEgb24gdGhlIHNlcnZlclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7SUpzb25hcGlDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIFJlbGF0ZWQgY29sbGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBBUEkgY2FsbCBVUkxcbiAqIEBwYXJhbSB7b2JqZWN0fSBbZGF0YV0gUmVxdWVzdCBib2R5XG4gKiBAcGFyYW0ge0lIZWFkZXJzfSBbaGVhZGVyc10gSGVhZGVycyB0byBiZSBzZW50XG4gKiBAcGFyYW0ge0lSZXF1ZXN0T3B0aW9uc30gW29wdGlvbnNdIFNlcnZlciBvcHRpb25zXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59IFJlc29sdmVzIHdpdGggYSBSZXNwb25zZSBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZTxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICB1cmw6IHN0cmluZyxcbiAgZGF0YT86IG9iamVjdCxcbiAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgaGVhZGVycz86IElIZWFkZXJzLFxuICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICByZXR1cm4gY29sbGVjdGlvbkZldGNoPFQ+KHtcbiAgICBjb2xsZWN0aW9uLFxuICAgIGRhdGEsXG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgb3B0aW9uczogey4uLm9wdGlvbnMsIGhlYWRlcnN9LFxuICAgIHVybCxcbiAgfSk7XG59XG5cbi8qKlxuICogQVBJIGNhbGwgdXNlZCB0byB1cGRhdGUgZGF0YSBvbiB0aGUgc2VydmVyXG4gKlxuICogQGV4cG9ydFxuICogQHBhcmFtIHtJSnNvbmFwaUNvbGxlY3Rpb259IGNvbGxlY3Rpb24gUmVsYXRlZCBjb2xsZWN0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIEFQSSBjYWxsIFVSTFxuICogQHBhcmFtIHtvYmplY3R9IFtkYXRhXSBSZXF1ZXN0IGJvZHlcbiAqIEBwYXJhbSB7SUhlYWRlcnN9IFtoZWFkZXJzXSBIZWFkZXJzIHRvIGJlIHNlbnRcbiAqIEBwYXJhbSB7SVJlcXVlc3RPcHRpb25zfSBbb3B0aW9uc10gU2VydmVyIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIFJlc3BvbnNlIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gIHVybDogc3RyaW5nLFxuICBkYXRhPzogb2JqZWN0LFxuICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uLFxuICBoZWFkZXJzPzogSUhlYWRlcnMsXG4gIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4pOiBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PiB7XG4gIHJldHVybiBjb2xsZWN0aW9uRmV0Y2g8VD4oe1xuICAgIGNvbGxlY3Rpb24sXG4gICAgZGF0YSxcbiAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgb3B0aW9uczogey4uLm9wdGlvbnMsIGhlYWRlcnN9LFxuICAgIHVybCxcbiAgfSk7XG59XG5cbi8qKlxuICogQVBJIGNhbGwgdXNlZCB0byByZW1vdmUgZGF0YSBmcm9tIHRoZSBzZXJ2ZXJcbiAqXG4gKiBAZXhwb3J0XG4gKiBAcGFyYW0ge0lKc29uYXBpQ29sbGVjdGlvbn0gY29sbGVjdGlvbiBSZWxhdGVkIGNvbGxlY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQVBJIGNhbGwgVVJMXG4gKiBAcGFyYW0ge0lIZWFkZXJzfSBbaGVhZGVyc10gSGVhZGVycyB0byBiZSBzZW50XG4gKiBAcGFyYW0ge0lSZXF1ZXN0T3B0aW9uc30gW29wdGlvbnNdIFNlcnZlciBvcHRpb25zXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59IFJlc29sdmVzIHdpdGggYSBSZXNwb25zZSBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZTxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICB1cmw6IHN0cmluZyxcbiAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgaGVhZGVycz86IElIZWFkZXJzLFxuICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICByZXR1cm4gY29sbGVjdGlvbkZldGNoPFQ+KHtcbiAgICBjb2xsZWN0aW9uLFxuICAgIGRhdGE6IHVuZGVmaW5lZCxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIG9wdGlvbnM6IHsuLi5vcHRpb25zLCBoZWFkZXJzfSxcbiAgICB1cmwsXG4gIH0pO1xufVxuXG4vKipcbiAqIEZldGNoIGEgbGluayBmcm9tIHRoZSBzZXJ2ZXJcbiAqXG4gKiBAZXhwb3J0XG4gKiBAcGFyYW0ge0pzb25BcGkuSUxpbmt9IGxpbmsgTGluayBVUkwgb3IgYSBsaW5rIG9iamVjdFxuICogQHBhcmFtIHtJSnNvbmFwaUNvbGxlY3Rpb259IGNvbGxlY3Rpb24gU3RvcmUgdGhhdCB3aWxsIGJlIHVzZWQgdG8gc2F2ZSB0aGUgcmVzcG9uc2VcbiAqIEBwYXJhbSB7SURpY3Rpb25hcnk8c3RyaW5nPn0gW3JlcXVlc3RIZWFkZXJzXSBSZXF1ZXN0IGhlYWRlcnNcbiAqIEBwYXJhbSB7SVJlcXVlc3RPcHRpb25zfSBbb3B0aW9uc10gU2VydmVyIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPExpYlJlc3BvbnNlPn0gUmVzcG9uc2UgcHJvbWlzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZmV0Y2hMaW5rPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gIGxpbms6IElMaW5rLFxuICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uLFxuICByZXF1ZXN0SGVhZGVycz86IElEaWN0aW9uYXJ5PHN0cmluZz4sXG4gIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4pOiBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PiB7XG4gIGlmIChsaW5rKSB7XG4gICAgY29uc3QgaHJlZjogc3RyaW5nID0gdHlwZW9mIGxpbmsgPT09ICdvYmplY3QnID8gbGluay5ocmVmIDogbGluaztcblxuICAgIGlmIChocmVmKSB7XG4gICAgICByZXR1cm4gcmVhZDxUPihocmVmLCBjb2xsZWN0aW9uLCByZXF1ZXN0SGVhZGVycywgb3B0aW9ucyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IExpYlJlc3BvbnNlKHtkYXRhOiB1bmRlZmluZWR9LCBjb2xsZWN0aW9uKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZTxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICByZWNvcmQ6IFQsXG4gIHByb3A/OiBzdHJpbmcsXG4pOiAocmVzcG9uc2U6IExpYlJlc3BvbnNlPFQ+KSA9PiBUIHtcbiAgcmV0dXJuIChyZXNwb25zZTogTGliUmVzcG9uc2U8VD4pOiBUID0+IHtcblxuICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xuICAgICAgdGhyb3cgcmVzcG9uc2UuZXJyb3I7XG4gICAgfVxuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjA0KSB7XG4gICAgICBzZXRNb2RlbE1ldGFLZXkocmVjb3JkLCBNT0RFTF9QRVJTSVNURURfRklFTEQsIHRydWUpO1xuICAgICAgcmV0dXJuIHJlY29yZCBhcyBUO1xuICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDIpIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlUmVjb3JkID0gcmVzcG9uc2UuZGF0YSBhcyBUO1xuICAgICAgc2V0TW9kZWxNZXRhS2V5KHJlc3BvbnNlUmVjb3JkLCBNT0RFTF9QUk9QX0ZJRUxELCBwcm9wKTtcbiAgICAgIHNldE1vZGVsTWV0YUtleShyZXNwb25zZVJlY29yZCwgTU9ERUxfUVVFVUVfRklFTEQsIHRydWUpO1xuICAgICAgc2V0TW9kZWxNZXRhS2V5KHJlc3BvbnNlUmVjb3JkLCBNT0RFTF9SRUxBVEVEX0ZJRUxELCByZWNvcmQpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlUmVjb3JkO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXRNb2RlbE1ldGFLZXkocmVjb3JkLCBNT0RFTF9QRVJTSVNURURfRklFTEQsIHRydWUpO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnJlcGxhY2VEYXRhKHJlY29yZCkuZGF0YSBhcyBUO1xuICAgIH1cbiAgfTtcbn1cbiJdfQ==","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/NetworkUtils.d.ts","text":"import { IDictionary } from 'datx-utils';\r\nimport { fetch } from 'isomorphic-fetch';\r\nimport { ParamArrayType } from './enums/ParamArrayType';\r\nimport { IHeaders } from './interfaces/IHeaders';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nimport { IJsonapiModel } from './interfaces/IJsonapiModel';\r\nimport { IRawResponse } from './interfaces/IRawResponse';\r\nimport { IRequestOptions } from './interfaces/IRequestOptions';\r\nimport { IResponseHeaders } from './interfaces/IResponseHeaders';\r\nimport { ILink, IResponse } from './interfaces/JsonApi';\r\nimport { Response as LibResponse } from './Response';\r\nexport declare type FetchType = (method: string, url: string, body?: object, requestHeaders?: IHeaders) => Promise<IRawResponse>;\r\nexport interface ICollectionFetchOpts {\r\n    url: string;\r\n    options?: IRequestOptions & {\r\n        headers?: IHeaders;\r\n    };\r\n    data?: object;\r\n    method: string;\r\n    collection?: IJsonapiCollection;\r\n    skipCache?: boolean;\r\n}\r\nexport declare type CollectionFetchType = <T extends IJsonapiModel>(options: ICollectionFetchOpts) => Promise<LibResponse<T>>;\r\nexport interface IResponseObject {\r\n    data: IResponse;\r\n    error?: Error;\r\n    headers: IResponseHeaders;\r\n    requestHeaders: IHeaders;\r\n    status: number;\r\n}\r\nexport interface IConfigType {\r\n    baseFetch: FetchType;\r\n    baseUrl: string;\r\n    cache: boolean;\r\n    defaultFetchOptions: IDictionary<any>;\r\n    fetchReference: fetch;\r\n    paramArrayType: ParamArrayType;\r\n    onError: (IResponseObject) => IResponseObject;\r\n    transformRequest: (options: ICollectionFetchOpts) => ICollectionFetchOpts;\r\n    transformResponse: (response: IRawResponse) => IRawResponse;\r\n}\r\nexport declare const config: IConfigType;\r\nexport declare function fetch<T extends IJsonapiModel = IJsonapiModel>(options: ICollectionFetchOpts): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to get data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function read<T extends IJsonapiModel = IJsonapiModel>(url: string, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to create data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function create<T extends IJsonapiModel = IJsonapiModel>(url: string, data?: object, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to update data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function update<T extends IJsonapiModel = IJsonapiModel>(url: string, data?: object, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to remove data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function remove<T extends IJsonapiModel = IJsonapiModel>(url: string, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * Fetch a link from the server\r\n *\r\n * @export\r\n * @param {JsonApi.ILink} link Link URL or a link object\r\n * @param {IJsonapiCollection} collection Store that will be used to save the response\r\n * @param {IDictionary<string>} [requestHeaders] Request headers\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<LibResponse>} Response promise\r\n */\r\nexport declare function fetchLink<T extends IJsonapiModel = IJsonapiModel>(link: ILink, collection?: IJsonapiCollection, requestHeaders?: IDictionary<string>, options?: IRequestOptions): Promise<LibResponse<T>>;\r\nexport declare function handleResponse<T extends IJsonapiModel = IJsonapiModel>(record: T, prop?: string): (response: LibResponse<T>) => T;\r\n"}}
