{"code":"import * as tslib_1 from \"tslib\";\r\nimport { getModelType, initModelRef, ReferenceType, updateModel, } from 'datx';\r\nimport { mapItems } from 'datx-utils';\r\nimport { clearAllCache, clearCacheByType } from './cache';\r\nimport { URL_REGEX } from './consts';\r\nimport { ParamArrayType } from './enums/ParamArrayType';\r\nimport { GenericModel } from './GenericModel';\r\nimport { flattenModel, removeModel } from './helpers/model';\r\nimport { getValue } from './helpers/utils';\r\nimport { config, fetch, read } from './NetworkUtils';\r\nexport function decorateCollection(BaseClass) {\r\n    var JsonapiCollection = /** @class */ (function (_super) {\r\n        tslib_1.__extends(JsonapiCollection, _super);\r\n        function JsonapiCollection() {\r\n            return _super !== null && _super.apply(this, arguments) || this;\r\n        }\r\n        JsonapiCollection.prototype.sync = function (body) {\r\n            var _this = this;\r\n            if (!body) {\r\n                return null;\r\n            }\r\n            var data = this.__iterateEntries(body, function (obj) { return _this.__addRecord(obj); });\r\n            this.__iterateEntries(body, this.__updateRelationships.bind(this));\r\n            return data;\r\n        };\r\n        /**\r\n         * Fetch the records with the given type and id\r\n         *\r\n         * @param {string} type Record type\r\n         * @param {number|string} type Record id\r\n         * @param {IRequestOptions} [options] Server options\r\n         * @returns {Promise<Response>} Resolves with the Response object or rejects with an error\r\n         */\r\n        JsonapiCollection.prototype.fetch = function (type, id, options) {\r\n            var _this = this;\r\n            var modelType = getModelType(type);\r\n            var query = this.__prepareQuery(modelType, id, undefined, options);\r\n            return read(query.url, this, query.headers, options)\r\n                .then(function (res) { return _this.__handleErrors(res); });\r\n        };\r\n        /**\r\n         * Fetch the first page of records of the given type\r\n         *\r\n         * @param {string} type Record type\r\n         * @param {IRequestOptions} [options] Server options\r\n         * @returns {Promise<Response>} Resolves with the Response object or rejects with an error\r\n         */\r\n        JsonapiCollection.prototype.fetchAll = function (type, options) {\r\n            var _this = this;\r\n            var modelType = getModelType(type);\r\n            var query = this.__prepareQuery(modelType, undefined, undefined, options);\r\n            return read(query.url, this, query.headers, options)\r\n                .then(function (res) { return _this.__handleErrors(res); });\r\n        };\r\n        JsonapiCollection.prototype.request = function (url, method, data, options) {\r\n            if (method === void 0) { method = 'GET'; }\r\n            var query = this.__buildUrl(url, data, options);\r\n            return fetch({ url: query.url, options: options, data: data, method: method, collection: this });\r\n        };\r\n        JsonapiCollection.prototype.remove = function (obj, id, remote) {\r\n            var remove = (typeof id === 'boolean' || typeof id === 'object') ? id : remote;\r\n            var modelId = (typeof id !== 'boolean' && typeof id !== 'object') ? id : undefined;\r\n            var type = getModelType(obj);\r\n            var model = this.find(type, modelId);\r\n            if (model && remove) {\r\n                return removeModel(model, typeof remove === 'object' ? remove : undefined);\r\n            }\r\n            if (model) {\r\n                _super.prototype.remove.call(this, model);\r\n            }\r\n            return Promise.resolve();\r\n        };\r\n        JsonapiCollection.prototype.removeAll = function (type) {\r\n            _super.prototype.removeAll.call(this, type);\r\n            clearCacheByType(getModelType(type));\r\n        };\r\n        JsonapiCollection.prototype.reset = function () {\r\n            _super.prototype.reset.call(this);\r\n            clearAllCache();\r\n        };\r\n        /**\r\n         * Function used to handle response errors\r\n         *\r\n         * @private\r\n         * @param {Response} response API response\r\n         * @returns API response\r\n         */\r\n        JsonapiCollection.prototype.__handleErrors = function (response) {\r\n            if (response.error) {\r\n                throw response.error;\r\n            }\r\n            return response;\r\n        };\r\n        JsonapiCollection.prototype.__addRecord = function (obj) {\r\n            var staticCollection = this.constructor;\r\n            var type = obj.type, id = obj.id;\r\n            var record = this.find(type, id);\r\n            var flattened = flattenModel(obj);\r\n            if (record) {\r\n                updateModel(record, flattened);\r\n            }\r\n            else if (staticCollection.types.filter(function (item) { return item.type === type; }).length) {\r\n                record = this.add(flattened, type);\r\n            }\r\n            else {\r\n                record = this.add(new GenericModel(flattened));\r\n            }\r\n            return record;\r\n        };\r\n        JsonapiCollection.prototype.__updateRelationships = function (obj) {\r\n            var _this = this;\r\n            var record = this.find(obj.type, obj.id);\r\n            var refs = obj.relationships ? Object.keys(obj.relationships) : [];\r\n            refs.forEach(function (ref) {\r\n                var items = obj.relationships[ref].data;\r\n                if (items instanceof Array && items.length < 1) {\r\n                    // it's only possible to update items with one ore more refs. Early exit\r\n                    return;\r\n                }\r\n                if (items && record) {\r\n                    var models = mapItems(items, function (def) { return _this.find(def.type, def.id) || def.id; }) || null;\r\n                    var itemType = items instanceof Array ? items[0].type : items.type;\r\n                    if (ref in record) {\r\n                        record[ref] = models;\r\n                    }\r\n                    else {\r\n                        initModelRef(record, ref, { model: itemType, type: ReferenceType.TO_ONE_OR_MANY }, models);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        JsonapiCollection.prototype.__iterateEntries = function (body, fn) {\r\n            mapItems((body && body.included) || [], fn);\r\n            return mapItems((body && body.data) || [], fn);\r\n        };\r\n        JsonapiCollection.prototype.__prepareQuery = function (type, id, data, options) {\r\n            var staticCollection = this.constructor;\r\n            var model = staticCollection.types.filter(function (item) { return item.type === type; })[0];\r\n            var path = model\r\n                ? (getValue(model['endpoint']) || model['baseUrl'] || getModelType(model))\r\n                : type;\r\n            var url = id ? path + \"/\" + id : \"\" + path;\r\n            return this.__buildUrl(url, data, options);\r\n        };\r\n        JsonapiCollection.prototype.__buildUrl = function (url, data, options) {\r\n            var headers = (options && options.headers) || {};\r\n            var params = this.__prepareFilters((options && options.filter) || {}).concat(this.__prepareSort(options && options.sort), this.__prepareIncludes(options && options.include), this.__prepareFields((options && options.fields) || {}), this.__prepareRawParams((options && options.params) || []));\r\n            var baseUrl = this.__appendParams(this.__prefixUrl(url), params);\r\n            return { data: data, headers: headers, url: baseUrl };\r\n        };\r\n        JsonapiCollection.prototype.__prepareFilters = function (filters) {\r\n            return this.__parametrize(filters).map(function (item) { return \"filter[\" + item.key + \"]=\" + item.value; });\r\n        };\r\n        JsonapiCollection.prototype.__prepareSort = function (sort) {\r\n            return sort ? [\"sort=\" + sort] : [];\r\n        };\r\n        JsonapiCollection.prototype.__prepareIncludes = function (include) {\r\n            return include ? [\"include=\" + include] : [];\r\n        };\r\n        JsonapiCollection.prototype.__prepareFields = function (fields) {\r\n            var list = [];\r\n            Object.keys(fields).forEach(function (key) {\r\n                list.push(\"fields[\" + key + \"]=\" + fields[key]);\r\n            });\r\n            return list;\r\n        };\r\n        JsonapiCollection.prototype.__prepareRawParams = function (params) {\r\n            return params.map(function (param) {\r\n                if (typeof param === 'string') {\r\n                    return param;\r\n                }\r\n                return param.key + \"=\" + param.value;\r\n            });\r\n        };\r\n        JsonapiCollection.prototype.__prefixUrl = function (url) {\r\n            if (URL_REGEX.test(url)) {\r\n                return url;\r\n            }\r\n            return \"\" + config.baseUrl + url;\r\n        };\r\n        JsonapiCollection.prototype.__appendParams = function (url, params) {\r\n            if (params.length) {\r\n                var separator = url.indexOf('?') === -1 ? '?' : '&';\r\n                url += separator + params.join('&');\r\n            }\r\n            return url;\r\n        };\r\n        JsonapiCollection.prototype.__parametrize = function (params, scope) {\r\n            var _this = this;\r\n            if (scope === void 0) { scope = ''; }\r\n            var list = [];\r\n            Object.keys(params).forEach(function (key) {\r\n                if (params[key] instanceof Array) {\r\n                    if (config.paramArrayType === ParamArrayType.OBJECT_PATH) {\r\n                        list.push.apply(list, _this.__parametrize(params[key], key + \".\"));\r\n                    }\r\n                    else if (config.paramArrayType === ParamArrayType.COMMA_SEPARATED) {\r\n                        list.push({ key: \"\" + scope + key, value: params[key].join(',') });\r\n                    }\r\n                    else if (config.paramArrayType === ParamArrayType.MULTIPLE_PARAMS) {\r\n                        list.push.apply(list, params[key].map(function (param) { return ({ key: \"\" + scope + key, value: param }); }));\r\n                    }\r\n                    else if (config.paramArrayType === ParamArrayType.PARAM_ARRAY) {\r\n                        list.push.apply(list, params[key].map(function (param) { return ({ key: \"\" + scope + key + \"][\", value: param }); }));\r\n                    }\r\n                }\r\n                else if (typeof params[key] === 'object') {\r\n                    list.push.apply(list, _this.__parametrize(params[key], key + \".\"));\r\n                }\r\n                else {\r\n                    list.push({ key: \"\" + scope + key, value: params[key] });\r\n                }\r\n            });\r\n            return list;\r\n        };\r\n        JsonapiCollection.types = (BaseClass.types && BaseClass.types.length)\r\n            ? BaseClass.types.concat(GenericModel)\r\n            : [GenericModel];\r\n        JsonapiCollection.cache = BaseClass['cache'] === undefined\r\n            ? typeof window !== 'undefined'\r\n            : BaseClass['cache'];\r\n        JsonapiCollection.defaultModel = BaseClass['defaultModel'] || GenericModel;\r\n        return JsonapiCollection;\r\n    }(BaseClass));\r\n    return JsonapiCollection;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdGVDb2xsZWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3JjL2RlY29yYXRlQ29sbGVjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFlBQVksRUFJWixZQUFZLEVBSVosYUFBYSxFQUNiLFdBQVcsR0FDWixNQUFNLE1BQU0sQ0FBQztBQUNkLE9BQU8sRUFBeUIsUUFBUSxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBRTVELE9BQU8sRUFBQyxhQUFhLEVBQUUsZ0JBQWdCLEVBQUMsTUFBTSxTQUFTLENBQUM7QUFDeEQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUNuQyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDdEQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxZQUFZLEVBQUUsV0FBVyxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDMUQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBUXpDLE9BQU8sRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBS25ELE1BQU0sNkJBQTZCLFNBQWdDO0lBRWpFO1FBQWdDLDZDQUFTO1FBQXpDOztRQXlRQSxDQUFDO1FBN1BRLGdDQUFJLEdBQVgsVUFBcUQsSUFBZ0I7WUFBckUsaUJBT0M7WUFOQyxJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUNULE9BQU8sSUFBSSxDQUFDO2FBQ2I7WUFDRCxJQUFNLElBQUksR0FBb0IsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxVQUFDLEdBQVksSUFBSyxPQUFBLEtBQUksQ0FBQyxXQUFXLENBQUksR0FBRyxDQUFDLEVBQXhCLENBQXdCLENBQUMsQ0FBQztZQUN0RyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxx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QVM7WUFDN0QsQ0FBQyxDQUFDLE9BQU8sTUFBTSxLQUFLLFdBQVc7WUFDL0IsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVULDhCQUFZLEdBQUcsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLFlBQVksQ0FBQztRQStQekUsd0JBQUM7S0FBQSxBQXpRRCxDQUFnQyxTQUFTLEdBeVF4QztJQUVELE9BQU8saUJBQWdGLENBQUM7QUFDMUYsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGdldE1vZGVsVHlwZSxcbiAgSUNvbGxlY3Rpb25Db25zdHJ1Y3RvcixcbiAgSUlkZW50aWZpZXIsXG4gIElNb2RlbENvbnN0cnVjdG9yLFxuICBpbml0TW9kZWxSZWYsXG4gIElUeXBlLFxuICBQdXJlQ29sbGVjdGlvbixcbiAgUHVyZU1vZGVsLFxuICBSZWZlcmVuY2VUeXBlLFxuICB1cGRhdGVNb2RlbCxcbn0gZnJvbSAnZGF0eCc7XG5pbXBvcnQge0lEaWN0aW9uYXJ5LCBJUmF3TW9kZWwsIG1hcEl0ZW1zfSBmcm9tICdkYXR4LXV0aWxzJztcblxuaW1wb3J0IHtjbGVhckFsbENhY2hlLCBjbGVhckNhY2hlQnlUeXBlfSBmcm9tICcuL2NhY2hlJztcbmltcG9ydCB7VVJMX1JFR0VYfSBmcm9tICcuL2NvbnN0cyc7XG5pbXBvcnQge1BhcmFtQXJyYXlUeXBlfSBmcm9tICcuL2VudW1zL1BhcmFtQXJyYXlUeXBlJztcbmltcG9ydCB7R2VuZXJpY01vZGVsfSBmcm9tICcuL0dlbmVyaWNNb2RlbCc7XG5pbXBvcnQge2ZsYXR0ZW5Nb2RlbCwgcmVtb3ZlTW9kZWx9IGZyb20gJy4vaGVscGVycy9tb2RlbCc7XG5pbXBvcnQge2dldFZhbHVlfSBmcm9tICcuL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHtJRmlsdGVyc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lGaWx0ZXJzJztcbmltcG9ydCB7SUhlYWRlcnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JSGVhZGVycyc7XG5pbXBvcnQge0lKc29uYXBpQ29sbGVjdGlvbn0gZnJvbSAnLi9pbnRlcmZhY2VzL0lKc29uYXBpQ29sbGVjdGlvbic7XG5pbXBvcnQge0lKc29uYXBpTW9kZWx9IGZyb20gJy4vaW50ZXJmYWNlcy9JSnNvbmFwaU1vZGVsJztcbmltcG9ydCB7SVJlcXVlc3RPcHRpb25zfSBmcm9tICcuL2ludGVyZmFjZXMvSVJlcXVlc3RPcHRpb25zJztcbmltcG9ydCB7SURlZmluaXRpb24sIElSZWxhdGlvbnNoaXAsIElSZXF1ZXN0fSBmcm9tICcuL2ludGVyZmFjZXMvSnNvbkFwaSc7XG5pbXBvcnQge0lSZWNvcmQsIElSZXNwb25zZX0gZnJvbSAnLi9pbnRlcmZhY2VzL0pzb25BcGknO1xuaW1wb3J0IHtjb25maWcsIGZldGNoLCByZWFkfSBmcm9tICcuL05ldHdvcmtVdGlscyc7XG5pbXBvcnQge1Jlc3BvbnNlfSBmcm9tICcuL1Jlc3BvbnNlJztcblxuZGVjbGFyZSB2YXIgd2luZG93OiBvYmplY3R8dW5kZWZpbmVkO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVjb3JhdGVDb2xsZWN0aW9uKEJhc2VDbGFzczogdHlwZW9mIFB1cmVDb2xsZWN0aW9uKSB7XG5cbiAgY2xhc3MgSnNvbmFwaUNvbGxlY3Rpb24gZXh0ZW5kcyBCYXNlQ2xhc3Mge1xuXG4gICAgcHVibGljIHN0YXRpYyB0eXBlcyA9IChCYXNlQ2xhc3MudHlwZXMgJiYgQmFzZUNsYXNzLnR5cGVzLmxlbmd0aClcbiAgICAgID8gQmFzZUNsYXNzLnR5cGVzLmNvbmNhdChHZW5lcmljTW9kZWwpXG4gICAgICA6IFtHZW5lcmljTW9kZWxdO1xuXG4gICAgcHVibGljIHN0YXRpYyBjYWNoZTogYm9vbGVhbiA9IEJhc2VDbGFzc1snY2FjaGUnXSA9PT0gdW5kZWZpbmVkXG4gICAgICA/IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgICA6IEJhc2VDbGFzc1snY2FjaGUnXTtcblxuICAgIHB1YmxpYyBzdGF0aWMgZGVmYXVsdE1vZGVsID0gQmFzZUNsYXNzWydkZWZhdWx0TW9kZWwnXSB8fCBHZW5lcmljTW9kZWw7XG5cbiAgICBwdWJsaWMgc3luYzxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KGJvZHk/OiBJUmVzcG9uc2UpOiBUfEFycmF5PFQ+fG51bGwge1xuICAgICAgaWYgKCFib2R5KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YTogVHxBcnJheTxUPnxudWxsID0gdGhpcy5fX2l0ZXJhdGVFbnRyaWVzKGJvZHksIChvYmo6IElSZWNvcmQpID0+IHRoaXMuX19hZGRSZWNvcmQ8VD4ob2JqKSk7XG4gICAgICB0aGlzLl9faXRlcmF0ZUVudHJpZXMoYm9keSwgdGhpcy5fX3VwZGF0ZVJlbGF0aW9uc2hpcHMuYmluZCh0aGlzKSk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCB0aGUgcmVjb3JkcyB3aXRoIHRoZSBnaXZlbiB0eXBlIGFuZCBpZFxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgUmVjb3JkIHR5cGVcbiAgICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHR5cGUgUmVjb3JkIGlkXG4gICAgICogQHBhcmFtIHtJUmVxdWVzdE9wdGlvbnN9IFtvcHRpb25zXSBTZXJ2ZXIgb3B0aW9uc1xuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCB0aGUgUmVzcG9uc2Ugb2JqZWN0IG9yIHJlamVjdHMgd2l0aCBhbiBlcnJvclxuICAgICAqL1xuICAgIHB1YmxpYyBmZXRjaDxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICAgICAgdHlwZTogSVR5cGV8SU1vZGVsQ29uc3RydWN0b3I8VD4sXG4gICAgICBpZDogbnVtYmVyfHN0cmluZyxcbiAgICAgIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4gICAgKTogUHJvbWlzZTxSZXNwb25zZTxUPj4ge1xuICAgICAgY29uc3QgbW9kZWxUeXBlID0gZ2V0TW9kZWxUeXBlKHR5cGUpO1xuICAgICAgY29uc3QgcXVlcnkgPSB0aGlzLl9fcHJlcGFyZVF1ZXJ5KG1vZGVsVHlwZSwgaWQsIHVuZGVmaW5lZCwgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gcmVhZDxUPihxdWVyeS51cmwsIHRoaXMsIHF1ZXJ5LmhlYWRlcnMsIG9wdGlvbnMpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHRoaXMuX19oYW5kbGVFcnJvcnM8VD4ocmVzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggdGhlIGZpcnN0IHBhZ2Ugb2YgcmVjb3JkcyBvZiB0aGUgZ2l2ZW4gdHlwZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgUmVjb3JkIHR5cGVcbiAgICAgKiBAcGFyYW0ge0lSZXF1ZXN0T3B0aW9uc30gW29wdGlvbnNdIFNlcnZlciBvcHRpb25zXG4gICAgICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSBSZXNvbHZlcyB3aXRoIHRoZSBSZXNwb25zZSBvYmplY3Qgb3IgcmVqZWN0cyB3aXRoIGFuIGVycm9yXG4gICAgICovXG4gICAgcHVibGljIGZldGNoQWxsPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gICAgICB0eXBlOiBJVHlwZXxJTW9kZWxDb25zdHJ1Y3RvcjxUPixcbiAgICAgIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4gICAgKTogUHJvbWlzZTxSZXNwb25zZTxUPj4ge1xuICAgICAgY29uc3QgbW9kZWxUeXBlID0gZ2V0TW9kZWxUeXBlKHR5cGUpO1xuICAgICAgY29uc3QgcXVlcnkgPSB0aGlzLl9fcHJlcGFyZVF1ZXJ5KG1vZGVsVHlwZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIHJlYWQ8VD4ocXVlcnkudXJsLCB0aGlzLCBxdWVyeS5oZWFkZXJzLCBvcHRpb25zKVxuICAgICAgICAudGhlbigocmVzKSA9PiB0aGlzLl9faGFuZGxlRXJyb3JzPFQ+KHJlcykpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZXF1ZXN0PFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gICAgICB1cmw6IHN0cmluZyxcbiAgICAgIG1ldGhvZDogc3RyaW5nID0gJ0dFVCcsXG4gICAgICBkYXRhPzogb2JqZWN0LFxuICAgICAgb3B0aW9ucz86IElSZXF1ZXN0T3B0aW9ucyxcbiAgICApOiBQcm9taXNlPFJlc3BvbnNlPFQ+PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHRoaXMuX19idWlsZFVybCh1cmwsIGRhdGEsIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIGZldGNoPFQ+KHt1cmw6IHF1ZXJ5LnVybCwgb3B0aW9ucywgZGF0YSwgbWV0aG9kLCBjb2xsZWN0aW9uOiB0aGlzfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbW92ZSh0eXBlOiBJVHlwZXx0eXBlb2YgUHVyZU1vZGVsLCBpZD86IElJZGVudGlmaWVyLCByZW1vdGU/OiBib29sZWFufElSZXF1ZXN0T3B0aW9ucyk7XG4gICAgcHVibGljIHJlbW92ZShtb2RlbDogUHVyZU1vZGVsLCByZW1vdGU/OiBib29sZWFufElSZXF1ZXN0T3B0aW9ucyk7XG4gICAgcHVibGljIHJlbW92ZShcbiAgICAgIG9iajogSVR5cGV8dHlwZW9mIFB1cmVNb2RlbHxQdXJlTW9kZWwsXG4gICAgICBpZD86IElJZGVudGlmaWVyfGJvb2xlYW58SVJlcXVlc3RPcHRpb25zLFxuICAgICAgcmVtb3RlPzogYm9vbGVhbnxJUmVxdWVzdE9wdGlvbnMsXG4gICAgKSB7XG4gICAgICBjb25zdCByZW1vdmUgPSAodHlwZW9mIGlkID09PSAnYm9vbGVhbicgfHwgdHlwZW9mIGlkID09PSAnb2JqZWN0JykgPyBpZCA6IHJlbW90ZTtcbiAgICAgIGNvbnN0IG1vZGVsSWQgPSAodHlwZW9mIGlkICE9PSAnYm9vbGVhbicgJiYgdHlwZW9mIGlkICE9PSAnb2JqZWN0JykgPyBpZCA6IHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IHR5cGUgPSBnZXRNb2RlbFR5cGUob2JqKTtcbiAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5maW5kKHR5cGUsIG1vZGVsSWQpO1xuXG4gICAgICBpZiAobW9kZWwgJiYgcmVtb3ZlKSB7XG4gICAgICAgIHJldHVybiByZW1vdmVNb2RlbChtb2RlbCwgdHlwZW9mIHJlbW92ZSA9PT0gJ29iamVjdCcgPyByZW1vdmUgOiB1bmRlZmluZWQpO1xuICAgICAgfVxuXG4gICAgICBpZiAobW9kZWwpIHtcbiAgICAgICAgc3VwZXIucmVtb3ZlKG1vZGVsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVtb3ZlQWxsKHR5cGU6IHN0cmluZyB8IG51bWJlciB8IHR5cGVvZiBQdXJlTW9kZWwpIHtcbiAgICAgIHN1cGVyLnJlbW92ZUFsbCh0eXBlKTtcbiAgICAgIGNsZWFyQ2FjaGVCeVR5cGUoZ2V0TW9kZWxUeXBlKHR5cGUpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQoKSB7XG4gICAgICBzdXBlci5yZXNldCgpO1xuICAgICAgY2xlYXJBbGxDYWNoZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gaGFuZGxlIHJlc3BvbnNlIGVycm9yc1xuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1Jlc3BvbnNlfSByZXNwb25zZSBBUEkgcmVzcG9uc2VcbiAgICAgKiBAcmV0dXJucyBBUEkgcmVzcG9uc2VcbiAgICAgKi9cbiAgICBwcml2YXRlIF9faGFuZGxlRXJyb3JzPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsPihyZXNwb25zZTogUmVzcG9uc2U8VD4pIHtcbiAgICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xuICAgICAgICB0aHJvdyByZXNwb25zZS5lcnJvcjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgX19hZGRSZWNvcmQ8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihvYmo6IElSZWNvcmQpOiBUIHtcbiAgICAgIGNvbnN0IHN0YXRpY0NvbGxlY3Rpb24gPSB0aGlzLmNvbnN0cnVjdG9yIGFzIHR5cGVvZiBQdXJlQ29sbGVjdGlvbjtcbiAgICAgIGNvbnN0IHt0eXBlLCBpZH0gPSBvYmo7XG4gICAgICBsZXQgcmVjb3JkOiBUfG51bGwgPSB0aGlzLmZpbmQodHlwZSwgaWQpIGFzIFR8bnVsbDtcbiAgICAgIGNvbnN0IGZsYXR0ZW5lZDogSVJhd01vZGVsID0gZmxhdHRlbk1vZGVsKG9iaik7XG5cbiAgICAgIGlmIChyZWNvcmQpIHtcbiAgICAgICAgdXBkYXRlTW9kZWwocmVjb3JkLCBmbGF0dGVuZWQpO1xuICAgICAgfSBlbHNlIGlmIChzdGF0aWNDb2xsZWN0aW9uLnR5cGVzLmZpbHRlcigoaXRlbSkgPT4gaXRlbS50eXBlID09PSB0eXBlKS5sZW5ndGgpIHtcbiAgICAgICAgcmVjb3JkID0gdGhpcy5hZGQoZmxhdHRlbmVkLCB0eXBlKSBhcyBUO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVjb3JkID0gdGhpcy5hZGQobmV3IEdlbmVyaWNNb2RlbChmbGF0dGVuZWQpKSBhcyBUO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVjb3JkO1xuICAgIH1cblxuICAgIHByaXZhdGUgX191cGRhdGVSZWxhdGlvbnNoaXBzKG9iajogSVJlY29yZCk6IHZvaWQge1xuICAgICAgY29uc3QgcmVjb3JkOiBQdXJlTW9kZWx8bnVsbCA9IHRoaXMuZmluZChvYmoudHlwZSwgb2JqLmlkKTtcbiAgICAgIGNvbnN0IHJlZnM6IEFycmF5PHN0cmluZz4gPSBvYmoucmVsYXRpb25zaGlwcyA/IE9iamVjdC5rZXlzKG9iai5yZWxhdGlvbnNoaXBzKSA6IFtdO1xuICAgICAgcmVmcy5mb3JFYWNoKChyZWY6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBpdGVtcyA9IChvYmoucmVsYXRpb25zaGlwcyBhcyBJRGljdGlvbmFyeTxJUmVsYXRpb25zaGlwPilbcmVmXS5kYXRhO1xuICAgICAgICBpZiAoaXRlbXMgaW5zdGFuY2VvZiBBcnJheSAmJiBpdGVtcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgLy8gaXQncyBvbmx5IHBvc3NpYmxlIHRvIHVwZGF0ZSBpdGVtcyB3aXRoIG9uZSBvcmUgbW9yZSByZWZzLiBFYXJseSBleGl0XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpdGVtcyAmJiByZWNvcmQpIHtcbiAgICAgICAgICBjb25zdCBtb2RlbHM6IFB1cmVNb2RlbHxBcnJheTxQdXJlTW9kZWw+fElJZGVudGlmaWVyfG51bGwgPSBtYXBJdGVtcyhcbiAgICAgICAgICAgIGl0ZW1zLFxuICAgICAgICAgICAgKGRlZjogSURlZmluaXRpb24pID0+IHRoaXMuZmluZChkZWYudHlwZSwgZGVmLmlkKSB8fCBkZWYuaWQsXG4gICAgICAgICAgKSB8fCBudWxsO1xuXG4gICAgICAgICAgY29uc3QgaXRlbVR5cGU6IHN0cmluZyA9IGl0ZW1zIGluc3RhbmNlb2YgQXJyYXkgPyBpdGVtc1swXS50eXBlIDogaXRlbXMudHlwZTtcbiAgICAgICAgICBpZiAocmVmIGluIHJlY29yZCkge1xuICAgICAgICAgICAgcmVjb3JkW3JlZl0gPSBtb2RlbHM7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGluaXRNb2RlbFJlZihyZWNvcmQsIHJlZiwge21vZGVsOiBpdGVtVHlwZSwgdHlwZTogUmVmZXJlbmNlVHlwZS5UT19PTkVfT1JfTUFOWX0sIG1vZGVscyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9faXRlcmF0ZUVudHJpZXM8VCBleHRlbmRzIElKc29uYXBpTW9kZWw+KGJvZHk6IElSZXNwb25zZSwgZm46IChpdGVtOiBJUmVjb3JkKSA9PiBUKSB7XG4gICAgICBtYXBJdGVtcygoYm9keSAmJiBib2R5LmluY2x1ZGVkKSB8fCBbXSwgZm4pO1xuICAgICAgcmV0dXJuIG1hcEl0ZW1zKChib2R5ICYmIGJvZHkuZGF0YSkgfHwgW10sIGZuKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9fcHJlcGFyZVF1ZXJ5KFxuICAgICAgdHlwZTogSVR5cGUsXG4gICAgICBpZD86IG51bWJlcnxzdHJpbmcsXG4gICAgICBkYXRhPzogSVJlcXVlc3QsXG4gICAgICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuICAgICk6IHtcbiAgICAgIHVybDogc3RyaW5nLFxuICAgICAgZGF0YT86IG9iamVjdCxcbiAgICAgIGhlYWRlcnM6IElIZWFkZXJzLFxuICAgIH0ge1xuICAgICAgY29uc3Qgc3RhdGljQ29sbGVjdGlvbiA9IHRoaXMuY29uc3RydWN0b3IgYXMgdHlwZW9mIFB1cmVDb2xsZWN0aW9uO1xuICAgICAgY29uc3QgbW9kZWw6IFB1cmVNb2RlbCA9IHN0YXRpY0NvbGxlY3Rpb24udHlwZXMuZmlsdGVyKChpdGVtKSA9PiBpdGVtLnR5cGUgPT09IHR5cGUpWzBdO1xuICAgICAgY29uc3QgcGF0aDogc3RyaW5nID0gbW9kZWxcbiAgICAgICAgPyAoZ2V0VmFsdWU8c3RyaW5nPihtb2RlbFsnZW5kcG9pbnQnXSkgfHwgbW9kZWxbJ2Jhc2VVcmwnXSB8fCBnZXRNb2RlbFR5cGUobW9kZWwpKVxuICAgICAgICA6IHR5cGU7XG5cbiAgICAgIGNvbnN0IHVybDogc3RyaW5nID0gaWQgPyBgJHtwYXRofS8ke2lkfWAgOiBgJHtwYXRofWA7XG4gICAgICByZXR1cm4gdGhpcy5fX2J1aWxkVXJsKHVybCwgZGF0YSwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfX2J1aWxkVXJsKHVybDogc3RyaW5nLCBkYXRhPzogSVJlcXVlc3QsIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMpIHtcbiAgICAgIGNvbnN0IGhlYWRlcnM6IElEaWN0aW9uYXJ5PHN0cmluZz4gPSAob3B0aW9ucyAmJiBvcHRpb25zLmhlYWRlcnMpIHx8IHt9O1xuXG4gICAgICBjb25zdCBwYXJhbXM6IEFycmF5PHN0cmluZz4gPSBbXG4gICAgICAgIC4uLnRoaXMuX19wcmVwYXJlRmlsdGVycygob3B0aW9ucyAmJiBvcHRpb25zLmZpbHRlcikgfHwge30pLFxuICAgICAgICAuLi50aGlzLl9fcHJlcGFyZVNvcnQob3B0aW9ucyAmJiBvcHRpb25zLnNvcnQpLFxuICAgICAgICAuLi50aGlzLl9fcHJlcGFyZUluY2x1ZGVzKG9wdGlvbnMgJiYgb3B0aW9ucy5pbmNsdWRlKSxcbiAgICAgICAgLi4udGhpcy5fX3ByZXBhcmVGaWVsZHMoKG9wdGlvbnMgJiYgb3B0aW9ucy5maWVsZHMpIHx8IHt9KSxcbiAgICAgICAgLi4udGhpcy5fX3ByZXBhcmVSYXdQYXJhbXMoKG9wdGlvbnMgJiYgb3B0aW9ucy5wYXJhbXMpIHx8IFtdKSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IGJhc2VVcmw6IHN0cmluZyA9IHRoaXMuX19hcHBlbmRQYXJhbXModGhpcy5fX3ByZWZpeFVybCh1cmwpLCBwYXJhbXMpO1xuICAgICAgcmV0dXJuIHtkYXRhLCBoZWFkZXJzLCB1cmw6IGJhc2VVcmx9O1xuICAgIH1cblxuICAgIHByaXZhdGUgX19wcmVwYXJlRmlsdGVycyhmaWx0ZXJzOiBJRmlsdGVycyk6IEFycmF5PHN0cmluZz4ge1xuICAgICAgcmV0dXJuIHRoaXMuX19wYXJhbWV0cml6ZShmaWx0ZXJzKS5tYXAoKGl0ZW0pID0+IGBmaWx0ZXJbJHtpdGVtLmtleX1dPSR7aXRlbS52YWx1ZX1gKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9fcHJlcGFyZVNvcnQoc29ydD86IHN0cmluZ3xBcnJheTxzdHJpbmc+KTogQXJyYXk8c3RyaW5nPiB7XG4gICAgICByZXR1cm4gc29ydCA/IFtgc29ydD0ke3NvcnR9YF0gOiBbXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9fcHJlcGFyZUluY2x1ZGVzKGluY2x1ZGU/OiBzdHJpbmd8QXJyYXk8c3RyaW5nPik6IEFycmF5PHN0cmluZz4ge1xuICAgICAgcmV0dXJuIGluY2x1ZGUgPyBbYGluY2x1ZGU9JHtpbmNsdWRlfWBdIDogW107XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfX3ByZXBhcmVGaWVsZHMoZmllbGRzOiBJRGljdGlvbmFyeTxzdHJpbmd8QXJyYXk8c3RyaW5nPj4pOiBBcnJheTxzdHJpbmc+IHtcbiAgICAgIGNvbnN0IGxpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcblxuICAgICAgT2JqZWN0LmtleXMoZmllbGRzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgbGlzdC5wdXNoKGBmaWVsZHNbJHtrZXl9XT0ke2ZpZWxkc1trZXldfWApO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBsaXN0O1xuICAgIH1cblxuICAgIHByaXZhdGUgX19wcmVwYXJlUmF3UGFyYW1zKHBhcmFtczogQXJyYXk8e2tleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfXxzdHJpbmc+KTogQXJyYXk8c3RyaW5nPiB7XG4gICAgICByZXR1cm4gcGFyYW1zLm1hcCgocGFyYW0pID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXR1cm4gcGFyYW07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3BhcmFtLmtleX09JHtwYXJhbS52YWx1ZX1gO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfX3ByZWZpeFVybCh1cmwpIHtcbiAgICAgIGlmIChVUkxfUkVHRVgudGVzdCh1cmwpKSB7XG4gICAgICAgIHJldHVybiB1cmw7XG4gICAgICB9XG4gICAgICByZXR1cm4gYCR7Y29uZmlnLmJhc2VVcmx9JHt1cmx9YDtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9fYXBwZW5kUGFyYW1zKHVybDogc3RyaW5nLCBwYXJhbXM6IEFycmF5PHN0cmluZz4pOiBzdHJpbmcge1xuICAgICAgaWYgKHBhcmFtcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3Qgc2VwYXJhdG9yID0gdXJsLmluZGV4T2YoJz8nKSA9PT0gLTEgPyAnPycgOiAnJic7XG4gICAgICAgIHVybCArPSBzZXBhcmF0b3IgKyBwYXJhbXMuam9pbignJicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVybDtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9fcGFyYW1ldHJpemUocGFyYW1zOiBvYmplY3QsIHNjb3BlOiBzdHJpbmcgPSAnJykge1xuICAgICAgY29uc3QgbGlzdDogQXJyYXk8e2tleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfT4gPSBbXTtcblxuICAgICAgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgaWYgKHBhcmFtc1trZXldIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICBpZiAoY29uZmlnLnBhcmFtQXJyYXlUeXBlID09PSBQYXJhbUFycmF5VHlwZS5PQkpFQ1RfUEFUSCkge1xuICAgICAgICAgICAgbGlzdC5wdXNoKC4uLnRoaXMuX19wYXJhbWV0cml6ZShwYXJhbXNba2V5XSwgYCR7a2V5fS5gKSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb25maWcucGFyYW1BcnJheVR5cGUgPT09IFBhcmFtQXJyYXlUeXBlLkNPTU1BX1NFUEFSQVRFRCkge1xuICAgICAgICAgICAgbGlzdC5wdXNoKHtrZXk6IGAke3Njb3BlfSR7a2V5fWAsIHZhbHVlOiBwYXJhbXNba2V5XS5qb2luKCcsJyl9KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy5wYXJhbUFycmF5VHlwZSA9PT0gUGFyYW1BcnJheVR5cGUuTVVMVElQTEVfUEFSQU1TKSB7XG4gICAgICAgICAgICBsaXN0LnB1c2goLi4ucGFyYW1zW2tleV0ubWFwKChwYXJhbSkgPT4gKHtrZXk6IGAke3Njb3BlfSR7a2V5fWAsIHZhbHVlOiBwYXJhbX0pKSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb25maWcucGFyYW1BcnJheVR5cGUgPT09IFBhcmFtQXJyYXlUeXBlLlBBUkFNX0FSUkFZKSB7XG4gICAgICAgICAgICBsaXN0LnB1c2goLi4ucGFyYW1zW2tleV0ubWFwKChwYXJhbSkgPT4gKHtrZXk6IGAke3Njb3BlfSR7a2V5fV1bYCwgdmFsdWU6IHBhcmFtfSkpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhcmFtc1trZXldID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIGxpc3QucHVzaCguLi50aGlzLl9fcGFyYW1ldHJpemUocGFyYW1zW2tleV0sIGAke2tleX0uYCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxpc3QucHVzaCh7a2V5OiBgJHtzY29wZX0ke2tleX1gLCB2YWx1ZTogcGFyYW1zW2tleV19KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBsaXN0O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBKc29uYXBpQ29sbGVjdGlvbiBhcyBJQ29sbGVjdGlvbkNvbnN0cnVjdG9yPFB1cmVDb2xsZWN0aW9uICYgSUpzb25hcGlDb2xsZWN0aW9uPjtcbn1cbiJdfQ==","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/decorateCollection.d.ts","text":"import { ICollectionConstructor, PureCollection } from 'datx';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nexport declare function decorateCollection(BaseClass: typeof PureCollection): ICollectionConstructor<PureCollection & IJsonapiCollection>;\r\n"}}
