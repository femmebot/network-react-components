{"code":"import * as tslib_1 from \"tslib\";\r\nimport { getModelId, getModelType, modelToJSON, updateModel, updateModelId } from 'datx';\r\nimport { assignComputed } from 'datx-utils';\r\nimport { action } from 'mobx';\r\nimport { GenericModel } from './GenericModel';\r\nimport { flattenModel } from './helpers/model';\r\nimport { fetchLink } from './NetworkUtils';\r\nvar Response = /** @class */ (function () {\r\n    function Response(response, collection, options, overrideData) {\r\n        var _this = this;\r\n        /**\r\n         * API response data (synced with the store)\r\n         *\r\n         * @type {(PureModel|Array<PureModel>)}\r\n         * @memberOf Response\r\n         */\r\n        this.data = null;\r\n        /**\r\n         * Cache used for the link requests\r\n         *\r\n         * @private\r\n         * @type {IDictionary<Promise<Response>>}\r\n         * @memberOf Response\r\n         */\r\n        this.__cache = {};\r\n        this.__collection = collection;\r\n        this.__options = options;\r\n        this.__response = response;\r\n        this.status = response.status;\r\n        if (collection) {\r\n            this.data = overrideData ? collection.add(overrideData) : collection.sync(response.data);\r\n        }\r\n        else if (response.data) {\r\n            // The case when a record is not in a store and save/remove are used\r\n            var resp = response.data;\r\n            if (resp.data) {\r\n                if (resp.data instanceof Array) {\r\n                    throw new Error('A save/remove operation should not return an array of results');\r\n                }\r\n                this.data = overrideData || new GenericModel(flattenModel(resp.data));\r\n            }\r\n        }\r\n        this.meta = (response.data && response.data.meta) || {};\r\n        this.links = (response.data && response.data.links) || {};\r\n        this.jsonapi = (response.data && response.data.jsonapi) || {};\r\n        this.headers = response.headers;\r\n        this.requestHeaders = response.requestHeaders;\r\n        this.error = (response.data && response.data.errors) || response.error;\r\n        var linkGetter = {};\r\n        if (this.links) {\r\n            Object.keys(this.links).forEach(function (link) {\r\n                assignComputed(_this, link, function () { return _this.__fetchLink(link); });\r\n            });\r\n        }\r\n        Object.freeze(this);\r\n        if (this.error) {\r\n            throw this;\r\n        }\r\n    }\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.replaceData = function (data) {\r\n        var record = this.data;\r\n        if (record === data) {\r\n            return this;\r\n        }\r\n        var oldId = getModelId(data);\r\n        var newId = getModelId(record);\r\n        var type = getModelType(record);\r\n        if (this.__collection) {\r\n            this.__collection.remove(record);\r\n            this.__collection.add(data);\r\n        }\r\n        updateModel(data, modelToJSON(record));\r\n        updateModelId(data, newId);\r\n        return new Response(this.__response, this.__collection, this.__options, data);\r\n    };\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.__fetchLink = function (name) {\r\n        if (!this.__cache[name]) {\r\n            var link = (this.links && name in this.links) ? this.links[name] : null;\r\n            if (link) {\r\n                this.__cache[name] = fetchLink(link, this.__collection, this.requestHeaders, this.__options);\r\n            }\r\n        }\r\n        return this.__cache[name];\r\n    };\r\n    tslib_1.__decorate([\r\n        action\r\n    ], Response.prototype, \"replaceData\", null);\r\n    return Response;\r\n}());\r\nexport { Response };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzcG9uc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvUmVzcG9uc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBYSxXQUFXLEVBQUUsYUFBYSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ2xHLE9BQU8sRUFBQyxjQUFjLEVBQWMsTUFBTSxZQUFZLENBQUM7QUFDdkQsT0FBTyxFQUFDLE1BQU0sRUFBbUMsTUFBTSxNQUFNLENBQUM7QUFTOUQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUU3QyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFekM7SUFzSUUsa0JBQ0UsUUFBc0IsRUFDdEIsVUFBK0IsRUFDL0IsT0FBeUIsRUFDekIsWUFBeUI7UUFKM0IsaUJBNkNDO1FBakxEOzs7OztXQUtHO1FBQ0ksU0FBSSxHQUFvQixJQUFJLENBQUM7UUFxSHBDOzs7Ozs7V0FNRztRQUNLLFlBQU8sR0FBc0MsRUFBRSxDQUFDO1FBUXRELElBQUksQ0FBQyxZQUFZLEdBQUcsVUFBVSxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxVQUFVLEdBQUcsUUFBUSxDQUFDO1FBQzNCLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUU5QixJQUFJLFVBQVUsRUFBRTtZQUNkLElBQUksQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFJLFlBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBSSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDckc7YUFBTSxJQUFJLFFBQVEsQ0FBQyxJQUFJLEVBQUU7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UUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFFdkIsSUFBTSxJQUFJLEdBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUV0RixJQUFJLElBQUksRUFBRTtnQkFDUixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBSSxJQUFJLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQzthQUNqRztTQUNGO1FBQ0QsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUF4Q087UUFBUCxNQUFNOytDQW1CTjtJQXNCSCxlQUFDO0NBQUEsQUF0T0QsSUFzT0M7U0F0T1ksUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Z2V0TW9kZWxJZCwgZ2V0TW9kZWxUeXBlLCBtb2RlbFRvSlNPTiwgUHVyZU1vZGVsLCB1cGRhdGVNb2RlbCwgdXBkYXRlTW9kZWxJZH0gZnJvbSAnZGF0eCc7XG5pbXBvcnQge2Fzc2lnbkNvbXB1dGVkLCBJRGljdGlvbmFyeX0gZnJvbSAnZGF0eC11dGlscyc7XG5pbXBvcnQge2FjdGlvbiwgZXh0ZW5kT2JzZXJ2YWJsZSwgSUNvbXB1dGVkVmFsdWV9IGZyb20gJ21vYngnO1xuXG5pbXBvcnQge0lIZWFkZXJzfSBmcm9tICcuL2ludGVyZmFjZXMvSUhlYWRlcnMnO1xuaW1wb3J0IHtJSnNvbmFwaU1vZGVsfSBmcm9tICcuL2ludGVyZmFjZXMvSUpzb25hcGlNb2RlbCc7XG5pbXBvcnQge0lSYXdSZXNwb25zZX0gZnJvbSAnLi9pbnRlcmZhY2VzL0lSYXdSZXNwb25zZSc7XG5pbXBvcnQge0lSZXF1ZXN0T3B0aW9uc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSZXF1ZXN0T3B0aW9ucyc7XG5pbXBvcnQge0lSZXNwb25zZUhlYWRlcnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmVzcG9uc2VIZWFkZXJzJztcbmltcG9ydCB7SUVycm9yLCBJSnNvbkFwaU9iamVjdCwgSUxpbmt9IGZyb20gJy4vaW50ZXJmYWNlcy9Kc29uQXBpJztcblxuaW1wb3J0IHtHZW5lcmljTW9kZWx9IGZyb20gJy4vR2VuZXJpY01vZGVsJztcbmltcG9ydCB7ZmxhdHRlbk1vZGVsfSBmcm9tICcuL2hlbHBlcnMvbW9kZWwnO1xuaW1wb3J0IHtJSnNvbmFwaUNvbGxlY3Rpb259IGZyb20gJy4vaW50ZXJmYWNlcy9JSnNvbmFwaUNvbGxlY3Rpb24nO1xuaW1wb3J0IHtmZXRjaExpbmt9IGZyb20gJy4vTmV0d29ya1V0aWxzJztcblxuZXhwb3J0IGNsYXNzIFJlc3BvbnNlPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsPiB7XG5cbiAgLyoqXG4gICAqIEFQSSByZXNwb25zZSBkYXRhIChzeW5jZWQgd2l0aCB0aGUgc3RvcmUpXG4gICAqXG4gICAqIEB0eXBlIHsoUHVyZU1vZGVsfEFycmF5PFB1cmVNb2RlbD4pfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBkYXRhOiBUfEFycmF5PFQ+fG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBBUEkgcmVzcG9uc2UgbWV0YWRhdGFcbiAgICpcbiAgICogQHR5cGUge29iamVjdH1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgbWV0YT86IG9iamVjdDtcblxuICAvKipcbiAgICogQVBJIHJlc3BvbnNlIGxpbmtzXG4gICAqXG4gICAqIEB0eXBlIHtvYmplY3R9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGxpbmtzPzogSURpY3Rpb25hcnk8SUxpbms+O1xuXG4gIC8qKlxuICAgKiBUaGUgSlNPTiBBUEkgb2JqZWN0IHJldHVybmVkIGJ5IHRoZSBzZXJ2ZXJcbiAgICpcbiAgICogQHR5cGUge0pzb25BcGkuSUpzb25BcGlPYmplY3R9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGpzb25hcGk/OiBJSnNvbkFwaU9iamVjdDtcblxuICAvKipcbiAgICogSGVhZGVycyByZWNlaXZlZCBmcm9tIHRoZSBBUEkgY2FsbFxuICAgKlxuICAgKiBAdHlwZSB7SVJlc3BvbnNlSGVhZGVyc31cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgaGVhZGVycz86IElSZXNwb25zZUhlYWRlcnM7XG5cbiAgLyoqXG4gICAqIEhlYWRlcnMgc2VudCB0byB0aGUgc2VydmVyXG4gICAqXG4gICAqIEB0eXBlIHtJSGVhZGVyc31cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgcmVxdWVzdEhlYWRlcnM/OiBJSGVhZGVycztcblxuICAvKipcbiAgICogUmVxdWVzdCBlcnJvclxuICAgKlxuICAgKiBAdHlwZSB7KEFycmF5PEpzb25BcGkuSUVycm9yPnxFcnJvcil9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGVycm9yPzogQXJyYXk8SUVycm9yPnxFcnJvcjtcblxuICAvKipcbiAgICogRmlyc3QgZGF0YSBwYWdlXG4gICAqXG4gICAqIEB0eXBlIHtQcm9taXNlPFJlc3BvbnNlPn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgZmlyc3Q/OiBQcm9taXNlPFJlc3BvbnNlPFQ+PjsgLy8gSGFuZGxlZCBieSB0aGUgX19mZXRjaExpbmtcblxuICAvKipcbiAgICogUHJldmlvdXMgZGF0YSBwYWdlXG4gICAqXG4gICAqIEB0eXBlIHtQcm9taXNlPFJlc3BvbnNlPn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgcHJldj86IFByb21pc2U8UmVzcG9uc2U8VD4+OyAvLyBIYW5kbGVkIGJ5IHRoZSBfX2ZldGNoTGlua1xuXG4gIC8qKlxuICAgKiBOZXh0IGRhdGEgcGFnZVxuICAgKlxuICAgKiBAdHlwZSB7UHJvbWlzZTxSZXNwb25zZT59XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIG5leHQ/OiBQcm9taXNlPFJlc3BvbnNlPFQ+PjsgLy8gSGFuZGxlZCBieSB0aGUgX19mZXRjaExpbmtcblxuICAvKipcbiAgICogTGFzdCBkYXRhIHBhZ2VcbiAgICpcbiAgICogQHR5cGUge1Byb21pc2U8UmVzcG9uc2U+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBsYXN0PzogUHJvbWlzZTxSZXNwb25zZTxUPj47IC8vIEhhbmRsZWQgYnkgdGhlIF9fZmV0Y2hMaW5rXG5cbiAgLyoqXG4gICAqIFJlY2VpdmVkIEhUVFAgc3RhdHVzXG4gICAqXG4gICAqIEB0eXBlIHtudW1iZXJ9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIHN0YXR1cz86IG51bWJlcjtcblxuICAvKipcbiAgICogUmVsYXRlZCBTdG9yZVxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SUpzb25hcGlDb2xsZWN0aW9ufVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19jb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uO1xuXG4gIC8qKlxuICAgKiBTZXJ2ZXIgb3B0aW9uc1xuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SVJlcXVlc3RPcHRpb25zfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19vcHRpb25zPzogSVJlcXVlc3RPcHRpb25zO1xuXG4gIC8qKlxuICAgKiBPcmlnaW5hbCBzZXJ2ZXIgcmVzcG9uc2VcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHR5cGUge0lSYXdSZXNwb25zZX1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwcml2YXRlIF9fcmVzcG9uc2U6IElSYXdSZXNwb25zZTtcblxuICAvKipcbiAgICogQ2FjaGUgdXNlZCBmb3IgdGhlIGxpbmsgcmVxdWVzdHNcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHR5cGUge0lEaWN0aW9uYXJ5PFByb21pc2U8UmVzcG9uc2U+Pn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwcml2YXRlIF9fY2FjaGU6IElEaWN0aW9uYXJ5PFByb21pc2U8UmVzcG9uc2U8VD4+PiA9IHt9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHJlc3BvbnNlOiBJUmF3UmVzcG9uc2UsXG4gICAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuICAgIG92ZXJyaWRlRGF0YT86IFR8QXJyYXk8VD4sXG4gICkge1xuICAgIHRoaXMuX19jb2xsZWN0aW9uID0gY29sbGVjdGlvbjtcbiAgICB0aGlzLl9fb3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgdGhpcy5fX3Jlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgdGhpcy5zdGF0dXMgPSByZXNwb25zZS5zdGF0dXM7XG5cbiAgICBpZiAoY29sbGVjdGlvbikge1xuICAgICAgdGhpcy5kYXRhID0gb3ZlcnJpZGVEYXRhID8gY29sbGVjdGlvbi5hZGQ8VD4ob3ZlcnJpZGVEYXRhIGFzIFQpIDogY29sbGVjdGlvbi5zeW5jPFQ+KHJlc3BvbnNlLmRhdGEpO1xuICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSkge1xuICAgICAgLy8gVGhlIGNhc2Ugd2hlbiBhIHJlY29yZCBpcyBub3QgaW4gYSBzdG9yZSBhbmQgc2F2ZS9yZW1vdmUgYXJlIHVzZWRcbiAgICAgIGNvbnN0IHJlc3AgPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICBpZiAocmVzcC5kYXRhKSB7XG4gICAgICAgIGlmIChyZXNwLmRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQSBzYXZlL3JlbW92ZSBvcGVyYXRpb24gc2hvdWxkIG5vdCByZXR1cm4gYW4gYXJyYXkgb2YgcmVzdWx0cycpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5kYXRhID0gb3ZlcnJpZGVEYXRhIHx8IG5ldyBHZW5lcmljTW9kZWwoZmxhdHRlbk1vZGVsKHJlc3AuZGF0YSkpIGFzIFQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5tZXRhID0gKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5tZXRhKSB8fCB7fTtcbiAgICB0aGlzLmxpbmtzID0gKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5saW5rcykgfHwge307XG4gICAgdGhpcy5qc29uYXBpID0gKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5qc29uYXBpKSB8fCB7fTtcbiAgICB0aGlzLmhlYWRlcnMgPSByZXNwb25zZS5oZWFkZXJzO1xuICAgIHRoaXMucmVxdWVzdEhlYWRlcnMgPSByZXNwb25zZS5yZXF1ZXN0SGVhZGVycztcbiAgICB0aGlzLmVycm9yID0gKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5lcnJvcnMpIHx8IHJlc3BvbnNlLmVycm9yO1xuXG4gICAgY29uc3QgbGlua0dldHRlcjogSURpY3Rpb25hcnk8SUNvbXB1dGVkVmFsdWU8UHJvbWlzZTxSZXNwb25zZTxUPj4+PiA9IHt9O1xuICAgIGlmICh0aGlzLmxpbmtzKSB7XG4gICAgICBPYmplY3Qua2V5cyh0aGlzLmxpbmtzKS5mb3JFYWNoKChsaW5rOiBzdHJpbmcpID0+IHtcbiAgICAgICAgYXNzaWduQ29tcHV0ZWQodGhpcywgbGluaywgKCkgPT4gdGhpcy5fX2ZldGNoTGluayhsaW5rKSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBPYmplY3QuZnJlZXplKHRoaXMpO1xuXG4gICAgaWYgKHRoaXMuZXJyb3IpIHtcbiAgICAgIHRocm93IHRoaXM7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlcGxhY2UgdGhlIHJlc3BvbnNlIHJlY29yZCB3aXRoIGEgZGlmZmVyZW50IHJlY29yZC4gVXNlZCB0byByZXBsYWNlIGEgcmVjb3JkIHdoaWxlIGtlZXBpbmcgdGhlIHNhbWUgcmVmZXJlbmNlXG4gICAqXG4gICAqIEBwYXJhbSB7UHVyZU1vZGVsfSBkYXRhIE5ldyBkYXRhXG4gICAqIEByZXR1cm5zIHtSZXNwb25zZX1cbiAgICpcbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBAYWN0aW9uIHB1YmxpYyByZXBsYWNlRGF0YShkYXRhOiBUKTogUmVzcG9uc2U8VD4ge1xuICAgIGNvbnN0IHJlY29yZDogUHVyZU1vZGVsID0gdGhpcy5kYXRhIGFzIFB1cmVNb2RlbDtcbiAgICBpZiAocmVjb3JkID09PSBkYXRhKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBjb25zdCBvbGRJZCA9IGdldE1vZGVsSWQoZGF0YSk7XG4gICAgY29uc3QgbmV3SWQgPSBnZXRNb2RlbElkKHJlY29yZCk7XG4gICAgY29uc3QgdHlwZSA9IGdldE1vZGVsVHlwZShyZWNvcmQpO1xuXG4gICAgaWYgKHRoaXMuX19jb2xsZWN0aW9uKSB7XG4gICAgICB0aGlzLl9fY29sbGVjdGlvbi5yZW1vdmUocmVjb3JkKTtcbiAgICAgIHRoaXMuX19jb2xsZWN0aW9uLmFkZChkYXRhKTtcbiAgICB9XG5cbiAgICB1cGRhdGVNb2RlbChkYXRhLCBtb2RlbFRvSlNPTihyZWNvcmQpKTtcbiAgICB1cGRhdGVNb2RlbElkKGRhdGEsIG5ld0lkKTtcblxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UodGhpcy5fX3Jlc3BvbnNlLCB0aGlzLl9fY29sbGVjdGlvbiwgdGhpcy5fX29wdGlvbnMsIGRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGEgbGluayBpcyBiZWluZyBmZXRjaGVkLiBUaGUgcmV0dXJuZWQgdmFsdWUgaXMgY2FjaGVkXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7YW55fSBuYW1lIExpbmsgbmFtZVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCBhIFJlc3BvbnNlIG9iamVjdFxuICAgKlxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19mZXRjaExpbmsobmFtZSkge1xuICAgIGlmICghdGhpcy5fX2NhY2hlW25hbWVdKSB7XG5cbiAgICAgIGNvbnN0IGxpbms6IElMaW5rfG51bGwgPSAodGhpcy5saW5rcyAmJiBuYW1lIGluIHRoaXMubGlua3MpID8gdGhpcy5saW5rc1tuYW1lXSA6IG51bGw7XG5cbiAgICAgIGlmIChsaW5rKSB7XG4gICAgICAgIHRoaXMuX19jYWNoZVtuYW1lXSA9IGZldGNoTGluazxUPihsaW5rLCB0aGlzLl9fY29sbGVjdGlvbiwgdGhpcy5yZXF1ZXN0SGVhZGVycywgdGhpcy5fX29wdGlvbnMpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fX2NhY2hlW25hbWVdO1xuICB9XG59XG4iXX0=","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/Response.d.ts","text":"import { IDictionary } from 'datx-utils';\r\nimport { IHeaders } from './interfaces/IHeaders';\r\nimport { IJsonapiModel } from './interfaces/IJsonapiModel';\r\nimport { IRawResponse } from './interfaces/IRawResponse';\r\nimport { IRequestOptions } from './interfaces/IRequestOptions';\r\nimport { IResponseHeaders } from './interfaces/IResponseHeaders';\r\nimport { IError, IJsonApiObject, ILink } from './interfaces/JsonApi';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nexport declare class Response<T extends IJsonapiModel> {\r\n    /**\r\n     * API response data (synced with the store)\r\n     *\r\n     * @type {(PureModel|Array<PureModel>)}\r\n     * @memberOf Response\r\n     */\r\n    data: T | Array<T> | null;\r\n    /**\r\n     * API response metadata\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    meta?: object;\r\n    /**\r\n     * API response links\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    links?: IDictionary<ILink>;\r\n    /**\r\n     * The JSON API object returned by the server\r\n     *\r\n     * @type {JsonApi.IJsonApiObject}\r\n     * @memberOf Response\r\n     */\r\n    jsonapi?: IJsonApiObject;\r\n    /**\r\n     * Headers received from the API call\r\n     *\r\n     * @type {IResponseHeaders}\r\n     * @memberOf Response\r\n     */\r\n    headers?: IResponseHeaders;\r\n    /**\r\n     * Headers sent to the server\r\n     *\r\n     * @type {IHeaders}\r\n     * @memberOf Response\r\n     */\r\n    requestHeaders?: IHeaders;\r\n    /**\r\n     * Request error\r\n     *\r\n     * @type {(Array<JsonApi.IError>|Error)}\r\n     * @memberOf Response\r\n     */\r\n    error?: Array<IError> | Error;\r\n    /**\r\n     * First data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    first?: Promise<Response<T>>;\r\n    /**\r\n     * Previous data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    prev?: Promise<Response<T>>;\r\n    /**\r\n     * Next data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    next?: Promise<Response<T>>;\r\n    /**\r\n     * Last data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    last?: Promise<Response<T>>;\r\n    /**\r\n     * Received HTTP status\r\n     *\r\n     * @type {number}\r\n     * @memberOf Response\r\n     */\r\n    status?: number;\r\n    /**\r\n     * Related Store\r\n     *\r\n     * @private\r\n     * @type {IJsonapiCollection}\r\n     * @memberOf Response\r\n     */\r\n    private __collection?;\r\n    /**\r\n     * Server options\r\n     *\r\n     * @private\r\n     * @type {IRequestOptions}\r\n     * @memberOf Response\r\n     */\r\n    private __options?;\r\n    /**\r\n     * Original server response\r\n     *\r\n     * @private\r\n     * @type {IRawResponse}\r\n     * @memberOf Response\r\n     */\r\n    private __response;\r\n    /**\r\n     * Cache used for the link requests\r\n     *\r\n     * @private\r\n     * @type {IDictionary<Promise<Response>>}\r\n     * @memberOf Response\r\n     */\r\n    private __cache;\r\n    constructor(response: IRawResponse, collection?: IJsonapiCollection, options?: IRequestOptions, overrideData?: T | Array<T>);\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    replaceData(data: T): Response<T>;\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    private __fetchLink(name);\r\n}\r\n"}}
