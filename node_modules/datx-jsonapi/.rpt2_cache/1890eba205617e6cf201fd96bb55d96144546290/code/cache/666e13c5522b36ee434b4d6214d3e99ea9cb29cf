{"code":"import * as tslib_1 from \"tslib\";\r\nimport { setModelMetaKey } from 'datx';\r\nimport { getCache, saveCache } from './cache';\r\nimport { MODEL_PERSISTED_FIELD, MODEL_PROP_FIELD, MODEL_QUEUE_FIELD, MODEL_RELATED_FIELD } from './consts';\r\nimport { ParamArrayType } from './enums/ParamArrayType';\r\nimport { isBrowser } from './helpers/utils';\r\nimport { Response as LibResponse } from './Response';\r\nexport var config = {\r\n    // Base URL for all API calls\r\n    baseUrl: '/',\r\n    // Enable caching by default in the browser\r\n    cache: isBrowser,\r\n    // Default options that will be passed to the fetch function\r\n    defaultFetchOptions: {\r\n        headers: {\r\n            'content-type': 'application/vnd.api+json',\r\n        },\r\n    },\r\n    // Reference of the fetch method that should be used\r\n    fetchReference: isBrowser && 'fetch' in window && window.fetch.bind(window),\r\n    // Determines how will the request param arrays be stringified\r\n    paramArrayType: ParamArrayType.COMMA_SEPARATED,\r\n    /**\r\n     * Base implementation of the fetch function (can be overridden)\r\n     *\r\n     * @param {string} method API call method\r\n     * @param {string} url API call URL\r\n     * @param {object} [body] API call body\r\n     * @param {IHeaders} [requestHeaders] Headers that will be sent\r\n     * @returns {Promise<IRawResponse>} Resolves with a raw response object\r\n     */\r\n    baseFetch: function (method, url, body, requestHeaders) {\r\n        var _this = this;\r\n        var data;\r\n        var status;\r\n        var headers;\r\n        var request = Promise.resolve();\r\n        var uppercaseMethod = method.toUpperCase();\r\n        var isBodySupported = uppercaseMethod !== 'GET' && uppercaseMethod !== 'HEAD';\r\n        return request\r\n            .then(function () {\r\n            var defaultHeaders = config.defaultFetchOptions.headers || {};\r\n            var reqHeaders = Object.assign({}, defaultHeaders, requestHeaders);\r\n            var options = Object.assign({}, config.defaultFetchOptions, {\r\n                body: isBodySupported && JSON.stringify(body) || undefined,\r\n                headers: reqHeaders,\r\n                method: method,\r\n            });\r\n            return _this.fetchReference(url, options);\r\n        })\r\n            .then(function (response) {\r\n            status = response.status;\r\n            headers = response.headers;\r\n            return response.json();\r\n        })\r\n            .catch(function (error) {\r\n            if (status === 204) {\r\n                return null;\r\n            }\r\n            throw error;\r\n        })\r\n            .then(function (responseData) {\r\n            data = responseData;\r\n            if (status >= 400) {\r\n                throw {\r\n                    message: \"Invalid HTTP status: \" + status,\r\n                    status: status,\r\n                };\r\n            }\r\n            return { data: data, headers: headers, requestHeaders: requestHeaders, status: status };\r\n        })\r\n            .catch(function (error) {\r\n            return _this.onError({ data: data, error: error, headers: headers, requestHeaders: requestHeaders, status: status });\r\n        });\r\n    },\r\n    onError: function (resp) {\r\n        return resp;\r\n    },\r\n    transformRequest: function (options) {\r\n        return options;\r\n    },\r\n    transformResponse: function (response) {\r\n        return response;\r\n    },\r\n};\r\n/**\r\n * Base implementation of the stateful fetch function (can be overridden)\r\n *\r\n * @param {ICollectionFetchOpts} reqOptions API request options\r\n * @returns {Promise<Response>} Resolves with a response object\r\n */\r\nfunction collectionFetch(reqOptions) {\r\n    var _a = config.transformRequest(reqOptions), url = _a.url, options = _a.options, data = _a.data, _b = _a.method, method = _b === void 0 ? 'GET' : _b, collection = _a.collection, views = _a.views;\r\n    var staticCollection = collection && collection.constructor;\r\n    var collectionCache = staticCollection && staticCollection.cache;\r\n    var isCacheSupported = method.toUpperCase() === 'GET';\r\n    var skipCache = reqOptions.options && reqOptions.options.skipCache;\r\n    if (config.cache && isCacheSupported && collectionCache && !skipCache) {\r\n        var cache = getCache(url);\r\n        if (cache) {\r\n            return Promise.resolve(cache.response);\r\n        }\r\n    }\r\n    return config.baseFetch(method, url, data, options && options.headers)\r\n        .then(function (response) {\r\n        var collectionResponse = Object.assign(response, { collection: collection });\r\n        var resp = new LibResponse(config.transformResponse(collectionResponse), collection, options, undefined, views);\r\n        if (config.cache && isCacheSupported) {\r\n            saveCache(url, resp);\r\n        }\r\n        return resp;\r\n    });\r\n}\r\nexport function fetch(options) {\r\n    return collectionFetch(options);\r\n}\r\n/**\r\n * API call used to get data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function read(url, collection, headers, options, views) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: undefined,\r\n        method: 'GET',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n        views: views,\r\n    });\r\n}\r\n/**\r\n * API call used to create data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function create(url, data, collection, headers, options, views) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: data,\r\n        method: 'POST',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n        views: views,\r\n    });\r\n}\r\n/**\r\n * API call used to update data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function update(url, data, collection, headers, options, views) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: data,\r\n        method: 'PATCH',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n        views: views,\r\n    });\r\n}\r\n/**\r\n * API call used to remove data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function remove(url, collection, headers, options, views) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: undefined,\r\n        method: 'DELETE',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n        views: views,\r\n    });\r\n}\r\n/**\r\n * Fetch a link from the server\r\n *\r\n * @export\r\n * @param {JsonApi.ILink} link Link URL or a link object\r\n * @param {IJsonapiCollection} collection Store that will be used to save the response\r\n * @param {IDictionary<string>} [requestHeaders] Request headers\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<LibResponse>} Response promise\r\n */\r\nexport function fetchLink(link, collection, requestHeaders, options, views) {\r\n    if (link) {\r\n        var href = typeof link === 'object' ? link.href : link;\r\n        if (href) {\r\n            return read(href, collection, requestHeaders, options, views);\r\n        }\r\n    }\r\n    return Promise.resolve(new LibResponse({ data: undefined }, collection));\r\n}\r\nexport function handleResponse(record, prop) {\r\n    return function (response) {\r\n        if (response.error) {\r\n            throw response.error;\r\n        }\r\n        if (response.status === 204) {\r\n            setModelMetaKey(record, MODEL_PERSISTED_FIELD, true);\r\n            return record;\r\n        }\r\n        else if (response.status === 202) {\r\n            var responseRecord = response.data;\r\n            setModelMetaKey(responseRecord, MODEL_PROP_FIELD, prop);\r\n            setModelMetaKey(responseRecord, MODEL_QUEUE_FIELD, true);\r\n            setModelMetaKey(responseRecord, MODEL_RELATED_FIELD, record);\r\n            return responseRecord;\r\n        }\r\n        else {\r\n            setModelMetaKey(record, MODEL_PERSISTED_FIELD, true);\r\n            return response.replaceData(record).data;\r\n        }\r\n    };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV0d29ya1V0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3JjL05ldHdvcmtVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLGVBQWUsRUFBTyxNQUFNLE1BQU0sQ0FBQztBQUkzQyxPQUFPLEVBQUMsUUFBUSxFQUFFLFNBQVMsRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUM1QyxPQUFPLEVBQUMscUJBQXFCLEVBQUUsZ0JBQWdCLEVBQUUsaUJBQWlCLEVBQUUsbUJBQW1CLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDekcsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ3RELE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQVExQyxPQUFPLEVBQUMsUUFBUSxJQUFJLFdBQVcsRUFBQyxNQUFNLFlBQVksQ0FBQztBQTJDbkQsTUFBTSxDQUFDLElBQU0sTUFBTSxHQUFnQjtJQUNqQyw2QkFBNkI7SUFDN0IsT0FBTyxFQUFFLEdBQUc7SUFFWiwyQ0FBMkM7SUFDM0MsS0FBSyxFQUFFLFNBQVM7SUFFaEIsNERBQTREO0lBQzVELG1CQUFtQixFQUFFO1FBQ25CLE9BQU8sRUFBRTtZQUNQLGNBQWMsRUFBRSwwQkFBMEI7U0FDM0M7S0FDRjtJQUVELG9EQUFvRDtJQUNwRCxjQUFjLEVBQUUsU0FBUyxJQUFJLE9BQU8sSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRTNFLDhEQUE4RDtJQUM5RCxjQUFjLEVBQUUsY0FBYyxDQUFDLGVBQWU7SUFFOUM7Ozs7Ozs7O09BUUc7SUFDSCxTQUFTLEVBQVQsVUFDRSxNQUFjLEVBQ2QsR0FBVyxFQUNYLElBQWEsRUFDYixjQUF5QjtRQUozQixpQkFxREM7UUEvQ0MsSUFBSSxJQUFlLENBQUM7UUFDcEIsSUFBSSxNQUFjLENBQUM7UUFDbkIsSUFBSSxPQUF5QixDQUFDO1FBRTlCLElB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RSxNQUFNLENBQUMsQ0FBQztZQUU3RCxPQUFPLGNBQWMsQ0FBQztTQUN2QjthQUFNO1lBQ0wsZUFBZSxDQUFDLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUVyRCxPQUFPLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBUyxDQUFDO1NBQy9DO0lBQ0gsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7c2V0TW9kZWxNZXRhS2V5LCBWaWV3fSBmcm9tICdkYXR4JztcbmltcG9ydCB7SURpY3Rpb25hcnl9IGZyb20gJ2RhdHgtdXRpbHMnO1xuaW1wb3J0IHtmZXRjaCwgUmVzcG9uc2V9IGZyb20gJ2lzb21vcnBoaWMtZmV0Y2gnO1xuXG5pbXBvcnQge2dldENhY2hlLCBzYXZlQ2FjaGV9IGZyb20gJy4vY2FjaGUnO1xuaW1wb3J0IHtNT0RFTF9QRVJTSVNURURfRklFTEQsIE1PREVMX1BST1BfRklFTEQsIE1PREVMX1FVRVVFX0ZJRUxELCBNT0RFTF9SRUxBVEVEX0ZJRUxEfSBmcm9tICcuL2NvbnN0cyc7XG5pbXBvcnQge1BhcmFtQXJyYXlUeXBlfSBmcm9tICcuL2VudW1zL1BhcmFtQXJyYXlUeXBlJztcbmltcG9ydCB7aXNCcm93c2VyfSBmcm9tICcuL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHtJSGVhZGVyc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lIZWFkZXJzJztcbmltcG9ydCB7SUpzb25hcGlDb2xsZWN0aW9ufSBmcm9tICcuL2ludGVyZmFjZXMvSUpzb25hcGlDb2xsZWN0aW9uJztcbmltcG9ydCB7SUpzb25hcGlNb2RlbH0gZnJvbSAnLi9pbnRlcmZhY2VzL0lKc29uYXBpTW9kZWwnO1xuaW1wb3J0IHtJUmF3UmVzcG9uc2V9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmF3UmVzcG9uc2UnO1xuaW1wb3J0IHtJUmVxdWVzdE9wdGlvbnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmVxdWVzdE9wdGlvbnMnO1xuaW1wb3J0IHtJUmVzcG9uc2VIZWFkZXJzfSBmcm9tICcuL2ludGVyZmFjZXMvSVJlc3BvbnNlSGVhZGVycyc7XG5pbXBvcnQge0lMaW5rLCBJUmVzcG9uc2V9IGZyb20gJy4vaW50ZXJmYWNlcy9Kc29uQXBpJztcbmltcG9ydCB7UmVzcG9uc2UgYXMgTGliUmVzcG9uc2V9IGZyb20gJy4vUmVzcG9uc2UnO1xuXG5kZWNsYXJlIHZhciB3aW5kb3c6IHtmZXRjaD86IGZldGNofTtcblxuZXhwb3J0IHR5cGUgRmV0Y2hUeXBlID0gKFxuICBtZXRob2Q6IHN0cmluZyxcbiAgdXJsOiBzdHJpbmcsXG4gIGJvZHk/OiBvYmplY3QsXG4gIHJlcXVlc3RIZWFkZXJzPzogSUhlYWRlcnMsXG4pID0+IFByb21pc2U8SVJhd1Jlc3BvbnNlPjtcblxuZXhwb3J0IGludGVyZmFjZSBJQ29sbGVjdGlvbkZldGNoT3B0cyB7XG4gIHVybDogc3RyaW5nO1xuICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zJntoZWFkZXJzPzogSUhlYWRlcnN9O1xuICBkYXRhPzogb2JqZWN0O1xuICBtZXRob2Q6IHN0cmluZztcbiAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbjtcbiAgc2tpcENhY2hlPzogYm9vbGVhbjtcbiAgdmlld3M/OiBBcnJheTxWaWV3Pjtcbn1cblxuZXhwb3J0IHR5cGUgQ29sbGVjdGlvbkZldGNoVHlwZSA9IDxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbD4ob3B0aW9uczogSUNvbGxlY3Rpb25GZXRjaE9wdHMpID0+IFByb21pc2U8TGliUmVzcG9uc2U8VD4+O1xuXG5leHBvcnQgaW50ZXJmYWNlIElSZXNwb25zZU9iamVjdCB7XG4gIGRhdGE6IElSZXNwb25zZTtcbiAgZXJyb3I/OiBFcnJvcjtcbiAgaGVhZGVyczogSVJlc3BvbnNlSGVhZGVycztcbiAgcmVxdWVzdEhlYWRlcnM6IElIZWFkZXJzO1xuICBzdGF0dXM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ29uZmlnVHlwZSB7XG4gIGJhc2VGZXRjaDogRmV0Y2hUeXBlO1xuICBiYXNlVXJsOiBzdHJpbmc7XG4gIGNhY2hlOiBib29sZWFuO1xuICBkZWZhdWx0RmV0Y2hPcHRpb25zOiBJRGljdGlvbmFyeTtcbiAgZmV0Y2hSZWZlcmVuY2U6IGZldGNoO1xuICBwYXJhbUFycmF5VHlwZTogUGFyYW1BcnJheVR5cGU7XG4gIG9uRXJyb3IoSVJlc3BvbnNlT2JqZWN0KTogSVJlc3BvbnNlT2JqZWN0O1xuICB0cmFuc2Zvcm1SZXF1ZXN0KG9wdGlvbnM6IElDb2xsZWN0aW9uRmV0Y2hPcHRzKTogSUNvbGxlY3Rpb25GZXRjaE9wdHM7XG4gIHRyYW5zZm9ybVJlc3BvbnNlKHJlc3BvbnNlOiBJUmF3UmVzcG9uc2UpOiBJUmF3UmVzcG9uc2U7XG59XG5cbmV4cG9ydCBjb25zdCBjb25maWc6IElDb25maWdUeXBlID0ge1xuICAvLyBCYXNlIFVSTCBmb3IgYWxsIEFQSSBjYWxsc1xuICBiYXNlVXJsOiAnLycsXG5cbiAgLy8gRW5hYmxlIGNhY2hpbmcgYnkgZGVmYXVsdCBpbiB0aGUgYnJvd3NlclxuICBjYWNoZTogaXNCcm93c2VyLFxuXG4gIC8vIERlZmF1bHQgb3B0aW9ucyB0aGF0IHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBmZXRjaCBmdW5jdGlvblxuICBkZWZhdWx0RmV0Y2hPcHRpb25zOiB7XG4gICAgaGVhZGVyczoge1xuICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi92bmQuYXBpK2pzb24nLFxuICAgIH0sXG4gIH0sXG5cbiAgLy8gUmVmZXJlbmNlIG9mIHRoZSBmZXRjaCBtZXRob2QgdGhhdCBzaG91bGQgYmUgdXNlZFxuICBmZXRjaFJlZmVyZW5jZTogaXNCcm93c2VyICYmICdmZXRjaCcgaW4gd2luZG93ICYmIHdpbmRvdy5mZXRjaC5iaW5kKHdpbmRvdyksXG5cbiAgLy8gRGV0ZXJtaW5lcyBob3cgd2lsbCB0aGUgcmVxdWVzdCBwYXJhbSBhcnJheXMgYmUgc3RyaW5naWZpZWRcbiAgcGFyYW1BcnJheVR5cGU6IFBhcmFtQXJyYXlUeXBlLkNPTU1BX1NFUEFSQVRFRCwgLy8gQXMgcmVjb21tZW5kZWQgYnkgdGhlIHNwZWNcblxuICAvKipcbiAgICogQmFzZSBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgZmV0Y2ggZnVuY3Rpb24gKGNhbiBiZSBvdmVycmlkZGVuKVxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kIEFQSSBjYWxsIG1ldGhvZFxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIEFQSSBjYWxsIFVSTFxuICAgKiBAcGFyYW0ge29iamVjdH0gW2JvZHldIEFQSSBjYWxsIGJvZHlcbiAgICogQHBhcmFtIHtJSGVhZGVyc30gW3JlcXVlc3RIZWFkZXJzXSBIZWFkZXJzIHRoYXQgd2lsbCBiZSBzZW50XG4gICAqIEByZXR1cm5zIHtQcm9taXNlPElSYXdSZXNwb25zZT59IFJlc29sdmVzIHdpdGggYSByYXcgcmVzcG9uc2Ugb2JqZWN0XG4gICAqL1xuICBiYXNlRmV0Y2goXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgYm9keT86IG9iamVjdCxcbiAgICByZXF1ZXN0SGVhZGVycz86IElIZWFkZXJzLFxuICApOiBQcm9taXNlPElSYXdSZXNwb25zZT4ge1xuICAgIGxldCBkYXRhOiBJUmVzcG9uc2U7XG4gICAgbGV0IHN0YXR1czogbnVtYmVyO1xuICAgIGxldCBoZWFkZXJzOiBJUmVzcG9uc2VIZWFkZXJzO1xuXG4gICAgY29uc3QgcmVxdWVzdDogUHJvbWlzZTx2b2lkPiA9IFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgY29uc3QgdXBwZXJjYXNlTWV0aG9kID0gbWV0aG9kLnRvVXBwZXJDYXNlKCk7XG4gICAgY29uc3QgaXNCb2R5U3VwcG9ydGVkID0gdXBwZXJjYXNlTWV0aG9kICE9PSAnR0VUJyAmJiB1cHBlcmNhc2VNZXRob2QgIT09ICdIRUFEJztcblxuICAgIHJldHVybiByZXF1ZXN0XG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRIZWFkZXJzID0gY29uZmlnLmRlZmF1bHRGZXRjaE9wdGlvbnMuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgY29uc3QgcmVxSGVhZGVyczogSUhlYWRlcnMgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0SGVhZGVycywgcmVxdWVzdEhlYWRlcnMpIGFzIElIZWFkZXJzO1xuICAgICAgICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnLmRlZmF1bHRGZXRjaE9wdGlvbnMsIHtcbiAgICAgICAgICBib2R5OiBpc0JvZHlTdXBwb3J0ZWQgJiYgSlNPTi5zdHJpbmdpZnkoYm9keSkgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIGhlYWRlcnM6IHJlcUhlYWRlcnMsXG4gICAgICAgICAgbWV0aG9kLFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5mZXRjaFJlZmVyZW5jZSh1cmwsIG9wdGlvbnMpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKChyZXNwb25zZTogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgc3RhdHVzID0gcmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgICBoZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVycztcblxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3I6IEVycm9yKSA9PiB7XG4gICAgICAgIGlmIChzdGF0dXMgPT09IDIwNCkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfSlcbiAgICAgIC50aGVuKChyZXNwb25zZURhdGE6IElSZXNwb25zZSkgPT4ge1xuICAgICAgICBkYXRhID0gcmVzcG9uc2VEYXRhO1xuICAgICAgICBpZiAoc3RhdHVzID49IDQwMCkge1xuICAgICAgICAgIHRocm93IHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBJbnZhbGlkIEhUVFAgc3RhdHVzOiAke3N0YXR1c31gLFxuICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge2RhdGEsIGhlYWRlcnMsIHJlcXVlc3RIZWFkZXJzLCBzdGF0dXN9O1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMub25FcnJvcih7ZGF0YSwgZXJyb3IsIGhlYWRlcnMsIHJlcXVlc3RIZWFkZXJzLCBzdGF0dXN9KTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIG9uRXJyb3IocmVzcDogSVJlc3BvbnNlT2JqZWN0KSB7XG4gICAgcmV0dXJuIHJlc3A7XG4gIH0sXG5cbiAgdHJhbnNmb3JtUmVxdWVzdChvcHRpb25zOiBJQ29sbGVjdGlvbkZldGNoT3B0cyk6IElDb2xsZWN0aW9uRmV0Y2hPcHRzIHtcbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfSxcblxuICB0cmFuc2Zvcm1SZXNwb25zZShyZXNwb25zZTogSVJhd1Jlc3BvbnNlKTogSVJhd1Jlc3BvbnNlIHtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH0sXG59O1xuXG4vKipcbiAqIEJhc2UgaW1wbGVtZW50YXRpb24gb2YgdGhlIHN0YXRlZnVsIGZldGNoIGZ1bmN0aW9uIChjYW4gYmUgb3ZlcnJpZGRlbilcbiAqXG4gKiBAcGFyYW0ge0lDb2xsZWN0aW9uRmV0Y2hPcHRzfSByZXFPcHRpb25zIEFQSSByZXF1ZXN0IG9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIHJlc3BvbnNlIG9iamVjdFxuICovXG5mdW5jdGlvbiBjb2xsZWN0aW9uRmV0Y2g8VCBleHRlbmRzIElKc29uYXBpTW9kZWw+KHJlcU9wdGlvbnM6IElDb2xsZWN0aW9uRmV0Y2hPcHRzKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICBjb25zdCB7XG4gICAgdXJsLFxuICAgIG9wdGlvbnMsXG4gICAgZGF0YSxcbiAgICBtZXRob2QgPSAnR0VUJyxcbiAgICBjb2xsZWN0aW9uLFxuICAgIHZpZXdzLFxuICB9ID0gY29uZmlnLnRyYW5zZm9ybVJlcXVlc3QocmVxT3B0aW9ucyk7XG5cbiAgY29uc3Qgc3RhdGljQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb24gJiYgY29sbGVjdGlvbi5jb25zdHJ1Y3RvciBhcyB7Y2FjaGU/OiBib29sZWFufTtcbiAgY29uc3QgY29sbGVjdGlvbkNhY2hlID0gc3RhdGljQ29sbGVjdGlvbiAmJiBzdGF0aWNDb2xsZWN0aW9uLmNhY2hlO1xuICBjb25zdCBpc0NhY2hlU3VwcG9ydGVkID0gbWV0aG9kLnRvVXBwZXJDYXNlKCkgPT09ICdHRVQnO1xuICBjb25zdCBza2lwQ2FjaGUgPSByZXFPcHRpb25zLm9wdGlvbnMgJiYgcmVxT3B0aW9ucy5vcHRpb25zLnNraXBDYWNoZTtcblxuICBpZiAoY29uZmlnLmNhY2hlICYmIGlzQ2FjaGVTdXBwb3J0ZWQgJiYgY29sbGVjdGlvbkNhY2hlICYmICFza2lwQ2FjaGUpIHtcbiAgICBjb25zdCBjYWNoZSA9IGdldENhY2hlKHVybCk7XG4gICAgaWYgKGNhY2hlKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNhY2hlLnJlc3BvbnNlKSBhcyBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PjtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gY29uZmlnLmJhc2VGZXRjaChtZXRob2QsIHVybCwgZGF0YSwgb3B0aW9ucyAmJiBvcHRpb25zLmhlYWRlcnMpXG4gICAgLnRoZW4oKHJlc3BvbnNlOiBJUmF3UmVzcG9uc2UpID0+IHtcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb25SZXNwb25zZSA9IE9iamVjdC5hc3NpZ24ocmVzcG9uc2UsIHtjb2xsZWN0aW9ufSk7XG4gICAgICBjb25zdCByZXNwID0gbmV3IExpYlJlc3BvbnNlPFQ+KFxuICAgICAgICBjb25maWcudHJhbnNmb3JtUmVzcG9uc2UoY29sbGVjdGlvblJlc3BvbnNlKSwgY29sbGVjdGlvbiwgb3B0aW9ucywgdW5kZWZpbmVkLCB2aWV3cyxcbiAgICAgICk7XG4gICAgICBpZiAoY29uZmlnLmNhY2hlICYmIGlzQ2FjaGVTdXBwb3J0ZWQpIHtcbiAgICAgICAgc2F2ZUNhY2hlKHVybCwgcmVzcCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXNwO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmV0Y2g8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihvcHRpb25zOiBJQ29sbGVjdGlvbkZldGNoT3B0cykge1xuICByZXR1cm4gY29sbGVjdGlvbkZldGNoPFQ+KG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIEFQSSBjYWxsIHVzZWQgdG8gZ2V0IGRhdGEgZnJvbSB0aGUgc2VydmVyXG4gKlxuICogQGV4cG9ydFxuICogQHBhcmFtIHtJSnNvbmFwaUNvbGxlY3Rpb259IGNvbGxlY3Rpb24gUmVsYXRlZCBjb2xsZWN0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIEFQSSBjYWxsIFVSTFxuICogQHBhcmFtIHtJSGVhZGVyc30gW2hlYWRlcnNdIEhlYWRlcnMgdG8gYmUgc2VudFxuICogQHBhcmFtIHtJUmVxdWVzdE9wdGlvbnN9IFtvcHRpb25zXSBTZXJ2ZXIgb3B0aW9uc1xuICogQHBhcmFtIHtBcnJheTxWaWV3Pn0gW3ZpZXdzXSBSZXF1ZXN0IHZpZXdcbiAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIFJlc3BvbnNlIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZDxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICB1cmw6IHN0cmluZyxcbiAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgaGVhZGVycz86IElIZWFkZXJzLFxuICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuICB2aWV3cz86IEFycmF5PFZpZXc+LFxuKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICByZXR1cm4gY29sbGVjdGlvbkZldGNoPFQ+KHtcbiAgICBjb2xsZWN0aW9uLFxuICAgIGRhdGE6IHVuZGVmaW5lZCxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIG9wdGlvbnM6IHsuLi5vcHRpb25zLCBoZWFkZXJzfSxcbiAgICB1cmwsXG4gICAgdmlld3MsXG4gIH0pO1xufVxuXG4vKipcbiAqIEFQSSBjYWxsIHVzZWQgdG8gY3JlYXRlIGRhdGEgb24gdGhlIHNlcnZlclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7SUpzb25hcGlDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIFJlbGF0ZWQgY29sbGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBBUEkgY2FsbCBVUkxcbiAqIEBwYXJhbSB7b2JqZWN0fSBbZGF0YV0gUmVxdWVzdCBib2R5XG4gKiBAcGFyYW0ge0lIZWFkZXJzfSBbaGVhZGVyc10gSGVhZGVycyB0byBiZSBzZW50XG4gKiBAcGFyYW0ge0lSZXF1ZXN0T3B0aW9uc30gW29wdGlvbnNdIFNlcnZlciBvcHRpb25zXG4gKiBAcGFyYW0ge0FycmF5PFZpZXc+fSBbdmlld3NdIFJlcXVlc3Qgdmlld1xuICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSBSZXNvbHZlcyB3aXRoIGEgUmVzcG9uc2Ugb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGU8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihcbiAgdXJsOiBzdHJpbmcsXG4gIGRhdGE/OiBvYmplY3QsXG4gIGNvbGxlY3Rpb24/OiBJSnNvbmFwaUNvbGxlY3Rpb24sXG4gIGhlYWRlcnM/OiBJSGVhZGVycyxcbiAgb3B0aW9ucz86IElSZXF1ZXN0T3B0aW9ucyxcbiAgdmlld3M/OiBBcnJheTxWaWV3Pixcbik6IFByb21pc2U8TGliUmVzcG9uc2U8VD4+IHtcbiAgcmV0dXJuIGNvbGxlY3Rpb25GZXRjaDxUPih7XG4gICAgY29sbGVjdGlvbixcbiAgICBkYXRhLFxuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIG9wdGlvbnM6IHsuLi5vcHRpb25zLCBoZWFkZXJzfSxcbiAgICB1cmwsXG4gICAgdmlld3MsXG4gIH0pO1xufVxuXG4vKipcbiAqIEFQSSBjYWxsIHVzZWQgdG8gdXBkYXRlIGRhdGEgb24gdGhlIHNlcnZlclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7SUpzb25hcGlDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIFJlbGF0ZWQgY29sbGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBBUEkgY2FsbCBVUkxcbiAqIEBwYXJhbSB7b2JqZWN0fSBbZGF0YV0gUmVxdWVzdCBib2R5XG4gKiBAcGFyYW0ge0lIZWFkZXJzfSBbaGVhZGVyc10gSGVhZGVycyB0byBiZSBzZW50XG4gKiBAcGFyYW0ge0lSZXF1ZXN0T3B0aW9uc30gW29wdGlvbnNdIFNlcnZlciBvcHRpb25zXG4gKiBAcGFyYW0ge0FycmF5PFZpZXc+fSBbdmlld3NdIFJlcXVlc3Qgdmlld1xuICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSBSZXNvbHZlcyB3aXRoIGEgUmVzcG9uc2Ugb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGU8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihcbiAgdXJsOiBzdHJpbmcsXG4gIGRhdGE/OiBvYmplY3QsXG4gIGNvbGxlY3Rpb24/OiBJSnNvbmFwaUNvbGxlY3Rpb24sXG4gIGhlYWRlcnM/OiBJSGVhZGVycyxcbiAgb3B0aW9ucz86IElSZXF1ZXN0T3B0aW9ucyxcbiAgdmlld3M/OiBBcnJheTxWaWV3Pixcbik6IFByb21pc2U8TGliUmVzcG9uc2U8VD4+IHtcbiAgcmV0dXJuIGNvbGxlY3Rpb25GZXRjaDxUPih7XG4gICAgY29sbGVjdGlvbixcbiAgICBkYXRhLFxuICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICBvcHRpb25zOiB7Li4ub3B0aW9ucywgaGVhZGVyc30sXG4gICAgdXJsLFxuICAgIHZpZXdzLFxuICB9KTtcbn1cblxuLyoqXG4gKiBBUEkgY2FsbCB1c2VkIHRvIHJlbW92ZSBkYXRhIGZyb20gdGhlIHNlcnZlclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7SUpzb25hcGlDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIFJlbGF0ZWQgY29sbGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBBUEkgY2FsbCBVUkxcbiAqIEBwYXJhbSB7SUhlYWRlcnN9IFtoZWFkZXJzXSBIZWFkZXJzIHRvIGJlIHNlbnRcbiAqIEBwYXJhbSB7SVJlcXVlc3RPcHRpb25zfSBbb3B0aW9uc10gU2VydmVyIG9wdGlvbnNcbiAqIEBwYXJhbSB7QXJyYXk8Vmlldz59IFt2aWV3c10gUmVxdWVzdCB2aWV3XG4gKiBAcmV0dXJucyB7UHJvbWlzZTxSZXNwb25zZT59IFJlc29sdmVzIHdpdGggYSBSZXNwb25zZSBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZTxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICB1cmw6IHN0cmluZyxcbiAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgaGVhZGVycz86IElIZWFkZXJzLFxuICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuICB2aWV3cz86IEFycmF5PFZpZXc+LFxuKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICByZXR1cm4gY29sbGVjdGlvbkZldGNoPFQ+KHtcbiAgICBjb2xsZWN0aW9uLFxuICAgIGRhdGE6IHVuZGVmaW5lZCxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIG9wdGlvbnM6IHsuLi5vcHRpb25zLCBoZWFkZXJzfSxcbiAgICB1cmwsXG4gICAgdmlld3MsXG4gIH0pO1xufVxuXG4vKipcbiAqIEZldGNoIGEgbGluayBmcm9tIHRoZSBzZXJ2ZXJcbiAqXG4gKiBAZXhwb3J0XG4gKiBAcGFyYW0ge0pzb25BcGkuSUxpbmt9IGxpbmsgTGluayBVUkwgb3IgYSBsaW5rIG9iamVjdFxuICogQHBhcmFtIHtJSnNvbmFwaUNvbGxlY3Rpb259IGNvbGxlY3Rpb24gU3RvcmUgdGhhdCB3aWxsIGJlIHVzZWQgdG8gc2F2ZSB0aGUgcmVzcG9uc2VcbiAqIEBwYXJhbSB7SURpY3Rpb25hcnk8c3RyaW5nPn0gW3JlcXVlc3RIZWFkZXJzXSBSZXF1ZXN0IGhlYWRlcnNcbiAqIEBwYXJhbSB7SVJlcXVlc3RPcHRpb25zfSBbb3B0aW9uc10gU2VydmVyIG9wdGlvbnNcbiAqIEBwYXJhbSB7QXJyYXk8Vmlldz59IFt2aWV3c10gUmVxdWVzdCB2aWV3XG4gKiBAcmV0dXJucyB7UHJvbWlzZTxMaWJSZXNwb25zZT59IFJlc3BvbnNlIHByb21pc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZldGNoTGluazxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbCA9IElKc29uYXBpTW9kZWw+KFxuICBsaW5rOiBJTGluayxcbiAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgcmVxdWVzdEhlYWRlcnM/OiBJRGljdGlvbmFyeTxzdHJpbmc+LFxuICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuICB2aWV3cz86IEFycmF5PFZpZXc+LFxuKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICBpZiAobGluaykge1xuICAgIGNvbnN0IGhyZWY6IHN0cmluZyA9IHR5cGVvZiBsaW5rID09PSAnb2JqZWN0JyA/IGxpbmsuaHJlZiA6IGxpbms7XG5cbiAgICBpZiAoaHJlZikge1xuICAgICAgcmV0dXJuIHJlYWQ8VD4oaHJlZiwgY29sbGVjdGlvbiwgcmVxdWVzdEhlYWRlcnMsIG9wdGlvbnMsIHZpZXdzKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBMaWJSZXNwb25zZSh7ZGF0YTogdW5kZWZpbmVkfSwgY29sbGVjdGlvbikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlUmVzcG9uc2U8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihcbiAgcmVjb3JkOiBULFxuICBwcm9wPzogc3RyaW5nLFxuKTogKHJlc3BvbnNlOiBMaWJSZXNwb25zZTxUPikgPT4gVCB7XG4gIHJldHVybiAocmVzcG9uc2U6IExpYlJlc3BvbnNlPFQ+KTogVCA9PiB7XG4gICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7XG4gICAgICB0aHJvdyByZXNwb25zZS5lcnJvcjtcbiAgICB9XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDQpIHtcbiAgICAgIHNldE1vZGVsTWV0YUtleShyZWNvcmQsIE1PREVMX1BFUlNJU1RFRF9GSUVMRCwgdHJ1ZSk7XG5cbiAgICAgIHJldHVybiByZWNvcmQ7XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMikge1xuICAgICAgY29uc3QgcmVzcG9uc2VSZWNvcmQgPSByZXNwb25zZS5kYXRhIGFzIFQ7XG4gICAgICBzZXRNb2RlbE1ldGFLZXkocmVzcG9uc2VSZWNvcmQsIE1PREVMX1BST1BfRklFTEQsIHByb3ApO1xuICAgICAgc2V0TW9kZWxNZXRhS2V5KHJlc3BvbnNlUmVjb3JkLCBNT0RFTF9RVUVVRV9GSUVMRCwgdHJ1ZSk7XG4gICAgICBzZXRNb2RlbE1ldGFLZXkocmVzcG9uc2VSZWNvcmQsIE1PREVMX1JFTEFURURfRklFTEQsIHJlY29yZCk7XG5cbiAgICAgIHJldHVybiByZXNwb25zZVJlY29yZDtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0TW9kZWxNZXRhS2V5KHJlY29yZCwgTU9ERUxfUEVSU0lTVEVEX0ZJRUxELCB0cnVlKTtcblxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnJlcGxhY2VEYXRhKHJlY29yZCkuZGF0YSBhcyBUO1xuICAgIH1cbiAgfTtcbn1cbiJdfQ==","dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/NetworkUtils.d.ts","text":"import { View } from 'datx';\r\nimport { IDictionary } from 'datx-utils';\r\nimport { fetch } from 'isomorphic-fetch';\r\nimport { ParamArrayType } from './enums/ParamArrayType';\r\nimport { IHeaders } from './interfaces/IHeaders';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nimport { IJsonapiModel } from './interfaces/IJsonapiModel';\r\nimport { IRawResponse } from './interfaces/IRawResponse';\r\nimport { IRequestOptions } from './interfaces/IRequestOptions';\r\nimport { IResponseHeaders } from './interfaces/IResponseHeaders';\r\nimport { ILink, IResponse } from './interfaces/JsonApi';\r\nimport { Response as LibResponse } from './Response';\r\nexport declare type FetchType = (method: string, url: string, body?: object, requestHeaders?: IHeaders) => Promise<IRawResponse>;\r\nexport interface ICollectionFetchOpts {\r\n    url: string;\r\n    options?: IRequestOptions & {\r\n        headers?: IHeaders;\r\n    };\r\n    data?: object;\r\n    method: string;\r\n    collection?: IJsonapiCollection;\r\n    skipCache?: boolean;\r\n    views?: Array<View>;\r\n}\r\nexport declare type CollectionFetchType = <T extends IJsonapiModel>(options: ICollectionFetchOpts) => Promise<LibResponse<T>>;\r\nexport interface IResponseObject {\r\n    data: IResponse;\r\n    error?: Error;\r\n    headers: IResponseHeaders;\r\n    requestHeaders: IHeaders;\r\n    status: number;\r\n}\r\nexport interface IConfigType {\r\n    baseFetch: FetchType;\r\n    baseUrl: string;\r\n    cache: boolean;\r\n    defaultFetchOptions: IDictionary;\r\n    fetchReference: fetch;\r\n    paramArrayType: ParamArrayType;\r\n    onError(IResponseObject: any): IResponseObject;\r\n    transformRequest(options: ICollectionFetchOpts): ICollectionFetchOpts;\r\n    transformResponse(response: IRawResponse): IRawResponse;\r\n}\r\nexport declare const config: IConfigType;\r\nexport declare function fetch<T extends IJsonapiModel = IJsonapiModel>(options: ICollectionFetchOpts): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to get data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function read<T extends IJsonapiModel = IJsonapiModel>(url: string, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions, views?: Array<View>): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to create data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function create<T extends IJsonapiModel = IJsonapiModel>(url: string, data?: object, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions, views?: Array<View>): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to update data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function update<T extends IJsonapiModel = IJsonapiModel>(url: string, data?: object, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions, views?: Array<View>): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to remove data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function remove<T extends IJsonapiModel = IJsonapiModel>(url: string, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions, views?: Array<View>): Promise<LibResponse<T>>;\r\n/**\r\n * Fetch a link from the server\r\n *\r\n * @export\r\n * @param {JsonApi.ILink} link Link URL or a link object\r\n * @param {IJsonapiCollection} collection Store that will be used to save the response\r\n * @param {IDictionary<string>} [requestHeaders] Request headers\r\n * @param {IRequestOptions} [options] Server options\r\n * @param {Array<View>} [views] Request view\r\n * @returns {Promise<LibResponse>} Response promise\r\n */\r\nexport declare function fetchLink<T extends IJsonapiModel = IJsonapiModel>(link: ILink, collection?: IJsonapiCollection, requestHeaders?: IDictionary<string>, options?: IRequestOptions, views?: Array<View>): Promise<LibResponse<T>>;\r\nexport declare function handleResponse<T extends IJsonapiModel = IJsonapiModel>(record: T, prop?: string): (response: LibResponse<T>) => T;\r\n"}}
