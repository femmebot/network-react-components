{"code":"import * as tslib_1 from \"tslib\";\r\nimport { getModelId, getModelType, modelToJSON, updateModel, updateModelId } from 'datx';\r\nimport { assignComputed } from 'datx-utils';\r\nimport { action } from 'mobx';\r\nimport { GenericModel } from './GenericModel';\r\nimport { flattenModel } from './helpers/model';\r\nimport { fetchLink } from './NetworkUtils';\r\nvar Response = /** @class */ (function () {\r\n    function Response(response, collection, options, overrideData, views) {\r\n        var _this = this;\r\n        /**\r\n         * API response data (synced with the store)\r\n         *\r\n         * @type {(PureModel|Array<PureModel>)}\r\n         * @memberOf Response\r\n         */\r\n        this.data = null;\r\n        this.views = [];\r\n        /**\r\n         * Cache used for the link requests\r\n         *\r\n         * @private\r\n         * @type {IDictionary<Promise<Response>>}\r\n         * @memberOf Response\r\n         */\r\n        this.__cache = {};\r\n        this.__collection = collection;\r\n        this.__options = options;\r\n        this.__response = response;\r\n        this.status = response.status;\r\n        if (views) {\r\n            this.views = views;\r\n        }\r\n        if (collection) {\r\n            this.data = overrideData ? collection.add(overrideData) : collection.sync(response.data);\r\n        }\r\n        else if (response.data) {\r\n            // The case when a record is not in a store and save/remove are used\r\n            var resp = response.data;\r\n            if (resp.data) {\r\n                if (resp.data instanceof Array) {\r\n                    throw new Error('A save/remove operation should not return an array of results');\r\n                }\r\n                this.data = overrideData || new GenericModel(flattenModel(resp.data));\r\n            }\r\n        }\r\n        this.views.forEach(function (view) {\r\n            if (_this.data) {\r\n                view.add(_this.data);\r\n            }\r\n        });\r\n        this.meta = (response.data && response.data.meta) || {};\r\n        this.links = (response.data && response.data.links) || {};\r\n        this.jsonapi = (response.data && response.data.jsonapi) || {};\r\n        this.headers = response.headers;\r\n        this.requestHeaders = response.requestHeaders;\r\n        this.error = (response.data && response.data.errors) || response.error;\r\n        var linkGetter = {};\r\n        if (this.links) {\r\n            Object.keys(this.links).forEach(function (link) {\r\n                assignComputed(_this, link, function () { return _this.__fetchLink(link); });\r\n            });\r\n        }\r\n        Object.freeze(this);\r\n        if (this.error) {\r\n            throw this;\r\n        }\r\n    }\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.replaceData = function (data) {\r\n        var record = this.data;\r\n        if (record === data) {\r\n            return this;\r\n        }\r\n        var oldId = getModelId(data);\r\n        var newId = getModelId(record);\r\n        var type = getModelType(record);\r\n        var viewIndexes = this.views.map(function (view) { return view.list.indexOf(record); });\r\n        if (this.__collection) {\r\n            this.__collection.remove(record);\r\n            this.__collection.add(data);\r\n        }\r\n        updateModel(data, modelToJSON(record));\r\n        updateModelId(data, newId);\r\n        this.views.forEach(function (view, index) {\r\n            if (viewIndexes[index] !== -1) {\r\n                view.list[viewIndexes[index]] = data;\r\n            }\r\n        });\r\n        return new Response(this.__response, this.__collection, this.__options, data);\r\n    };\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.__fetchLink = function (name) {\r\n        if (!this.__cache[name]) {\r\n            var link = (this.links && name in this.links) ? this.links[name] : null;\r\n            if (link) {\r\n                this.__cache[name] = fetchLink(link, this.__collection, this.requestHeaders, this.__options, this.views);\r\n            }\r\n        }\r\n        return this.__cache[name];\r\n    };\r\n    tslib_1.__decorate([\r\n        action\r\n    ], Response.prototype, \"replaceData\", null);\r\n    return Response;\r\n}());\r\nexport { Response };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzcG9uc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvUmVzcG9uc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBYSxXQUFXLEVBQUUsYUFBYSxFQUFPLE1BQU0sTUFBTSxDQUFDO0FBQ3hHLE9BQU8sRUFBQyxjQUFjLEVBQWMsTUFBTSxZQUFZLENBQUM7QUFDdkQsT0FBTyxFQUFDLE1BQU0sRUFBbUMsTUFBTSxNQUFNLENBQUM7QUFTOUQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUU3QyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFekM7SUF1SUUsa0JBQ0UsUUFBc0IsRUFDdEIsVUFBK0IsRUFDL0IsT0FBeUIsRUFDekIsWUFBeUIsRUFDekIsS0FBbUI7UUFMckIsaUJBdURDO1FBN0xEOzs7OztXQUtHO1FBQ0ksU0FBSSxHQUFvQixJQUFJLENBQUM7UUEwRjdCLFVBQUssR0FBZ0IsRUFBRSxDQUFDO1FBNkIvQjs7Ozs7O1dBTUc7UUFDSyxZQUFPLEdBQXNDLEVBQUUsQ0FBQztRQVN0RCxJQUFJLENBQUMsWUFBWSxHQUFHLFVBQVUsQ0FBQztRQUMvQixJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQztRQUN6QixJQUFJLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDOUIsSUFBSSxLQUFLLEVBQUU7WUFDVCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztTQUNwQjtRQUVELElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUksWUFBaUIs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LEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUN6RSxDQUFDO2FBQ0g7U0FDRjtRQUVELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBbERPO1FBQVAsTUFBTTsrQ0EyQk47SUF3QkgsZUFBQztDQUFBLEFBM1BELElBMlBDO1NBM1BZLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2dldE1vZGVsSWQsIGdldE1vZGVsVHlwZSwgbW9kZWxUb0pTT04sIFB1cmVNb2RlbCwgdXBkYXRlTW9kZWwsIHVwZGF0ZU1vZGVsSWQsIFZpZXd9IGZyb20gJ2RhdHgnO1xuaW1wb3J0IHthc3NpZ25Db21wdXRlZCwgSURpY3Rpb25hcnl9IGZyb20gJ2RhdHgtdXRpbHMnO1xuaW1wb3J0IHthY3Rpb24sIGV4dGVuZE9ic2VydmFibGUsIElDb21wdXRlZFZhbHVlfSBmcm9tICdtb2J4JztcblxuaW1wb3J0IHtJSGVhZGVyc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lIZWFkZXJzJztcbmltcG9ydCB7SUpzb25hcGlNb2RlbH0gZnJvbSAnLi9pbnRlcmZhY2VzL0lKc29uYXBpTW9kZWwnO1xuaW1wb3J0IHtJUmF3UmVzcG9uc2V9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmF3UmVzcG9uc2UnO1xuaW1wb3J0IHtJUmVxdWVzdE9wdGlvbnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmVxdWVzdE9wdGlvbnMnO1xuaW1wb3J0IHtJUmVzcG9uc2VIZWFkZXJzfSBmcm9tICcuL2ludGVyZmFjZXMvSVJlc3BvbnNlSGVhZGVycyc7XG5pbXBvcnQge0lFcnJvciwgSUpzb25BcGlPYmplY3QsIElMaW5rfSBmcm9tICcuL2ludGVyZmFjZXMvSnNvbkFwaSc7XG5cbmltcG9ydCB7R2VuZXJpY01vZGVsfSBmcm9tICcuL0dlbmVyaWNNb2RlbCc7XG5pbXBvcnQge2ZsYXR0ZW5Nb2RlbH0gZnJvbSAnLi9oZWxwZXJzL21vZGVsJztcbmltcG9ydCB7SUpzb25hcGlDb2xsZWN0aW9ufSBmcm9tICcuL2ludGVyZmFjZXMvSUpzb25hcGlDb2xsZWN0aW9uJztcbmltcG9ydCB7ZmV0Y2hMaW5rfSBmcm9tICcuL05ldHdvcmtVdGlscyc7XG5cbmV4cG9ydCBjbGFzcyBSZXNwb25zZTxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbD4ge1xuICAvKipcbiAgICogQVBJIHJlc3BvbnNlIGRhdGEgKHN5bmNlZCB3aXRoIHRoZSBzdG9yZSlcbiAgICpcbiAgICogQHR5cGUgeyhQdXJlTW9kZWx8QXJyYXk8UHVyZU1vZGVsPil9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGRhdGE6IFR8QXJyYXk8VD58bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEFQSSByZXNwb25zZSBtZXRhZGF0YVxuICAgKlxuICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBtZXRhPzogb2JqZWN0O1xuXG4gIC8qKlxuICAgKiBBUEkgcmVzcG9uc2UgbGlua3NcbiAgICpcbiAgICogQHR5cGUge29iamVjdH1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgbGlua3M/OiBJRGljdGlvbmFyeTxJTGluaz47XG5cbiAgLyoqXG4gICAqIFRoZSBKU09OIEFQSSBvYmplY3QgcmV0dXJuZWQgYnkgdGhlIHNlcnZlclxuICAgKlxuICAgKiBAdHlwZSB7SnNvbkFwaS5JSnNvbkFwaU9iamVjdH1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMganNvbmFwaT86IElKc29uQXBpT2JqZWN0O1xuXG4gIC8qKlxuICAgKiBIZWFkZXJzIHJlY2VpdmVkIGZyb20gdGhlIEFQSSBjYWxsXG4gICAqXG4gICAqIEB0eXBlIHtJUmVzcG9uc2VIZWFkZXJzfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBoZWFkZXJzPzogSVJlc3BvbnNlSGVhZGVycztcblxuICAvKipcbiAgICogSGVhZGVycyBzZW50IHRvIHRoZSBzZXJ2ZXJcbiAgICpcbiAgICogQHR5cGUge0lIZWFkZXJzfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyByZXF1ZXN0SGVhZGVycz86IElIZWFkZXJzO1xuXG4gIC8qKlxuICAgKiBSZXF1ZXN0IGVycm9yXG4gICAqXG4gICAqIEB0eXBlIHsoQXJyYXk8SnNvbkFwaS5JRXJyb3I+fEVycm9yKX1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgZXJyb3I/OiBBcnJheTxJRXJyb3I+fEVycm9yO1xuXG4gIC8qKlxuICAgKiBGaXJzdCBkYXRhIHBhZ2VcbiAgICpcbiAgICogQHR5cGUge1Byb21pc2U8UmVzcG9uc2U+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBmaXJzdD86IFByb21pc2U8UmVzcG9uc2U8VD4+OyAvLyBIYW5kbGVkIGJ5IHRoZSBfX2ZldGNoTGlua1xuXG4gIC8qKlxuICAgKiBQcmV2aW91cyBkYXRhIHBhZ2VcbiAgICpcbiAgICogQHR5cGUge1Byb21pc2U8UmVzcG9uc2U+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBwcmV2PzogUHJvbWlzZTxSZXNwb25zZTxUPj47IC8vIEhhbmRsZWQgYnkgdGhlIF9fZmV0Y2hMaW5rXG5cbiAgLyoqXG4gICAqIE5leHQgZGF0YSBwYWdlXG4gICAqXG4gICAqIEB0eXBlIHtQcm9taXNlPFJlc3BvbnNlPn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgbmV4dD86IFByb21pc2U8UmVzcG9uc2U8VD4+OyAvLyBIYW5kbGVkIGJ5IHRoZSBfX2ZldGNoTGlua1xuXG4gIC8qKlxuICAgKiBMYXN0IGRhdGEgcGFnZVxuICAgKlxuICAgKiBAdHlwZSB7UHJvbWlzZTxSZXNwb25zZT59XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGxhc3Q/OiBQcm9taXNlPFJlc3BvbnNlPFQ+PjsgLy8gSGFuZGxlZCBieSB0aGUgX19mZXRjaExpbmtcblxuICAvKipcbiAgICogUmVjZWl2ZWQgSFRUUCBzdGF0dXNcbiAgICpcbiAgICogQHR5cGUge251bWJlcn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgc3RhdHVzPzogbnVtYmVyO1xuXG4gIHB1YmxpYyB2aWV3czogQXJyYXk8Vmlldz4gPSBbXTtcblxuICAvKipcbiAgICogUmVsYXRlZCBTdG9yZVxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SUpzb25hcGlDb2xsZWN0aW9ufVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19jb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uO1xuXG4gIC8qKlxuICAgKiBTZXJ2ZXIgb3B0aW9uc1xuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SVJlcXVlc3RPcHRpb25zfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19vcHRpb25zPzogSVJlcXVlc3RPcHRpb25zO1xuXG4gIC8qKlxuICAgKiBPcmlnaW5hbCBzZXJ2ZXIgcmVzcG9uc2VcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHR5cGUge0lSYXdSZXNwb25zZX1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwcml2YXRlIF9fcmVzcG9uc2U6IElSYXdSZXNwb25zZTtcblxuICAvKipcbiAgICogQ2FjaGUgdXNlZCBmb3IgdGhlIGxpbmsgcmVxdWVzdHNcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHR5cGUge0lEaWN0aW9uYXJ5PFByb21pc2U8UmVzcG9uc2U+Pn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwcml2YXRlIF9fY2FjaGU6IElEaWN0aW9uYXJ5PFByb21pc2U8UmVzcG9uc2U8VD4+PiA9IHt9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHJlc3BvbnNlOiBJUmF3UmVzcG9uc2UsXG4gICAgY29sbGVjdGlvbj86IElKc29uYXBpQ29sbGVjdGlvbixcbiAgICBvcHRpb25zPzogSVJlcXVlc3RPcHRpb25zLFxuICAgIG92ZXJyaWRlRGF0YT86IFR8QXJyYXk8VD4sXG4gICAgdmlld3M/OiBBcnJheTxWaWV3PixcbiAgKSB7XG4gICAgdGhpcy5fX2NvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIHRoaXMuX19vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLl9fcmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICB0aGlzLnN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1cztcbiAgICBpZiAodmlld3MpIHtcbiAgICAgIHRoaXMudmlld3MgPSB2aWV3cztcbiAgICB9XG5cbiAgICBpZiAoY29sbGVjdGlvbikge1xuICAgICAgdGhpcy5kYXRhID0gb3ZlcnJpZGVEYXRhID8gY29sbGVjdGlvbi5hZGQ8VD4ob3ZlcnJpZGVEYXRhIGFzIFQpIDogY29sbGVjdGlvbi5zeW5jPFQ+KHJlc3BvbnNlLmRhdGEpO1xuICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSkge1xuICAgICAgLy8gVGhlIGNhc2Ugd2hlbiBhIHJlY29yZCBpcyBub3QgaW4gYSBzdG9yZSBhbmQgc2F2ZS9yZW1vdmUgYXJlIHVzZWRcbiAgICAgIGNvbnN0IHJlc3AgPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICBpZiAocmVzcC5kYXRhKSB7XG4gICAgICAgIGlmIChyZXNwLmRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQSBzYXZlL3JlbW92ZSBvcGVyYXRpb24gc2hvdWxkIG5vdCByZXR1cm4gYW4gYXJyYXkgb2YgcmVzdWx0cycpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5kYXRhID0gb3ZlcnJpZGVEYXRhIHx8IG5ldyBHZW5lcmljTW9kZWwoZmxhdHRlbk1vZGVsKHJlc3AuZGF0YSkpIGFzIFQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy52aWV3cy5mb3JFYWNoKCh2aWV3KSA9PiB7XG4gICAgICBpZiAodGhpcy5kYXRhKSB7XG4gICAgICAgIHZpZXcuYWRkKHRoaXMuZGF0YSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLm1ldGEgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLm1ldGEpIHx8IHt9O1xuICAgIHRoaXMubGlua3MgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmxpbmtzKSB8fCB7fTtcbiAgICB0aGlzLmpzb25hcGkgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmpzb25hcGkpIHx8IHt9O1xuICAgIHRoaXMuaGVhZGVycyA9IHJlc3BvbnNlLmhlYWRlcnM7XG4gICAgdGhpcy5yZXF1ZXN0SGVhZGVycyA9IHJlc3BvbnNlLnJlcXVlc3RIZWFkZXJzO1xuICAgIHRoaXMuZXJyb3IgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmVycm9ycykgfHwgcmVzcG9uc2UuZXJyb3I7XG5cbiAgICBjb25zdCBsaW5rR2V0dGVyOiBJRGljdGlvbmFyeTxJQ29tcHV0ZWRWYWx1ZTxQcm9taXNlPFJlc3BvbnNlPFQ+Pj4+ID0ge307XG4gICAgaWYgKHRoaXMubGlua3MpIHtcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMubGlua3MpLmZvckVhY2goKGxpbms6IHN0cmluZykgPT4ge1xuICAgICAgICBhc3NpZ25Db21wdXRlZCh0aGlzLCBsaW5rLCAoKSA9PiB0aGlzLl9fZmV0Y2hMaW5rKGxpbmspKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIE9iamVjdC5mcmVlemUodGhpcyk7XG5cbiAgICBpZiAodGhpcy5lcnJvcikge1xuICAgICAgdGhyb3cgdGhpcztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVwbGFjZSB0aGUgcmVzcG9uc2UgcmVjb3JkIHdpdGggYSBkaWZmZXJlbnQgcmVjb3JkLiBVc2VkIHRvIHJlcGxhY2UgYSByZWNvcmQgd2hpbGUga2VlcGluZyB0aGUgc2FtZSByZWZlcmVuY2VcbiAgICpcbiAgICogQHBhcmFtIHtQdXJlTW9kZWx9IGRhdGEgTmV3IGRhdGFcbiAgICogQHJldHVybnMge1Jlc3BvbnNlfVxuICAgKlxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIEBhY3Rpb24gcHVibGljIHJlcGxhY2VEYXRhKGRhdGE6IFQpOiBSZXNwb25zZTxUPiB7XG4gICAgY29uc3QgcmVjb3JkOiBQdXJlTW9kZWwgPSB0aGlzLmRhdGEgYXMgUHVyZU1vZGVsO1xuICAgIGlmIChyZWNvcmQgPT09IGRhdGEpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGNvbnN0IG9sZElkID0gZ2V0TW9kZWxJZChkYXRhKTtcbiAgICBjb25zdCBuZXdJZCA9IGdldE1vZGVsSWQocmVjb3JkKTtcbiAgICBjb25zdCB0eXBlID0gZ2V0TW9kZWxUeXBlKHJlY29yZCk7XG5cbiAgICBjb25zdCB2aWV3SW5kZXhlcyA9IHRoaXMudmlld3MubWFwKCh2aWV3KSA9PiB2aWV3Lmxpc3QuaW5kZXhPZihyZWNvcmQpKTtcblxuICAgIGlmICh0aGlzLl9fY29sbGVjdGlvbikge1xuICAgICAgdGhpcy5fX2NvbGxlY3Rpb24ucmVtb3ZlKHJlY29yZCk7XG4gICAgICB0aGlzLl9fY29sbGVjdGlvbi5hZGQoZGF0YSk7XG4gICAgfVxuXG4gICAgdXBkYXRlTW9kZWwoZGF0YSwgbW9kZWxUb0pTT04ocmVjb3JkKSk7XG4gICAgdXBkYXRlTW9kZWxJZChkYXRhLCBuZXdJZCk7XG5cbiAgICB0aGlzLnZpZXdzLmZvckVhY2goKHZpZXcsIGluZGV4KSA9PiB7XG4gICAgICBpZiAodmlld0luZGV4ZXNbaW5kZXhdICE9PSAtMSkge1xuICAgICAgICB2aWV3Lmxpc3Rbdmlld0luZGV4ZXNbaW5kZXhdXSA9IGRhdGE7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKHRoaXMuX19yZXNwb25zZSwgdGhpcy5fX2NvbGxlY3Rpb24sIHRoaXMuX19vcHRpb25zLCBkYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiBhIGxpbmsgaXMgYmVpbmcgZmV0Y2hlZC4gVGhlIHJldHVybmVkIHZhbHVlIGlzIGNhY2hlZFxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge2FueX0gbmFtZSBMaW5rIG5hbWVcbiAgICogQHJldHVybnMgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggYSBSZXNwb25zZSBvYmplY3RcbiAgICpcbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwcml2YXRlIF9fZmV0Y2hMaW5rKG5hbWUpIHtcbiAgICBpZiAoIXRoaXMuX19jYWNoZVtuYW1lXSkge1xuICAgICAgY29uc3QgbGluazogSUxpbmt8bnVsbCA9ICh0aGlzLmxpbmtzICYmIG5hbWUgaW4gdGhpcy5saW5rcykgPyB0aGlzLmxpbmtzW25hbWVdIDogbnVsbDtcblxuICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgdGhpcy5fX2NhY2hlW25hbWVdID0gZmV0Y2hMaW5rPFQ+KFxuICAgICAgICAgIGxpbmssIHRoaXMuX19jb2xsZWN0aW9uLCB0aGlzLnJlcXVlc3RIZWFkZXJzLCB0aGlzLl9fb3B0aW9ucywgdGhpcy52aWV3cyxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fX2NhY2hlW25hbWVdO1xuICB9XG59XG4iXX0=","dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/Response.d.ts","text":"import { View } from 'datx';\r\nimport { IDictionary } from 'datx-utils';\r\nimport { IHeaders } from './interfaces/IHeaders';\r\nimport { IJsonapiModel } from './interfaces/IJsonapiModel';\r\nimport { IRawResponse } from './interfaces/IRawResponse';\r\nimport { IRequestOptions } from './interfaces/IRequestOptions';\r\nimport { IResponseHeaders } from './interfaces/IResponseHeaders';\r\nimport { IError, IJsonApiObject, ILink } from './interfaces/JsonApi';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nexport declare class Response<T extends IJsonapiModel> {\r\n    /**\r\n     * API response data (synced with the store)\r\n     *\r\n     * @type {(PureModel|Array<PureModel>)}\r\n     * @memberOf Response\r\n     */\r\n    data: T | Array<T> | null;\r\n    /**\r\n     * API response metadata\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    meta?: object;\r\n    /**\r\n     * API response links\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    links?: IDictionary<ILink>;\r\n    /**\r\n     * The JSON API object returned by the server\r\n     *\r\n     * @type {JsonApi.IJsonApiObject}\r\n     * @memberOf Response\r\n     */\r\n    jsonapi?: IJsonApiObject;\r\n    /**\r\n     * Headers received from the API call\r\n     *\r\n     * @type {IResponseHeaders}\r\n     * @memberOf Response\r\n     */\r\n    headers?: IResponseHeaders;\r\n    /**\r\n     * Headers sent to the server\r\n     *\r\n     * @type {IHeaders}\r\n     * @memberOf Response\r\n     */\r\n    requestHeaders?: IHeaders;\r\n    /**\r\n     * Request error\r\n     *\r\n     * @type {(Array<JsonApi.IError>|Error)}\r\n     * @memberOf Response\r\n     */\r\n    error?: Array<IError> | Error;\r\n    /**\r\n     * First data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    first?: Promise<Response<T>>;\r\n    /**\r\n     * Previous data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    prev?: Promise<Response<T>>;\r\n    /**\r\n     * Next data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    next?: Promise<Response<T>>;\r\n    /**\r\n     * Last data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    last?: Promise<Response<T>>;\r\n    /**\r\n     * Received HTTP status\r\n     *\r\n     * @type {number}\r\n     * @memberOf Response\r\n     */\r\n    status?: number;\r\n    views: Array<View>;\r\n    /**\r\n     * Related Store\r\n     *\r\n     * @private\r\n     * @type {IJsonapiCollection}\r\n     * @memberOf Response\r\n     */\r\n    private __collection?;\r\n    /**\r\n     * Server options\r\n     *\r\n     * @private\r\n     * @type {IRequestOptions}\r\n     * @memberOf Response\r\n     */\r\n    private __options?;\r\n    /**\r\n     * Original server response\r\n     *\r\n     * @private\r\n     * @type {IRawResponse}\r\n     * @memberOf Response\r\n     */\r\n    private __response;\r\n    /**\r\n     * Cache used for the link requests\r\n     *\r\n     * @private\r\n     * @type {IDictionary<Promise<Response>>}\r\n     * @memberOf Response\r\n     */\r\n    private __cache;\r\n    constructor(response: IRawResponse, collection?: IJsonapiCollection, options?: IRequestOptions, overrideData?: T | Array<T>, views?: Array<View>);\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    replaceData(data: T): Response<T>;\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    private __fetchLink(name);\r\n}\r\n"}}
