{"code":"import * as tslib_1 from \"tslib\";\r\nimport { getModelId, getModelType, modelToJSON, updateModel, updateModelId } from 'datx';\r\nimport { assignComputed } from 'datx-utils';\r\nimport { action } from 'mobx';\r\nimport { GenericModel } from './GenericModel';\r\nimport { flattenModel } from './helpers/model';\r\nimport { fetchLink } from './NetworkUtils';\r\nvar Response = /** @class */ (function () {\r\n    function Response(response, collection, options, overrideData, views) {\r\n        var _this = this;\r\n        /**\r\n         * API response data (synced with the store)\r\n         *\r\n         * @type {(PureModel|Array<PureModel>)}\r\n         * @memberOf Response\r\n         */\r\n        this.data = null;\r\n        this.views = [];\r\n        /**\r\n         * Cache used for the link requests\r\n         *\r\n         * @private\r\n         * @type {IDictionary<Promise<Response>>}\r\n         * @memberOf Response\r\n         */\r\n        this.__cache = {};\r\n        this.__collection = collection;\r\n        this.__options = options;\r\n        this.__response = response;\r\n        this.status = response.status;\r\n        if (views) {\r\n            this.views = views;\r\n        }\r\n        if (collection) {\r\n            this.data = overrideData ? collection.add(overrideData) : collection.sync(response.data);\r\n        }\r\n        else if (response.data) {\r\n            // The case when a record is not in a store and save/remove are used\r\n            var resp = response.data;\r\n            if (resp.data) {\r\n                if (resp.data instanceof Array) {\r\n                    throw new Error('A save/remove operation should not return an array of results');\r\n                }\r\n                this.data = overrideData || new GenericModel(flattenModel(resp.data));\r\n            }\r\n        }\r\n        this.views.forEach(function (view) {\r\n            if (_this.data) {\r\n                view.add(_this.data);\r\n            }\r\n        });\r\n        this.meta = (response.data && response.data.meta) || {};\r\n        this.links = (response.data && response.data.links) || {};\r\n        this.jsonapi = (response.data && response.data.jsonapi) || {};\r\n        this.headers = response.headers;\r\n        this.requestHeaders = response.requestHeaders;\r\n        this.error = (response.data && response.data.errors) || response.error;\r\n        var linkGetter = {};\r\n        if (this.links) {\r\n            Object.keys(this.links).forEach(function (link) {\r\n                assignComputed(_this, link, function () { return _this.__fetchLink(link); });\r\n            });\r\n        }\r\n        Object.freeze(this);\r\n        if (this.error) {\r\n            throw this;\r\n        }\r\n    }\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.replaceData = function (data) {\r\n        var record = this.data;\r\n        if (record === data) {\r\n            return this;\r\n        }\r\n        var oldId = getModelId(data);\r\n        var newId = getModelId(record);\r\n        var type = getModelType(record);\r\n        var viewIndexes = this.views.map(function (view) { return view.list.indexOf(record); });\r\n        if (this.__collection) {\r\n            this.__collection.remove(record);\r\n            this.__collection.add(data);\r\n        }\r\n        updateModel(data, modelToJSON(record));\r\n        updateModelId(data, newId);\r\n        this.views.forEach(function (view, index) {\r\n            if (viewIndexes[index] !== -1) {\r\n                view.list[viewIndexes[index]] = data;\r\n            }\r\n        });\r\n        return new Response(this.__response, this.__collection, this.__options, data);\r\n    };\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.__fetchLink = function (name) {\r\n        if (!this.__cache[name]) {\r\n            var link = (this.links && name in this.links) ? this.links[name] : null;\r\n            if (link) {\r\n                this.__cache[name] = fetchLink(link, this.__collection, this.requestHeaders, this.__options, this.views);\r\n            }\r\n        }\r\n        return this.__cache[name];\r\n    };\r\n    tslib_1.__decorate([\r\n        action\r\n    ], Response.prototype, \"replaceData\", null);\r\n    return Response;\r\n}());\r\nexport { Response };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzcG9uc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvUmVzcG9uc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBYSxXQUFXLEVBQUUsYUFBYSxFQUFPLE1BQU0sTUFBTSxDQUFDO0FBQ3hHLE9BQU8sRUFBQyxjQUFjLEVBQWMsTUFBTSxZQUFZLENBQUM7QUFDdkQsT0FBTyxFQUFDLE1BQU0sRUFBbUMsTUFBTSxNQUFNLENBQUM7QUFTOUQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUU3QyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFekM7SUF3SUUsa0JBQ0UsUUFBc0IsRUFDdEIsVUFBK0IsRUFDL0IsT0FBeUIsRUFDekIsWUFBeUIsRUFDekIsS0FBbUI7UUFMckIsaUJBdURDO1FBN0xEOzs7OztXQUtHO1FBQ0ksU0FBSSxHQUFvQixJQUFJLENBQUM7UUEwRjdCLFVBQUssR0FBZ0IsRUFBRSxDQUFDO1FBNkIvQjs7Ozs7O1dBTUc7UUFDSyxZQUFPLEdBQXNDLEVBQUUsQ0FBQztRQVN0RCxJQUFJLENBQUMsWUFBWSxHQUFHLFVBQVUsQ0FBQztRQUMvQixJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQztRQUN6QixJQUFJLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDOUIsSUFBSSxLQUFLLEVBQUU7WUFDVCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztTQUNwQjtRQUVELElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUksWUFBaUIs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LEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUN6RSxDQUFDO2FBQ0g7U0FDRjtRQUNELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBbERPO1FBQVAsTUFBTTsrQ0EyQk47SUF3QkgsZUFBQztDQUFBLEFBNVBELElBNFBDO1NBNVBZLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2dldE1vZGVsSWQsIGdldE1vZGVsVHlwZSwgbW9kZWxUb0pTT04sIFB1cmVNb2RlbCwgdXBkYXRlTW9kZWwsIHVwZGF0ZU1vZGVsSWQsIFZpZXd9IGZyb20gJ2RhdHgnO1xuaW1wb3J0IHthc3NpZ25Db21wdXRlZCwgSURpY3Rpb25hcnl9IGZyb20gJ2RhdHgtdXRpbHMnO1xuaW1wb3J0IHthY3Rpb24sIGV4dGVuZE9ic2VydmFibGUsIElDb21wdXRlZFZhbHVlfSBmcm9tICdtb2J4JztcblxuaW1wb3J0IHtJSGVhZGVyc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lIZWFkZXJzJztcbmltcG9ydCB7SUpzb25hcGlNb2RlbH0gZnJvbSAnLi9pbnRlcmZhY2VzL0lKc29uYXBpTW9kZWwnO1xuaW1wb3J0IHtJUmF3UmVzcG9uc2V9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmF3UmVzcG9uc2UnO1xuaW1wb3J0IHtJUmVxdWVzdE9wdGlvbnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JUmVxdWVzdE9wdGlvbnMnO1xuaW1wb3J0IHtJUmVzcG9uc2VIZWFkZXJzfSBmcm9tICcuL2ludGVyZmFjZXMvSVJlc3BvbnNlSGVhZGVycyc7XG5pbXBvcnQge0lFcnJvciwgSUpzb25BcGlPYmplY3QsIElMaW5rfSBmcm9tICcuL2ludGVyZmFjZXMvSnNvbkFwaSc7XG5cbmltcG9ydCB7R2VuZXJpY01vZGVsfSBmcm9tICcuL0dlbmVyaWNNb2RlbCc7XG5pbXBvcnQge2ZsYXR0ZW5Nb2RlbH0gZnJvbSAnLi9oZWxwZXJzL21vZGVsJztcbmltcG9ydCB7SUpzb25hcGlDb2xsZWN0aW9ufSBmcm9tICcuL2ludGVyZmFjZXMvSUpzb25hcGlDb2xsZWN0aW9uJztcbmltcG9ydCB7ZmV0Y2hMaW5rfSBmcm9tICcuL05ldHdvcmtVdGlscyc7XG5cbmV4cG9ydCBjbGFzcyBSZXNwb25zZTxUIGV4dGVuZHMgSUpzb25hcGlNb2RlbD4ge1xuXG4gIC8qKlxuICAgKiBBUEkgcmVzcG9uc2UgZGF0YSAoc3luY2VkIHdpdGggdGhlIHN0b3JlKVxuICAgKlxuICAgKiBAdHlwZSB7KFB1cmVNb2RlbHxBcnJheTxQdXJlTW9kZWw+KX1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgZGF0YTogVHxBcnJheTxUPnxudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogQVBJIHJlc3BvbnNlIG1ldGFkYXRhXG4gICAqXG4gICAqIEB0eXBlIHtvYmplY3R9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIG1ldGE/OiBvYmplY3Q7XG5cbiAgLyoqXG4gICAqIEFQSSByZXNwb25zZSBsaW5rc1xuICAgKlxuICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBsaW5rcz86IElEaWN0aW9uYXJ5PElMaW5rPjtcblxuICAvKipcbiAgICogVGhlIEpTT04gQVBJIG9iamVjdCByZXR1cm5lZCBieSB0aGUgc2VydmVyXG4gICAqXG4gICAqIEB0eXBlIHtKc29uQXBpLklKc29uQXBpT2JqZWN0fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBqc29uYXBpPzogSUpzb25BcGlPYmplY3Q7XG5cbiAgLyoqXG4gICAqIEhlYWRlcnMgcmVjZWl2ZWQgZnJvbSB0aGUgQVBJIGNhbGxcbiAgICpcbiAgICogQHR5cGUge0lSZXNwb25zZUhlYWRlcnN9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGhlYWRlcnM/OiBJUmVzcG9uc2VIZWFkZXJzO1xuXG4gIC8qKlxuICAgKiBIZWFkZXJzIHNlbnQgdG8gdGhlIHNlcnZlclxuICAgKlxuICAgKiBAdHlwZSB7SUhlYWRlcnN9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIHJlcXVlc3RIZWFkZXJzPzogSUhlYWRlcnM7XG5cbiAgLyoqXG4gICAqIFJlcXVlc3QgZXJyb3JcbiAgICpcbiAgICogQHR5cGUgeyhBcnJheTxKc29uQXBpLklFcnJvcj58RXJyb3IpfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBlcnJvcj86IEFycmF5PElFcnJvcj58RXJyb3I7XG5cbiAgLyoqXG4gICAqIEZpcnN0IGRhdGEgcGFnZVxuICAgKlxuICAgKiBAdHlwZSB7UHJvbWlzZTxSZXNwb25zZT59XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGZpcnN0PzogUHJvbWlzZTxSZXNwb25zZTxUPj47IC8vIEhhbmRsZWQgYnkgdGhlIF9fZmV0Y2hMaW5rXG5cbiAgLyoqXG4gICAqIFByZXZpb3VzIGRhdGEgcGFnZVxuICAgKlxuICAgKiBAdHlwZSB7UHJvbWlzZTxSZXNwb25zZT59XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIHByZXY/OiBQcm9taXNlPFJlc3BvbnNlPFQ+PjsgLy8gSGFuZGxlZCBieSB0aGUgX19mZXRjaExpbmtcblxuICAvKipcbiAgICogTmV4dCBkYXRhIHBhZ2VcbiAgICpcbiAgICogQHR5cGUge1Byb21pc2U8UmVzcG9uc2U+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBuZXh0PzogUHJvbWlzZTxSZXNwb25zZTxUPj47IC8vIEhhbmRsZWQgYnkgdGhlIF9fZmV0Y2hMaW5rXG5cbiAgLyoqXG4gICAqIExhc3QgZGF0YSBwYWdlXG4gICAqXG4gICAqIEB0eXBlIHtQcm9taXNlPFJlc3BvbnNlPn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgbGFzdD86IFByb21pc2U8UmVzcG9uc2U8VD4+OyAvLyBIYW5kbGVkIGJ5IHRoZSBfX2ZldGNoTGlua1xuXG4gIC8qKlxuICAgKiBSZWNlaXZlZCBIVFRQIHN0YXR1c1xuICAgKlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBzdGF0dXM/OiBudW1iZXI7XG5cbiAgcHVibGljIHZpZXdzOiBBcnJheTxWaWV3PiA9IFtdO1xuXG4gIC8qKlxuICAgKiBSZWxhdGVkIFN0b3JlXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtJSnNvbmFwaUNvbGxlY3Rpb259XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHJpdmF0ZSBfX2NvbGxlY3Rpb24/OiBJSnNvbmFwaUNvbGxlY3Rpb247XG5cbiAgLyoqXG4gICAqIFNlcnZlciBvcHRpb25zXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtJUmVxdWVzdE9wdGlvbnN9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHJpdmF0ZSBfX29wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnM7XG5cbiAgLyoqXG4gICAqIE9yaWdpbmFsIHNlcnZlciByZXNwb25zZVxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SVJhd1Jlc3BvbnNlfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19yZXNwb25zZTogSVJhd1Jlc3BvbnNlO1xuXG4gIC8qKlxuICAgKiBDYWNoZSB1c2VkIGZvciB0aGUgbGluayByZXF1ZXN0c1xuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SURpY3Rpb25hcnk8UHJvbWlzZTxSZXNwb25zZT4+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19jYWNoZTogSURpY3Rpb25hcnk8UHJvbWlzZTxSZXNwb25zZTxUPj4+ID0ge307XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcmVzcG9uc2U6IElSYXdSZXNwb25zZSxcbiAgICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uLFxuICAgIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4gICAgb3ZlcnJpZGVEYXRhPzogVHxBcnJheTxUPixcbiAgICB2aWV3cz86IEFycmF5PFZpZXc+LFxuICApIHtcbiAgICB0aGlzLl9fY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgdGhpcy5fX29wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMuX19yZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgIHRoaXMuc3RhdHVzID0gcmVzcG9uc2Uuc3RhdHVzO1xuICAgIGlmICh2aWV3cykge1xuICAgICAgdGhpcy52aWV3cyA9IHZpZXdzO1xuICAgIH1cblxuICAgIGlmIChjb2xsZWN0aW9uKSB7XG4gICAgICB0aGlzLmRhdGEgPSBvdmVycmlkZURhdGEgPyBjb2xsZWN0aW9uLmFkZDxUPihvdmVycmlkZURhdGEgYXMgVCkgOiBjb2xsZWN0aW9uLnN5bmM8VD4ocmVzcG9uc2UuZGF0YSk7XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhKSB7XG4gICAgICAvLyBUaGUgY2FzZSB3aGVuIGEgcmVjb3JkIGlzIG5vdCBpbiBhIHN0b3JlIGFuZCBzYXZlL3JlbW92ZSBhcmUgdXNlZFxuICAgICAgY29uc3QgcmVzcCA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgIGlmIChyZXNwLmRhdGEpIHtcbiAgICAgICAgaWYgKHJlc3AuZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBIHNhdmUvcmVtb3ZlIG9wZXJhdGlvbiBzaG91bGQgbm90IHJldHVybiBhbiBhcnJheSBvZiByZXN1bHRzJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRhdGEgPSBvdmVycmlkZURhdGEgfHwgbmV3IEdlbmVyaWNNb2RlbChmbGF0dGVuTW9kZWwocmVzcC5kYXRhKSkgYXMgVDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnZpZXdzLmZvckVhY2goKHZpZXcpID0+IHtcbiAgICAgIGlmICh0aGlzLmRhdGEpIHtcbiAgICAgICAgdmlldy5hZGQodGhpcy5kYXRhKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMubWV0YSA9IChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubWV0YSkgfHwge307XG4gICAgdGhpcy5saW5rcyA9IChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubGlua3MpIHx8IHt9O1xuICAgIHRoaXMuanNvbmFwaSA9IChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuanNvbmFwaSkgfHwge307XG4gICAgdGhpcy5oZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVycztcbiAgICB0aGlzLnJlcXVlc3RIZWFkZXJzID0gcmVzcG9uc2UucmVxdWVzdEhlYWRlcnM7XG4gICAgdGhpcy5lcnJvciA9IChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuZXJyb3JzKSB8fCByZXNwb25zZS5lcnJvcjtcblxuICAgIGNvbnN0IGxpbmtHZXR0ZXI6IElEaWN0aW9uYXJ5PElDb21wdXRlZFZhbHVlPFByb21pc2U8UmVzcG9uc2U8VD4+Pj4gPSB7fTtcbiAgICBpZiAodGhpcy5saW5rcykge1xuICAgICAgT2JqZWN0LmtleXModGhpcy5saW5rcykuZm9yRWFjaCgobGluazogc3RyaW5nKSA9PiB7XG4gICAgICAgIGFzc2lnbkNvbXB1dGVkKHRoaXMsIGxpbmssICgpID0+IHRoaXMuX19mZXRjaExpbmsobGluaykpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgT2JqZWN0LmZyZWV6ZSh0aGlzKTtcblxuICAgIGlmICh0aGlzLmVycm9yKSB7XG4gICAgICB0aHJvdyB0aGlzO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXBsYWNlIHRoZSByZXNwb25zZSByZWNvcmQgd2l0aCBhIGRpZmZlcmVudCByZWNvcmQuIFVzZWQgdG8gcmVwbGFjZSBhIHJlY29yZCB3aGlsZSBrZWVwaW5nIHRoZSBzYW1lIHJlZmVyZW5jZVxuICAgKlxuICAgKiBAcGFyYW0ge1B1cmVNb2RlbH0gZGF0YSBOZXcgZGF0YVxuICAgKiBAcmV0dXJucyB7UmVzcG9uc2V9XG4gICAqXG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgQGFjdGlvbiBwdWJsaWMgcmVwbGFjZURhdGEoZGF0YTogVCk6IFJlc3BvbnNlPFQ+IHtcbiAgICBjb25zdCByZWNvcmQ6IFB1cmVNb2RlbCA9IHRoaXMuZGF0YSBhcyBQdXJlTW9kZWw7XG4gICAgaWYgKHJlY29yZCA9PT0gZGF0YSkge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgY29uc3Qgb2xkSWQgPSBnZXRNb2RlbElkKGRhdGEpO1xuICAgIGNvbnN0IG5ld0lkID0gZ2V0TW9kZWxJZChyZWNvcmQpO1xuICAgIGNvbnN0IHR5cGUgPSBnZXRNb2RlbFR5cGUocmVjb3JkKTtcblxuICAgIGNvbnN0IHZpZXdJbmRleGVzID0gdGhpcy52aWV3cy5tYXAoKHZpZXcpID0+IHZpZXcubGlzdC5pbmRleE9mKHJlY29yZCkpO1xuXG4gICAgaWYgKHRoaXMuX19jb2xsZWN0aW9uKSB7XG4gICAgICB0aGlzLl9fY29sbGVjdGlvbi5yZW1vdmUocmVjb3JkKTtcbiAgICAgIHRoaXMuX19jb2xsZWN0aW9uLmFkZChkYXRhKTtcbiAgICB9XG5cbiAgICB1cGRhdGVNb2RlbChkYXRhLCBtb2RlbFRvSlNPTihyZWNvcmQpKTtcbiAgICB1cGRhdGVNb2RlbElkKGRhdGEsIG5ld0lkKTtcblxuICAgIHRoaXMudmlld3MuZm9yRWFjaCgodmlldywgaW5kZXgpID0+IHtcbiAgICAgIGlmICh2aWV3SW5kZXhlc1tpbmRleF0gIT09IC0xKSB7XG4gICAgICAgIHZpZXcubGlzdFt2aWV3SW5kZXhlc1tpbmRleF1dID0gZGF0YTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UodGhpcy5fX3Jlc3BvbnNlLCB0aGlzLl9fY29sbGVjdGlvbiwgdGhpcy5fX29wdGlvbnMsIGRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIGEgbGluayBpcyBiZWluZyBmZXRjaGVkLiBUaGUgcmV0dXJuZWQgdmFsdWUgaXMgY2FjaGVkXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7YW55fSBuYW1lIExpbmsgbmFtZVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCBhIFJlc3BvbnNlIG9iamVjdFxuICAgKlxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19mZXRjaExpbmsobmFtZSkge1xuICAgIGlmICghdGhpcy5fX2NhY2hlW25hbWVdKSB7XG5cbiAgICAgIGNvbnN0IGxpbms6IElMaW5rfG51bGwgPSAodGhpcy5saW5rcyAmJiBuYW1lIGluIHRoaXMubGlua3MpID8gdGhpcy5saW5rc1tuYW1lXSA6IG51bGw7XG5cbiAgICAgIGlmIChsaW5rKSB7XG4gICAgICAgIHRoaXMuX19jYWNoZVtuYW1lXSA9IGZldGNoTGluazxUPihcbiAgICAgICAgICBsaW5rLCB0aGlzLl9fY29sbGVjdGlvbiwgdGhpcy5yZXF1ZXN0SGVhZGVycywgdGhpcy5fX29wdGlvbnMsIHRoaXMudmlld3MsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9fY2FjaGVbbmFtZV07XG4gIH1cbn1cbiJdfQ==","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/Response.d.ts","text":"import { View } from 'datx';\r\nimport { IDictionary } from 'datx-utils';\r\nimport { IHeaders } from './interfaces/IHeaders';\r\nimport { IJsonapiModel } from './interfaces/IJsonapiModel';\r\nimport { IRawResponse } from './interfaces/IRawResponse';\r\nimport { IRequestOptions } from './interfaces/IRequestOptions';\r\nimport { IResponseHeaders } from './interfaces/IResponseHeaders';\r\nimport { IError, IJsonApiObject, ILink } from './interfaces/JsonApi';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nexport declare class Response<T extends IJsonapiModel> {\r\n    /**\r\n     * API response data (synced with the store)\r\n     *\r\n     * @type {(PureModel|Array<PureModel>)}\r\n     * @memberOf Response\r\n     */\r\n    data: T | Array<T> | null;\r\n    /**\r\n     * API response metadata\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    meta?: object;\r\n    /**\r\n     * API response links\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    links?: IDictionary<ILink>;\r\n    /**\r\n     * The JSON API object returned by the server\r\n     *\r\n     * @type {JsonApi.IJsonApiObject}\r\n     * @memberOf Response\r\n     */\r\n    jsonapi?: IJsonApiObject;\r\n    /**\r\n     * Headers received from the API call\r\n     *\r\n     * @type {IResponseHeaders}\r\n     * @memberOf Response\r\n     */\r\n    headers?: IResponseHeaders;\r\n    /**\r\n     * Headers sent to the server\r\n     *\r\n     * @type {IHeaders}\r\n     * @memberOf Response\r\n     */\r\n    requestHeaders?: IHeaders;\r\n    /**\r\n     * Request error\r\n     *\r\n     * @type {(Array<JsonApi.IError>|Error)}\r\n     * @memberOf Response\r\n     */\r\n    error?: Array<IError> | Error;\r\n    /**\r\n     * First data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    first?: Promise<Response<T>>;\r\n    /**\r\n     * Previous data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    prev?: Promise<Response<T>>;\r\n    /**\r\n     * Next data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    next?: Promise<Response<T>>;\r\n    /**\r\n     * Last data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    last?: Promise<Response<T>>;\r\n    /**\r\n     * Received HTTP status\r\n     *\r\n     * @type {number}\r\n     * @memberOf Response\r\n     */\r\n    status?: number;\r\n    views: Array<View>;\r\n    /**\r\n     * Related Store\r\n     *\r\n     * @private\r\n     * @type {IJsonapiCollection}\r\n     * @memberOf Response\r\n     */\r\n    private __collection?;\r\n    /**\r\n     * Server options\r\n     *\r\n     * @private\r\n     * @type {IRequestOptions}\r\n     * @memberOf Response\r\n     */\r\n    private __options?;\r\n    /**\r\n     * Original server response\r\n     *\r\n     * @private\r\n     * @type {IRawResponse}\r\n     * @memberOf Response\r\n     */\r\n    private __response;\r\n    /**\r\n     * Cache used for the link requests\r\n     *\r\n     * @private\r\n     * @type {IDictionary<Promise<Response>>}\r\n     * @memberOf Response\r\n     */\r\n    private __cache;\r\n    constructor(response: IRawResponse, collection?: IJsonapiCollection, options?: IRequestOptions, overrideData?: T | Array<T>, views?: Array<View>);\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    replaceData(data: T): Response<T>;\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    private __fetchLink(name);\r\n}\r\n"}}
