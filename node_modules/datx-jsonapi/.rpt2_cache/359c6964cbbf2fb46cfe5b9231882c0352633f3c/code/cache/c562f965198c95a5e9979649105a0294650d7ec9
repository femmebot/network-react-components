{"code":"import * as tslib_1 from \"tslib\";\r\nimport { setModelMetaKey } from 'datx';\r\nimport { getCache, saveCache } from './cache';\r\nimport { MODEL_PERSISTED_FIELD, MODEL_PROP_FIELD, MODEL_QUEUE_FIELD, MODEL_RELATED_FIELD } from './consts';\r\nimport { ParamArrayType } from './enums/ParamArrayType';\r\nimport { isBrowser } from './helpers/utils';\r\nimport { Response as LibResponse } from './Response';\r\nexport var config = {\r\n    /** Base URL for all API calls */\r\n    baseUrl: '/',\r\n    /** Enable caching by default in the browser */\r\n    cache: isBrowser,\r\n    /** Default options that will be passed to the fetch function */\r\n    defaultFetchOptions: {\r\n        headers: {\r\n            'content-type': 'application/vnd.api+json',\r\n        },\r\n    },\r\n    /** Reference of the fetch method that should be used */\r\n    fetchReference: isBrowser && 'fetch' in window && window.fetch.bind(window),\r\n    /** Determines how will the request param arrays be stringified */\r\n    paramArrayType: ParamArrayType.COMMA_SEPARATED,\r\n    /**\r\n     * Base implementation of the fetch function (can be overridden)\r\n     *\r\n     * @param {string} method API call method\r\n     * @param {string} url API call URL\r\n     * @param {object} [body] API call body\r\n     * @param {IHeaders} [requestHeaders] Headers that will be sent\r\n     * @returns {Promise<IRawResponse>} Resolves with a raw response object\r\n     */\r\n    baseFetch: function (method, url, body, requestHeaders) {\r\n        var _this = this;\r\n        var data;\r\n        var status;\r\n        var headers;\r\n        var request = Promise.resolve();\r\n        var uppercaseMethod = method.toUpperCase();\r\n        var isBodySupported = uppercaseMethod !== 'GET' && uppercaseMethod !== 'HEAD';\r\n        return request\r\n            .then(function () {\r\n            var defaultHeaders = config.defaultFetchOptions.headers || {};\r\n            var reqHeaders = Object.assign({}, defaultHeaders, requestHeaders);\r\n            var options = Object.assign({}, config.defaultFetchOptions, {\r\n                body: isBodySupported && JSON.stringify(body) || undefined,\r\n                headers: reqHeaders,\r\n                method: method,\r\n            });\r\n            return _this.fetchReference(url, options);\r\n        })\r\n            .then(function (response) {\r\n            status = response.status;\r\n            headers = response.headers;\r\n            return response.json();\r\n        })\r\n            .catch(function (error) {\r\n            if (status === 204) {\r\n                return null;\r\n            }\r\n            throw error;\r\n        })\r\n            .then(function (responseData) {\r\n            data = responseData;\r\n            if (status >= 400) {\r\n                throw {\r\n                    message: \"Invalid HTTP status: \" + status,\r\n                    status: status,\r\n                };\r\n            }\r\n            return { data: data, headers: headers, requestHeaders: requestHeaders, status: status };\r\n        })\r\n            .catch(function (error) {\r\n            return _this.onError({ data: data, error: error, headers: headers, requestHeaders: requestHeaders, status: status });\r\n        });\r\n    },\r\n    onError: function (resp) {\r\n        return resp;\r\n    },\r\n    transformRequest: function (options) {\r\n        return options;\r\n    },\r\n    transformResponse: function (response) {\r\n        return response;\r\n    },\r\n};\r\n/**\r\n * Base implementation of the stateful fetch function (can be overridden)\r\n *\r\n * @param {ICollectionFetchOpts} reqOptions API request options\r\n * @returns {Promise<Response>} Resolves with a response object\r\n */\r\nfunction collectionFetch(reqOptions) {\r\n    var _a = config.transformRequest(reqOptions), url = _a.url, options = _a.options, data = _a.data, _b = _a.method, method = _b === void 0 ? 'GET' : _b, collection = _a.collection;\r\n    var staticCollection = collection && collection.constructor;\r\n    var collectionCache = staticCollection && staticCollection.cache;\r\n    var isCacheSupported = method.toUpperCase() === 'GET';\r\n    var skipCache = reqOptions.options && reqOptions.options.skipCache;\r\n    if (config.cache && isCacheSupported && collectionCache && !skipCache) {\r\n        var cache = getCache(url);\r\n        if (cache) {\r\n            return Promise.resolve(cache.response);\r\n        }\r\n    }\r\n    return config.baseFetch(method, url, data, options && options.headers)\r\n        .then(function (response) {\r\n        var collectionResponse = Object.assign(response, { collection: collection });\r\n        var resp = new LibResponse(config.transformResponse(collectionResponse), collection, options);\r\n        if (config.cache && isCacheSupported) {\r\n            saveCache(url, resp);\r\n        }\r\n        return resp;\r\n    });\r\n}\r\nexport function fetch(options) {\r\n    return collectionFetch(options);\r\n}\r\n/**\r\n * API call used to get data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function read(url, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: undefined,\r\n        method: 'GET',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * API call used to create data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function create(url, data, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: data,\r\n        method: 'POST',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * API call used to update data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function update(url, data, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: data,\r\n        method: 'PATCH',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * API call used to remove data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport function remove(url, collection, headers, options) {\r\n    return collectionFetch({\r\n        collection: collection,\r\n        data: undefined,\r\n        method: 'DELETE',\r\n        options: tslib_1.__assign({}, options, { headers: headers }),\r\n        url: url,\r\n    });\r\n}\r\n/**\r\n * Fetch a link from the server\r\n *\r\n * @export\r\n * @param {JsonApi.ILink} link Link URL or a link object\r\n * @param {IJsonapiCollection} collection Store that will be used to save the response\r\n * @param {IDictionary<string>} [requestHeaders] Request headers\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<LibResponse>} Response promise\r\n */\r\nexport function fetchLink(link, collection, requestHeaders, options) {\r\n    if (link) {\r\n        var href = typeof link === 'object' ? link.href : link;\r\n        if (href) {\r\n            return read(href, collection, requestHeaders, options);\r\n        }\r\n    }\r\n    return Promise.resolve(new LibResponse({ data: undefined }, collection));\r\n}\r\nexport function handleResponse(record, prop) {\r\n    return function (response) {\r\n        if (response.error) {\r\n            throw response.error;\r\n        }\r\n        if (response.status === 204) {\r\n            setModelMetaKey(record, MODEL_PERSISTED_FIELD, true);\r\n            return record;\r\n        }\r\n        else if (response.status === 202) {\r\n            var responseRecord = response.data;\r\n            setModelMetaKey(responseRecord, MODEL_PROP_FIELD, prop);\r\n            setModelMetaKey(responseRecord, MODEL_QUEUE_FIELD, true);\r\n            setModelMetaKey(responseRecord, MODEL_RELATED_FIELD, record);\r\n            return responseRecord;\r\n        }\r\n        else {\r\n            setModelMetaKey(record, MODEL_PERSISTED_FIELD, true);\r\n            return response.replaceData(record).data;\r\n        }\r\n    };\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV0d29ya1V0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3JjL05ldHdvcmtVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUlyQyxPQUFPLEVBQUMsUUFBUSxFQUFFLFNBQVMsRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUM1QyxPQUFPLEVBQUMscUJBQXFCLEVBQUUsZ0JBQWdCLEVBQUUsaUJBQWlCLEVBQUUsbUJBQW1CLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFDekcsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ3RELE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQVExQyxPQUFPLEVBQUMsUUFBUSxJQUFJLFdBQVcsRUFBQyxNQUFNLFlBQVksQ0FBQztBQTBDbkQsTUFBTSxDQUFDLElBQU0sTUFBTSxHQUFnQjtJQUVqQyxpQ0FBaUM7SUFDakMsT0FBTyxFQUFFLEdBQUc7SUFFWiwrQ0FBK0M7SUFDL0MsS0FBSyxFQUFFLFNBQVM7SUFFaEIsZ0VBQWdFO0lBQ2hFLG1CQUFtQixFQUFFO1FBQ25CLE9BQU8sRUFBRTtZQUNQLGNBQWMsRUFBRSwwQkFBMEI7U0FDM0M7S0FDRjtJQUVELHdEQUF3RDtJQUN4RCxjQUFjLEVBQUUsU0FBUyxJQUFJLE9BQU8sSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRTNFLGtFQUFrRTtJQUNsRSxjQUFjLEVBQUUsY0FBYyxDQUFDLGVBQWU7SUFFOUM7Ozs7Ozs7O09BUUc7SUFDSCxTQUFTLEVBQVQsVUFDRSxNQUFjLEVBQ2QsR0FBVyxFQUNYLElBQWEsRUFDYixjQUF5QjtRQUozQixpQkFtREM7UUE3Q0MsSUFBSSxJQUFlLENBQUM7UUFDcEIsSUFBSSxNQUFjLENBQUM7UUFDbkIsSUFBSSxPQUF5QixDQUFDO1FBRTlCLElB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LENBQUMsQ0FBQztZQUNuQyxJQUFNLGNBQWMsR0FBRyxRQUFRLENBQUMsSUFBUyxDQUFDO1lBQzFDLGVBQWUsQ0FBQyxjQUFjLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDeEQsZUFBZSxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN6RCxlQUFlLENBQUMsY0FBYyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQzdELE1BQU0sQ0FBQyxjQUFjLENBQUM7UUFDeEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sZUFBZSxDQUFDLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFTLENBQUM7UUFDaEQsQ0FBQztJQUNILENBQUMsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3NldE1vZGVsTWV0YUtleX0gZnJvbSAnZGF0eCc7XG5pbXBvcnQge0lEaWN0aW9uYXJ5fSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7ZmV0Y2gsIFJlc3BvbnNlfSBmcm9tICdpc29tb3JwaGljLWZldGNoJztcblxuaW1wb3J0IHtnZXRDYWNoZSwgc2F2ZUNhY2hlfSBmcm9tICcuL2NhY2hlJztcbmltcG9ydCB7TU9ERUxfUEVSU0lTVEVEX0ZJRUxELCBNT0RFTF9QUk9QX0ZJRUxELCBNT0RFTF9RVUVVRV9GSUVMRCwgTU9ERUxfUkVMQVRFRF9GSUVMRH0gZnJvbSAnLi9jb25zdHMnO1xuaW1wb3J0IHtQYXJhbUFycmF5VHlwZX0gZnJvbSAnLi9lbnVtcy9QYXJhbUFycmF5VHlwZSc7XG5pbXBvcnQge2lzQnJvd3Nlcn0gZnJvbSAnLi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCB7SUhlYWRlcnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JSGVhZGVycyc7XG5pbXBvcnQge0lKc29uYXBpQ29sbGVjdGlvbn0gZnJvbSAnLi9pbnRlcmZhY2VzL0lKc29uYXBpQ29sbGVjdGlvbic7XG5pbXBvcnQge0lKc29uYXBpTW9kZWx9IGZyb20gJy4vaW50ZXJmYWNlcy9JSnNvbmFwaU1vZGVsJztcbmltcG9ydCB7SVJhd1Jlc3BvbnNlfSBmcm9tICcuL2ludGVyZmFjZXMvSVJhd1Jlc3BvbnNlJztcbmltcG9ydCB7SVJlcXVlc3RPcHRpb25zfSBmcm9tICcuL2ludGVyZmFjZXMvSVJlcXVlc3RPcHRpb25zJztcbmltcG9ydCB7SVJlc3BvbnNlSGVhZGVyc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSZXNwb25zZUhlYWRlcnMnO1xuaW1wb3J0IHtJTGluaywgSVJlc3BvbnNlfSBmcm9tICcuL2ludGVyZmFjZXMvSnNvbkFwaSc7XG5pbXBvcnQge1Jlc3BvbnNlIGFzIExpYlJlc3BvbnNlfSBmcm9tICcuL1Jlc3BvbnNlJztcblxuZGVjbGFyZSB2YXIgd2luZG93OiB7ZmV0Y2g/OiBmZXRjaH07XG5cbmV4cG9ydCB0eXBlIEZldGNoVHlwZSA9IChcbiAgbWV0aG9kOiBzdHJpbmcsXG4gIHVybDogc3RyaW5nLFxuICBib2R5Pzogb2JqZWN0LFxuICByZXF1ZXN0SGVhZGVycz86IElIZWFkZXJzLFxuKSA9PiBQcm9taXNlPElSYXdSZXNwb25zZT47XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbGxlY3Rpb25GZXRjaE9wdHMge1xuICB1cmw6IHN0cmluZztcbiAgb3B0aW9ucz86IElSZXF1ZXN0T3B0aW9ucyZ7aGVhZGVycz86IElIZWFkZXJzfTtcbiAgZGF0YT86IG9iamVjdDtcbiAgbWV0aG9kOiBzdHJpbmc7XG4gIGNvbGxlY3Rpb24/OiBJSnNvbmFwaUNvbGxlY3Rpb247XG4gIHNraXBDYWNoZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCB0eXBlIENvbGxlY3Rpb25GZXRjaFR5cGUgPSA8VCBleHRlbmRzIElKc29uYXBpTW9kZWw+KG9wdGlvbnM6IElDb2xsZWN0aW9uRmV0Y2hPcHRzKSA9PiBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PjtcblxuZXhwb3J0IGludGVyZmFjZSBJUmVzcG9uc2VPYmplY3Qge1xuICBkYXRhOiBJUmVzcG9uc2U7XG4gIGVycm9yPzogRXJyb3I7XG4gIGhlYWRlcnM6IElSZXNwb25zZUhlYWRlcnM7XG4gIHJlcXVlc3RIZWFkZXJzOiBJSGVhZGVycztcbiAgc3RhdHVzOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbmZpZ1R5cGUge1xuICBiYXNlRmV0Y2g6IEZldGNoVHlwZTtcbiAgYmFzZVVybDogc3RyaW5nO1xuICBjYWNoZTogYm9vbGVhbixcbiAgZGVmYXVsdEZldGNoT3B0aW9uczogSURpY3Rpb25hcnk8YW55PjtcbiAgZmV0Y2hSZWZlcmVuY2U6IGZldGNoO1xuICBwYXJhbUFycmF5VHlwZTogUGFyYW1BcnJheVR5cGU7XG4gIG9uRXJyb3I6IChJUmVzcG9uc2VPYmplY3QpID0+IElSZXNwb25zZU9iamVjdDtcbiAgdHJhbnNmb3JtUmVxdWVzdDogKG9wdGlvbnM6IElDb2xsZWN0aW9uRmV0Y2hPcHRzKSA9PiBJQ29sbGVjdGlvbkZldGNoT3B0cztcbiAgdHJhbnNmb3JtUmVzcG9uc2U6IChyZXNwb25zZTogSVJhd1Jlc3BvbnNlKSA9PiBJUmF3UmVzcG9uc2U7XG59XG5cbmV4cG9ydCBjb25zdCBjb25maWc6IElDb25maWdUeXBlID0ge1xuXG4gIC8qKiBCYXNlIFVSTCBmb3IgYWxsIEFQSSBjYWxscyAqL1xuICBiYXNlVXJsOiAnLycsXG5cbiAgLyoqIEVuYWJsZSBjYWNoaW5nIGJ5IGRlZmF1bHQgaW4gdGhlIGJyb3dzZXIgKi9cbiAgY2FjaGU6IGlzQnJvd3NlcixcblxuICAvKiogRGVmYXVsdCBvcHRpb25zIHRoYXQgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGZldGNoIGZ1bmN0aW9uICovXG4gIGRlZmF1bHRGZXRjaE9wdGlvbnM6IHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL3ZuZC5hcGkranNvbicsXG4gICAgfSxcbiAgfSxcblxuICAvKiogUmVmZXJlbmNlIG9mIHRoZSBmZXRjaCBtZXRob2QgdGhhdCBzaG91bGQgYmUgdXNlZCAqL1xuICBmZXRjaFJlZmVyZW5jZTogaXNCcm93c2VyICYmICdmZXRjaCcgaW4gd2luZG93ICYmIHdpbmRvdy5mZXRjaC5iaW5kKHdpbmRvdyksXG5cbiAgLyoqIERldGVybWluZXMgaG93IHdpbGwgdGhlIHJlcXVlc3QgcGFyYW0gYXJyYXlzIGJlIHN0cmluZ2lmaWVkICovXG4gIHBhcmFtQXJyYXlUeXBlOiBQYXJhbUFycmF5VHlwZS5DT01NQV9TRVBBUkFURUQsIC8vIEFzIHJlY29tbWVuZGVkIGJ5IHRoZSBzcGVjXG5cbiAgLyoqXG4gICAqIEJhc2UgaW1wbGVtZW50YXRpb24gb2YgdGhlIGZldGNoIGZ1bmN0aW9uIChjYW4gYmUgb3ZlcnJpZGRlbilcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZCBBUEkgY2FsbCBtZXRob2RcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBBUEkgY2FsbCBVUkxcbiAgICogQHBhcmFtIHtvYmplY3R9IFtib2R5XSBBUEkgY2FsbCBib2R5XG4gICAqIEBwYXJhbSB7SUhlYWRlcnN9IFtyZXF1ZXN0SGVhZGVyc10gSGVhZGVycyB0aGF0IHdpbGwgYmUgc2VudFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxJUmF3UmVzcG9uc2U+fSBSZXNvbHZlcyB3aXRoIGEgcmF3IHJlc3BvbnNlIG9iamVjdFxuICAgKi9cbiAgYmFzZUZldGNoKFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIHVybDogc3RyaW5nLFxuICAgIGJvZHk/OiBvYmplY3QsXG4gICAgcmVxdWVzdEhlYWRlcnM/OiBJSGVhZGVycyxcbiAgKTogUHJvbWlzZTxJUmF3UmVzcG9uc2U+IHtcbiAgICBsZXQgZGF0YTogSVJlc3BvbnNlO1xuICAgIGxldCBzdGF0dXM6IG51bWJlcjtcbiAgICBsZXQgaGVhZGVyczogSVJlc3BvbnNlSGVhZGVycztcblxuICAgIGNvbnN0IHJlcXVlc3Q6IFByb21pc2U8dm9pZD4gPSBQcm9taXNlLnJlc29sdmUoKTtcblxuICAgIGNvbnN0IHVwcGVyY2FzZU1ldGhvZCA9IG1ldGhvZC50b1VwcGVyQ2FzZSgpO1xuICAgIGNvbnN0IGlzQm9keVN1cHBvcnRlZCA9IHVwcGVyY2FzZU1ldGhvZCAhPT0gJ0dFVCcgJiYgdXBwZXJjYXNlTWV0aG9kICE9PSAnSEVBRCc7XG5cbiAgICByZXR1cm4gcmVxdWVzdFxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjb25zdCBkZWZhdWx0SGVhZGVycyA9IGNvbmZpZy5kZWZhdWx0RmV0Y2hPcHRpb25zLmhlYWRlcnMgfHwge307XG4gICAgICAgIGNvbnN0IHJlcUhlYWRlcnM6IElIZWFkZXJzID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdEhlYWRlcnMsIHJlcXVlc3RIZWFkZXJzKSBhcyBJSGVhZGVycztcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZy5kZWZhdWx0RmV0Y2hPcHRpb25zLCB7XG4gICAgICAgICAgYm9keTogaXNCb2R5U3VwcG9ydGVkICYmIEpTT04uc3RyaW5naWZ5KGJvZHkpIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICBoZWFkZXJzOiByZXFIZWFkZXJzLFxuICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLmZldGNoUmVmZXJlbmNlKHVybCwgb3B0aW9ucyk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKHJlc3BvbnNlOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICBzdGF0dXMgPSByZXNwb25zZS5zdGF0dXM7XG4gICAgICAgIGhlYWRlcnMgPSByZXNwb25zZS5oZWFkZXJzO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3I6IEVycm9yKSA9PiB7XG4gICAgICAgIGlmIChzdGF0dXMgPT09IDIwNCkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfSlcbiAgICAgIC50aGVuKChyZXNwb25zZURhdGE6IElSZXNwb25zZSkgPT4ge1xuICAgICAgICBkYXRhID0gcmVzcG9uc2VEYXRhO1xuICAgICAgICBpZiAoc3RhdHVzID49IDQwMCkge1xuICAgICAgICAgIHRocm93IHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBJbnZhbGlkIEhUVFAgc3RhdHVzOiAke3N0YXR1c31gLFxuICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge2RhdGEsIGhlYWRlcnMsIHJlcXVlc3RIZWFkZXJzLCBzdGF0dXN9O1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMub25FcnJvcih7ZGF0YSwgZXJyb3IsIGhlYWRlcnMsIHJlcXVlc3RIZWFkZXJzLCBzdGF0dXN9KTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIG9uRXJyb3IocmVzcDogSVJlc3BvbnNlT2JqZWN0KSB7XG4gICAgcmV0dXJuIHJlc3A7XG4gIH0sXG5cbiAgdHJhbnNmb3JtUmVxdWVzdChvcHRpb25zOiBJQ29sbGVjdGlvbkZldGNoT3B0cyk6IElDb2xsZWN0aW9uRmV0Y2hPcHRzIHtcbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfSxcblxuICB0cmFuc2Zvcm1SZXNwb25zZShyZXNwb25zZTogSVJhd1Jlc3BvbnNlKTogSVJhd1Jlc3BvbnNlIHtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH0sXG59O1xuXG4vKipcbiAqIEJhc2UgaW1wbGVtZW50YXRpb24gb2YgdGhlIHN0YXRlZnVsIGZldGNoIGZ1bmN0aW9uIChjYW4gYmUgb3ZlcnJpZGRlbilcbiAqXG4gKiBAcGFyYW0ge0lDb2xsZWN0aW9uRmV0Y2hPcHRzfSByZXFPcHRpb25zIEFQSSByZXF1ZXN0IG9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIHJlc3BvbnNlIG9iamVjdFxuICovXG5mdW5jdGlvbiBjb2xsZWN0aW9uRmV0Y2g8VCBleHRlbmRzIElKc29uYXBpTW9kZWw+KHJlcU9wdGlvbnM6IElDb2xsZWN0aW9uRmV0Y2hPcHRzKTogUHJvbWlzZTxMaWJSZXNwb25zZTxUPj4ge1xuICBjb25zdCB7XG4gICAgdXJsLFxuICAgIG9wdGlvbnMsXG4gICAgZGF0YSxcbiAgICBtZXRob2QgPSAnR0VUJyxcbiAgICBjb2xsZWN0aW9uLFxuICB9ID0gY29uZmlnLnRyYW5zZm9ybVJlcXVlc3QocmVxT3B0aW9ucyk7XG5cbiAgY29uc3Qgc3RhdGljQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb24gJiYgY29sbGVjdGlvbi5jb25zdHJ1Y3RvciBhcyB7Y2FjaGU/OiBib29sZWFufTtcbiAgY29uc3QgY29sbGVjdGlvbkNhY2hlID0gc3RhdGljQ29sbGVjdGlvbiAmJiBzdGF0aWNDb2xsZWN0aW9uLmNhY2hlO1xuICBjb25zdCBpc0NhY2hlU3VwcG9ydGVkID0gbWV0aG9kLnRvVXBwZXJDYXNlKCkgPT09ICdHRVQnO1xuICBjb25zdCBza2lwQ2FjaGUgPSByZXFPcHRpb25zLm9wdGlvbnMgJiYgcmVxT3B0aW9ucy5vcHRpb25zLnNraXBDYWNoZTtcblxuICBpZiAoY29uZmlnLmNhY2hlICYmIGlzQ2FjaGVTdXBwb3J0ZWQgJiYgY29sbGVjdGlvbkNhY2hlICYmICFza2lwQ2FjaGUpIHtcbiAgICBjb25zdCBjYWNoZSA9IGdldENhY2hlKHVybCk7XG4gICAgaWYgKGNhY2hlKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNhY2hlLnJlc3BvbnNlKSBhcyBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PjtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gY29uZmlnLmJhc2VGZXRjaChtZXRob2QsIHVybCwgZGF0YSwgb3B0aW9ucyAmJiBvcHRpb25zLmhlYWRlcnMpXG4gICAgLnRoZW4oKHJlc3BvbnNlOiBJUmF3UmVzcG9uc2UpID0+IHtcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb25SZXNwb25zZSA9IE9iamVjdC5hc3NpZ24ocmVzcG9uc2UsIHtjb2xsZWN0aW9ufSk7XG4gICAgICBjb25zdCByZXNwID0gbmV3IExpYlJlc3BvbnNlPFQ+KGNvbmZpZy50cmFuc2Zvcm1SZXNwb25zZShjb2xsZWN0aW9uUmVzcG9uc2UpLCBjb2xsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgIGlmIChjb25maWcuY2FjaGUgJiYgaXNDYWNoZVN1cHBvcnRlZCkge1xuICAgICAgICBzYXZlQ2FjaGUodXJsLCByZXNwKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXNwO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmV0Y2g8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihvcHRpb25zOiBJQ29sbGVjdGlvbkZldGNoT3B0cykge1xuICByZXR1cm4gY29sbGVjdGlvbkZldGNoPFQ+KG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIEFQSSBjYWxsIHVzZWQgdG8gZ2V0IGRhdGEgZnJvbSB0aGUgc2VydmVyXG4gKlxuICogQGV4cG9ydFxuICogQHBhcmFtIHtJSnNvbmFwaUNvbGxlY3Rpb259IGNvbGxlY3Rpb24gUmVsYXRlZCBjb2xsZWN0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIEFQSSBjYWxsIFVSTFxuICogQHBhcmFtIHtJSGVhZGVyc30gW2hlYWRlcnNdIEhlYWRlcnMgdG8gYmUgc2VudFxuICogQHBhcmFtIHtJUmVxdWVzdE9wdGlvbnN9IFtvcHRpb25zXSBTZXJ2ZXIgb3B0aW9uc1xuICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSBSZXNvbHZlcyB3aXRoIGEgUmVzcG9uc2Ugb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWFkPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gIHVybDogc3RyaW5nLFxuICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uLFxuICBoZWFkZXJzPzogSUhlYWRlcnMsXG4gIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4pOiBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PiB7XG4gIHJldHVybiBjb2xsZWN0aW9uRmV0Y2g8VD4oe1xuICAgIGNvbGxlY3Rpb24sXG4gICAgZGF0YTogdW5kZWZpbmVkLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgb3B0aW9uczogey4uLm9wdGlvbnMsIGhlYWRlcnN9LFxuICAgIHVybCxcbiAgfSk7XG59XG5cbi8qKlxuICogQVBJIGNhbGwgdXNlZCB0byBjcmVhdGUgZGF0YSBvbiB0aGUgc2VydmVyXG4gKlxuICogQGV4cG9ydFxuICogQHBhcmFtIHtJSnNvbmFwaUNvbGxlY3Rpb259IGNvbGxlY3Rpb24gUmVsYXRlZCBjb2xsZWN0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIEFQSSBjYWxsIFVSTFxuICogQHBhcmFtIHtvYmplY3R9IFtkYXRhXSBSZXF1ZXN0IGJvZHlcbiAqIEBwYXJhbSB7SUhlYWRlcnN9IFtoZWFkZXJzXSBIZWFkZXJzIHRvIGJlIHNlbnRcbiAqIEBwYXJhbSB7SVJlcXVlc3RPcHRpb25zfSBbb3B0aW9uc10gU2VydmVyIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIFJlc3BvbnNlIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gIHVybDogc3RyaW5nLFxuICBkYXRhPzogb2JqZWN0LFxuICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uLFxuICBoZWFkZXJzPzogSUhlYWRlcnMsXG4gIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4pOiBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PiB7XG4gIHJldHVybiBjb2xsZWN0aW9uRmV0Y2g8VD4oe1xuICAgIGNvbGxlY3Rpb24sXG4gICAgZGF0YSxcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBvcHRpb25zOiB7Li4ub3B0aW9ucywgaGVhZGVyc30sXG4gICAgdXJsLFxuICB9KTtcbn1cblxuLyoqXG4gKiBBUEkgY2FsbCB1c2VkIHRvIHVwZGF0ZSBkYXRhIG9uIHRoZSBzZXJ2ZXJcbiAqXG4gKiBAZXhwb3J0XG4gKiBAcGFyYW0ge0lKc29uYXBpQ29sbGVjdGlvbn0gY29sbGVjdGlvbiBSZWxhdGVkIGNvbGxlY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQVBJIGNhbGwgVVJMXG4gKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdIFJlcXVlc3QgYm9keVxuICogQHBhcmFtIHtJSGVhZGVyc30gW2hlYWRlcnNdIEhlYWRlcnMgdG8gYmUgc2VudFxuICogQHBhcmFtIHtJUmVxdWVzdE9wdGlvbnN9IFtvcHRpb25zXSBTZXJ2ZXIgb3B0aW9uc1xuICogQHJldHVybnMge1Byb21pc2U8UmVzcG9uc2U+fSBSZXNvbHZlcyB3aXRoIGEgUmVzcG9uc2Ugb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGU8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihcbiAgdXJsOiBzdHJpbmcsXG4gIGRhdGE/OiBvYmplY3QsXG4gIGNvbGxlY3Rpb24/OiBJSnNvbmFwaUNvbGxlY3Rpb24sXG4gIGhlYWRlcnM/OiBJSGVhZGVycyxcbiAgb3B0aW9ucz86IElSZXF1ZXN0T3B0aW9ucyxcbik6IFByb21pc2U8TGliUmVzcG9uc2U8VD4+IHtcbiAgcmV0dXJuIGNvbGxlY3Rpb25GZXRjaDxUPih7XG4gICAgY29sbGVjdGlvbixcbiAgICBkYXRhLFxuICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICBvcHRpb25zOiB7Li4ub3B0aW9ucywgaGVhZGVyc30sXG4gICAgdXJsLFxuICB9KTtcbn1cblxuLyoqXG4gKiBBUEkgY2FsbCB1c2VkIHRvIHJlbW92ZSBkYXRhIGZyb20gdGhlIHNlcnZlclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7SUpzb25hcGlDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIFJlbGF0ZWQgY29sbGVjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBBUEkgY2FsbCBVUkxcbiAqIEBwYXJhbSB7SUhlYWRlcnN9IFtoZWFkZXJzXSBIZWFkZXJzIHRvIGJlIHNlbnRcbiAqIEBwYXJhbSB7SVJlcXVlc3RPcHRpb25zfSBbb3B0aW9uc10gU2VydmVyIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPFJlc3BvbnNlPn0gUmVzb2x2ZXMgd2l0aCBhIFJlc3BvbnNlIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gIHVybDogc3RyaW5nLFxuICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uLFxuICBoZWFkZXJzPzogSUhlYWRlcnMsXG4gIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4pOiBQcm9taXNlPExpYlJlc3BvbnNlPFQ+PiB7XG4gIHJldHVybiBjb2xsZWN0aW9uRmV0Y2g8VD4oe1xuICAgIGNvbGxlY3Rpb24sXG4gICAgZGF0YTogdW5kZWZpbmVkLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgb3B0aW9uczogey4uLm9wdGlvbnMsIGhlYWRlcnN9LFxuICAgIHVybCxcbiAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2ggYSBsaW5rIGZyb20gdGhlIHNlcnZlclxuICpcbiAqIEBleHBvcnRcbiAqIEBwYXJhbSB7SnNvbkFwaS5JTGlua30gbGluayBMaW5rIFVSTCBvciBhIGxpbmsgb2JqZWN0XG4gKiBAcGFyYW0ge0lKc29uYXBpQ29sbGVjdGlvbn0gY29sbGVjdGlvbiBTdG9yZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBzYXZlIHRoZSByZXNwb25zZVxuICogQHBhcmFtIHtJRGljdGlvbmFyeTxzdHJpbmc+fSBbcmVxdWVzdEhlYWRlcnNdIFJlcXVlc3QgaGVhZGVyc1xuICogQHBhcmFtIHtJUmVxdWVzdE9wdGlvbnN9IFtvcHRpb25zXSBTZXJ2ZXIgb3B0aW9uc1xuICogQHJldHVybnMge1Byb21pc2U8TGliUmVzcG9uc2U+fSBSZXNwb25zZSBwcm9taXNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmZXRjaExpbms8VCBleHRlbmRzIElKc29uYXBpTW9kZWwgPSBJSnNvbmFwaU1vZGVsPihcbiAgbGluazogSUxpbmssXG4gIGNvbGxlY3Rpb24/OiBJSnNvbmFwaUNvbGxlY3Rpb24sXG4gIHJlcXVlc3RIZWFkZXJzPzogSURpY3Rpb25hcnk8c3RyaW5nPixcbiAgb3B0aW9ucz86IElSZXF1ZXN0T3B0aW9ucyxcbik6IFByb21pc2U8TGliUmVzcG9uc2U8VD4+IHtcbiAgaWYgKGxpbmspIHtcbiAgICBjb25zdCBocmVmOiBzdHJpbmcgPSB0eXBlb2YgbGluayA9PT0gJ29iamVjdCcgPyBsaW5rLmhyZWYgOiBsaW5rO1xuXG4gICAgaWYgKGhyZWYpIHtcbiAgICAgIHJldHVybiByZWFkPFQ+KGhyZWYsIGNvbGxlY3Rpb24sIHJlcXVlc3RIZWFkZXJzLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgTGliUmVzcG9uc2Uoe2RhdGE6IHVuZGVmaW5lZH0sIGNvbGxlY3Rpb24pKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVJlc3BvbnNlPFQgZXh0ZW5kcyBJSnNvbmFwaU1vZGVsID0gSUpzb25hcGlNb2RlbD4oXG4gIHJlY29yZDogVCxcbiAgcHJvcD86IHN0cmluZyxcbik6IChyZXNwb25zZTogTGliUmVzcG9uc2U8VD4pID0+IFQge1xuICByZXR1cm4gKHJlc3BvbnNlOiBMaWJSZXNwb25zZTxUPik6IFQgPT4ge1xuXG4gICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7XG4gICAgICB0aHJvdyByZXNwb25zZS5lcnJvcjtcbiAgICB9XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDQpIHtcbiAgICAgIHNldE1vZGVsTWV0YUtleShyZWNvcmQsIE1PREVMX1BFUlNJU1RFRF9GSUVMRCwgdHJ1ZSk7XG4gICAgICByZXR1cm4gcmVjb3JkIGFzIFQ7XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMikge1xuICAgICAgY29uc3QgcmVzcG9uc2VSZWNvcmQgPSByZXNwb25zZS5kYXRhIGFzIFQ7XG4gICAgICBzZXRNb2RlbE1ldGFLZXkocmVzcG9uc2VSZWNvcmQsIE1PREVMX1BST1BfRklFTEQsIHByb3ApO1xuICAgICAgc2V0TW9kZWxNZXRhS2V5KHJlc3BvbnNlUmVjb3JkLCBNT0RFTF9RVUVVRV9GSUVMRCwgdHJ1ZSk7XG4gICAgICBzZXRNb2RlbE1ldGFLZXkocmVzcG9uc2VSZWNvcmQsIE1PREVMX1JFTEFURURfRklFTEQsIHJlY29yZCk7XG4gICAgICByZXR1cm4gcmVzcG9uc2VSZWNvcmQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldE1vZGVsTWV0YUtleShyZWNvcmQsIE1PREVMX1BFUlNJU1RFRF9GSUVMRCwgdHJ1ZSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2UucmVwbGFjZURhdGEocmVjb3JkKS5kYXRhIGFzIFQ7XG4gICAgfVxuICB9O1xufVxuIl19","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/NetworkUtils.d.ts","text":"import { IDictionary } from 'datx-utils';\r\nimport { fetch } from 'isomorphic-fetch';\r\nimport { ParamArrayType } from './enums/ParamArrayType';\r\nimport { IHeaders } from './interfaces/IHeaders';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nimport { IJsonapiModel } from './interfaces/IJsonapiModel';\r\nimport { IRawResponse } from './interfaces/IRawResponse';\r\nimport { IRequestOptions } from './interfaces/IRequestOptions';\r\nimport { IResponseHeaders } from './interfaces/IResponseHeaders';\r\nimport { ILink, IResponse } from './interfaces/JsonApi';\r\nimport { Response as LibResponse } from './Response';\r\nexport declare type FetchType = (method: string, url: string, body?: object, requestHeaders?: IHeaders) => Promise<IRawResponse>;\r\nexport interface ICollectionFetchOpts {\r\n    url: string;\r\n    options?: IRequestOptions & {\r\n        headers?: IHeaders;\r\n    };\r\n    data?: object;\r\n    method: string;\r\n    collection?: IJsonapiCollection;\r\n    skipCache?: boolean;\r\n}\r\nexport declare type CollectionFetchType = <T extends IJsonapiModel>(options: ICollectionFetchOpts) => Promise<LibResponse<T>>;\r\nexport interface IResponseObject {\r\n    data: IResponse;\r\n    error?: Error;\r\n    headers: IResponseHeaders;\r\n    requestHeaders: IHeaders;\r\n    status: number;\r\n}\r\nexport interface IConfigType {\r\n    baseFetch: FetchType;\r\n    baseUrl: string;\r\n    cache: boolean;\r\n    defaultFetchOptions: IDictionary<any>;\r\n    fetchReference: fetch;\r\n    paramArrayType: ParamArrayType;\r\n    onError: (IResponseObject) => IResponseObject;\r\n    transformRequest: (options: ICollectionFetchOpts) => ICollectionFetchOpts;\r\n    transformResponse: (response: IRawResponse) => IRawResponse;\r\n}\r\nexport declare const config: IConfigType;\r\nexport declare function fetch<T extends IJsonapiModel = IJsonapiModel>(options: ICollectionFetchOpts): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to get data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function read<T extends IJsonapiModel = IJsonapiModel>(url: string, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to create data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function create<T extends IJsonapiModel = IJsonapiModel>(url: string, data?: object, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to update data on the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {object} [data] Request body\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function update<T extends IJsonapiModel = IJsonapiModel>(url: string, data?: object, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * API call used to remove data from the server\r\n *\r\n * @export\r\n * @param {IJsonapiCollection} collection Related collection\r\n * @param {string} url API call URL\r\n * @param {IHeaders} [headers] Headers to be sent\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<Response>} Resolves with a Response object\r\n */\r\nexport declare function remove<T extends IJsonapiModel = IJsonapiModel>(url: string, collection?: IJsonapiCollection, headers?: IHeaders, options?: IRequestOptions): Promise<LibResponse<T>>;\r\n/**\r\n * Fetch a link from the server\r\n *\r\n * @export\r\n * @param {JsonApi.ILink} link Link URL or a link object\r\n * @param {IJsonapiCollection} collection Store that will be used to save the response\r\n * @param {IDictionary<string>} [requestHeaders] Request headers\r\n * @param {IRequestOptions} [options] Server options\r\n * @returns {Promise<LibResponse>} Response promise\r\n */\r\nexport declare function fetchLink<T extends IJsonapiModel = IJsonapiModel>(link: ILink, collection?: IJsonapiCollection, requestHeaders?: IDictionary<string>, options?: IRequestOptions): Promise<LibResponse<T>>;\r\nexport declare function handleResponse<T extends IJsonapiModel = IJsonapiModel>(record: T, prop?: string): (response: LibResponse<T>) => T;\r\n"}}
