{"code":"import * as tslib_1 from \"tslib\";\r\nimport { getModelId, getModelType, modelToJSON, updateModel, updateModelId } from 'datx';\r\nimport { assignComputed } from 'datx-utils';\r\nimport { action } from 'mobx';\r\nimport { GenericModel } from './GenericModel';\r\nimport { flattenModel } from './helpers/model';\r\nimport { fetchLink } from './NetworkUtils';\r\nvar Response = /** @class */ (function () {\r\n    function Response(response, collection, options, overrideData) {\r\n        var _this = this;\r\n        /**\r\n         * API response data (synced with the store)\r\n         *\r\n         * @type {(PureModel|Array<PureModel>)}\r\n         * @memberOf Response\r\n         */\r\n        this.data = null;\r\n        /**\r\n         * Cache used for the link requests\r\n         *\r\n         * @private\r\n         * @type {IDictionary<Promise<Response>>}\r\n         * @memberOf Response\r\n         */\r\n        this.__cache = {};\r\n        this.__collection = collection;\r\n        this.__options = options;\r\n        this.__response = response;\r\n        this.status = response.status;\r\n        if (collection) {\r\n            this.data = overrideData ? collection.add(overrideData) : collection.sync(response.data);\r\n        }\r\n        else if (response.data) {\r\n            // The case when a record is not in a store and save/remove are used\r\n            var resp = response.data;\r\n            if (resp.data) {\r\n                if (resp.data instanceof Array) {\r\n                    throw new Error('A save/remove operation should not return an array of results');\r\n                }\r\n                this.data = overrideData || new GenericModel(flattenModel(resp.data));\r\n            }\r\n        }\r\n        this.meta = (response.data && response.data.meta) || {};\r\n        this.links = (response.data && response.data.links) || {};\r\n        this.jsonapi = (response.data && response.data.jsonapi) || {};\r\n        this.headers = response.headers;\r\n        this.requestHeaders = response.requestHeaders;\r\n        this.error = (response.data && response.data.errors) || response.error;\r\n        var linkGetter = {};\r\n        if (this.links) {\r\n            Object.keys(this.links).forEach(function (link) {\r\n                assignComputed(_this, link, function () { return _this.__fetchLink(link); });\r\n            });\r\n        }\r\n        Object.freeze(this);\r\n        if (this.error) {\r\n            throw this;\r\n        }\r\n    }\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.replaceData = function (data) {\r\n        var record = this.data;\r\n        if (record === data) {\r\n            return this;\r\n        }\r\n        var oldId = getModelId(data);\r\n        var newId = getModelId(record);\r\n        var type = getModelType(record);\r\n        if (this.__collection) {\r\n            this.__collection.remove(record);\r\n            this.__collection.add(data);\r\n        }\r\n        updateModel(data, modelToJSON(record));\r\n        updateModelId(data, newId);\r\n        return new Response(this.__response, this.__collection, this.__options, data);\r\n    };\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    Response.prototype.__fetchLink = function (name) {\r\n        if (!this.__cache[name]) {\r\n            var link = (this.links && name in this.links) ? this.links[name] : null;\r\n            if (link) {\r\n                this.__cache[name] = fetchLink(link, this.__collection, this.requestHeaders, this.__options);\r\n            }\r\n        }\r\n        return this.__cache[name];\r\n    };\r\n    tslib_1.__decorate([\r\n        action\r\n    ], Response.prototype, \"replaceData\", null);\r\n    return Response;\r\n}());\r\nexport { Response };\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzcG9uc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcmMvUmVzcG9uc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBYSxXQUFXLEVBQUUsYUFBYSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ2xHLE9BQU8sRUFBQyxjQUFjLEVBQWMsTUFBTSxZQUFZLENBQUM7QUFDdkQsT0FBTyxFQUFDLE1BQU0sRUFBbUMsTUFBTSxNQUFNLENBQUM7QUFTOUQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUU3QyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFekM7SUFzSUUsa0JBQ0UsUUFBc0IsRUFDdEIsVUFBK0IsRUFDL0IsT0FBeUIsRUFDekIsWUFBeUI7UUFKM0IsaUJBNkNDO1FBakxEOzs7OztXQUtHO1FBQ0ksU0FBSSxHQUFvQixJQUFJLENBQUM7UUFxSHBDOzs7Ozs7V0FNRztRQUNLLFlBQU8sR0FBc0MsRUFBRSxDQUFDO1FBUXRELElBQUksQ0FBQyxZQUFZLEdBQUcsVUFBVSxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxVQUFVLEdBQUcsUUFBUSxDQUFDO1FBQzNCLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUU5QixFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2YsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUksWUFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0RyxDQUFDO1FBQUMs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TSxDQUFDLENBQUMsQ0FBQztRQUN2QyxhQUFhLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRTNCLE1BQU0sQ0FBQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBRUQ7Ozs7Ozs7O09BUUc7SUFDSyw4QkFBVyxHQUFuQixVQUFvQixJQUFJO1FBQ3RCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFeEIsSUFBTSxJQUFJLEdBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUV0RixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNULElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsU0FBUyxDQUFJLElBQUksRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2xHLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQXhDTztRQUFQLE1BQU07K0NBbUJOO0lBc0JILGVBQUM7Q0FBQSxBQXRPRCxJQXNPQztTQXRPWSxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtnZXRNb2RlbElkLCBnZXRNb2RlbFR5cGUsIG1vZGVsVG9KU09OLCBQdXJlTW9kZWwsIHVwZGF0ZU1vZGVsLCB1cGRhdGVNb2RlbElkfSBmcm9tICdkYXR4JztcbmltcG9ydCB7YXNzaWduQ29tcHV0ZWQsIElEaWN0aW9uYXJ5fSBmcm9tICdkYXR4LXV0aWxzJztcbmltcG9ydCB7YWN0aW9uLCBleHRlbmRPYnNlcnZhYmxlLCBJQ29tcHV0ZWRWYWx1ZX0gZnJvbSAnbW9ieCc7XG5cbmltcG9ydCB7SUhlYWRlcnN9IGZyb20gJy4vaW50ZXJmYWNlcy9JSGVhZGVycyc7XG5pbXBvcnQge0lKc29uYXBpTW9kZWx9IGZyb20gJy4vaW50ZXJmYWNlcy9JSnNvbmFwaU1vZGVsJztcbmltcG9ydCB7SVJhd1Jlc3BvbnNlfSBmcm9tICcuL2ludGVyZmFjZXMvSVJhd1Jlc3BvbnNlJztcbmltcG9ydCB7SVJlcXVlc3RPcHRpb25zfSBmcm9tICcuL2ludGVyZmFjZXMvSVJlcXVlc3RPcHRpb25zJztcbmltcG9ydCB7SVJlc3BvbnNlSGVhZGVyc30gZnJvbSAnLi9pbnRlcmZhY2VzL0lSZXNwb25zZUhlYWRlcnMnO1xuaW1wb3J0IHtJRXJyb3IsIElKc29uQXBpT2JqZWN0LCBJTGlua30gZnJvbSAnLi9pbnRlcmZhY2VzL0pzb25BcGknO1xuXG5pbXBvcnQge0dlbmVyaWNNb2RlbH0gZnJvbSAnLi9HZW5lcmljTW9kZWwnO1xuaW1wb3J0IHtmbGF0dGVuTW9kZWx9IGZyb20gJy4vaGVscGVycy9tb2RlbCc7XG5pbXBvcnQge0lKc29uYXBpQ29sbGVjdGlvbn0gZnJvbSAnLi9pbnRlcmZhY2VzL0lKc29uYXBpQ29sbGVjdGlvbic7XG5pbXBvcnQge2ZldGNoTGlua30gZnJvbSAnLi9OZXR3b3JrVXRpbHMnO1xuXG5leHBvcnQgY2xhc3MgUmVzcG9uc2U8VCBleHRlbmRzIElKc29uYXBpTW9kZWw+IHtcblxuICAvKipcbiAgICogQVBJIHJlc3BvbnNlIGRhdGEgKHN5bmNlZCB3aXRoIHRoZSBzdG9yZSlcbiAgICpcbiAgICogQHR5cGUgeyhQdXJlTW9kZWx8QXJyYXk8UHVyZU1vZGVsPil9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGRhdGE6IFR8QXJyYXk8VD58bnVsbCA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEFQSSByZXNwb25zZSBtZXRhZGF0YVxuICAgKlxuICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBtZXRhPzogb2JqZWN0O1xuXG4gIC8qKlxuICAgKiBBUEkgcmVzcG9uc2UgbGlua3NcbiAgICpcbiAgICogQHR5cGUge29iamVjdH1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgbGlua3M/OiBJRGljdGlvbmFyeTxJTGluaz47XG5cbiAgLyoqXG4gICAqIFRoZSBKU09OIEFQSSBvYmplY3QgcmV0dXJuZWQgYnkgdGhlIHNlcnZlclxuICAgKlxuICAgKiBAdHlwZSB7SnNvbkFwaS5JSnNvbkFwaU9iamVjdH1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMganNvbmFwaT86IElKc29uQXBpT2JqZWN0O1xuXG4gIC8qKlxuICAgKiBIZWFkZXJzIHJlY2VpdmVkIGZyb20gdGhlIEFQSSBjYWxsXG4gICAqXG4gICAqIEB0eXBlIHtJUmVzcG9uc2VIZWFkZXJzfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBoZWFkZXJzPzogSVJlc3BvbnNlSGVhZGVycztcblxuICAvKipcbiAgICogSGVhZGVycyBzZW50IHRvIHRoZSBzZXJ2ZXJcbiAgICpcbiAgICogQHR5cGUge0lIZWFkZXJzfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyByZXF1ZXN0SGVhZGVycz86IElIZWFkZXJzO1xuXG4gIC8qKlxuICAgKiBSZXF1ZXN0IGVycm9yXG4gICAqXG4gICAqIEB0eXBlIHsoQXJyYXk8SnNvbkFwaS5JRXJyb3I+fEVycm9yKX1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgZXJyb3I/OiBBcnJheTxJRXJyb3I+fEVycm9yO1xuXG4gIC8qKlxuICAgKiBGaXJzdCBkYXRhIHBhZ2VcbiAgICpcbiAgICogQHR5cGUge1Byb21pc2U8UmVzcG9uc2U+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBmaXJzdD86IFByb21pc2U8UmVzcG9uc2U8VD4+OyAvLyBIYW5kbGVkIGJ5IHRoZSBfX2ZldGNoTGlua1xuXG4gIC8qKlxuICAgKiBQcmV2aW91cyBkYXRhIHBhZ2VcbiAgICpcbiAgICogQHR5cGUge1Byb21pc2U8UmVzcG9uc2U+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBwcmV2PzogUHJvbWlzZTxSZXNwb25zZTxUPj47IC8vIEhhbmRsZWQgYnkgdGhlIF9fZmV0Y2hMaW5rXG5cbiAgLyoqXG4gICAqIE5leHQgZGF0YSBwYWdlXG4gICAqXG4gICAqIEB0eXBlIHtQcm9taXNlPFJlc3BvbnNlPn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgbmV4dD86IFByb21pc2U8UmVzcG9uc2U8VD4+OyAvLyBIYW5kbGVkIGJ5IHRoZSBfX2ZldGNoTGlua1xuXG4gIC8qKlxuICAgKiBMYXN0IGRhdGEgcGFnZVxuICAgKlxuICAgKiBAdHlwZSB7UHJvbWlzZTxSZXNwb25zZT59XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHVibGljIGxhc3Q/OiBQcm9taXNlPFJlc3BvbnNlPFQ+PjsgLy8gSGFuZGxlZCBieSB0aGUgX19mZXRjaExpbmtcblxuICAvKipcbiAgICogUmVjZWl2ZWQgSFRUUCBzdGF0dXNcbiAgICpcbiAgICogQHR5cGUge251bWJlcn1cbiAgICogQG1lbWJlck9mIFJlc3BvbnNlXG4gICAqL1xuICBwdWJsaWMgc3RhdHVzPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBSZWxhdGVkIFN0b3JlXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtJSnNvbmFwaUNvbGxlY3Rpb259XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHJpdmF0ZSBfX2NvbGxlY3Rpb24/OiBJSnNvbmFwaUNvbGxlY3Rpb247XG5cbiAgLyoqXG4gICAqIFNlcnZlciBvcHRpb25zXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtJUmVxdWVzdE9wdGlvbnN9XG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHJpdmF0ZSBfX29wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnM7XG5cbiAgLyoqXG4gICAqIE9yaWdpbmFsIHNlcnZlciByZXNwb25zZVxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SVJhd1Jlc3BvbnNlfVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19yZXNwb25zZTogSVJhd1Jlc3BvbnNlO1xuXG4gIC8qKlxuICAgKiBDYWNoZSB1c2VkIGZvciB0aGUgbGluayByZXF1ZXN0c1xuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7SURpY3Rpb25hcnk8UHJvbWlzZTxSZXNwb25zZT4+fVxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIHByaXZhdGUgX19jYWNoZTogSURpY3Rpb25hcnk8UHJvbWlzZTxSZXNwb25zZTxUPj4+ID0ge307XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcmVzcG9uc2U6IElSYXdSZXNwb25zZSxcbiAgICBjb2xsZWN0aW9uPzogSUpzb25hcGlDb2xsZWN0aW9uLFxuICAgIG9wdGlvbnM/OiBJUmVxdWVzdE9wdGlvbnMsXG4gICAgb3ZlcnJpZGVEYXRhPzogVHxBcnJheTxUPixcbiAgKSB7XG4gICAgdGhpcy5fX2NvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIHRoaXMuX19vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLl9fcmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICB0aGlzLnN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1cztcblxuICAgIGlmIChjb2xsZWN0aW9uKSB7XG4gICAgICB0aGlzLmRhdGEgPSBvdmVycmlkZURhdGEgPyBjb2xsZWN0aW9uLmFkZDxUPihvdmVycmlkZURhdGEgYXMgVCkgOiBjb2xsZWN0aW9uLnN5bmM8VD4ocmVzcG9uc2UuZGF0YSk7XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhKSB7XG4gICAgICAvLyBUaGUgY2FzZSB3aGVuIGEgcmVjb3JkIGlzIG5vdCBpbiBhIHN0b3JlIGFuZCBzYXZlL3JlbW92ZSBhcmUgdXNlZFxuICAgICAgY29uc3QgcmVzcCA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgIGlmIChyZXNwLmRhdGEpIHtcbiAgICAgICAgaWYgKHJlc3AuZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBIHNhdmUvcmVtb3ZlIG9wZXJhdGlvbiBzaG91bGQgbm90IHJldHVybiBhbiBhcnJheSBvZiByZXN1bHRzJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRhdGEgPSBvdmVycmlkZURhdGEgfHwgbmV3IEdlbmVyaWNNb2RlbChmbGF0dGVuTW9kZWwocmVzcC5kYXRhKSkgYXMgVDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLm1ldGEgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLm1ldGEpIHx8IHt9O1xuICAgIHRoaXMubGlua3MgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmxpbmtzKSB8fCB7fTtcbiAgICB0aGlzLmpzb25hcGkgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmpzb25hcGkpIHx8IHt9O1xuICAgIHRoaXMuaGVhZGVycyA9IHJlc3BvbnNlLmhlYWRlcnM7XG4gICAgdGhpcy5yZXF1ZXN0SGVhZGVycyA9IHJlc3BvbnNlLnJlcXVlc3RIZWFkZXJzO1xuICAgIHRoaXMuZXJyb3IgPSAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmVycm9ycykgfHwgcmVzcG9uc2UuZXJyb3I7XG5cbiAgICBjb25zdCBsaW5rR2V0dGVyOiBJRGljdGlvbmFyeTxJQ29tcHV0ZWRWYWx1ZTxQcm9taXNlPFJlc3BvbnNlPFQ+Pj4+ID0ge307XG4gICAgaWYgKHRoaXMubGlua3MpIHtcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMubGlua3MpLmZvckVhY2goKGxpbms6IHN0cmluZykgPT4ge1xuICAgICAgICBhc3NpZ25Db21wdXRlZCh0aGlzLCBsaW5rLCAoKSA9PiB0aGlzLl9fZmV0Y2hMaW5rKGxpbmspKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIE9iamVjdC5mcmVlemUodGhpcyk7XG5cbiAgICBpZiAodGhpcy5lcnJvcikge1xuICAgICAgdGhyb3cgdGhpcztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVwbGFjZSB0aGUgcmVzcG9uc2UgcmVjb3JkIHdpdGggYSBkaWZmZXJlbnQgcmVjb3JkLiBVc2VkIHRvIHJlcGxhY2UgYSByZWNvcmQgd2hpbGUga2VlcGluZyB0aGUgc2FtZSByZWZlcmVuY2VcbiAgICpcbiAgICogQHBhcmFtIHtQdXJlTW9kZWx9IGRhdGEgTmV3IGRhdGFcbiAgICogQHJldHVybnMge1Jlc3BvbnNlfVxuICAgKlxuICAgKiBAbWVtYmVyT2YgUmVzcG9uc2VcbiAgICovXG4gIEBhY3Rpb24gcHVibGljIHJlcGxhY2VEYXRhKGRhdGE6IFQpOiBSZXNwb25zZTxUPiB7XG4gICAgY29uc3QgcmVjb3JkOiBQdXJlTW9kZWwgPSB0aGlzLmRhdGEgYXMgUHVyZU1vZGVsO1xuICAgIGlmIChyZWNvcmQgPT09IGRhdGEpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGNvbnN0IG9sZElkID0gZ2V0TW9kZWxJZChkYXRhKTtcbiAgICBjb25zdCBuZXdJZCA9IGdldE1vZGVsSWQocmVjb3JkKTtcbiAgICBjb25zdCB0eXBlID0gZ2V0TW9kZWxUeXBlKHJlY29yZCk7XG5cbiAgICBpZiAodGhpcy5fX2NvbGxlY3Rpb24pIHtcbiAgICAgIHRoaXMuX19jb2xsZWN0aW9uLnJlbW92ZShyZWNvcmQpO1xuICAgICAgdGhpcy5fX2NvbGxlY3Rpb24uYWRkKGRhdGEpO1xuICAgIH1cblxuICAgIHVwZGF0ZU1vZGVsKGRhdGEsIG1vZGVsVG9KU09OKHJlY29yZCkpO1xuICAgIHVwZGF0ZU1vZGVsSWQoZGF0YSwgbmV3SWQpO1xuXG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZSh0aGlzLl9fcmVzcG9uc2UsIHRoaXMuX19jb2xsZWN0aW9uLCB0aGlzLl9fb3B0aW9ucywgZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogRnVuY3Rpb24gY2FsbGVkIHdoZW4gYSBsaW5rIGlzIGJlaW5nIGZldGNoZWQuIFRoZSByZXR1cm5lZCB2YWx1ZSBpcyBjYWNoZWRcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHthbnl9IG5hbWUgTGluayBuYW1lXG4gICAqIEByZXR1cm5zIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIGEgUmVzcG9uc2Ugb2JqZWN0XG4gICAqXG4gICAqIEBtZW1iZXJPZiBSZXNwb25zZVxuICAgKi9cbiAgcHJpdmF0ZSBfX2ZldGNoTGluayhuYW1lKSB7XG4gICAgaWYgKCF0aGlzLl9fY2FjaGVbbmFtZV0pIHtcblxuICAgICAgY29uc3QgbGluazogSUxpbmt8bnVsbCA9ICh0aGlzLmxpbmtzICYmIG5hbWUgaW4gdGhpcy5saW5rcykgPyB0aGlzLmxpbmtzW25hbWVdIDogbnVsbDtcblxuICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgdGhpcy5fX2NhY2hlW25hbWVdID0gZmV0Y2hMaW5rPFQ+KGxpbmssIHRoaXMuX19jb2xsZWN0aW9uLCB0aGlzLnJlcXVlc3RIZWFkZXJzLCB0aGlzLl9fb3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9fY2FjaGVbbmFtZV07XG4gIH1cbn1cbiJdfQ==","map":{"mappings":""},"dts":{"name":"/Users/darko/Projects/mobx/datx/packages/datx-jsonapi/Response.d.ts","text":"import { IDictionary } from 'datx-utils';\r\nimport { IHeaders } from './interfaces/IHeaders';\r\nimport { IJsonapiModel } from './interfaces/IJsonapiModel';\r\nimport { IRawResponse } from './interfaces/IRawResponse';\r\nimport { IRequestOptions } from './interfaces/IRequestOptions';\r\nimport { IResponseHeaders } from './interfaces/IResponseHeaders';\r\nimport { IError, IJsonApiObject, ILink } from './interfaces/JsonApi';\r\nimport { IJsonapiCollection } from './interfaces/IJsonapiCollection';\r\nexport declare class Response<T extends IJsonapiModel> {\r\n    /**\r\n     * API response data (synced with the store)\r\n     *\r\n     * @type {(PureModel|Array<PureModel>)}\r\n     * @memberOf Response\r\n     */\r\n    data: T | Array<T> | null;\r\n    /**\r\n     * API response metadata\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    meta?: object;\r\n    /**\r\n     * API response links\r\n     *\r\n     * @type {object}\r\n     * @memberOf Response\r\n     */\r\n    links?: IDictionary<ILink>;\r\n    /**\r\n     * The JSON API object returned by the server\r\n     *\r\n     * @type {JsonApi.IJsonApiObject}\r\n     * @memberOf Response\r\n     */\r\n    jsonapi?: IJsonApiObject;\r\n    /**\r\n     * Headers received from the API call\r\n     *\r\n     * @type {IResponseHeaders}\r\n     * @memberOf Response\r\n     */\r\n    headers?: IResponseHeaders;\r\n    /**\r\n     * Headers sent to the server\r\n     *\r\n     * @type {IHeaders}\r\n     * @memberOf Response\r\n     */\r\n    requestHeaders?: IHeaders;\r\n    /**\r\n     * Request error\r\n     *\r\n     * @type {(Array<JsonApi.IError>|Error)}\r\n     * @memberOf Response\r\n     */\r\n    error?: Array<IError> | Error;\r\n    /**\r\n     * First data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    first?: Promise<Response<T>>;\r\n    /**\r\n     * Previous data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    prev?: Promise<Response<T>>;\r\n    /**\r\n     * Next data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    next?: Promise<Response<T>>;\r\n    /**\r\n     * Last data page\r\n     *\r\n     * @type {Promise<Response>}\r\n     * @memberOf Response\r\n     */\r\n    last?: Promise<Response<T>>;\r\n    /**\r\n     * Received HTTP status\r\n     *\r\n     * @type {number}\r\n     * @memberOf Response\r\n     */\r\n    status?: number;\r\n    /**\r\n     * Related Store\r\n     *\r\n     * @private\r\n     * @type {IJsonapiCollection}\r\n     * @memberOf Response\r\n     */\r\n    private __collection?;\r\n    /**\r\n     * Server options\r\n     *\r\n     * @private\r\n     * @type {IRequestOptions}\r\n     * @memberOf Response\r\n     */\r\n    private __options?;\r\n    /**\r\n     * Original server response\r\n     *\r\n     * @private\r\n     * @type {IRawResponse}\r\n     * @memberOf Response\r\n     */\r\n    private __response;\r\n    /**\r\n     * Cache used for the link requests\r\n     *\r\n     * @private\r\n     * @type {IDictionary<Promise<Response>>}\r\n     * @memberOf Response\r\n     */\r\n    private __cache;\r\n    constructor(response: IRawResponse, collection?: IJsonapiCollection, options?: IRequestOptions, overrideData?: T | Array<T>);\r\n    /**\r\n     * Replace the response record with a different record. Used to replace a record while keeping the same reference\r\n     *\r\n     * @param {PureModel} data New data\r\n     * @returns {Response}\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    replaceData(data: T): Response<T>;\r\n    /**\r\n     * Function called when a link is being fetched. The returned value is cached\r\n     *\r\n     * @private\r\n     * @param {any} name Link name\r\n     * @returns Promise that resolves with a Response object\r\n     *\r\n     * @memberOf Response\r\n     */\r\n    private __fetchLink(name);\r\n}\r\n"}}
